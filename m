From: Eric Sunshine <sunshine@sunshineco.com>
Subject: Re: [PATCH v3 2/4] generate-cmdlist.sh: parse common command groups
Date: Sun, 3 May 2015 16:40:53 -0400
Message-ID: <CAPig+cSRiw7QeAzuxAJF8mikeK1YiNoNATKzMz71L8E29LLp4Q@mail.gmail.com>
References: <554405D5.9080702@gmail.com>
	<55456990.6000509@gmail.com>
	<55456A40.80806@gmail.com>
	<xmqqpp6hv94x.fsf@gitster.dls.corp.google.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: QUOTED-PRINTABLE
Cc: =?UTF-8?Q?S=C3=A9bastien_Guimmara?= <sebastien.guimmara@gmail.com>,
	Git List <git@vger.kernel.org>,
	Luke Diamand <luke@diamand.org>,
	Andreas Schwab <schwab@linux-m68k.org>
To: Junio C Hamano <gitster@pobox.com>
X-From: git-owner@vger.kernel.org Sun May 03 22:41:03 2015
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git-2@plane.gmane.org
Received: from vger.kernel.org ([209.132.180.67])
	by plane.gmane.org with esmtp (Exim 4.69)
	(envelope-from <git-owner@vger.kernel.org>)
	id 1Yp0hA-0006Px-9g
	for gcvg-git-2@plane.gmane.org; Sun, 03 May 2015 22:41:00 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1751634AbbECUk4 convert rfc822-to-quoted-printable (ORCPT
	<rfc822;gcvg-git-2@m.gmane.org>); Sun, 3 May 2015 16:40:56 -0400
Received: from mail-ig0-f172.google.com ([209.85.213.172]:36116 "EHLO
	mail-ig0-f172.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1751007AbbECUky convert rfc822-to-8bit (ORCPT
	<rfc822;git@vger.kernel.org>); Sun, 3 May 2015 16:40:54 -0400
Received: by igblo3 with SMTP id lo3so70730324igb.1
        for <git@vger.kernel.org>; Sun, 03 May 2015 13:40:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20120113;
        h=mime-version:sender:in-reply-to:references:date:message-id:subject
         :from:to:cc:content-type:content-transfer-encoding;
        bh=42hYzG1mFrcAli+gsOY6hQHQ56mrMvK3vBVZB6tkmv4=;
        b=CgI/EMX5P8Bc/DvHB0RHBgGfbrsFKL1hqS2PdvCqzXYN3QuBVZocJRvNmRBWeNPnQG
         z2A+JaDKO2vkPdNUhDwSMzKtTmBie/nyiFmNzR3e6VY+vUeGdEhRcVqfYSWvfJeB/gl/
         6AZL4dQ2AvAZezwXF5W/aAQ3ANIkk/mQX86VUH3k3JV/4Evtu8gsgUvtJaEVpizZiFla
         L4wWl25ddBjyL7n7JmhynwdCCyvVWVhYFZ107VasJp49LLbCalNv20lMAQPNn4LhelH0
         sd94kLVH4QgnX4/RPsdwDRWrbmY/DWUqiGCHjNNp+tTmqCaOnVNUP/WOLA646nYeWnl5
         WyzQ==
X-Received: by 10.42.207.206 with SMTP id fz14mr25061236icb.34.1430685653936;
 Sun, 03 May 2015 13:40:53 -0700 (PDT)
Received: by 10.107.28.132 with HTTP; Sun, 3 May 2015 13:40:53 -0700 (PDT)
In-Reply-To: <xmqqpp6hv94x.fsf@gitster.dls.corp.google.com>
X-Google-Sender-Auth: 0icR-6OwZ1cYQkqJCdigN7GmOo0
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/268291>

On Sun, May 3, 2015 at 1:55 PM, Junio C Hamano <gitster@pobox.com> wrot=
e:
> S=C3=A9bastien Guimmara  <sebastien.guimmara@gmail.com> writes:
>
>> Teach generate-cmdlist.sh to parse common command groups
>> found in command-list.txt in the form
>>
>> common-3_worktree ('3_worktree' being the group identifier)
>>
>> Extract the $grp variable, in addition to the previous $cmd,
>> and inject it as a third field in the cmdname_help struct:
>>
>> {"add", N_("Add file contents to the index"), "3_worktree"},
>>
>> So that when 'git' is called, we can display common commands
>> grouped by theme instead of a less useful alphabetical order.
>>
>> Reviewed by: Luke Diamand <luke@diamand.org>
>> Reviewed by: Andreas Schwab <schwab@linux-m68k.org>
>
> These people may have helped you to polish your earlier round to
> come up with this version, but I do not think they should be listed
> as reviewed-by (in the sense that they would say "Yes, I read this
> version and consider it very good--I endorse the change!") yet.

Minor addendum: If you'd like to acknowledge Luke for $(...) and
Andreas for IFS munging, then Helped-by: would be appropriate (and
doesn't require their consent).

More below.

>> Signed-off-by: S=C3=A9bastien Guimmara <sebastien.guimmara@gmail.com=
>
>> ---
>> diff --git a/generate-cmdlist.sh b/generate-cmdlist.sh
>> index 9a4c9b9..98f937b 100755
>> --- a/generate-cmdlist.sh
>> +++ b/generate-cmdlist.sh
>> @@ -4,19 +4,20 @@ echo "/* Automatically generated by $0 */
>>  struct cmdname_help {
>>      char name[16];
>>      char help[80];
>> +    char group[20];
>
> Storing group name in duplicated text for all commands and then
> using string comparison at runtime is grossly wasteful, don't you
> think, especially when the list is not manually maintained?
>
> command-list.txt is something manually maintained, i.e. the source,
> and it makes sense to use easy-to-see strings like "3_worktree"
> label there instead of cryptic number, but the whole point of this
> script is to pre-process that text into .c file to a form that is
> more suited for machine consumption.  I think this script should:
>
>  - read command list once to make the list of groups in a new
>    separate array;
>
>  - add the group as an "unsigned char group_number" (as we won't
>    have more than 200 groups) field to this struct;
>
>  - read command list again and for each command give the group
>    number here.
>
> or something like that.

Some additional observations:

The "common-N_group" form seems both redundant and unsightly.
Redundant because you could just as easily pluck out 'common' lines by
searching for "N_group", thus making the "common-" prefix unnecessary.
Unsightly because the mix of "-" and "_" is hard to read. (In general,
"-" is easier to read, thus probably a better choice.)

Thinking out loud, without regard to implementation complexity...

I might expect to see the table of groups to be declared first, in the
order that they should be displayed by "git help". Having the groups
in their own table also allows you to give them human-readable
descriptions. For actual use, you'd tag each command with the bare
group name.

So, something like this, perhaps:

    [groups]
    init    starting a working area
    info    examining history and state
    ...
    branching    branching and merging histories

    [commands]
    git-branch    mainporcelain branching
    ...
    git-clone    mainporcelain init
    ...

This way, the 'N' in "N_group" is unnecessary since presentation order
is implied by the [groups] table, and you don't need the "common-"
prefix anymore since any command having an attribute from the [groups]
table is automatically considered common.
