Return-Path: <git-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on dcvr.yhbt.net
X-Spam-Level: 
X-Spam-ASN: AS31976 209.132.180.0/23
X-Spam-Status: No, score=-3.4 required=3.0 tests=AWL,BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FORGED_FROMDOMAIN,FREEMAIL_FROM,
	FROM_EXCESS_BASE64,HEADER_FROM_DIFFERENT_DOMAINS,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI shortcircuit=no autolearn=ham autolearn_force=no
	version=3.4.2
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by dcvr.yhbt.net (Postfix) with ESMTP id 10FF01F453
	for <e@80x24.org>; Sat,  2 Feb 2019 00:41:53 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726477AbfBBAlv (ORCPT <rfc822;e@80x24.org>);
        Fri, 1 Feb 2019 19:41:51 -0500
Received: from mail-wr1-f67.google.com ([209.85.221.67]:45716 "EHLO
        mail-wr1-f67.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1725915AbfBBAlv (ORCPT <rfc822;git@vger.kernel.org>);
        Fri, 1 Feb 2019 19:41:51 -0500
Received: by mail-wr1-f67.google.com with SMTP id t6so8857140wrr.12
        for <git@vger.kernel.org>; Fri, 01 Feb 2019 16:41:49 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=date:from:to:cc:subject:message-id:references:mime-version
         :content-disposition:in-reply-to:user-agent;
        bh=+Z/6Q3b+FE7JmLbpCPH9BJtXUs0GL8978vF7JkaTdyM=;
        b=mqc1iF3yj6P9i60Yqd1cOcZjfowiFSLflgWQf4WCFElTc86pGehCnK0/1CKOz0amj8
         mIw0HA+RfFYMavjEj95dek2nLaue7+tOKNsDhMAHbdbJr3hQuykojyde5yQJJQw6K+Bc
         aQPCTKy8HXDT1Yy7YQOXXEkNTHWNBf2VpGUPYRTRRdcl9yr9sbTW0HeUuvs6PbUsM30e
         ckWzPBrrg6CBEG/4uI+EOjstiXrBM4cNQQlcbXw5AQ8snV+TLRHDUB8EIzWJCDAMeHkQ
         01DKq6544xX69seagi3vulJglscODE+NJcQZrihikYT4xwjVxO0qWIlTFmL7J6rpFP9a
         663g==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:date:from:to:cc:subject:message-id:references
         :mime-version:content-disposition:in-reply-to:user-agent;
        bh=+Z/6Q3b+FE7JmLbpCPH9BJtXUs0GL8978vF7JkaTdyM=;
        b=RZsrycG1CTXNvcv7Oqvg4+hd2V6XTevq39HxQynBJ27uWPVqxl8+8vPXPcFLfdEtj6
         AK3EZGgqiESSvSOQs4ypy+3rklmcfpRm4EqdRq+rSV2KQjlKhU+fzx9WQc4BzRwDFmqr
         44P2aa22pijRUR7WWdPNQhCCNElU8RyIZq3KiJ/qoFshb9/Dm6xdscOLFFOOK3YWMvm5
         rfCZMYTvI7wsrLSTl60Wiiknlv2MF9GPUgR6Mn10GnI3NO49MQzPgJjm2AVw9Bw/sMbh
         Re4z+vo3WCvNmLvSFIX0BRw0xBIu6hoJ5qyMZ8++dZ3CH7QPupd1QUZdqPvsHlCES36Z
         yy4Q==
X-Gm-Message-State: AJcUukcW4OBv3k0TNF58vmKmJgUZNh958jZAqLd4Su5f6tCgWWr/gWBh
        q8nJEBPP5EzweIVVcO04w4g=
X-Google-Smtp-Source: ALg8bN6AM788FCh9DjYsxIv2eo6PWAo2bBd2G6+sJAprUTsU9vayw/5VRuqkmr4L7y0APb2g7tVa+g==
X-Received: by 2002:adf:f009:: with SMTP id j9mr39987639wro.170.1549068109116;
        Fri, 01 Feb 2019 16:41:49 -0800 (PST)
Received: from szeder.dev (x4db56e67.dyn.telefonica.de. [77.181.110.103])
        by smtp.gmail.com with ESMTPSA id a132sm6675649wmh.5.2019.02.01.16.41.47
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Fri, 01 Feb 2019 16:41:48 -0800 (PST)
Date:   Sat, 2 Feb 2019 01:41:45 +0100
From:   SZEDER =?utf-8?B?R8OhYm9y?= <szeder.dev@gmail.com>
To:     Ramsay Jones <ramsay@ramsayjones.plus.com>
Cc:     Junio C Hamano <gitster@pobox.com>,
        Johannes Schindelin <Johannes.Schindelin@gmx.de>,
        GIT Mailing-list <git@vger.kernel.org>,
        Luc Van Oostenryck <luc.vanoostenryck@gmail.com>
Subject: Re: [PATCH 0/1] Using sparse in a CI job
Message-ID: <20190202004145.GE10587@szeder.dev>
References: <78f85f0b-176f-0b54-2ec8-4c13fd386733@ramsayjones.plus.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
In-Reply-To: <78f85f0b-176f-0b54-2ec8-4c13fd386733@ramsayjones.plus.com>
User-Agent: Mutt/1.5.24 (2015-08-30)
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

On Fri, Feb 01, 2019 at 09:01:20PM +0000, Ramsay Jones wrote:
> I suspect that the Makefile sparse target is not easy to use in a CI
> job, since the 'sparse' program (via cgcc -no-compile) does not exit
> with a non-zero value, even when issuing errors and warnings.

We had the same issue with Coccinelle in the static analysis build job
on Travis CI, which was happily succeeding even when Coccinelle
noticed undesired code patterns entering the codebase.  We've dealt
with that by looking at the patch files generated by 'make
coccicheck': if they were empty, then all is well, if they are not,
then dump their contents into the log and 'exit 1'.  See 0860a7641b
(travis-ci: fail if Coccinelle static analysis found something to
transform, 2018-07-23).

I think we could do something like that with sparse as well.

> At the moment, on Linux, the sp-out file is free from any sparse errors
> or warnings. So are next and pu:
> 
>   $ grep error sp-out
>   $ grep warning sp-out

On 'master' I get:

  $ grep error sp-out 
  $ grep warning sp-out 
  connect.c:652:40: warning: incorrect type in argument 2 (invalid types)
  pack-revindex.c:65:23: warning: memset with byte count of 262144
  unix-socket.c:83:26: warning: incorrect type in argument 2 (invalid types)
  unix-socket.c:108:23: warning: incorrect type in argument 2 (invalid types)
  daemon.c:1041:36: warning: incorrect type in argument 2 (invalid types)
  daemon.c:1184:67: warning: incorrect type in argument 2 (invalid types)
  imap-send.c:1022:42: warning: incorrect type in argument 2 (invalid types)
  credential-cache--daemon.c:180:37: warning: incorrect type in argument 2 (invalid types)
  $ sparse --version
  v0.5.0

