From: Johannes Schindelin <johannes.schindelin@gmx.de>
Subject: [PATCH 1/4] config --show-origin: report paths with forward
 slashes
Date: Tue, 22 Mar 2016 18:42:40 +0100 (CET)
Message-ID: <8beb1c208e33e1de8f272caa22fb7a0b662ca4cc.1458668543.git.johannes.schindelin@gmx.de>
References: <cover.1458668543.git.johannes.schindelin@gmx.de>
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Cc: git@vger.kernel.org, Lars Schneider <larsxschneider@gmail.com>,
	Johannes Sixt <j6t@kdbg.org>,
	Kazutoshi SATODA <k_satoda@f2.dion.ne.jp>,
	Eric Wong <normalperson@yhbt.net>
To: Junio C Hamano <gitster@pobox.com>
X-From: git-owner@vger.kernel.org Tue Mar 22 18:43:09 2016
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git-2@plane.gmane.org
Received: from vger.kernel.org ([209.132.180.67])
	by plane.gmane.org with esmtp (Exim 4.69)
	(envelope-from <git-owner@vger.kernel.org>)
	id 1aiQKi-0003FW-ME
	for gcvg-git-2@plane.gmane.org; Tue, 22 Mar 2016 18:43:09 +0100
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1755656AbcCVRnD (ORCPT <rfc822;gcvg-git-2@m.gmane.org>);
	Tue, 22 Mar 2016 13:43:03 -0400
Received: from mout.gmx.net ([212.227.17.20]:64549 "EHLO mout.gmx.net"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S1755205AbcCVRnB (ORCPT <rfc822;git@vger.kernel.org>);
	Tue, 22 Mar 2016 13:43:01 -0400
Received: from virtualbox ([37.24.143.127]) by mail.gmx.com (mrgmx102) with
 ESMTPSA (Nemesis) id 0LnDof-1a7jj72z2z-00hK5t; Tue, 22 Mar 2016 18:42:44
 +0100
X-X-Sender: virtualbox@virtualbox
In-Reply-To: <cover.1458668543.git.johannes.schindelin@gmx.de>
User-Agent: Alpine 2.20 (DEB 67 2015-01-07)
X-Provags-ID: V03:K0:7lvLbofF6Yr4bPq7sPxBij4ni9NSM+DYXezD28Um4PoWyOLXGN/
 vJIVA/ACaJvugpFaaI/eUdrCn+Hsp9LSK/TzUSbh5vzsLVpvbBkdPEDwLgATxG4Z+3OPhRw
 fxB+u3jKpEuZMhb/rkFUHMu506IeXDMg3FXn4LHXEVx5qrOMqaCxbT0pipfBky7hO3wJla8
 weQk/OMlh65gzJG9wssew==
X-UI-Out-Filterresults: notjunk:1;V01:K0:LdqZqPF98/o=:0GSDQEk9KCgBM9QkFjHEAd
 qPfn61zKgofnaMZ/04Drz6UvKiabmwSLVLwu7LALePxULI0GOROxXpWUO96Gfp65W7zjus2NX
 Gz8MahiEqYTMJvrgNcMdeOLIndzNSaBeDCsiqm0uFP6QabePy4GLoM0HP/4cOE14xQ99rQ0jw
 VSSxwfckUbHGwpD9oiv5kXIcN7ZIr1FyzeqyA5VjD5dCKoYaITeTKhhsmNQT3Bb6pERrqFMa9
 bot7DxqS/7tnHDeGk/j2pTacO/+9qM32EKfLHxejnIPS+D3RiTMq7wwLWNvIukRkJrJCeTGNI
 0+NMiN+nyOmvHD4PNpLClloF3aGf03Xvn9vELX4qRn4bJRIj8JsGff8lFiKxT4QBvJxcgWvHp
 m53ZoKz0VtJE70gnLbXR7S8mO9ixMQSZDpbLcsijJWRLhPTMGKsIjLamty70XIKJO935XABfd
 V5rQLiMyFRHY+fa6Yi32hXpzqmRgo03ZZfTMQEc+cQBKto2ZiesV3tgFOM6vl52lxDOadY33U
 LpY1+zkfzlx57D5gjaGea3T2HYtLeGfZVZ3NZ10VpkJ/+TMvjSP6YqYRHoF2hnpejTe5rvH4r
 kJtR8kwrUFdKsuOuX3OXmp/uSKs9EH55l/DdDWcPJJACxr6AKiS9birfxG4ocH3TsTzNATnnP
 wQ1kM/E6HHsyIkA9Ti/Jfk/ICQBzIRQg/+A1EOMLMfjNWSpz5jErinTpJr4R7Ed8am9MLMpyP
 m2d932qgR+SQI9fAeKOr6bzyrQclxK9qhR2Fm61Tdyt6z3q9khR8qvbkoedsYIxVR8Y5inKM 
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/289522>

On Windows, the backslash is the native directory separator, but all
supported Windows versions also accept the forward slash in most
circumstances.

Our tests expect forward slashes.

Relative paths are generated by Git using forward slashes.

So let's try to be consistent and use forward slashes in the $HOME part
of the paths reported by `git config --show-origin`, too.

Signed-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>
---
 compat/mingw.h | 6 ++++++
 path.c         | 3 +++
 2 files changed, 9 insertions(+)

diff --git a/compat/mingw.h b/compat/mingw.h
index 8c5bf50..c008694 100644
--- a/compat/mingw.h
+++ b/compat/mingw.h
@@ -396,6 +396,12 @@ static inline char *mingw_find_last_dir_sep(const char *path)
 			ret = (char *)path;
 	return ret;
 }
+static inline void convert_slashes(char *path)
+{
+	for (; *path; path++)
+		if (*path == '\\')
+			*path = '/';
+}
 #define find_last_dir_sep mingw_find_last_dir_sep
 int mingw_offset_1st_component(const char *path);
 #define offset_1st_component mingw_offset_1st_component
diff --git a/path.c b/path.c
index 8b7e168..969b494 100644
--- a/path.c
+++ b/path.c
@@ -584,6 +584,9 @@ char *expand_user_path(const char *path)
 			if (!home)
 				goto return_null;
 			strbuf_addstr(&user_path, home);
+#ifdef GIT_WINDOWS_NATIVE
+			convert_slashes(user_path.buf);
+#endif
 		} else {
 			struct passwd *pw = getpw_str(username, username_len);
 			if (!pw)
-- 
2.7.4.windows.1
