Return-Path: <SRS0=FNL0=6A=vger.kernel.org=git-owner@kernel.org>
Received: from mail.kernel.org (mail.kernel.org [198.145.29.99])
	by smtp.lore.kernel.org (Postfix) with ESMTP id D402CC2BB55
	for <git@archiver.kernel.org>; Thu, 16 Apr 2020 16:54:51 +0000 (UTC)
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.kernel.org (Postfix) with ESMTP id 5DEF02076D
	for <git@archiver.kernel.org>; Thu, 16 Apr 2020 16:54:51 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1729945AbgDPQyt (ORCPT <rfc822;git@archiver.kernel.org>);
        Thu, 16 Apr 2020 12:54:49 -0400
Received: from hosting01.xaranet.de ([192.162.85.201]:46067 "EHLO
        hosting01.xaranet.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1730006AbgDPQyn (ORCPT <rfc822;git@vger.kernel.org>);
        Thu, 16 Apr 2020 12:54:43 -0400
X-Greylist: delayed 509 seconds by postgrey-1.27 at vger.kernel.org; Thu, 16 Apr 2020 12:52:15 EDT
Received: from [192.168.178.20] (p57AF92DF.dip0.t-ipconnect.de [87.175.146.223])
        by hosting01.xaranet.de (Postfix) with ESMTPSA id 6BB14C0
        for <git@vger.kernel.org>; Thu, 16 Apr 2020 18:43:41 +0200 (CEST)
Authentication-Results: hosting01.xaranet.de;
        spf=pass (sender IP is 87.175.146.223) smtp.mailfrom=guy.j@maurel.de smtp.helo=[192.168.178.20]
Received-SPF: pass (hosting01.xaranet.de: connection is authenticated)
To:     git@vger.kernel.org
From:   Guy Maurel <guy.j@maurel.de>
Subject: a problem with git diff
Autocrypt: addr=guy.j@maurel.de; prefer-encrypt=mutual; keydata=
 xsFNBFULFngBEADELpLj7bA7xsuIKROJqp7q+7iPJOMZSyNFedHwQ1MCAH5NDERNig8Ky0UT
 s2MSbe1oK0PHoGRH8mUwh2LpHBBxNZROlSr58Y0UW7czSHumGWr/t0IbM4kUvvimEXfVvjQq
 c3zRYLUyhGZrJtdZgIu5ZgfR7rQWKOkLsVVs2LDGaRxExqM8Q40smVJADEwIyecH/ICkYqsl
 wQ+0j71aFjORTauwtXtwCGU5Cu11a6Ld6JFJpG+r5R/DrXDXbP8dHJQw4K2ERIvhATgvIZmX
 hUjLgRYmH0Nx+vGpGZkctfT0pOycrnBZyaD0lP4Bxg6IqFKufk9UUfN7+OhSUJPokngNAtNh
 I2VhLvZ36ag/ec6h/2/Qmwa1VAr6NJz+aL5y2nb9GCmrTfNawP3C5LfAdYoCtKIPB5dbP43G
 yCBo4wGgU/7qJ/bGRLkdrp6Kxqn4SO5FMqrCSnbVTD5naxwwINTCGfPv/qE81FbLM+7YFA/z
 EeInJlTTbnmEd5nw3L9ZBMQrD78zIRMGWi0rkeF1NvMjdD6JN06iuT7yeBLtp1HLpT79bsDA
 JqZqmmnqM+NbYrB5rO+fJGdKmA359wJ62+Jr5zhx1WJ0HjYBR+Ioz32hgBLe0LPJh9HyHx40
 +snnubTI2gUYTHz9x1JL0vWmhpIrifO2VmAa+jWrZe6Fr5hX4QARAQABzRxHdXkgTWF1cmVs
 IDxndXkuakBtYXVyZWwuZGU+wsGrBBMBCAA+AhsjBQsJCAcCBhUICQoLAgQWAgMBAh4BAheA
 FiEEHg3x692piv7cWK8TQwqwpdKHhxMFAl5L7gkFCQsiCxEAIQkQQwqwpdKHhxMWIQQeDfHr
 3amK/txYrxNDCrCl0oeHE956D/45qbOzFXPs2MSTf8zSYwF2PJ3LQSOh4IFVtGaAS0oHkXiQ
 mDdB1UCj3m0dV3FxlEsOJIa1cEJVB3gNUZvReHNS/ZKm+eBAkQVRhibxc0JYZuW9HKkoYY6a
 ExV5pHQlBv3Yn6k/svRKogGD2eRp62S0pyQx+MwHM/7wF05IdI6FszIS1i4SPGN7nMPniiO9
 SmRCCyNmCsrByOd+CksNWd1w0osQzyv7IA4xQ2rLp0kF7b5hBz3p/tvnensKKJS/c9IHlGFo
 Ysqmh3Ot29pYdRn533F9KisHMaW+OMlAPIEIkeBunAOwde5ICKfuh6mYY0sfOfWsZnrHOeJy
 r65VSIQ19HdOgEr+/x1v4C2ZQSaGcxQhlU1VFwnHonmI0ASueV+dt+K75aOrAhAq+wdYStha
 eU5KPxWIrHRuq1eYdyPqCClAKeEfmjx1mENpzEDhurL+SKvf1GGnX3bELuIzFOAr9JUTwzkD
 NO9L1ZFVQ+F6Db10G4e61VDXN7j7CKubnIzc6cnh8/N4W/b5cyAamL+tpUak/yvB6SAxddzt
 4rg4CEBBYpObgKhKKeINZJ7uB22HEldEXA1rhkVtM4NLyL+0Tz0f5k5ZlAFdyx0oqhsqC4ad
 N2HMUjr2OfhdJixg8cfGRQeMxLSVYJdpQ543bOm9f02DDJ6y2sjgCHuhPDfahc7BTQRVCxZ4
 ARAAvTaVw6Ipa58hn8ZZsrIHhr4hQLNKuk/KTBQ+Buv/WV7R9JAHNUBRMNDI3IZih9OWtdap
 praak7npjW2bw39vDOALZGy62gATLyVdTJNbIrL+p9CT9Xvz6ohI2G4/7iCI0zZ+PZuoNeqq
 LJuNV9ELssDp3jHBpGUbAwiKDc77cpiwvKTyyIezapbLvEqqrMzsevTuiyfuHmKKsLDGW2Aq
 rvLFn98zwTXAp9Vva0qwq0TDpNyrQuRpVc1QleOWmhCnPzZx8izR7GEkshc2E8gTxPNQu893
 uFWnxBT86Q/8mIT6CTtyJ6aYen1pa9oF11o4v8asRagxzElSNSkqHVCnaABcG0yNX6XbvsXI
 QBuX089h4GTzpLRnkHC8+XrLMsoFc5Y5uLWqSZKlnj3KGMWoYGJc1xQGP88Jm875dCRmaLtd
 q2VPCosuZazNvJ797h8PptsQm5HO37w6hL1OJwl3wKJRoHws/0XXayotJpAYL81PjhqdxRAv
 omTOmC0X9aJeaSxRE+SnKcMGa2ZjFMW30Iz9+wpnogQfTjkAt9v5slCbYUiUxugAQgTLtXJk
 CGx/046+DbblNvx5v62G5bsV4Hy+bFXcp2z2SPdIxyAnC+aKXE/cXCts2KdD9y1lYxWXAtKW
 AVWaKicgTAlXA+mBd7iM8P3nhyuy6B8wjEJElGsAEQEAAcLBkwQYAQgAJgIbDBYhBB4N8evd
 qYr+3FivE0MKsKXSh4cTBQJeS+4TBQkLIgsbACEJEEMKsKXSh4cTFiEEHg3x692piv7cWK8T
 QwqwpdKHhxPLvQ//UktTCNssQy6y3k2EECQGIGsnir0WSA0gLRnguWL9UfcpqEdM/aTHBO0t
 vWXfyaFUITdffP4XQJis1RttGgCe92CEOC4isS7c4z3ocTaUrslR3fclI5HMJ3ptXK1Lq+q/
 +yeqTl6rdESMu8Hdqnxk6m7zPPZuhyqq9r6imJVTeg8Sc6sERv46LHOtf5BgYp9wT0LprfWA
 Hg4/zWAi/XFGB7xsOo7lkiKtfI9E7270TcLgkdnx2KY0n1xlkaiNjPCIq5bLUMQ444mq0XIr
 A7CJ1B7BRgW70Km32IciXxQ5JwUYn3W+WVPJFBE/uTPnrlFTvu7lgrX2qr/jT/510CG2CfEg
 RZhxOzcXu+zpQqhNfQFN0qgOV0ch9YlI6g+ncGNNEw9IFXP6d0P7x0JEGGB471DVCLXumEW1
 uurVfDNYM/BfcGGFxPkETV+f4gbsC0TDbC8Oe0pZ9diZu8WRy7vGNUkqpi6w+o1yq4eCY5T/
 SWhtx9l+ePWQuLk7W89t9h0GxfsIv5qvJ1OFUU3098TRjyXutJrzIL61LJKBgSi0hHOoMvQM
 8Q7BBQlK+AOT2u/6ohPe7/aDvrdIefEpes0vAmXy4WGrkzfynxEhaTnz/Ebut6ltqcuZozKX
 esU8gjENZrh9ropU6IMP2PRmmBmJ2VR3o82BLh4OR3CNrQrUoqY=
Message-ID: <65cbee30-fa37-1422-98f2-2c2b5aa094bd@maurel.de>
Date:   Thu, 16 Apr 2020 18:43:40 +0200
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101
 Thunderbird/68.4.1
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="------------E0C971C11DC220B22925FC86"
Content-Language: de-DE
X-PPP-Message-ID: <158705542433.20010.12331618229795076758@hosting01.xaranet.de>
X-PPP-Vhost: maurel.de
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

This is a multi-part message in MIME format.
--------------E0C971C11DC220B22925FC86
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: 7bit

Hello!

Using the appended two files:
  git diff combine.cpp-2020-04-16-A combine.cpp-2020-04-16-R > git-diff.diff-Y

doesn't show the same differences as with:
  meld combine.cpp-2020-04-16-R combine.cpp-2020-04-16-A

Have a look at git-diff.diff-Y at line 210:
-static void process_returns(void)
+static void mark_lvalue(chunk_t *pc)

which is NOT correct.

What is to do?
Thanks
-- 
Guy Maurel
Sebastian-Fischer-Weg 13
89077 Ulm

--------------E0C971C11DC220B22925FC86
Content-Type: text/plain; charset=UTF-8;
 name="combine.cpp-2020-04-16-A"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="combine.cpp-2020-04-16-A"

LyoqCiAqIEBmaWxlIGNvbWJpbmUuY3BwCiAqIExhYmVscyB0aGUgY2h1bmtzIGFzIG5lZWRl
ZC4KICoKICogQGF1dGhvciAgQmVuIEdhcmRuZXIKICogQGF1dGhvciAgR3V5IE1hdXJlbCBz
aW5jZSB2ZXJzaW9uIDAuNjIgZm9yIHVuY3J1c3RpZnk0UXQKICogICAgICAgICAgT2N0b2Jl
ciAyMDE1LCAyMDE2CiAqIEBsaWNlbnNlIEdQTCB2MisKICovCgojaW5jbHVkZSAiY29tYmlu
ZS5oIgoKI2luY2x1ZGUgImNodW5rX2xpc3QuaCIKI2luY2x1ZGUgImNvbWJpbmVfbGFiZWxz
LmgiCiNpbmNsdWRlICJDaHVua1N0YWNrLmgiCiNpbmNsdWRlICJlcnJvcl90eXBlcy5oIgoj
aW5jbHVkZSAiZmxhZ19wYXJlbnMuaCIKI2luY2x1ZGUgImxhbmdfcGF3bi5oIgojaW5jbHVk
ZSAibGFuZ3VhZ2VfdG9vbHMuaCIKI2luY2x1ZGUgImxvZ19ydWxlcy5oIgojaW5jbHVkZSAi
bmV3bGluZXMuaCIKI2luY2x1ZGUgInByb3RvdHlwZXMuaCIKI2luY2x1ZGUgInRva2VuaXpl
X2NsZWFudXAuaCIKI2luY2x1ZGUgInVuY19jdHlwZS5oIgojaW5jbHVkZSAidW5jcnVzdGlm
eS5oIgojaW5jbHVkZSAidW5jcnVzdGlmeV90eXBlcy5oIgoKI2luY2x1ZGUgPGNhc3NlcnQ+
CiNpbmNsdWRlIDxjc3RkaW8+CiNpbmNsdWRlIDxjc3RkbGliPgojaW5jbHVkZSA8bGltaXRz
PgojaW5jbHVkZSA8bWFwPgoKdXNpbmcgbmFtZXNwYWNlIHN0ZDsKdXNpbmcgbmFtZXNwYWNl
IHVuY3J1c3RpZnk7CgoKLyoqCiAqIE1hcmsgdGhlIHBhcmVucyBhbmQgY29sb25zIGluOgog
KiAgIGFzbSB2b2xhdGlsZSAoICJ4eCIgOiAieHgiIChsKSwgInl5IihoKSA6IC4uLiAgKTsK
ICoKICogQHBhcmFtIHBjICB0aGUgQ1RfQVNNIGl0ZW0KICovCnN0YXRpYyB2b2lkIGZsYWdf
YXNtKGNodW5rX3QgKnBjKTsKCgovKioKICogQ29tYmluZXMgdHdvIHRva2VucyBpbnRvIHt7
IGFuZCB9fSBpZiBpbnNpZGUgcGFyZW5zIGFuZCBub3RoaW5nIGlzIGJldHdlZW4KICogZWl0
aGVyIHBhaXIuCiAqLwpzdGF0aWMgdm9pZCBjaGVja19kb3VibGVfYnJhY2VfaW5pdChjaHVu
a190ICpibzEpOwoKCi8qKgogKiBXZSBhcmUgb24gYSB0eXBlZGVmLgogKiBJZiB0aGUgbmV4
dCB3b3JkIGlzIG5vdCBlbnVtL3VuaW9uL3N0cnVjdCwgdGhlbiB0aGUgbGFzdCB3b3JkIGJl
Zm9yZSB0aGUKICogbmV4dCAnLCcgb3IgJzsnIG9yICdfX2F0dHJpYnV0ZV9fJyBpcyBhIHR5
cGUuCiAqCiAqIHR5cGVkZWYgW3R5cGUuLi5dIFsqXSB0eXBlIFssIFsqXXR5cGVdIDsKICog
dHlwZWRlZiA8cmV0dXJuIHR5cGU+KFsqXWZ1bmMpKCk7CiAqIHR5cGVkZWYgPHJldHVybiB0
eXBlPihbKl1mdW5jKShwYXJhbXMpOwogKiB0eXBlZGVmIDxyZXR1cm4gdHlwZT4oX19zdGRj
YWxsICpmdW5jKSgpOyBCdWcgIyA2MzMgICAgTVMtc3BlY2lmaWMgZXh0ZW5zaW9uCiAqICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGUgdGhlIGNv
bmZpZy1maWxlICJ0ZXN0L2NvbmZpZy9NUy1jYWxsaW5nX2NvbnZlbnRpb25zLmNmZyIKICog
dHlwZWRlZiA8cmV0dXJuIHR5cGU+ZnVuYyhwYXJhbXMpOwogKiB0eXBlZGVmIDxlbnVtL3N0
cnVjdC91bmlvbj4gW3R5cGVdIFsqXSB0eXBlIFssIFsqXXR5cGVdIDsKICogdHlwZWRlZiA8
ZW51bS9zdHJ1Y3QvdW5pb24+IFt0eXBlXSB7IC4uLiB9IFsqXSB0eXBlIFssIFsqXXR5cGVd
IDsKICovCnN0YXRpYyB2b2lkIGZpeF90eXBlZGVmKGNodW5rX3QgKnBjKTsKCgovKioKICog
V2UgYXJlIG9uIGFuIGVudW0vc3RydWN0L3VuaW9uIHRhZyB0aGF0IGlzIE5PVCBpbnNpZGUg
YSB0eXBlZGVmLgogKiBJZiB0aGVyZSBpcyBhIHsuLi59IGFuZCB3b3JkcyBiZWZvcmUgdGhl
ICc7JywgdGhlbiB0aGV5IGFyZSB2YXJpYWJsZXMuCiAqCiAqIHRhZyB7IC4uLiB9IFsqXSB3
b3JkIFssIFsqXXdvcmRdIDsKICogdGFnIFt3b3JkL3R5cGVdIHsgLi4uIH0gWypdIHdvcmQg
WywgWypdd29yZF0gOwogKiBlbnVtIFt3b3JkL3R5cGUgWzogaW50X3R5cGVdXSB7IC4uLiB9
IFsqXSB3b3JkIFssIFsqXXdvcmRdIDsKICogdGFnIFt3b3JkL3R5cGVdIFt3b3JkXTsgLS0g
dGhpcyBnZXRzIGNhdWdodCBsYXRlci4KICogZmNuKHRhZyBbd29yZC90eXBlXSBbd29yZF0p
CiAqIGEgPSAodGFnIFt3b3JkL3R5cGVdIFsqXSkmYjsKICoKICogUkVWSVNJVDogc2hvdWxk
IHRoaXMgYmUgY29uc29saWRhdGVkIHdpdGggdGhlIHR5cGVkZWYgY29kZT8KICovCnN0YXRp
YyB2b2lkIGZpeF9lbnVtX3N0cnVjdF91bmlvbihjaHVua190ICpwYyk7CgoKLyoqCiAqIENo
ZWNrcyB0byBzZWUgaWYgdGhlIGN1cnJlbnQgcGFyZW4gaXMgcGFydCBvZiBhIGNhc3QuCiAq
IFdlIGFscmVhZHkgdmVyaWZpZWQgdGhhdCB0aGlzIGRvZXNuJ3QgZm9sbG93IGZ1bmN0aW9u
LCBUWVBFLCBJRiwgRk9SLAogKiBTV0lUQ0gsIG9yIFdISUxFIGFuZCBpcyBmb2xsb3dlZCBi
eSBXT1JELCBUWVBFLCBTVFJVQ1QsIEVOVU0sIG9yIFVOSU9OLgogKgogKiBAcGFyYW0gc3Rh
cnQgIFBvaW50ZXIgdG8gdGhlIG9wZW4gcGFyZW4KICovCnN0YXRpYyB2b2lkIGZpeF9jYXN0
cyhjaHVua190ICpwYyk7CgoKLyoqCiAqIENUX1RZUEVfQ0FTVCBmb2xsb3dzIHRoaXMgcGF0
dGVybjoKICogZHluYW1pY19jYXN0PC4uLj4oLi4uKQogKgogKiBNYXJrIGV2ZXJ5dGhpbmcg
YmV0d2VlbiB0aGUgPD4gYXMgYSB0eXBlIGFuZCBzZXQgdGhlIHBhcmVuIHBhcmVudAogKi8K
c3RhdGljIHZvaWQgZml4X3R5cGVfY2FzdChjaHVua190ICpwYyk7CgoKc3RhdGljIHZvaWQg
cHJvY2Vzc19yZXR1cm5zKHZvaWQpOwoKCi8qKgogKiBQcm9jZXNzZXMgYSByZXR1cm4gc3Rh
dGVtZW50LCBsYWJlbGluZyB0aGUgcGFyZW5zIGFuZCBtYXJraW5nIHRoZSBwYXJlbnQuCiAq
IE1heSByZW1vdmUgb3IgYWRkIHBhcmVucyBhcm91bmQgdGhlIHJldHVybiBzdGF0ZW1lbnQK
ICoKICogQHBhcmFtIHBjICBQb2ludGVyIHRvIHRoZSByZXR1cm4gY2h1bmsKICovCnN0YXRp
YyBjaHVua190ICpwcm9jZXNzX3JldHVybihjaHVua190ICpwYyk7CgoKLyoqCiAqIFByb2Nl
c3MgYW4gT2JqQyAnY2xhc3MnCiAqIHBjIGlzIHRoZSBjaHVuayBhZnRlciAnQGltcGxlbWVu
dGF0aW9uJyBvciAnQGludGVyZmFjZScgb3IgJ0Bwcm90b2NvbCcuCiAqIENoYW5nZSBjb2xv
bnMsIGV0Yy4gUHJvY2Vzc2VzIHN0dWZmIHVudGlsICdAZW5kJy4KICogU2tpcHMgYW55dGhp
bmcgaW4gYnJhY2VzLgogKi8Kc3RhdGljIHZvaWQgaGFuZGxlX29jX2NsYXNzKGNodW5rX3Qg
KnBjKTsKCgovKioKICogIE1hcmsgT2JqZWN0aXZlLUMgYmxvY2tzIChha2EgbGFtYmRhcyBv
ciBjbG9zdXJlcykKICogIFRoZSBzeW50YXggYW5kIHVzYWdlIGlzIGV4YWN0bHkgbGlrZSBD
IGZ1bmN0aW9uIHBvaW50ZXJzCiAqICBidXQgaW5zdGVhZCBvZiBhbiBhc3RlcmlzayB0aGV5
IGhhdmUgYSBjYXJldCBhcyBwb2ludGVyIHN5bWJvbC4KICogIEFsdGhvdWdoIGl0IG1heSBs
b29rIGV4cGVuc2l2ZSB0aGlzIGZ1bmN0aW9ucyBpcyBvbmx5IHRyaWdnZXJlZAogKiAgb24g
YXBwZWFyYW5jZSBvZiBhbiBPQ19CTE9DS19DQVJFVCBmb3IgTEFOR19PQy4KICogIHJlcGVh
dCgxMCwgXnsgcHV0YygnMCcrZCk7IH0pOwogKiAgdHlwZWRlZiB2b2lkIChed29ya0Jsa190
KSh2b2lkKTsKICoKICogQHBhcmFtIHBjICBwb2ludHMgdG8gdGhlICdeJwogKi8Kc3RhdGlj
IHZvaWQgaGFuZGxlX29jX2Jsb2NrX2xpdGVyYWwoY2h1bmtfdCAqcGMpOwoKCi8qKgogKiBN
YXJrIE9iamVjdGl2ZS1DIGJsb2NrIHR5cGVzLgogKiBUaGUgc3ludGF4IGFuZCB1c2FnZSBp
cyBleGFjdGx5IGxpa2UgQyBmdW5jdGlvbiBwb2ludGVycwogKiBidXQgaW5zdGVhZCBvZiBh
biBhc3RlcmlzayB0aGV5IGhhdmUgYSBjYXJldCBhcyBwb2ludGVyIHN5bWJvbC4KICogIHR5
cGVkZWYgdm9pZCAoXndvcmtCbGtfdCkodm9pZCk7CiAqICBjb25zdCBjaGFyICogKF53b3Jr
VmFyKSh2b2lkKTsKICogIC0odm9pZClGb286KHZvaWQoXikoKSlibGsgeyB9CiAqCiAqIFRo
aXMgaXMgdHJpZ2dlcmVkIHdoZW4gdGhlIHNlcXVlbmNlICcoJyAnXicgaXMgZm91bmQuCiAq
CiAqIEBwYXJhbSBwYyAgcG9pbnRzIHRvIHRoZSAnXicKICovCnN0YXRpYyB2b2lkIGhhbmRs
ZV9vY19ibG9ja190eXBlKGNodW5rX3QgKnBjKTsKCgovKioKICogUHJvY2VzcyBhbiBPYmpD
IG1lc3NhZ2Ugc3BlYy9kZWMKICoKICogU3BlY3M6CiAqIC0odm9pZCkgZm9vIEFSR1M7CiAq
CiAqIERlY2xhcmF0aW9uOgogKiAtKHZvaWQpIGZvbyBBUkdTIHsgIH0KICoKICogTEFCRUwg
OiAoQVJHVFlQRSkgQVJHTkFNRQogKgogKiBBUkdTIGlzICc6IChBUkdUWVBFKSBBUkdOQU1F
IFtNT1JFQVJHUy4uLl0nCiAqIE1PUkVBUkdTIGlzICcgWyBMQUJFTF0gOiAoQVJHVFlQRSkg
QVJHTkFNRSAnCiAqIC0odm9pZCkgZm9vOiAoaW50KSBhcmc6IHsgIH0KICogLSh2b2lkKSBm
b286IChpbnQpIGFyZzogeyAgfQogKiAtKHZvaWQpIGluc2VydE9iamVjdDooaWQpYW5PYmpl
Y3QgYXRJbmRleDooaW50KWluZGV4CiAqLwpzdGF0aWMgdm9pZCBoYW5kbGVfb2NfbWVzc2Fn
ZV9kZWNsKGNodW5rX3QgKnBjKTsKCgovKioKICogUHJvY2VzcyBhbiBPYmpDIG1lc3NhZ2Ug
c2VuZCBzdGF0ZW1lbnQ6CiAqIFsgY2xhc3MgZnVuYzogdmFsMSBuYW1lMjogdmFsMiBuYW1l
MzogdmFsM10gOyAvLyBuYW1lZCBwYXJhbXMKICogWyBjbGFzcyBmdW5jOiB2YWwxICAgICAg
OiB2YWwyICAgICAgOiB2YWwzXSA7IC8vIHVubmFtZWQgcGFyYW1zCiAqIFsgY2xhc3MgPHBy
b3RvPiBzZWxmIG1ldGhvZCBdIDsgLy8gd2l0aCBwcm90b2NvbAogKiBbW05TTXV0YWJsZVN0
cmluZyBhbGxvY10gaW5pdFdpdGhTdHJpbmc6IEAiIiBdIC8vIGNsYXNzIGZyb20gbXNnCiAq
IFtmdW5jKGEsYixjKSBsYXN0T2JqZWN0IF0gLy8gY2xhc3MgZnJvbSBmdW5jCiAqCiAqIE1h
aW5seSBmaW5kIHRoZSBtYXRjaGluZyAnXScgYW5kICc7JyBhbmQgbWFyayB0aGUgY29sb25z
LgogKgogKiBAcGFyYW0gcGMgIHBvaW50cyB0byB0aGUgb3BlbiBzcXVhcmUgJ1snCiAqLwpz
dGF0aWMgdm9pZCBoYW5kbGVfb2NfbWVzc2FnZV9zZW5kKGNodW5rX3QgKnBjKTsKCgovLyEg
UHJvY2VzcyBAUHJvcGVydHkgdmFsdWVzIGFuZCByZS1hcnJhbmdlIHRoZW0gaWYgbmVjZXNz
YXJ5CnN0YXRpYyB2b2lkIGhhbmRsZV9vY19wcm9wZXJ0eV9kZWNsKGNodW5rX3QgKnBjKTsK
Ci8vISBQcm9jZXNzIEBhdmFpbGFibGUgYW5ub3RhdGlvbgpzdGF0aWMgdm9pZCBoYW5kbGVf
b2NfYXZhaWxhYmxlKGNodW5rX3QgKnBjKTsKCi8qKgogKiBQcm9jZXNzIGEgdHlwZSB0aGF0
IGlzIGVuY2xvc2VkIGluIHBhcmVucyBpbiBtZXNzYWdlIGRlY2xhcmF0aW9ucy4KICogVE9E
TzogaGFuZGxlIGJsb2NrIHR5cGVzLCB3aGljaCBnZXQgc3BlY2lhbCBmb3JtYXR0aW5nCiAq
CiAqIEBwYXJhbSBwYyAgcG9pbnRzIHRvIHRoZSBvcGVuIHBhcmVuCiAqCiAqIEByZXR1cm4g
dGhlIGNodW5rIGFmdGVyIHRoZSB0eXBlCiAqLwpzdGF0aWMgY2h1bmtfdCAqaGFuZGxlX29j
X21kX3R5cGUoY2h1bmtfdCAqcGFyZW5fb3BlbiwgY190b2tlbl90IHB0eXBlLCBwY2ZfZmxh
Z3NfdCBmbGFncywgYm9vbCAmZGlkX2l0KTsKCi8qKgogKiBQcm9jZXNzIGFuIEMjIFtdIHRo
aW5neToKICogICAgW2Fzc2VtYmx5OiB4eHhdCiAqICAgIFtBdHRyaWJ1dGVVc2FnZSgpXQog
KiAgICBbQFhdCiAqCiAqIFNldCB0aGUgbmV4dCBjaHVuayB0byBhIHN0YXRlbWVudCBzdGFy
dCBhZnRlciB0aGUgY2xvc2UgJ10nCiAqCiAqIEBwYXJhbSBwYyAgcG9pbnRzIHRvIHRoZSBv
cGVuIHNxdWFyZSAnWycKICovCnN0YXRpYyB2b2lkIGhhbmRsZV9jc19zcXVhcmVfc3RtdChj
aHVua190ICpwYyk7CgoKLyoqCiAqIFdlIGFyZSBvbiBhIGJyYWNlIG9wZW4gdGhhdCBpcyBw
cmVjZWRlZCBieSBhIHdvcmQgb3Igc3F1YXJlIGNsb3NlLgogKiBTZXQgdGhlIGJyYWNlIHBh
cmVudCB0byBDVF9DU19QUk9QRVJUWSBhbmQgZmluZCB0aGUgZmlyc3QgaXRlbSBpbiB0aGUK
ICogcHJvcGVydHkgYW5kIHNldCBpdHMgcGFyZW50LCB0b28uCiAqLwpzdGF0aWMgdm9pZCBo
YW5kbGVfY3NfcHJvcGVydHkoY2h1bmtfdCAqcGMpOwoKCi8qKgogKiBXZSBoaXQgYSAnXScg
Zm9sbG93ZWQgYnkgYSBXT1JELiBUaGlzIG1heSBiZSBhIG11bHRpZGltZW5zaW9uYWwgYXJy
YXkgdHlwZS4KICogRXhhbXBsZTogaW50WywsXSB4OwogKiBJZiB0aGVyZSBpcyBub3RoaW5n
IGJ1dCBjb21tYXMgYmV0d2VlbiB0aGUgb3BlbiBhbmQgY2xvc2UsIHRoZW4gbWFyayBpdC4K
ICovCnN0YXRpYyB2b2lkIGhhbmRsZV9jc19hcnJheV90eXBlKGNodW5rX3QgKnBjKTsKCgov
KioKICogV2UgYXJlIG9uIHRoZSBDKysgJ3RlbXBsYXRlJyBrZXl3b3JkLgogKiBXaGF0IGZv
bGxvd3Mgc2hvdWxkIGJlIHRoZSBmb2xsb3dpbmc6CiAqCiAqIHRlbXBsYXRlIDxjbGFzcyBp
ZGVudGlmaWVyPiBmdW5jdGlvbl9kZWNsYXJhdGlvbjsKICogdGVtcGxhdGUgPHR5cGVuYW1l
IGlkZW50aWZpZXI+IGZ1bmN0aW9uX2RlY2xhcmF0aW9uOwogKiB0ZW1wbGF0ZSA8Y2xhc3Mg
aWRlbnRpZmllcj4gY2xhc3MgY2xhc3NfZGVjbGFyYXRpb247CiAqIHRlbXBsYXRlIDx0eXBl
bmFtZSBpZGVudGlmaWVyPiBjbGFzcyBjbGFzc19kZWNsYXJhdGlvbjsKICoKICogQ2hhbmdl
IHRoZSAnY2xhc3MnIGluc2lkZSB0aGUgPD4gdG8gQ1RfVFlQRS4KICogU2V0IHRoZSBwYXJl
bnQgdG8gdGhlIGNsYXNzIGFmdGVyIHRoZSA8PiB0byBDVF9URU1QTEFURS4KICogU2V0IHRo
ZSBwYXJlbnQgb2YgdGhlIHNlbWljb2xvbiB0byBDVF9URU1QTEFURS4KICovCnN0YXRpYyB2
b2lkIGhhbmRsZV9jcHBfdGVtcGxhdGUoY2h1bmtfdCAqcGMpOwoKCi8qKgogKiBWZXJpZnkg
YW5kIHRoZW4gbWFyayBDKysgbGFtYmRhIGV4cHJlc3Npb25zLgogKiBUaGUgZXhwZWN0ZWQg
Zm9ybWF0IGlzICdbLi4uXSguLi4pey4uLn0nIG9yICdbLi4uXSguLi4pIC0+IHR5cGUgey4u
Ln0nCiAqIHNxX28gaXMgJ1snIENUX1NRVUFSRV9PUEVOIG9yICdbXScgQ1RfVFNRVUFSRQog
KiBTcGxpdCB0aGUgJ1tdJyBzbyB3ZSBjYW4gY29udHJvbCB0aGUgc3BhY2UKICovCnN0YXRp
YyB2b2lkIGhhbmRsZV9jcHBfbGFtYmRhKGNodW5rX3QgKnBjKTsKCgovKioKICogV2UgYXJl
IG9uIHRoZSBEICd0ZW1wbGF0ZScga2V5d29yZC4KICogV2hhdCBmb2xsb3dzIHNob3VsZCBi
ZSB0aGUgZm9sbG93aW5nOgogKgogKiB0ZW1wbGF0ZSBOQU1FICggVFlQRUxJU1QgKSB7IEJP
RFkgfQogKgogKiBTZXQgdGhlIHBhcmVudCBvZiBOQU1FIHRvIHRlbXBsYXRlLCBjaGFuZ2Ug
TkFNRSB0byBDVF9UWVBFLgogKiBTZXQgdGhlIHBhcmVudCBvZiB0aGUgcGFyZW5zIGFuZCBi
cmFjZXMgdG8gQ1RfVEVNUExBVEUuCiAqIFNjYW4gdGhlIGJvZHkgZm9yIGVhY2ggdHlwZSBp
biBUWVBFTElTVCBhbmQgY2hhbmdlIHRoZSB0eXBlIHRvIENUX1RZUEUuCiAqLwpzdGF0aWMg
dm9pZCBoYW5kbGVfZF90ZW1wbGF0ZShjaHVua190ICpwYyk7CgoKLyoqCiAqIEEgZnVuYyB3
cmFwIGNodW5rIGFuZCB3aGF0IGZvbGxvd3Mgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYSBmdW5j
dGlvbiBuYW1lLgogKiBDcmVhdGUgbmV3IHRleHQgZm9yIHRoZSBjaHVuayBhbmQgY2FsbCBp
dCBhIENUX0ZVTkNUSU9OLgogKgogKiBBIHR5cGUgd3JhcCBjaHVuayBhbmQgd2hhdCBmb2xs
b3dzIHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgc2ltcGxlIHR5cGUuCiAqIENyZWF0ZSBuZXcg
dGV4dCBmb3IgdGhlIGNodW5rIGFuZCBjYWxsIGl0IGEgQ1RfVFlQRS4KICovCnN0YXRpYyB2
b2lkIGhhbmRsZV93cmFwKGNodW5rX3QgKnBjKTsKCgovKioKICogQSBwcm90byB3cmFwIGNo
dW5rIGFuZCB3aGF0IGZvbGxvd3Mgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYSBmdW5jdGlvbiBw
cm90by4KICoKICogUkVUVFlQRSBQUk9UT19XUkFQKCBOQU1FLCBQQVJBTVMgKTsgb3IgUkVU
VFlQRSBQUk9UT19XUkFQKCBOQU1FLCAoUEFSQU1TKSApOwogKiBSRVRUWVBFIGdldHMgY2hh
bmdlZCB3aXRoIG1ha2VfdHlwZSgpLgogKiBQUk9UT19XUkFQIGlzIG1hcmtlZCBhcyBDVF9G
VU5DX1BST1RPIG9yIENUX0ZVTkNfREVGLgogKiBOQU1FIGlzIG1hcmtlZCBhcyBDVF9XT1JE
LgogKiBQQVJBTVMgaXMgYWxsIG1hcmtlZCBhcyBwcm90b3R5cGUgcGFyYW1ldGVycy4KICov
CnN0YXRpYyB2b2lkIGhhbmRsZV9wcm90b193cmFwKGNodW5rX3QgKnBjKTsKCgpzdGF0aWMg
Ym9vbCBpc19vY19ibG9jayhjaHVua190ICpwYyk7CgoKLyoqCiAqIEphdmEgYXNzZXJ0IHN0
YXRlbWVudHMgYXJlOiAiYXNzZXJ0IEVYUDEgWzogRVhQMl0gOyIKICogTWFyayB0aGUgcGFy
ZW50IG9mIHRoZSBjb2xvbiBhbmQgc2VtaWNvbG9uCiAqLwpzdGF0aWMgdm9pZCBoYW5kbGVf
amF2YV9hc3NlcnQoY2h1bmtfdCAqcGMpOwoKCnZvaWQgZmxhZ19zZXJpZXMoY2h1bmtfdCAq
c3RhcnQsIGNodW5rX3QgKmVuZCwgcGNmX2ZsYWdzX3Qgc2V0X2ZsYWdzLCBwY2ZfZmxhZ3Nf
dCBjbHJfZmxhZ3MsIHNjb3BlX2UgbmF2KQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CgogICB3
aGlsZSAoc3RhcnQgIT0gbnVsbHB0ciAmJiBzdGFydCAhPSBlbmQpCiAgIHsKICAgICAgY2h1
bmtfZmxhZ3NfdXBkKHN0YXJ0LCBjbHJfZmxhZ3MsIHNldF9mbGFncyk7CgogICAgICBzdGFy
dCA9IGNodW5rX2dldF9uZXh0KHN0YXJ0LCBuYXYpOwoKICAgICAgaWYgKHN0YXJ0ID09IG51
bGxwdHIpCiAgICAgIHsKICAgICAgICAgcmV0dXJuOwogICAgICB9CiAgIH0KCiAgIGlmIChl
bmQgIT0gbnVsbHB0cikKICAgewogICAgICBjaHVua19mbGFnc191cGQoZW5kLCBjbHJfZmxh
Z3MsIHNldF9mbGFncyk7CiAgIH0KfQoKCnN0YXRpYyB2b2lkIGZsYWdfYXNtKGNodW5rX3Qg
KnBjKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CgogICBjaHVua190ICp0bXAgPSBjaHVua19n
ZXRfbmV4dF9uY25sKHBjLCBzY29wZV9lOjpQUkVQUk9DKTsKCiAgIGlmICghY2h1bmtfaXNf
dG9rZW4odG1wLCBDVF9RVUFMSUZJRVIpKQogICB7CiAgICAgIHJldHVybjsKICAgfQogICBj
aHVua190ICpwbyA9IGNodW5rX2dldF9uZXh0X25jbmwodG1wLCBzY29wZV9lOjpQUkVQUk9D
KTsKCiAgIGlmICghY2h1bmtfaXNfcGFyZW5fb3BlbihwbykpCiAgIHsKICAgICAgcmV0dXJu
OwogICB9CiAgIGNodW5rX3QgKmVuZCA9IGNodW5rX3NraXBfdG9fbWF0Y2gocG8sIHNjb3Bl
X2U6OlBSRVBST0MpOwoKICAgaWYgKGVuZCA9PSBudWxscHRyKQogICB7CiAgICAgIHJldHVy
bjsKICAgfQogICBzZXRfY2h1bmtfcGFyZW50KHBvLCBDVF9BU00pOwogICBzZXRfY2h1bmtf
cGFyZW50KGVuZCwgQ1RfQVNNKTsKCiAgIGZvciAoICB0bXAgPSBjaHVua19nZXRfbmV4dF9u
Y25sKHBvLCBzY29wZV9lOjpQUkVQUk9DKTsKICAgICAgICAgIHRtcCAhPSBudWxscHRyCiAg
ICAgICAmJiB0bXAgIT0gZW5kOwogICAgICAgICAgdG1wID0gY2h1bmtfZ2V0X25leHRfbmNu
bCh0bXAsIHNjb3BlX2U6OlBSRVBST0MpKQogICB7CiAgICAgIGlmIChjaHVua19pc190b2tl
bih0bXAsIENUX0NPTE9OKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZSh0bXAs
IENUX0FTTV9DT0xPTik7CiAgICAgIH0KICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4o
dG1wLCBDVF9EQ19NRU1CRVIpKQogICAgICB7CiAgICAgICAgIC8vIGlmIHRoZXJlIGlzIGEg
c3RyaW5nIG9uIGJvdGggc2lkZXMsIHRoZW4gdGhpcyBpcyB0d28gQVNNX0NPTE9OcwogICAg
ICAgICBpZiAoICBjaHVua19pc190b2tlbihjaHVua19nZXRfbmV4dF9uY25sKHRtcCwgc2Nv
cGVfZTo6UFJFUFJPQyksIENUX1NUUklORykKICAgICAgICAgICAgJiYgY2h1bmtfaXNfdG9r
ZW4oY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHRtcCwgc2NvcGVfZTo6UFJFUFJPQyksIENUX1NU
UklORykpIC8vIElzc3VlICMyMjc5CiAgICAgICAgIHsKICAgICAgICAgICAgY2h1bmtfdCBu
YzsKCiAgICAgICAgICAgIG5jID0gKnRtcDsKCiAgICAgICAgICAgIHRtcC0+c3RyLnJlc2l6
ZSgxKTsKICAgICAgICAgICAgdG1wLT5vcmlnX2NvbF9lbmQgPSB0bXAtPm9yaWdfY29sICsg
MTsKICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9BU01fQ09MT04pOwoKICAg
ICAgICAgICAgc2V0X2NodW5rX3R5cGUoJm5jLCB0bXAtPnR5cGUpOwogICAgICAgICAgICBu
Yy5zdHIucG9wX2Zyb250KCk7CiAgICAgICAgICAgIG5jLm9yaWdfY29sKys7CiAgICAgICAg
ICAgIG5jLmNvbHVtbisrOwogICAgICAgICAgICBjaHVua19hZGRfYWZ0ZXIoJm5jLCB0bXAp
OwogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgdG1wID0gY2h1bmtfZ2V0X25leHRfbmNu
bChlbmQsIHNjb3BlX2U6OlBSRVBST0MpOwoKICAgaWYgKHRtcCA9PSBudWxscHRyKQogICB7
CiAgICAgIHJldHVybjsKICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfU0VN
SUNPTE9OKSkKICAgewogICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfQVNNKTsKICAg
fQp9IC8vIGZsYWdfYXNtCgoKdm9pZCBkb19zeW1ib2xfY2hlY2soY2h1bmtfdCAqcHJldiwg
Y2h1bmtfdCAqcGMsIGNodW5rX3QgKm5leHQpCnsKICAgTE9HX0ZVTkNfRU5UUlkoKTsKICAg
Y2h1bmtfdCAqdG1wOwoKICAgLy8gc2VwYXJhdGUgdGhlIHVzZXMgb2YgQ1RfQVNTSUdOIHNp
Z24gJz0nCiAgIC8vIGludG8gQ1RfQVNTSUdOX0RFRkFVTFRfQVJHLCBDVF9BU1NJR05fRlVO
Q19QUk9UTwogICBpZiAoICBjaHVua19pc190b2tlbihwYywgQ1RfQVNTSUdOKQogICAgICAm
JiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09IENUX0ZVTkNfUFJPVE8KICAgICAgJiYg
KCAgcGMtPmZsYWdzLnRlc3QoUENGX0lOX0ZDTl9ERUYpICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIC8vIElzc3VlICMyMjM2CiAgICAgICAgIHx8IHBjLT5mbGFncy50ZXN0KFBDRl9J
Tl9DT05TVF9BUkdTKSkpCiAgIHsKICAgICAgTE9HX0ZNVChMRkNOUiwgIiVzKCVkKTogb3Jp
Z19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xuIiwKICAgICAg
ICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2Nv
bCwgcGMtPnRleHQoKSk7CiAgICAgIGxvZ19wY2ZfZmxhZ3MoTEZDTlIsIHBjLT5mbGFncyk7
CiAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9BU1NJR05fREVGQVVMVF9BUkcpOwogICB9
CgogICBpZiAoICAoICBjaHVua19pc190b2tlbihwcmV2LCBDVF9GUEFSRU5fQ0xPU0UpCiAg
ICAgICAgIHx8ICggICggIGNodW5rX2lzX3N0cihwcmV2LCAiY29uc3QiLCA1KQogICAgICAg
ICAgICAgICB8fCBjaHVua19pc19zdHIocHJldiwgIm92ZXJyaWRlIiwgOCkpCiAgICAgICAg
ICAgICYmIGNodW5rX2lzX3Rva2VuKHByZXYtPnByZXYsIENUX0ZQQVJFTl9DTE9TRSkpKQog
ICAgICAmJiBjaHVua19pc190b2tlbihwYywgQ1RfQVNTSUdOKQogICAgICAmJiAoICBjaHVu
a19pc190b2tlbihuZXh0LCBDVF9ERUZBVUxUKQogICAgICAgICB8fCBjaHVua19pc190b2tl
bihuZXh0LCBDVF9ERUxFVEUpCiAgICAgICAgIHx8IGNodW5rX2lzX3N0cihuZXh0LCAiMCIs
IDEpKSkKICAgewogICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfQVNTSUdOX0ZVTkNfUFJP
VE8pOwogICB9CgogICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX09DX0FUKSkKICAgewog
ICAgICBpZiAoICBjaHVua19pc190b2tlbihuZXh0LCBDVF9QQVJFTl9PUEVOKQogICAgICAg
ICB8fCBjaHVua19pc190b2tlbihuZXh0LCBDVF9CUkFDRV9PUEVOKQogICAgICAgICB8fCBj
aHVua19pc190b2tlbihuZXh0LCBDVF9TUVVBUkVfT1BFTikpCiAgICAgIHsKICAgICAgICAg
ZmxhZ19wYXJlbnMobmV4dCwgUENGX09DX0JPWEVELCBuZXh0LT50eXBlLCBDVF9PQ19BVCwg
ZmFsc2UpOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICBzZXRfY2h1bmtf
cGFyZW50KG5leHQsIENUX09DX0FUKTsKICAgICAgfQogICB9CgogICAvLyBEIHN0dWZmCiAg
IGlmICggIGxhbmd1YWdlX2lzX3NldChMQU5HX0QpCiAgICAgICYmIGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9RVUFMSUZJRVIpCiAgICAgICYmIGNodW5rX2lzX3N0cihwYywgImNvbnN0Iiwg
NSkKICAgICAgJiYgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfUEFSRU5fT1BFTikpCiAgIHsK
ICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0RfQ0FTVCk7CiAgICAgIHNldF9wYXJlbl9w
YXJlbnQobmV4dCwgcGMtPnR5cGUpOwogICB9CgogICBpZiAoICBjaHVua19pc190b2tlbihu
ZXh0LCBDVF9QQVJFTl9PUEVOKQogICAgICAmJiAoICBjaHVua19pc190b2tlbihwYywgQ1Rf
RF9DQVNUKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfREVMRUdBVEUpCiAg
ICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BTElHTikpKQogICB7CiAgICAgIC8v
IG1hcmsgdGhlIHBhcmVudGhlc2lzIHBhcmVudAogICAgICB0bXAgPSBzZXRfcGFyZW5fcGFy
ZW50KG5leHQsIHBjLT50eXBlKTsKCiAgICAgIC8vIEZvciBhIEQgY2FzdCAtIGNvbnZlcnQg
dGhlIG5leHQgaXRlbQogICAgICBpZiAoICBjaHVua19pc190b2tlbihwYywgQ1RfRF9DQVNU
KQogICAgICAgICAmJiB0bXAgIT0gbnVsbHB0cikKICAgICAgewogICAgICAgICBpZiAoY2h1
bmtfaXNfdG9rZW4odG1wLCBDVF9TVEFSKSkKICAgICAgICAgewogICAgICAgICAgICBzZXRf
Y2h1bmtfdHlwZSh0bXAsIENUX0RFUkVGKTsKICAgICAgICAgfQogICAgICAgICBlbHNlIGlm
IChjaHVua19pc190b2tlbih0bXAsIENUX0FNUCkpCiAgICAgICAgIHsKICAgICAgICAgICAg
c2V0X2NodW5rX3R5cGUodG1wLCBDVF9BRERSKTsKICAgICAgICAgfQogICAgICAgICBlbHNl
IGlmIChjaHVua19pc190b2tlbih0bXAsIENUX01JTlVTKSkKICAgICAgICAgewogICAgICAg
ICAgICBzZXRfY2h1bmtfdHlwZSh0bXAsIENUX05FRyk7CiAgICAgICAgIH0KICAgICAgICAg
ZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9QTFVTKSkKICAgICAgICAgewogICAg
ICAgICAgICBzZXRfY2h1bmtfdHlwZSh0bXAsIENUX1BPUyk7CiAgICAgICAgIH0KICAgICAg
fQoKICAgICAgLyoKICAgICAgICogRm9yIGEgZGVsZWdhdGUsIG1hcmsgcHJldmlvdXMgd29y
ZHMgYXMgdHlwZXMgYW5kIHRoZSBpdGVtIGFmdGVyIHRoZQogICAgICAgKiBjbG9zZSBwYXJl
biBhcyBhIHZhcmlhYmxlIGRlZgogICAgICAgKi8KICAgICAgaWYgKGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9ERUxFR0FURSkpCiAgICAgIHsKICAgICAgICAgaWYgKHRtcCAhPSBudWxscHRy
KQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBDVF9ERUxF
R0FURSk7CgogICAgICAgICAgICBpZiAodG1wLT5sZXZlbCA9PSB0bXAtPmJyYWNlX2xldmVs
KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGNodW5rX2ZsYWdzX3NldCh0bXAsIFBD
Rl9WQVJfMVNUX0RFRik7CiAgICAgICAgICAgIH0KICAgICAgICAgfQoKICAgICAgICAgZm9y
ICh0bXAgPSBjaHVua19nZXRfcHJldl9uY25sbmkocGMpOyB0bXAgIT0gbnVsbHB0cjsgdG1w
ID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHRtcCkpIC8vIElzc3VlICMyMjc5CiAgICAgICAg
IHsKICAgICAgICAgICAgaWYgKCAgY2h1bmtfaXNfc2VtaWNvbG9uKHRtcCkKICAgICAgICAg
ICAgICAgfHwgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9CUkFDRV9PUEVOKQogICAgICAgICAg
ICAgICB8fCBjaHVua19pc190b2tlbih0bXAsIENUX1ZCUkFDRV9PUEVOKSkKICAgICAgICAg
ICAgewogICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBt
YWtlX3R5cGUodG1wKTsKICAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoICBjaHVua19p
c190b2tlbihwYywgQ1RfQUxJR04pCiAgICAgICAgICYmIHRtcCAhPSBudWxscHRyKQogICAg
ICB7CiAgICAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX0JSQUNFX09QRU4pKQog
ICAgICAgICB7CiAgICAgICAgICAgIHNldF9wYXJlbl9wYXJlbnQodG1wLCBwYy0+dHlwZSk7
CiAgICAgICAgIH0KICAgICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9D
T0xPTikpCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVudCh0bXAsIHBj
LT50eXBlKTsKICAgICAgICAgfQogICAgICB9CiAgIH0gLy8gcGFyZW4gb3BlbiArIGNhc3Qv
YWxpZ24vZGVsZWdhdGUKCiAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfSU5WQVJJQU5U
KSkKICAgewogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfUEFSRU5fT1BFTikp
CiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBwYy0+dHlwZSk7CiAg
ICAgICAgIHRtcCA9IGNodW5rX2dldF9uZXh0KG5leHQpOwoKICAgICAgICAgd2hpbGUgKHRt
cCAhPSBudWxscHRyKQogICAgICAgICB7CiAgICAgICAgICAgIGlmIChjaHVua19pc190b2tl
bih0bXAsIENUX1BBUkVOX0NMT1NFKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBz
ZXRfY2h1bmtfcGFyZW50KHRtcCwgcGMtPnR5cGUpOwogICAgICAgICAgICAgICBicmVhazsK
ICAgICAgICAgICAgfQogICAgICAgICAgICBtYWtlX3R5cGUodG1wKTsKICAgICAgICAgICAg
dG1wID0gY2h1bmtfZ2V0X25leHQodG1wKTsKICAgICAgICAgfQogICAgICB9CiAgICAgIGVs
c2UKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfUVVBTElGSUVSKTsK
ICAgICAgfQogICB9CgogICBpZiAoICBjaHVua19pc190b2tlbihwcmV2LCBDVF9CUkFDRV9P
UEVOKQogICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocHJldikgIT0gQ1RfQ1NfUFJP
UEVSVFkKICAgICAgJiYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0dFVFNFVCkKICAgICAg
ICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0dFVFNFVF9FTVBUWSkpKQogICB7CiAgICAg
IGZsYWdfcGFyZW5zKHByZXYsIFBDRl9OT05FLCBDVF9OT05FLCBDVF9HRVRTRVQsIGZhbHNl
KTsKICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BU00pKQogICB7CiAgICAg
IGZsYWdfYXNtKHBjKTsKICAgfQoKICAgLy8gY2xhbmcgc3R1ZmYgLSBBIG5ldyBkZXJpdmVk
IHR5cGUgaXMgaW50cm9kdWNlZCB0byBDIGFuZCwgYnkgZXh0ZW5zaW9uLCBPYmplY3RpdmUt
QywgQysrLCBhbmQgT2JqZWN0aXZlLUMrKwogICBpZiAobGFuZ3VhZ2VfaXNfc2V0KExBTkdf
QyB8IExBTkdfQ1BQIHwgTEFOR19PQykpCiAgIHsKICAgICAgaWYgKGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9DQVJFVCkpCiAgICAgIHsKICAgICAgICAgaWYgKCAgcGMtPmZsYWdzLnRlc3Qo
UENGX0VYUFJfU1RBUlQpCiAgICAgICAgICAgIHx8IHBjLT5mbGFncy50ZXN0KFBDRl9JTl9Q
UkVQUk9DKSkKICAgICAgICAgewogICAgICAgICAgICBoYW5kbGVfb2NfYmxvY2tfbGl0ZXJh
bChwYyk7CiAgICAgICAgIH0KICAgICAgfQogICB9CgogICAvLyBPYmplY3RpdmUgQyBzdHVm
ZgogICBpZiAobGFuZ3VhZ2VfaXNfc2V0KExBTkdfT0MpKQogICB7CiAgICAgIC8vIENoZWNr
IGZvciBtZXNzYWdlIGRlY2xhcmF0aW9ucwogICAgICBpZiAocGMtPmZsYWdzLnRlc3QoUENG
X1NUTVRfU1RBUlQpKQogICAgICB7CiAgICAgICAgIGlmICggICggIGNodW5rX2lzX3N0cihw
YywgIi0iLCAxKQogICAgICAgICAgICAgICB8fCBjaHVua19pc19zdHIocGMsICIrIiwgMSkp
CiAgICAgICAgICAgICYmIGNodW5rX2lzX3N0cihuZXh0LCAiKCIsIDEpKQogICAgICAgICB7
CiAgICAgICAgICAgIGhhbmRsZV9vY19tZXNzYWdlX2RlY2wocGMpOwogICAgICAgICB9CiAg
ICAgIH0KCiAgICAgIGlmICggIHBjLT5mbGFncy50ZXN0KFBDRl9FWFBSX1NUQVJUKQogICAg
ICAgICB8fCBwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykpCiAgICAgIHsKICAgICAg
ICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TUVVBUkVfT1BFTikpCiAgICAgICAgIHsK
ICAgICAgICAgICAgaGFuZGxlX29jX21lc3NhZ2Vfc2VuZChwYyk7CiAgICAgICAgIH0KICAg
ICAgfQoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9PQ19QUk9QRVJUWSkpCiAg
ICAgIHsKICAgICAgICAgaGFuZGxlX29jX3Byb3BlcnR5X2RlY2wocGMpOwogICAgICB9Cgog
ICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX09DX0FWQUlMQUJMRSkpCiAgICAgIHsK
ICAgICAgICAgaGFuZGxlX29jX2F2YWlsYWJsZShwYyk7CiAgICAgIH0KICAgfQoKICAgLy8g
QyMgc3R1ZmYKICAgaWYgKGxhbmd1YWdlX2lzX3NldChMQU5HX0NTKSkKICAgewogICAgICAv
LyAnW2Fzc2VtYmx5OiB4eHhdJyBzdHVmZgogICAgICBpZiAoICBwYy0+ZmxhZ3MudGVzdChQ
Q0ZfRVhQUl9TVEFSVCkKICAgICAgICAgJiYgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NRVUFS
RV9PUEVOKSkKICAgICAgewogICAgICAgICBoYW5kbGVfY3Nfc3F1YXJlX3N0bXQocGMpOwog
ICAgICB9CgogICAgICBpZiAoICBjaHVua19pc190b2tlbihuZXh0LCBDVF9CUkFDRV9PUEVO
KQogICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUobmV4dCkgPT0gQ1RfTk9ORQog
ICAgICAgICAmJiAoICBjaHVua19pc190b2tlbihwYywgQ1RfU1FVQVJFX0NMT1NFKQogICAg
ICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQU5HTEVfQ0xPU0UpCiAgICAgICAg
ICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9XT1JEKSkpCiAgICAgIHsKICAgICAgICAg
aGFuZGxlX2NzX3Byb3BlcnR5KG5leHQpOwogICAgICB9CgogICAgICBpZiAoICBjaHVua19p
c190b2tlbihwYywgQ1RfU1FVQVJFX0NMT1NFKQogICAgICAgICAmJiBjaHVua19pc190b2tl
bihuZXh0LCBDVF9XT1JEKSkKICAgICAgewogICAgICAgICBoYW5kbGVfY3NfYXJyYXlfdHlw
ZShwYyk7CiAgICAgIH0KCiAgICAgIGlmICggICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9M
QU1CREEpCiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9ERUxFR0FURSkp
CiAgICAgICAgICYmIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0JSQUNFX09QRU4pKQogICAg
ICB7CiAgICAgICAgIHNldF9wYXJlbl9wYXJlbnQobmV4dCwgcGMtPnR5cGUpOwogICAgICB9
CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1dIRU4pICYmIHBjLT5uZXh0LT50
eXBlICE9IENUX1NQQVJFTl9PUEVOKQogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBl
KHBjLCBDVF9XT1JEKTsKICAgICAgfQogICB9CgogICBpZiAoICBsYW5ndWFnZV9pc19zZXQo
TEFOR19KQVZBKQogICAgICAmJiBjaHVua19pc190b2tlbihwYywgQ1RfTEFNQkRBKQogICAg
ICAmJiBjaHVua19pc190b2tlbihuZXh0LCBDVF9CUkFDRV9PUEVOKSkKICAgewogICAgICBz
ZXRfcGFyZW5fcGFyZW50KG5leHQsIHBjLT50eXBlKTsKICAgfQoKICAgaWYgKGNodW5rX2lz
X3Rva2VuKHBjLCBDVF9ORVcpKQogICB7CiAgICAgIGNodW5rX3QgKnRzID0gbnVsbHB0cjsK
ICAgICAgdG1wID0gbmV4dDsKCiAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX1RT
UVVBUkUpKQogICAgICB7CiAgICAgICAgIHRzICA9IHRtcDsKICAgICAgICAgdG1wID0gY2h1
bmtfZ2V0X25leHRfbmNubCh0bXApOwogICAgICB9CgogICAgICBpZiAoICBjaHVua19pc190
b2tlbih0bXAsIENUX0JSQUNFX09QRU4pCiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHRt
cCwgQ1RfUEFSRU5fT1BFTikpCiAgICAgIHsKICAgICAgICAgc2V0X3BhcmVuX3BhcmVudCh0
bXAsIHBjLT50eXBlKTsKCiAgICAgICAgIGlmICh0cyAhPSBudWxscHRyKQogICAgICAgICB7
CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodHMsIHBjLT50eXBlKTsKICAgICAgICAg
fQogICAgICB9CiAgIH0KCiAgIC8vIEMrKzExIExhbWJkYSBzdHVmZgogICBpZiAoICBsYW5n
dWFnZV9pc19zZXQoTEFOR19DUFApCiAgICAgICYmICggIGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9TUVVBUkVfT1BFTikKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RTUVVB
UkUpKSkKICAgewogICAgICBoYW5kbGVfY3BwX2xhbWJkYShwYyk7CiAgIH0KCiAgIC8vIEZJ
WE1FOiB3aGljaCBsYW5ndWFnZSBkb2VzIHRoaXMgYXBwbHkgdG8/CiAgIC8vIElzc3VlICMy
NDMyCiAgIGlmICghbGFuZ3VhZ2VfaXNfc2V0KExBTkdfT0MpKQogICB7CiAgICAgIGlmICgg
IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BU1NJR04pCiAgICAgICAgICYmIGNodW5rX2lzX3Rv
a2VuKG5leHQsIENUX1NRVUFSRV9PUEVOKSkKICAgICAgewogICAgICAgICBzZXRfcGFyZW5f
cGFyZW50KG5leHQsIENUX0FTU0lHTik7CgogICAgICAgICAvLyBNYXJrIG9uZS1saW5lciBh
c3NpZ25tZW50CiAgICAgICAgIHRtcCA9IG5leHQ7CgogICAgICAgICB3aGlsZSAoKHRtcCA9
IGNodW5rX2dldF9uZXh0X25jKHRtcCkpICE9IG51bGxwdHIpCiAgICAgICAgIHsKICAgICAg
ICAgICAgaWYgKGNodW5rX2lzX25ld2xpbmUodG1wKSkKICAgICAgICAgICAgewogICAgICAg
ICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNodW5rX2lz
X3Rva2VuKHRtcCwgQ1RfU1FVQVJFX0NMT1NFKSAmJiBuZXh0LT5sZXZlbCA9PSB0bXAtPmxl
dmVsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGNodW5rX2ZsYWdzX3NldCh0bXAs
IFBDRl9PTkVfTElORVIpOwogICAgICAgICAgICAgICBjaHVua19mbGFnc19zZXQobmV4dCwg
UENGX09ORV9MSU5FUik7CiAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAg
ICAgICAgIH0KICAgICAgfQogICB9CgogICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FT
U0VSVCkpCiAgIHsKICAgICAgaGFuZGxlX2phdmFfYXNzZXJ0KHBjKTsKICAgfQoKICAgaWYg
KGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BTk5PVEFUSU9OKSkKICAgewogICAgICB0bXAgPSBj
aHVua19nZXRfbmV4dF9uY25sKHBjKTsKCiAgICAgIGlmIChjaHVua19pc19wYXJlbl9vcGVu
KHRtcCkpCiAgICAgIHsKICAgICAgICAgc2V0X3BhcmVuX3BhcmVudCh0bXAsIENUX0FOTk9U
QVRJT04pOwogICAgICB9CiAgIH0KCiAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfU0la
RU9GKSAmJiBsYW5ndWFnZV9pc19zZXQoTEFOR19BTExDKSkKICAgewogICAgICB0bXAgPSBj
aHVua19nZXRfbmV4dF9uY25sKHBjKTsKCiAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAs
IENUX0VMTElQU0lTKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwg
Q1RfU0laRU9GKTsKICAgICAgfQogICB9CgogICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENU
X0RFQ0xUWVBFKSkKICAgewogICAgICB0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsK
CiAgICAgIGlmIChjaHVua19pc19wYXJlbl9vcGVuKHRtcCkpCiAgICAgIHsKICAgICAgICAg
Ly8gZGVjbHR5cGUgbWF5IGJlIGZvbGxvd2VkIGJ5IGEgYnJhY2VkLWluaXQtbGlzdAogICAg
ICAgICB0bXAgPSBzZXRfcGFyZW5fcGFyZW50KHRtcCwgQ1RfREVDTFRZUEUpOwoKICAgICAg
ICAgaWYgKGNodW5rX2lzX29wZW5pbmdfYnJhY2UodG1wKSkKICAgICAgICAgewogICAgICAg
ICAgICB0bXAgPSBzZXRfcGFyZW5fcGFyZW50KHRtcCwgQ1RfQlJBQ0VEX0lOSVRfTElTVCk7
CgogICAgICAgICAgICBpZiAodG1wKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGNo
dW5rX2ZsYWdzX2Nscih0bXAsIFBDRl9FWFBSX1NUQVJUIHwgUENGX1NUTVRfU1RBUlQpOwog
ICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgICAgZWxzZQogICAgICAgICB7CiAgICAg
ICAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX1dPUkQpKQogICAgICAgICAgICB7
CiAgICAgICAgICAgICAgIGNodW5rX2ZsYWdzX3NldCh0bXAsIFBDRl9WQVJfMVNUX0RFRik7
CiAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgICB9CiAgIH0KCiAgIC8vIEEgW10gaW4g
QyMgYW5kIEQgb25seSBmb2xsb3dzIGEgdHlwZQogICBpZiAoICBjaHVua19pc190b2tlbihw
YywgQ1RfVFNRVUFSRSkKICAgICAgJiYgbGFuZ3VhZ2VfaXNfc2V0KExBTkdfRCB8IExBTkdf
Q1MgfCBMQU5HX1ZBTEEpKQogICB7CiAgICAgIGlmIChjaHVua19pc190b2tlbihwcmV2LCBD
VF9XT1JEKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZShwcmV2LCBDVF9UWVBF
KTsKICAgICAgfQoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1dPUkQpKQog
ICAgICB7CiAgICAgICAgIGNodW5rX2ZsYWdzX3NldChuZXh0LCBQQ0ZfVkFSXzFTVF9ERUYp
OwogICAgICB9CiAgIH0KCiAgIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TUUxfRVhF
QykKICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NRTF9CRUdJTikKICAgICAgfHwg
Y2h1bmtfaXNfdG9rZW4ocGMsIENUX1NRTF9FTkQpKQogICB7CiAgICAgIG1hcmtfZXhlY19z
cWwocGMpOwogICB9CgogICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1BST1RPX1dSQVAp
KQogICB7CiAgICAgIGhhbmRsZV9wcm90b193cmFwKHBjKTsKICAgfQoKICAgLy8gSGFuZGxl
IHRoZSB0eXBlZGVmCiAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfVFlQRURFRikpCiAg
IHsKICAgICAgZml4X3R5cGVkZWYocGMpOwogICB9CgogICBpZiAoICBjaHVua19pc190b2tl
bihwYywgQ1RfRU5VTSkKICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NUUlVDVCkK
ICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1VOSU9OKQogICAgICB8fCAoICBjaHVu
a19pc190b2tlbihwYywgQ1RfQ0xBU1MpCiAgICAgICAgICYmICFsYW5ndWFnZV9pc19zZXQo
TEFOR19EKSkpCiAgIHsKICAgICAgaWYgKHByZXYtPnR5cGUgIT0gQ1RfVFlQRURFRikKICAg
ICAgewogICAgICAgICBmaXhfZW51bV9zdHJ1Y3RfdW5pb24ocGMpOwogICAgICB9CiAgIH0K
CiAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfRVhURVJOKSkKICAgewogICAgICBpZiAo
Y2h1bmtfaXNfcGFyZW5fb3BlbihuZXh0KSkKICAgICAgewogICAgICAgICB0bXAgPSBmbGFn
X3BhcmVucyhuZXh0LCBQQ0ZfTk9ORSwgQ1RfTk9ORSwgQ1RfRVhURVJOLCB0cnVlKTsKCiAg
ICAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX0JSQUNFX09QRU4pKQogICAgICAg
ICB7CiAgICAgICAgICAgIHNldF9wYXJlbl9wYXJlbnQodG1wLCBDVF9FWFRFUk4pOwogICAg
ICAgICB9CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgIC8vIG5leHQgbGlr
ZWx5IGlzIGEgc3RyaW5nIChzZWUgdG9rZW5pemVfY2xlYW51cC5jcHApCiAgICAgICAgIHNl
dF9jaHVua19wYXJlbnQobmV4dCwgQ1RfRVhURVJOKTsKICAgICAgICAgdG1wID0gY2h1bmtf
Z2V0X25leHRfbmNubChuZXh0KTsKCiAgICAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAs
IENUX0JSQUNFX09QRU4pKQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9wYXJlbl9wYXJl
bnQodG1wLCBDVF9FWFRFUk4pOwogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgaWYgKGNo
dW5rX2lzX3Rva2VuKHBjLCBDVF9URU1QTEFURSkpCiAgIHsKICAgICAgaWYgKGxhbmd1YWdl
X2lzX3NldChMQU5HX0QpKQogICAgICB7CiAgICAgICAgIGhhbmRsZV9kX3RlbXBsYXRlKHBj
KTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAgaGFuZGxlX2NwcF90ZW1w
bGF0ZShwYyk7CiAgICAgIH0KICAgfQoKICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENU
X1dPUkQpCiAgICAgICYmIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0FOR0xFX09QRU4pCiAg
ICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShuZXh0KSA9PSBDVF9URU1QTEFURSkKICAg
ewogICAgICBtYXJrX3RlbXBsYXRlX2Z1bmMocGMsIG5leHQpOwogICB9CgogICBpZiAoICBj
aHVua19pc190b2tlbihwYywgQ1RfU1FVQVJFX0NMT1NFKQogICAgICAmJiBjaHVua19pc190
b2tlbihuZXh0LCBDVF9QQVJFTl9PUEVOKSkKICAgewogICAgICBmbGFnX3BhcmVucyhuZXh0
LCBQQ0ZfTk9ORSwgQ1RfRlBBUkVOX09QRU4sIENUX05PTkUsIGZhbHNlKTsKICAgfQoKICAg
aWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9UWVBFX0NBU1QpKQogICB7CiAgICAgIGZpeF90
eXBlX2Nhc3QocGMpOwogICB9CgogICBpZiAoICBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMp
ID09IENUX0FTU0lHTgogICAgICAmJiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0JSQUNFX09Q
RU4pIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TUVVBUkVfT1BFTikpKQogICB7CiAgICAg
IC8vIE1hcmsgZXZlcnl0aGluZyBpbiBoZXJlIGFzIGluIGFzc2lnbgogICAgICBmbGFnX3Bh
cmVucyhwYywgUENGX0lOX0FSUkFZX0FTU0lHTiwgcGMtPnR5cGUsIENUX05PTkUsIGZhbHNl
KTsKICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9EX1RFTVBMQVRFKSkKICAg
ewogICAgICBzZXRfcGFyZW5fcGFyZW50KG5leHQsIHBjLT50eXBlKTsKICAgfQoKICAgLyoK
ICAgICogQSB3b3JkIGJlZm9yZSBhbiBvcGVuIHBhcmVuIGlzIGEgZnVuY3Rpb24gY2FsbCBv
ciBkZWZpbml0aW9uLgogICAgKiBDVF9XT1JEID0+IENUX0ZVTkNfQ0FMTCBvciBDVF9GVU5D
X0RFRgogICAgKi8KICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1BBUkVOX09QRU4p
KQogICB7CiAgICAgIHRtcCA9IGNodW5rX2dldF9uZXh0X25jbmwobmV4dCk7CgogICAgICBp
ZiAoICBsYW5ndWFnZV9pc19zZXQoTEFOR19DIHwgTEFOR19DUFAgfCBMQU5HX09DKQogICAg
ICAgICAmJiBjaHVua19pc190b2tlbih0bXAsIENUX0NBUkVUKSkKICAgICAgewogICAgICAg
ICBoYW5kbGVfb2NfYmxvY2tfdHlwZSh0bXApOwoKICAgICAgICAgLy8gVGhpcyBpcyB0aGUg
Y2FzZSB3aGVyZSBhIGJsb2NrIGxpdGVyYWwgaXMgcGFzc2VkIGFzIHRoZSBmaXJzdCBhcmd1
bWVudCBvZiBhIEMtc3R5bGUgbWV0aG9kIGludm9jYXRpb24uCiAgICAgICAgIGlmICggICgg
IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfT0NfQkxPQ0tfQ0FSRVQpCiAgICAgICAgICAgICAg
IHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfQ0FSRVQpKQogICAgICAgICAgICAmJiBjaHVu
a19pc190b2tlbihwYywgQ1RfV09SRCkpCiAgICAgICAgIHsKICAgICAgICAgICAgTE9HX0ZN
VChMRkNOLCAiJXMoJWQpOiAoMSkgU0VUIFRPIENUX0ZVTkNfQ0FMTDogb3JpZ19saW5lIGlz
ICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xuIiwKICAgICAgICAgICAgICAg
ICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwg
cGMtPnRleHQoKSk7CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DX0NB
TEwpOwogICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSBpZiAoICBjaHVua19pc190b2tl
bihwYywgQ1RfV09SRCkKICAgICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1Rf
T1BFUkFUT1JfVkFMKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1Rf
RlVOQ1RJT04pOwogICAgICB9CiAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9GSVhFRCkpCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0ZVTkNU
SU9OKTsKICAgICAgICAgc2V0X2NodW5rX3BhcmVudChwYywgQ1RfRklYRUQpOwogICAgICB9
CiAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9UWVBFKSkKICAgICAgewog
ICAgICAgICAvKgogICAgICAgICAgKiBJZiB3ZSBhcmUgb24gYSB0eXBlLCB0aGVuIHdlIGFy
ZSBlaXRoZXIgb24gYSBDKysgc3R5bGUgY2FzdCwgYW4KICAgICAgICAgICogYXJyYXkgcmVm
ZXJlbmNlLCBhIGZ1bmN0aW9uIG9yIHdlIGFyZSBvbiBhIGZ1bmN0aW9uIHR5cGUuCiAgICAg
ICAgICAqIFRoZSBvbmx5IHdheSB0byB0ZWxsIGZvciBzdXJlIGlzIHRvIGZpbmQgdGhlIGNs
b3NlIHBhcmVuIGFuZCBzZWUKICAgICAgICAgICogaWYgaXQgaXMgZm9sbG93ZWQgYnkgYW4g
b3BlbiBwYXJlbi4KICAgICAgICAgICogImludCg1LjYpIgogICAgICAgICAgKiAiaW50KCki
CiAgICAgICAgICAqICJpbnQoZm9vKSh2b2lkKSIKICAgICAgICAgICoKICAgICAgICAgICog
RklYTUU6IHRoaXMgY2hlY2sgY2FuIGJlIGRvbmUgYmV0dGVyLi4uCiAgICAgICAgICAqLwog
ICAgICAgICBMT0dfRk1UKExGQ05SLCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmln
X2NvbCBpcyAlenUsIHRleHQoKSAnJXMnXG4iLAogICAgICAgICAgICAgICAgIF9fZnVuY19f
LCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpKTsK
CiAgICAgICAgIGJvb2wgaXNfYnlyZWZfYXJyYXkgPSBmYWxzZTsKCiAgICAgICAgIGlmIChs
YW5ndWFnZV9pc19zZXQoTEFOR19DUFApKQogICAgICAgICB7CiAgICAgICAgICAgIC8vIElm
IHRoZSBvcGVuIHBhcmVuIGlzIGZvbGxvd2VkIGJ5IGFuIGFtcGVyc2FuZCwgYW4gb3B0aW9u
YWwgd29yZCwKICAgICAgICAgICAgLy8gYSBjbG9zZSBwYXJlbnRoZXNpcywgYW5kIGFuIG9w
ZW4gc3F1YXJlIGJyYWNrZXQsIHRoZW4gaXQgaXMgYW4KICAgICAgICAgICAgLy8gYXJyYXkg
YmVpbmcgcGFzc2VkIGJ5IHJlZmVyZW5jZSwgbm90IGEgY2FzdAogICAgICAgICAgICB0bXAg
PSBjaHVua19nZXRfbmV4dF9uY25sKG5leHQpOwoKICAgICAgICAgICAgaWYgKGNodW5rX2lz
X3Rva2VuKHRtcCwgQ1RfQU1QKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBhdXRv
IHRtcDIgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcCk7CgogICAgICAgICAgICAgICBpZiAo
Y2h1bmtfaXNfdG9rZW4odG1wMiwgQ1RfV09SRCkpCiAgICAgICAgICAgICAgIHsKICAgICAg
ICAgICAgICAgICAgdG1wMiA9IGNodW5rX2dldF9uZXh0X25jbmwodG1wMik7CiAgICAgICAg
ICAgICAgIH0KCiAgICAgICAgICAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAyLCBDVF9Q
QVJFTl9DTE9TRSkpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgdG1wMiA9
IGNodW5rX2dldF9uZXh0X25jbmwodG1wMik7CgogICAgICAgICAgICAgICAgICBpZiAoY2h1
bmtfaXNfdG9rZW4odG1wMiwgQ1RfU1FVQVJFX09QRU4pKQogICAgICAgICAgICAgICAgICB7
CiAgICAgICAgICAgICAgICAgICAgIGlzX2J5cmVmX2FycmF5ID0gdHJ1ZTsKICAgICAgICAg
ICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9CWVJFRik7CiAgICAgICAgICAg
ICAgICAgIH0KICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgIH0KCiAg
ICAgICAgIGlmICghaXNfYnlyZWZfYXJyYXkpCiAgICAgICAgIHsKICAgICAgICAgICAgdG1w
ID0gY2h1bmtfZ2V0X25leHRfdHlwZShuZXh0LCBDVF9QQVJFTl9DTE9TRSwgbmV4dC0+bGV2
ZWwpOwoKICAgICAgICAgICAgaWYgKHRtcCAhPSBudWxscHRyKQogICAgICAgICAgICB7CiAg
ICAgICAgICAgICAgIHRtcCA9IGNodW5rX2dldF9uZXh0KHRtcCk7CgogICAgICAgICAgICAg
ICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9QQVJFTl9PUEVOKSkKICAgICAgICAgICAg
ICAgewogICAgICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfRlVOQ1RJT04p
OwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg
ewogICAgICAgICAgICAgICAgICBpZiAoICBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09
IENUX05PTkUKICAgICAgICAgICAgICAgICAgICAgJiYgIXBjLT5mbGFncy50ZXN0KFBDRl9J
Tl9UWVBFREVGKSkKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICB0
bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKG5leHQpOwoKICAgICAgICAgICAgICAgICAgICAg
aWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfUEFSRU5fQ0xPU0UpKQogICAgICAgICAgICAg
ICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIGhhdmUgVFlQRSgpCiAg
ICAgICAgICAgICAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DVElPTik7
CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAg
ICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIGhhdmUg
VFlQRSguLi4pCiAgICAgICAgICAgICAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBD
VF9DUFBfQ0FTVCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldF9wYXJlbl9wYXJlbnQo
bmV4dCwgQ1RfQ1BQX0NBU1QpOwogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg
ICAgICAgIH0KICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgIH0KICAg
ICAgfQogICB9CgogICBpZiAobGFuZ3VhZ2VfaXNfc2V0KExBTkdfUEFXTikpCiAgIHsKICAg
ICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0ZVTkNUSU9OKQogICAgICAgICAmJiBw
Yy0+YnJhY2VfbGV2ZWwgPiAwKQogICAgICB7CiAgICAgICAgIExPR19GTVQoTEZDTiwgIiVz
KCVkKTogKDIpIFNFVCBUTyBDVF9GVU5DX0NBTEw6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdf
Y29sIGlzICV6dSwgdGV4dCgpICclcydcbiIsCiAgICAgICAgICAgICAgICAgX19mdW5jX18s
IF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIHBjLT50ZXh0KCkpOwog
ICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfRlVOQ19DQUxMKTsKICAgICAgfQoKICAg
ICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NUQVRFKQogICAgICAgICAmJiBjaHVu
a19pc190b2tlbihuZXh0LCBDVF9QQVJFTl9PUEVOKSkKICAgICAgewogICAgICAgICBzZXRf
cGFyZW5fcGFyZW50KG5leHQsIHBjLT50eXBlKTsKICAgICAgfQogICB9CiAgIGVsc2UKICAg
ewogICAgICBpZiAoICAoICBjaHVua19pc190b2tlbihwYywgQ1RfRlVOQ1RJT04pCiAgICAg
ICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9GVU5DX0RFRikpCiAgICAgICAgICYm
ICggIChnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09IENUX09DX0JMT0NLX0VYUFIpCiAg
ICAgICAgICAgIHx8ICFpc19vY19ibG9jayhwYykpKQogICAgICB7CiAgICAgICAgIG1hcmtf
ZnVuY3Rpb24ocGMpOwogICAgICB9CiAgIH0KCiAgIC8vIERldGVjdCBDOTkgbWVtYmVyIHN0
dWZmCiAgIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9NRU1CRVIpCiAgICAgICYmICgg
IGNodW5rX2lzX3Rva2VuKHByZXYsIENUX0NPTU1BKQogICAgICAgICB8fCBjaHVua19pc190
b2tlbihwcmV2LCBDVF9CUkFDRV9PUEVOKSkpCiAgIHsKICAgICAgc2V0X2NodW5rX3R5cGUo
cGMsIENUX0M5OV9NRU1CRVIpOwogICAgICBzZXRfY2h1bmtfcGFyZW50KG5leHQsIENUX0M5
OV9NRU1CRVIpOwogICB9CgogICAvLyBNYXJrIGZ1bmN0aW9uIHBhcmVucyBhbmQgYnJhY2Vz
CiAgIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9GVU5DX0RFRikKICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX0ZVTkNfQ0FMTCkKICAgICAgfHwgY2h1bmtfaXNfdG9rZW4o
cGMsIENUX0ZVTkNfQ0FMTF9VU0VSKQogICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1Rf
RlVOQ19QUk9UTykpCiAgIHsKICAgICAgdG1wID0gbmV4dDsKCiAgICAgIGlmIChjaHVua19p
c190b2tlbih0bXAsIENUX1NRVUFSRV9PUEVOKSkKICAgICAgewogICAgICAgICB0bXAgPSBz
ZXRfcGFyZW5fcGFyZW50KHRtcCwgcGMtPnR5cGUpOwogICAgICB9CiAgICAgIGVsc2UgaWYg
KGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfVFNRVUFSRSkgfHwgZ2V0X2NodW5rX3BhcmVudF90
eXBlKHRtcCkgPT0gQ1RfT1BFUkFUT1IpCiAgICAgIHsKICAgICAgICAgdG1wID0gY2h1bmtf
Z2V0X25leHRfbmNubCh0bXApOwogICAgICB9CgogICAgICBpZiAodG1wICE9IG51bGxwdHIp
CiAgICAgIHsKICAgICAgICAgaWYgKGNodW5rX2lzX3BhcmVuX29wZW4odG1wKSkKICAgICAg
ICAgewogICAgICAgICAgICB0bXAgPSBmbGFnX3BhcmVucyh0bXAsIFBDRl9OT05FLCBDVF9G
UEFSRU5fT1BFTiwgcGMtPnR5cGUsIGZhbHNlKTsKCiAgICAgICAgICAgIGlmICh0bXAgIT0g
bnVsbHB0cikKICAgICAgICAgICAgewogICAgICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9r
ZW4odG1wLCBDVF9CUkFDRV9PUEVOKSkKICAgICAgICAgICAgICAgewogICAgICAgICAgICAg
ICAgICBpZiAoICBnZXRfY2h1bmtfcGFyZW50X3R5cGUodG1wKSAhPSBDVF9ET1VCTEVfQlJB
Q0UKICAgICAgICAgICAgICAgICAgICAgJiYgIXBjLT5mbGFncy50ZXN0KFBDRl9JTl9DT05T
VF9BUkdTKSkKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICBzZXRf
cGFyZW5fcGFyZW50KHRtcCwgcGMtPnR5cGUpOwogICAgICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICAgIH0KICAgICAgICAgICAgICAgZWxzZSBpZiAoICBjaHVua19pc19zZW1pY29s
b24odG1wKQogICAgICAgICAgICAgICAgICAgICAgICYmIGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9GVU5DX1BST1RPKSkKICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBzZXRf
Y2h1bmtfcGFyZW50KHRtcCwgcGMtPnR5cGUpOwogICAgICAgICAgICAgICB9CiAgICAgICAg
ICAgIH0KICAgICAgICAgfQogICAgICB9CiAgIH0KCiAgIC8vIE1hcmsgdGhlIHBhcmFtZXRl
cnMgaW4gY2F0Y2goKQogICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0NBVENIKSAmJiBj
aHVua19pc190b2tlbihuZXh0LCBDVF9TUEFSRU5fT1BFTikpCiAgIHsKICAgICAgZml4X2Zj
bl9kZWZfcGFyYW1zKG5leHQpOwogICB9CgogICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENU
X1RIUk9XKSAmJiBjaHVua19pc190b2tlbihwcmV2LCBDVF9GUEFSRU5fQ0xPU0UpKQogICB7
CiAgICAgIHNldF9jaHVua19wYXJlbnQocGMsIGdldF9jaHVua19wYXJlbnRfdHlwZShwcmV2
KSk7CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfUEFSRU5fT1BFTikpCiAg
ICAgIHsKICAgICAgICAgc2V0X3BhcmVuX3BhcmVudChuZXh0LCBDVF9USFJPVyk7CiAgICAg
IH0KICAgfQoKICAgLy8gTWFyayB0aGUgYnJhY2VzIGluOiAiZm9yX2VhY2hfZW50cnkoeHh4
KSB7IH0iCiAgIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9CUkFDRV9PUEVOKQogICAg
ICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpICE9IENUX0RPVUJMRV9CUkFDRQogICAg
ICAmJiBjaHVua19pc190b2tlbihwcmV2LCBDVF9GUEFSRU5fQ0xPU0UpCiAgICAgICYmICgg
IGdldF9jaHVua19wYXJlbnRfdHlwZShwcmV2KSA9PSBDVF9GVU5DX0NBTEwKICAgICAgICAg
fHwgZ2V0X2NodW5rX3BhcmVudF90eXBlKHByZXYpID09IENUX0ZVTkNfQ0FMTF9VU0VSKQog
ICAgICAmJiAhcGMtPmZsYWdzLnRlc3QoUENGX0lOX0NPTlNUX0FSR1MpKQogICB7CiAgICAg
IExPR19GTVQoTEZDTiwgIiVzKCVkKTogKDMpIFNFVCBUTyBDVF9GVU5DX0NBTEw6IG9yaWdf
bGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcydcbiIsCiAgICAgICAg
ICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2ws
IHBjLT50ZXh0KCkpOwogICAgICBzZXRfcGFyZW5fcGFyZW50KHBjLCBDVF9GVU5DX0NBTEwp
OwogICB9CgogICAvKgogICAgKiBDaGVjayBmb3IgYSBjbG9zZSBwYXJlbnRoZXNpcyBmb2xs
b3dlZCBieSBhbiBvcGVuIHBhcmVudGhlc2lzLAogICAgKiB3aGljaCBtZWFucyB0aGF0IHdl
IGFyZSBvbiBhIGZ1bmN0aW9uIHR5cGUgZGVjbGFyYXRpb24gKEMvQysrIG9ubHk/KS4KICAg
ICogTm90ZSB0aGF0IHR5cGVkZWZzIGFyZSBhbHJlYWR5IHRha2VuIGNhcmUgb2YuCiAgICAq
LwogICBpZiAoICAhcGMtPmZsYWdzLnRlc3RfYW55KFBDRl9JTl9UWVBFREVGIHwgUENGX0lO
X1RFTVBMQVRFKQogICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpICE9IENUX0NQ
UF9DQVNUCiAgICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgIT0gQ1RfQ19DQVNU
CiAgICAgICYmICFwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykKICAgICAgJiYgIWlz
X29jX2Jsb2NrKHBjKQogICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpICE9IENU
X09DX01TR19ERUNMCiAgICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgIT0gQ1Rf
T0NfTVNHX1NQRUMKICAgICAgJiYgY2h1bmtfaXNfc3RyKHBjLCAiKSIsIDEpCiAgICAgICYm
IGNodW5rX2lzX3N0cihuZXh0LCAiKCIsIDEpKQogICB7CiAgICAgIGlmIChsYW5ndWFnZV9p
c19zZXQoTEFOR19EKSkKICAgICAgewogICAgICAgICBmbGFnX3BhcmVucyhuZXh0LCBQQ0Zf
Tk9ORSwgQ1RfRlBBUkVOX09QRU4sIENUX0ZVTkNfQ0FMTCwgZmFsc2UpOwogICAgICB9CiAg
ICAgIGVsc2UKICAgICAgewogICAgICAgICBtYXJrX2Z1bmN0aW9uX3R5cGUocGMpOwogICAg
ICB9CiAgIH0KCiAgIGlmICggIChjaHVua19pc190b2tlbihwYywgQ1RfQ0xBU1MpIHx8IGNo
dW5rX2lzX3Rva2VuKHBjLCBDVF9TVFJVQ1QpKQogICAgICAmJiBwYy0+bGV2ZWwgPT0gcGMt
PmJyYWNlX2xldmVsKQogICB7CiAgICAgIGlmIChwYy0+dHlwZSAhPSBDVF9TVFJVQ1QgfHwg
IWxhbmd1YWdlX2lzX3NldChMQU5HX0MpKQogICAgICB7CiAgICAgICAgIG1hcmtfY2xhc3Nf
Y3RvcihwYyk7CiAgICAgIH0KICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9P
Q19DTEFTUykpCiAgIHsKICAgICAgaGFuZGxlX29jX2NsYXNzKHBjKTsKICAgfQogICAvLyBU
T0RPOiBDaGVjayBmb3Igc3R1ZmYgdGhhdCBjYW4gb25seSBvY2N1ciBhdCB0aGUgc3RhcnQg
b2YgYW4gc3RhdGVtZW50CgogICBpZiAoIWxhbmd1YWdlX2lzX3NldChMQU5HX0QpKQogICB7
CiAgICAgIC8qCiAgICAgICAqIENoZWNrIGEgcGFyZW50aGVzaXMgcGFpciB0byBzZWUgaWYg
aXQgaXMgYSBjYXN0LgogICAgICAgKiBOb3RlIHRoYXQgU1BBUkVOIGFuZCBGUEFSRU4gaGF2
ZSBhbHJlYWR5IGJlZW4gbWFya2VkLgogICAgICAgKi8KICAgICAgaWYgKCAgY2h1bmtfaXNf
dG9rZW4ocGMsIENUX1BBUkVOX09QRU4pCiAgICAgICAgICYmICggIGdldF9jaHVua19wYXJl
bnRfdHlwZShwYykgPT0gQ1RfTk9ORQogICAgICAgICAgICB8fCBnZXRfY2h1bmtfcGFyZW50
X3R5cGUocGMpID09IENUX09DX01TRwogICAgICAgICAgICB8fCBnZXRfY2h1bmtfcGFyZW50
X3R5cGUocGMpID09IENUX09DX0JMT0NLX0VYUFIKICAgICAgICAgICAgfHwgZ2V0X2NodW5r
X3BhcmVudF90eXBlKHBjKSA9PSBDVF9DU19TUV9TVE1UKSAgICAgICAgICAgLy8gSXNzdWUg
IyAxMjU2CiAgICAgICAgICYmICggIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1dPUkQpCiAg
ICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1RZUEUpCiAgICAgICAgICAg
IHx8IGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1NUUlVDVCkKICAgICAgICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4obmV4dCwgQ1RfUVVBTElGSUVSKQogICAgICAgICAgICB8fCBjaHVua19p
c190b2tlbihuZXh0LCBDVF9NRU1CRVIpCiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2Vu
KG5leHQsIENUX0RDX01FTUJFUikKICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4obmV4
dCwgQ1RfRU5VTSkKICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfVU5J
T04pKQogICAgICAgICAmJiBwcmV2LT50eXBlICE9IENUX0RFQ0xUWVBFCiAgICAgICAgICYm
IHByZXYtPnR5cGUgIT0gQ1RfU0laRU9GCiAgICAgICAgICYmIGdldF9jaHVua19wYXJlbnRf
dHlwZShwcmV2KSAhPSBDVF9TSVpFT0YKICAgICAgICAgJiYgZ2V0X2NodW5rX3BhcmVudF90
eXBlKHByZXYpICE9IENUX09QRVJBVE9SCiAgICAgICAgICYmICFwYy0+ZmxhZ3MudGVzdChQ
Q0ZfSU5fVFlQRURFRikpCiAgICAgIHsKICAgICAgICAgZml4X2Nhc3RzKHBjKTsKICAgICAg
fQogICB9CgogICBpZiAobGFuZ3VhZ2VfaXNfc2V0KExBTkdfQ1BQKSkKICAgewogICAgICBj
aHVua190ICpubmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwobmV4dCk7CgogICAgICAvLyBo
YW5kbGUgcGFyZW50X3R5cGUgb2YgYXNzaWducyBpbiBzcGVjaWFsIGZ1bmN0aW9ucyAocm81
ICsgcHVyZSB2aXJ0dWFsKQogICAgICBpZiAoICBwYy0+ZmxhZ3MudGVzdF9hbnkoUENGX0lO
X1NUUlVDVCB8IFBDRl9JTl9DTEFTUykKICAgICAgICAgJiYgY2h1bmtfaXNfdG9rZW4ocGMs
IENUX0FTU0lHTikKICAgICAgICAgJiYgY2h1bmtfaXNfdG9rZW4obm5leHQsIENUX1NFTUlD
T0xPTikKICAgICAgICAgJiYgKCAgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfREVGQVVMVCkK
ICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfREVMRVRFKQogICAgICAg
ICAgICB8fCAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfTlVNQkVSKSAmJiBjaHVua19pc19z
dHIobmV4dCwgIjAiLCAxKSkpKQogICAgICB7CiAgICAgICAgIGNvbnN0IHNpemVfdCBsZXZl
bCAgICAgICAgPSBwYy0+bGV2ZWw7CiAgICAgICAgIGJvb2wgICAgICAgICBmb3VuZF9zdGF0
dXMgPSBmYWxzZTsKICAgICAgICAgY2h1bmtfdCAgICAgICpwcHJldiAgICAgICA9IGNodW5r
X2dldF9wcmV2KHBjKTsKCiAgICAgICAgIGZvciAoIDsgKCAgcHByZXYgIT0gbnVsbHB0cgog
ICAgICAgICAgICAgICAgICYmIHBwcmV2LT5sZXZlbCA+PSBsZXZlbAogICAgICAgICAgICAg
ICAgICYmIHBwcmV2LT50eXBlICE9IENUX1NFTUlDT0xPTgogICAgICAgICAgICAgICAgICYm
IHBwcmV2LT50eXBlICE9IENUX0FDQ0VTU19DT0xPTikKICAgICAgICAgICAgICAgOyBwcHJl
diA9IGNodW5rX2dldF9wcmV2KHBwcmV2KSkKICAgICAgICAgewogICAgICAgICAgICBpZiAo
cHByZXYtPmxldmVsICE9IGxldmVsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGNv
bnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4o
bmV4dCwgQ1RfTlVNQkVSKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBpZiAoICBw
cHJldi0+dHlwZSA9PSBDVF9RVUFMSUZJRVIKICAgICAgICAgICAgICAgICAgJiYgY2h1bmtf
aXNfc3RyKHBwcmV2LCAidmlydHVhbCIsIDcpKQogICAgICAgICAgICAgICB7CiAgICAgICAg
ICAgICAgICAgIGZvdW5kX3N0YXR1cyA9IHRydWU7CiAgICAgICAgICAgICAgICAgIGJyZWFr
OwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAg
ICAgICAgICB7CiAgICAgICAgICAgICAgIGlmICggIHBwcmV2LT50eXBlID09IENUX0ZVTkNf
Q0xBU1NfUFJPVE8gIC8vIGN0b3IvZHRvcgogICAgICAgICAgICAgICAgICB8fCBwcHJldi0+
dHlwZSA9PSBDVF9GVU5DX1BST1RPKSAgICAgICAvLyBub3JtYWwgZnVuY3Rpb24KICAgICAg
ICAgICAgICAgewogICAgICAgICAgICAgICAgICBmb3VuZF9zdGF0dXMgPSB0cnVlOwogICAg
ICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg
ICAgICAgIH0KCiAgICAgICAgIGlmIChmb3VuZF9zdGF0dXMpCiAgICAgICAgIHsKICAgICAg
ICAgICAgc2V0X2NodW5rX3BhcmVudChwYywgcHByZXYtPnR5cGUpOwogICAgICAgICB9CiAg
ICAgIH0KICAgICAgLy8gSXNzdWUgIzIzMzIKICAgICAgYm9vbCB3ZV9oYXZlX2FfY2FzZV9i
ZWZvcmUgPSBmYWxzZTsKCiAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfQ09MT04p
KQogICAgICB7CiAgICAgICAgIC8vIGNoZWNrIGlmIHdlIGhhdmUgYSBjYXNlIGJlZm9yZQog
ICAgICAgICBjaHVua190ICpzd2l0Y2hfYmVmb3JlID0gY2h1bmtfZ2V0X3ByZXZfdHlwZShw
YywgQ1RfQ0FTRSwgcGMtPmxldmVsKTsKCiAgICAgICAgIGlmIChzd2l0Y2hfYmVmb3JlICE9
IG51bGxwdHIpCiAgICAgICAgIHsKICAgICAgICAgICAgTE9HX0ZNVChMRkNOUiwgIiVzKCVk
KTogc3dpdGNoX2JlZm9yZS0+b3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0
ZXh0KCkgaXMgJyVzJywgdHlwZSBpcyAlc1xuIiwKICAgICAgICAgICAgICAgICAgICBfX2Z1
bmNfXywgX19MSU5FX18sIHN3aXRjaF9iZWZvcmUtPm9yaWdfbGluZSwgc3dpdGNoX2JlZm9y
ZS0+b3JpZ19jb2wsCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoX2JlZm9yZS0+dGV4dCgp
LCBnZXRfdG9rZW5fbmFtZShzd2l0Y2hfYmVmb3JlLT50eXBlKSk7CiAgICAgICAgICAgIHdl
X2hhdmVfYV9jYXNlX2JlZm9yZSA9IHRydWU7CiAgICAgICAgIH0KICAgICAgfQoKICAgICAg
Ly8gRGV0ZWN0IGEgYnJhY2VkLWluaXQtbGlzdAogICAgICBpZiAoICBjaHVua19pc190b2tl
bihwYywgQ1RfV09SRCkKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RZUEUp
CiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BU1NJR04pCiAgICAgICAgIHx8
IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9SRVRVUk4pCiAgICAgICAgIHx8IGNodW5rX2lzX3Rv
a2VuKHBjLCBDVF9DT01NQSkKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FO
R0xFX0NMT1NFKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfU1FVQVJFX0NM
T1NFKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfVFNRVUFSRSkKICAgICAg
ICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0ZQQVJFTl9PUEVOKQogICAgICAgICB8fCBj
aHVua19pc190b2tlbihwYywgQ1RfUVVFU1RJT04pCiAgICAgICAgIHx8ICggIGNodW5rX2lz
X3Rva2VuKHBjLCBDVF9DT0xPTikKICAgICAgICAgICAgJiYgIXdlX2hhdmVfYV9jYXNlX2Jl
Zm9yZSkKICAgICAgICAgfHwgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0JSQUNFX09QRU4p
CiAgICAgICAgICAgICYmICggIGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgPT0gQ1RfTk9O
RQogICAgICAgICAgICAgICB8fCBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09IENUX0JS
QUNFRF9JTklUX0xJU1QpKSkKICAgICAgewogICAgICAgICBsb2dfcGNmX2ZsYWdzKExGQ05S
LCBwYy0+ZmxhZ3MpOwogICAgICAgICBhdXRvIGJyYWNlX29wZW4gPSBjaHVua19nZXRfbmV4
dF9uY25sKHBjKTsKCiAgICAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKGJyYWNlX29wZW4s
IENUX0JSQUNFX09QRU4pCiAgICAgICAgICAgICYmICggIGdldF9jaHVua19wYXJlbnRfdHlw
ZShicmFjZV9vcGVuKSA9PSBDVF9OT05FCiAgICAgICAgICAgICAgIHx8IGdldF9jaHVua19w
YXJlbnRfdHlwZShicmFjZV9vcGVuKSA9PSBDVF9BU1NJR04KICAgICAgICAgICAgICAgfHwg
Z2V0X2NodW5rX3BhcmVudF90eXBlKGJyYWNlX29wZW4pID09IENUX1JFVFVSTgogICAgICAg
ICAgICAgICB8fCBnZXRfY2h1bmtfcGFyZW50X3R5cGUoYnJhY2Vfb3BlbikgPT0gQ1RfQlJB
Q0VEX0lOSVRfTElTVCkpCiAgICAgICAgIHsKICAgICAgICAgICAgbG9nX3BjZl9mbGFncyhM
RkNOUiwgYnJhY2Vfb3Blbi0+ZmxhZ3MpOwogICAgICAgICAgICBhdXRvIGJyYWNlX2Nsb3Nl
ID0gY2h1bmtfc2tpcF90b19tYXRjaChuZXh0KTsKCiAgICAgICAgICAgIGlmIChjaHVua19p
c190b2tlbihicmFjZV9jbG9zZSwgQ1RfQlJBQ0VfQ0xPU0UpKQogICAgICAgICAgICB7CiAg
ICAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQoYnJhY2Vfb3BlbiwgQ1RfQlJBQ0VEX0lO
SVRfTElTVCk7CiAgICAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQoYnJhY2VfY2xvc2Us
IENUX0JSQUNFRF9JTklUX0xJU1QpOwoKICAgICAgICAgICAgICAgdG1wID0gY2h1bmtfZ2V0
X25leHRfbmNubChicmFjZV9jbG9zZSk7CgogICAgICAgICAgICAgICBpZiAodG1wKQogICAg
ICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGNodW5rX2ZsYWdzX2Nscih0bXAsIFBD
Rl9FWFBSX1NUQVJUIHwgUENGX1NUTVRfU1RBUlQpOwogICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICAgIC8vIFRPRE86IENoYW5nZSBwYy0+dHlwZSBDVF9XT1JEIC0+IENUX1RZUEUK
ICAgICAgICAgICAgICAgLy8gZm9yIHRoZSBjYXNlIENUX0FTU0lHTiAoYW5kIG90aGVycyku
CgogICAgICAgICAgICAgICAvLyBUT0RPOiBNb3ZlIHRoaXMgYmxvY2sgdG8gdGhlIGZpeF9m
Y25fY2FsbF9hcmdzIGZ1bmN0aW9uLgogICAgICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX1dPUkQpICYmIHBjLT5mbGFncy50ZXN0KFBDRl9JTl9GQ05fQ0FMTCkpCiAg
ICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENU
X1RZUEUpOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgfQogICAg
ICB9CiAgIH0KCiAgIC8vIENoZWNrIGZvciBzdHVmZiB0aGF0IGNhbiBvbmx5IG9jY3VyIGF0
IHRoZSBzdGFydCBvZiBhbiBleHByZXNzaW9uCiAgIGlmICggIHBjLT5mbGFncy50ZXN0KFBD
Rl9FWFBSX1NUQVJUKQogICAgICB8fCAocHJldi0+ZmxhZ3MudGVzdChQQ0ZfRVhQUl9TVEFS
VCkgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9PQ19BVCkpCiAgIHsKICAg
ICAgLy8gQ2hhbmdlIFNUQVIsIE1JTlVTLCBhbmQgUExVUyBpbiB0aGUgZWFzeSBjYXNlcwog
ICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NUQVIpKQogICAgICB7CiAgICAgICAg
IC8vIGlzc3VlICM1OTYKICAgICAgICAgLy8gWzB4MTAwMDYyMDIwOklOX1NQQVJFTixJTl9G
T1IsU1RNVF9TVEFSVCxFWFBSX1NUQVJULFBVTkNUVUFUT1JdCiAgICAgICAgIC8vIHByZXYt
PnR5cGUgaXMgQ1RfQ09MT04gPT0+IENUX0RFUkVGCiAgICAgICAgIGlmIChjaHVua19pc190
b2tlbihwcmV2LCBDVF9BTkdMRV9DTE9TRSkpCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0
X2NodW5rX3R5cGUocGMsIENUX1BUUl9UWVBFKTsKICAgICAgICAgfQogICAgICAgICBlbHNl
IGlmIChjaHVua19pc190b2tlbihwcmV2LCBDVF9DT0xPTikpCiAgICAgICAgIHsKICAgICAg
ICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0RFUkVGKTsKICAgICAgICAgfQogICAgICAg
ICBlbHNlCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0RF
UkVGKTsKICAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoICBsYW5ndWFnZV9pc19zZXQo
TEFOR19DUFApCiAgICAgICAgICYmIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DQVJFVCkKICAg
ICAgICAgJiYgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfQU5HTEVfQ0xPU0UpKQogICAgICB7
CiAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9QVFJfVFlQRSk7CiAgICAgIH0KCiAg
ICAgIGlmICggIGxhbmd1YWdlX2lzX3NldChMQU5HX0NTKQogICAgICAgICAmJiAoY2h1bmtf
aXNfdG9rZW4ocGMsIENUX1FVRVNUSU9OKSkKICAgICAgICAgJiYgKGNodW5rX2lzX3Rva2Vu
KHByZXYsIENUX0FOR0xFX0NMT1NFKSkpCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5
cGUocGMsIENUX1BUUl9UWVBFKTsKICAgICAgfQoKICAgICAgaWYgKGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9NSU5VUykpCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENU
X05FRyk7CiAgICAgIH0KCiAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfUExVUykp
CiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX1BPUyk7CiAgICAgIH0K
CiAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfSU5DREVDX0FGVEVSKSkKICAgICAg
ewogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfSU5DREVDX0JFRk9SRSk7CiAgICAg
IH0KCiAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfQU1QKSkKICAgICAgewogICAg
ICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfQU5HTEVfQ0xPU0UpKSAgICAgICAg
ICAgICAvLyBJc3N1ZSAjMjMyNAogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua190
eXBlKHBjLCBDVF9CWVJFRik7CiAgICAgICAgIH0KICAgICAgICAgZWxzZQogICAgICAgICB7
CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9BRERSKTsKICAgICAgICAgfQog
ICAgICB9CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0NBUkVUKSkKICAgICAg
ewogICAgICAgICBpZiAobGFuZ3VhZ2VfaXNfc2V0KExBTkdfQyB8IExBTkdfQ1BQIHwgTEFO
R19PQykpCiAgICAgICAgIHsKICAgICAgICAgICAgLy8gVGhpcyBpcyBsaWtlbHkgdGhlIHN0
YXJ0IG9mIGEgYmxvY2sgbGl0ZXJhbAogICAgICAgICAgICBoYW5kbGVfb2NfYmxvY2tfbGl0
ZXJhbChwYyk7CiAgICAgICAgIH0KICAgICAgfQogICB9CgogICAvLyBEZXRlY3QgYSB2YXJp
YWJsZSBkZWZpbml0aW9uIHRoYXQgc3RhcnRzIHdpdGggc3RydWN0L2VudW0vdW5pb24vY2xh
c3MKICAgaWYgKCAgIXBjLT5mbGFncy50ZXN0KFBDRl9JTl9UWVBFREVGKQogICAgICAmJiBn
ZXRfY2h1bmtfcGFyZW50X3R5cGUocHJldikgIT0gQ1RfQ1BQX0NBU1QKICAgICAgJiYgIXBy
ZXYtPmZsYWdzLnRlc3QoUENGX0lOX0ZDTl9ERUYpCiAgICAgICYmICggIGNodW5rX2lzX3Rv
a2VuKHBjLCBDVF9TVFJVQ1QpCiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9V
TklPTikKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0NMQVNTKQogICAgICAg
ICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfRU5VTSkpKQogICB7CiAgICAgIHRtcCA9IGNo
dW5rX3NraXBfZGNfbWVtYmVyKG5leHQpOwoKICAgICAgaWYgKChjaHVua19pc190b2tlbih0
bXAsIENUX1RZUEUpIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfV09SRCkpKQogICAgICB7
CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBwYy0+dHlwZSk7CiAgICAgICAgIHNl
dF9jaHVua190eXBlKHRtcCwgQ1RfVFlQRSk7CgogICAgICAgICB0bXAgPSBjaHVua19nZXRf
bmV4dF9uY25sKHRtcCk7CiAgICAgIH0KCiAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAs
IENUX0JSQUNFX09QRU4pKQogICAgICB7CiAgICAgICAgIHRtcCA9IGNodW5rX3NraXBfdG9f
bWF0Y2godG1wKTsKCiAgICAgICAgIGlmICh0bXAgIT0gbnVsbHB0cikKICAgICAgICAgewog
ICAgICAgICAgICB0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcCk7CiAgICAgICAgIH0K
ICAgICAgfQoKICAgICAgaWYgKCAgdG1wICE9IG51bGxwdHIKICAgICAgICAgJiYgKGNodW5r
X2lzX3B0cl9vcGVyYXRvcih0bXApIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfV09SRCkp
KQogICAgICB7CiAgICAgICAgIG1hcmtfdmFyaWFibGVfZGVmaW5pdGlvbih0bXApOwogICAg
ICB9CiAgIH0KCiAgIC8qCiAgICAqIENoYW5nZSB0aGUgcGFyZW50aGVzaXMgcGFpciBhZnRl
ciBhIGZ1bmN0aW9uL21hY3JvLWZ1bmN0aW9uCiAgICAqIENUX1BBUkVOX09QRU4gPT4gQ1Rf
RlBBUkVOX09QRU4KICAgICovCiAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfTUFDUk9f
RlVOQykpCiAgIHsKICAgICAgZmxhZ19wYXJlbnMobmV4dCwgUENGX0lOX0ZDTl9DQUxMLCBD
VF9GUEFSRU5fT1BFTiwgQ1RfTUFDUk9fRlVOQywgZmFsc2UpOwogICB9CgogICBpZiAoICBj
aHVua19pc190b2tlbihwYywgQ1RfTUFDUk9fT1BFTikKICAgICAgfHwgY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX01BQ1JPX0VMU0UpCiAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9N
QUNST19DTE9TRSkpCiAgIHsKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1BB
UkVOX09QRU4pKQogICAgICB7CiAgICAgICAgIGZsYWdfcGFyZW5zKG5leHQsIFBDRl9OT05F
LCBDVF9GUEFSRU5fT1BFTiwgcGMtPnR5cGUsIGZhbHNlKTsKICAgICAgfQogICB9CgogICBp
ZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0RFTEVURSkgJiYgY2h1bmtfaXNfdG9rZW4obmV4
dCwgQ1RfVFNRVUFSRSkpCiAgIHsKICAgICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBDVF9E
RUxFVEUpOwogICB9CgogICAvLyBDaGFuZ2UgQ1RfU1RBUiB0byBDVF9QVFJfVFlQRSBvciBD
VF9BUklUSCBvciBDVF9ERVJFRgogICBpZiAoICBjaHVua19pc190b2tlbihwYywgQ1RfU1RB
UikKICAgICAgfHwgKGxhbmd1YWdlX2lzX3NldChMQU5HX0NQUCkgJiYgY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX0NBUkVUKSkpCiAgIHsKICAgICAgaWYgKGNodW5rX2lzX3BhcmVuX2Nsb3Nl
KG5leHQpIHx8IGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0NPTU1BKSkKICAgICAgewogICAg
ICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfUFRSX1RZUEUpOwogICAgICB9CiAgICAgIGVs
c2UgaWYgKGxhbmd1YWdlX2lzX3NldChMQU5HX09DKSAmJiBjaHVua19pc190b2tlbihuZXh0
LCBDVF9TVEFSKSkKICAgICAgewogICAgICAgICAvKgogICAgICAgICAgKiBDaGFuZ2UgcG9p
bnRlci10by1wb2ludGVyIHR5cGVzIGluIE9DX01TR19ERUNMcwogICAgICAgICAgKiBmcm9t
IEFSSVRIIDw9PT0+IERFUkVGIHRvIFBUUl9UWVBFIDw9PT0+IFBUUl9UWVBFCiAgICAgICAg
ICAqLwogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfUFRSX1RZUEUpOwogICAgICAg
ICBzZXRfY2h1bmtfcGFyZW50KHBjLCBnZXRfY2h1bmtfcGFyZW50X3R5cGUocHJldikpOwoK
ICAgICAgICAgc2V0X2NodW5rX3R5cGUobmV4dCwgQ1RfUFRSX1RZUEUpOwogICAgICAgICBz
ZXRfY2h1bmtfcGFyZW50KG5leHQsIGdldF9jaHVua19wYXJlbnRfdHlwZShwYykpOwogICAg
ICB9CiAgICAgIGVsc2UgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NUQVIpCiAgICAg
ICAgICAgICAgJiYgKCAgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfREVDTFRZUEUpCiAgICAg
ICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfU0laRU9GKQogICAgICAg
ICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHByZXYsIENUX0RFTEVURSkKICAgICAgICAg
ICAgICAgICB8fCAocGMgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9TSVpF
T0YpKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfREVSRUYpOwog
ICAgICB9CiAgICAgIGVsc2UgaWYgKCAgKCAgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfV09S
RCkKICAgICAgICAgICAgICAgICAmJiBjaHVua19lbmRzX3R5cGUocHJldikKICAgICAgICAg
ICAgICAgICAmJiAhcHJldi0+ZmxhZ3MudGVzdChQQ0ZfSU5fRkNOX0NUT1IpKQogICAgICAg
ICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHByZXYsIENUX0RDX01FTUJFUikKICAgICAgICAg
ICAgICB8fCBjaHVua19pc190b2tlbihwcmV2LCBDVF9QVFJfVFlQRSkpCiAgICAgIHsKICAg
ICAgICAgTE9HX0ZNVChMRkNOUiwgIiVzKCVkKTogcGMtPm9yaWdfbGluZSBpcyAlenUsIG9y
aWdfY29sIGlzICV6dSwgdGV4dCgpIGlzICclcycsIHR5cGUgaXMgJXNcbiAgICIsCiAgICAg
ICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3Jp
Z19jb2wsIHBjLT50ZXh0KCksIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CiAgICAgICAg
IGxvZ19wY2ZfZmxhZ3MoTEZDTlIsIHBjLT5mbGFncyk7CiAgICAgICAgIHNldF9jaHVua190
eXBlKHBjLCBDVF9QVFJfVFlQRSk7CiAgICAgIH0KICAgICAgZWxzZSBpZiAoY2h1bmtfaXNf
dG9rZW4obmV4dCwgQ1RfU1FVQVJFX09QRU4pICYmICFsYW5ndWFnZV9pc19zZXQoTEFOR19P
QykpICAvLyBpc3N1ZSAjIDQwOAogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHBj
LCBDVF9QVFJfVFlQRSk7CiAgICAgIH0KICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4o
cGMsIENUX1NUQVIpKQogICAgICB7CiAgICAgICAgIC8vIEFkZCBjaGVjayBmb3IgQ1RfRENf
TUVNQkVSIENUX1dPUkQgQ1RfU1RBUiBzZXF1ZW5jZQogICAgICAgICAvLyB0byBjb252ZXJ0
IENUX1dPUkQgaW50byBDVF9UWVBFCiAgICAgICAgIC8vIGFuZCBDVF9TVEFSIGludG8gQ1Rf
UFRSX1RZUEUKICAgICAgICAgLy8gbG9vayBmb3IgYW4gYXNzaWduIGJhY2t3YXJkIHRvIGRp
c3Rpbmd1aXNoIGJldHdlZW4KICAgICAgICAgLy8gICAgZG91YmxlIHJlc3VsdCA9IENvbnN0
YW50czo6UEkgKiBmYWN0b3I7CiAgICAgICAgIC8vIGFuZAogICAgICAgICAvLyAgICA6OnNv
bWU6Om5hbWUgKiBmb287CiAgICAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKHByZXYsIENU
X1dPUkQpCiAgICAgICAgICAgICYmIGNodW5rX2lzX3Rva2VuKHByZXYtPnByZXYsIENUX0RD
X01FTUJFUikKICAgICAgICAgICAgJiYgbGFuZ3VhZ2VfaXNfc2V0KExBTkdfQ1BQKSkKICAg
ICAgICAgewogICAgICAgICAgICAvLyBJc3N1ZSAxNDAyCiAgICAgICAgICAgIGJvb2wgYXNz
aWduX2ZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgIHRtcCA9IHBjOwoKICAgICAgICAgICAg
d2hpbGUgKHRtcCAhPSBudWxscHRyKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGlm
IChjaHVua19pc190b2tlbih0bXAsIENUX1NFTUlDT0xPTikpCiAgICAgICAgICAgICAgIHsK
ICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg
ICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9BU1NJR04pKQogICAgICAgICAg
ICAgICB7CiAgICAgICAgICAgICAgICAgIGFzc2lnbl9mb3VuZCA9IHRydWU7CiAgICAgICAg
ICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIHRtcCA9
IGNodW5rX2dldF9wcmV2X25jbmxuaSh0bXApOyAvLyBJc3N1ZSAjMjI3OQogICAgICAgICAg
ICB9CgogICAgICAgICAgICBpZiAoYXNzaWduX2ZvdW5kKQogICAgICAgICAgICB7CiAgICAg
ICAgICAgICAgIC8vIGRvdWJsZSByZXN1bHQgPSBDb25zdGFudHM6OlBJICogZmFjdG9yOwog
ICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfQVJJVEgpOwogICAgICAgICAg
ICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAvLyAg
ICA6OnNvbWU6Om5hbWUgKiBmb287CiAgICAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBy
ZXYsIENUX1RZUEUpOwogICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfUFRS
X1RZUEUpOwogICAgICAgICAgICB9CiAgICAgICAgIH0KCiAgICAgICAgIC8qCiAgICAgICAg
ICAqIEEgc3RhciBjYW4gaGF2ZSB0aHJlZSBtZWFuaW5ncwogICAgICAgICAgKiAxLiBDVF9E
RVJFRiAgICA9IHBvaW50ZXIgZGVyZWZlcmVuY2luZwogICAgICAgICAgKiAyLiBDVF9QVFJf
VFlQRSA9IHBvaW50ZXIgZGVmaW5pdGlvbgogICAgICAgICAgKiAzLiBDVF9BUklUSCAgICA9
IGFyaXRobWV0aWMgbXVsdGlwbGljYXRpb24KICAgICAgICAgICoKICAgICAgICAgICogbW9z
dCBQQ0ZfUFVOQ1RVQVRPUiBjaHVua3MgZXhjZXB0IGEgcGFyZW4gY2xvc2Ugd291bGQgbWFr
ZSB0aGlzCiAgICAgICAgICAqIGEgZGVyZWYuIEEgcGFyZW4gY2xvc2UgbWF5IGVuZCBhIGNh
c3Qgb3IgbWF5IGJlIHBhcnQgb2YgYSBtYWNybyBmY24uCiAgICAgICAgICAqLwogICAgICAg
ICBpZiAoY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfVFlQRSkpCiAgICAgICAgIHsKICAgICAg
ICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX1BUUl9UWVBFKTsKICAgICAgICAgfQogICAg
ICAgICBlbHNlIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLT5uZXh0LCBDVF9TRU1JQ09MT04p
ICAgICAgLy8gSXNzdWUgIzIzMTkKICAgICAgICAgICAgICAgICB8fCAoICBjaHVua19pc190
b2tlbihwYy0+bmV4dCwgQ1RfU1RBUikKICAgICAgICAgICAgICAgICAgICAmJiBjaHVua19p
c190b2tlbihwYy0+bmV4dC0+bmV4dCwgQ1RfU0VNSUNPTE9OKSkpCiAgICAgICAgIHsKICAg
ICAgICAgICAgLy8gZXhhbXBsZToKICAgICAgICAgICAgLy8gICAgdXNpbmcgQWJzdHJhY3RM
aW5rUHRyID0gQWJzdHJhY3RMaW5rKjsKICAgICAgICAgICAgLy8gICAgdXNpbmcgQWJzdHJh
Y3RMaW5rUHRyUHRyID0gQWJzdHJhY3RMaW5rKio7CiAgICAgICAgICAgIHNldF9jaHVua190
eXBlKHBjLCBDVF9QVFJfVFlQRSk7CiAgICAgICAgIH0KICAgICAgICAgZWxzZSBpZiAoICAo
ICBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09IENUX0ZVTkNfREVGCiAgICAgICAgICAg
ICAgICAgICAgJiYgKGNodW5rX2lzX29wZW5pbmdfYnJhY2UobmV4dCkgfHwgY2h1bmtfaXNf
c3RhcihwYy0+bmV4dCkpKQogICAgICAgICAgICAgICAgIHx8IChuZXh0LT50eXBlID09IENU
X1FVQUxJRklFUikpICAgICAgICAgICAgICAgLy8gSXNzdWUgIzI2NDgKICAgICAgICAgewog
ICAgICAgICAgICAvLyBleGFtcGxlOgogICAgICAgICAgICAvLyBhdXRvIGdldENvbXBvbmVu
dChDb2xvciAqY29sb3IpIC0+IENvbXBvbmVudCAqIHsKICAgICAgICAgICAgLy8gYXV0byBn
ZXRDb21wb25lbnQoQ29sb3IgKmNvbG9yKSAtPiBDb21wb25lbnQgKiogewogICAgICAgICAg
ICAvLyBhdXRvIGdldENvbXBvbmVudChDb2xvciAqY29sb3IpIC0+IENvbXBvbmVudCAqIF9O
b25udWxsCiAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9QVFJfVFlQRSk7CiAg
ICAgICAgIH0KICAgICAgICAgZWxzZSBpZiAoICBjaHVua19pc190b2tlbihwYy0+bmV4dCwg
Q1RfU0VNSUNPTE9OKSAgICAgIC8vIElzc3VlICMyMzE5CiAgICAgICAgICAgICAgICAgfHwg
KCAgY2h1bmtfaXNfdG9rZW4ocGMtPm5leHQsIENUX1NUQVIpCiAgICAgICAgICAgICAgICAg
ICAgJiYgY2h1bmtfaXNfdG9rZW4ocGMtPm5leHQtPm5leHQsIENUX1NUQVIpKSkKICAgICAg
ICAgewogICAgICAgICAgICAvLyBtb3JlIHBvaW50ZXJzIGFyZSBOT1QgeWV0IHBvc3NpYmxl
CiAgICAgICAgICAgIGZwcmludGYoc3RkZXJyLCAiVG9vIG1hbnkgcG9pbnRlcnNcbiIpOwog
ICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgImF0IGxpbmUgJXp1LCBjb2x1bW4gJXp1Llxu
IiwgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sKTsKICAgICAgICAgICAgZnByaW50Zihz
dGRlcnIsICJQbGVhc2UgbWFrZSBhIHJlcG9ydC5cbiIpOwogICAgICAgICAgICBsb2dfZmx1
c2godHJ1ZSk7CiAgICAgICAgICAgIGV4aXQoRVhfU09GVFdBUkUpOwogICAgICAgICB9CiAg
ICAgICAgIGVsc2UKICAgICAgICAgewogICAgICAgICAgICAvLyBJc3N1ZSAxNDAyCiAgICAg
ICAgICAgIHNldF9jaHVua190eXBlKHBjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAo
ICBwcmV2LT5mbGFncy50ZXN0KFBDRl9QVU5DVFVBVE9SKQogICAgICAgICAgICAgICAgICAg
ICAgICAgICAmJiAoICAhY2h1bmtfaXNfcGFyZW5fY2xvc2UocHJldikKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfU1BBUkVOX0NM
T1NFKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBnZXRfY2h1bmtfcGFyZW50
X3R5cGUocHJldikgPT0gQ1RfTUFDUk9fRlVOQykKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgJiYgcHJldi0+dHlwZSAhPSBDVF9TUVVBUkVfQ0xPU0UKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgJiYgcHJldi0+dHlwZSAhPSBDVF9EQ19NRU1CRVIpID8gQ1RfREVSRUYgOiBD
VF9BUklUSCk7CiAgICAgICAgIH0KCiAgICAgICAgIGlmIChwYy0+ZmxhZ3MudGVzdChQQ0Zf
SU5fVFlQRURFRikpICAvLyBJc3N1ZSAjMTI1NS8jNjMzCiAgICAgICAgIHsKICAgICAgICAg
ICAgdG1wID0gcGM7CgogICAgICAgICAgICB3aGlsZSAodG1wICE9IG51bGxwdHIpCiAgICAg
ICAgICAgIHsKICAgICAgICAgICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9T
RU1JQ09MT04pCiAgICAgICAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1Rf
QlJBQ0VfT1BFTikpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgYnJlYWs7
CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9r
ZW4odG1wLCBDVF9UWVBFREVGKSkKICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
ICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfUFRSX1RZUEUpOwogICAgICAgICAgICAgICB9CiAg
ICAgICAgICAgICAgIHRtcCA9IGNodW5rX2dldF9wcmV2X25jbmxuaSh0bXApOyAvLyBJc3N1
ZSAjMjI3OQogICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgfQogICB9CgogICBpZiAo
Y2h1bmtfaXNfdG9rZW4ocGMsIENUX0FNUCkpCiAgIHsKICAgICAgaWYgKGNodW5rX2lzX3Rv
a2VuKHByZXYsIENUX0RFTEVURSkpCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5cGUo
cGMsIENUX0FERFIpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBy
ZXYsIENUX1RZUEUpKQogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9C
WVJFRik7CiAgICAgIH0KICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1Rf
RlBBUkVOX0NMT1NFKSB8fCBjaHVua19pc190b2tlbihuZXh0LCBDVF9DT01NQSkpCiAgICAg
IHsKICAgICAgICAgLy8gZml4IHRoZSBidWcgIzY1NAogICAgICAgICAvLyBjb25uZWN0KCZt
YXBwZXIsIFNJR05BTChtYXBwZWQoUVN0cmluZyAmKSksIHRoaXMsIFNMT1Qob25Tb21lRXZl
bnQoUVN0cmluZyAmKSkpOwogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfQllSRUYp
OwogICAgICB9CiAgICAgIGVsc2UgaWYgKGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgPT0g
Q1RfVVNJTkdfQUxJQVMpCiAgICAgIHsKICAgICAgICAgLy8gZml4IHRoZSBJc3N1ZSAjIDE2
ODkKICAgICAgICAgLy8gdXNpbmcgcmVmZXJlbmNlID0gdmFsdWVfdHlwZSAmOwogICAgICAg
ICBzZXRfY2h1bmtfdHlwZShwYy0+cHJldiwgQ1RfVFlQRSk7CiAgICAgICAgIHNldF9jaHVu
a190eXBlKHBjLCBDVF9CWVJFRik7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAg
ICAgIC8vIElzc3VlICMgMTM5OAogICAgICAgICBpZiAoICBwYy0+ZmxhZ3MudGVzdChQQ0Zf
SU5fRkNOX0RFRikKICAgICAgICAgICAgJiYgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfV09S
RCkKICAgICAgICAgICAgJiYgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FNUCkKICAgICAgICAg
ICAgJiYgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfV09SRCkpCiAgICAgICAgIHsKICAgICAg
ICAgICAgLyoKICAgICAgICAgICAgICogQ2hhbmdlIENUX1dPUkQgYmVmb3JlIENUX0FNUCBi
ZWZvcmUgQ1RfV09SRCB0byBDVF9UWVBFCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBz
ZXRfY2h1bmtfdHlwZShwcmV2LCBDVF9UWVBFKTsKICAgICAgICAgfQogICAgICAgICBlbHNl
CiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0FSSVRIKTsK
CiAgICAgICAgICAgIGlmIChjaHVua19pc190b2tlbihwcmV2LCBDVF9XT1JEKSkKICAgICAg
ICAgICAgewogICAgICAgICAgICAgICB0bXAgPSBjaHVua19nZXRfcHJldl9uY25sbmkocHJl
dik7IC8vIElzc3VlICMyMjc5CgogICAgICAgICAgICAgICBpZiAodG1wICE9IG51bGxwdHIp
CiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgaWYgKCAgY2h1bmtfaXNfc2Vt
aWNvbG9uKHRtcCkKICAgICAgICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4odG1w
LCBDVF9CUkFDRV9PUEVOKQogICAgICAgICAgICAgICAgICAgICB8fCBjaHVua19pc190b2tl
bih0bXAsIENUX1FVQUxJRklFUikpCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAg
ICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0JZUkVGKTsKICAgICAgICAgICAgICAg
ICAgICAgc2V0X2NodW5rX3R5cGUocHJldiwgQ1RfVFlQRSk7CgogICAgICAgICAgICAgICAg
ICAgICBpZiAoISggIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX09QRVJBVE9SKQogICAgICAg
ICAgICAgICAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1RZUEUpCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfRENf
TUVNQkVSKSkpCiAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAg
ICAgTE9HX0ZNVChMRkNOUiwgIiVzKCVkKTogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wg
aXMgJXp1LCB0ZXh0KCkgJyVzJywgc2V0IFBDRl9WQVJfMVNUXG4iLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwg
cGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2h1
bmtfZmxhZ3Nfc2V0KG5leHQsIFBDRl9WQVJfMVNUKTsKICAgICAgICAgICAgICAgICAgICAg
fQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNodW5r
X2lzX3Rva2VuKHRtcCwgQ1RfRENfTUVNQkVSKSkKICAgICAgICAgICAgICAgICAgewogICAg
ICAgICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwcmV2LCBDVF9UWVBFKTsKCiAgICAg
ICAgICAgICAgICAgICAgIGlmICghY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfVFlQRSkpICAg
ICAgICAgICAgLy8gSXNzdWUgIzIxMDMKICAgICAgICAgICAgICAgICAgICAgewogICAgICAg
ICAgICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfQllSRUYpOwogICAgICAg
ICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgfQog
ICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgfQogICB9CgogICBpZiAoY2h1bmtfaXNf
dG9rZW4ocGMsIENUX01JTlVTKSB8fCBjaHVua19pc190b2tlbihwYywgQ1RfUExVUykpCiAg
IHsKICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfUE9TKQogICAgICAgICB8
fCBjaHVua19pc190b2tlbihwcmV2LCBDVF9ORUcpCiAgICAgICAgIHx8IGNodW5rX2lzX3Rv
a2VuKHByZXYsIENUX0FSSVRIKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZShw
YywgKHBjLT50eXBlID09IENUX01JTlVTKSA/IENUX05FRyA6IENUX1BPUyk7CiAgICAgIH0K
ICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfT0NfQ0xBU1MpKQogICAg
ICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCAoY2h1bmtfaXNfdG9rZW4ocGMsIENU
X01JTlVTKSkgPyBDVF9ORUcgOiBDVF9QT1MpOwogICAgICB9CiAgICAgIGVsc2UKICAgICAg
ewogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfQVJJVEgpOwogICAgICB9CiAgIH0K
CiAgIC8qCiAgICAqIEJ1ZyAjIDYzNAogICAgKiBDaGVjayBmb3IgZXh0ZXJuICJDIiBOU1N0
cmluZyogaTsKICAgICogTlNTdHJpbmcgaXMgYSB0eXBlCiAgICAqIGNoYW5nZSBDVF9XT1JE
ID0+IENUX1RZUEUgICAgIGZvciBwYwogICAgKiBjaGFuZ2UgQ1RfU1RBUiA9PiBDVF9QVFJf
VFlQRSBmb3IgcGMtbmV4dAogICAgKi8KICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9X
T1JEKSkgICAgIC8vIGhlcmUgTlNTdHJpbmcKICAgewogICAgICBpZiAocGMtPm5leHQgIT0g
bnVsbHB0cikgICAgICAgICAgLy8gaGVyZSAqCiAgICAgIHsKICAgICAgICAgaWYgKHBjLT5u
ZXh0LT50eXBlID09IENUX1NUQVIpIC8vIGhlcmUgKgogICAgICAgICB7CiAgICAgICAgICAg
IC8vIGNvbXBhcmUgdGV4dCB3aXRoICJDIiB0byBmaW5kIGV4dGVybiAiQyIgaW5zdHJ1Y3Rp
b25zCiAgICAgICAgICAgIGlmIChwYy0+cHJldiAhPSBudWxscHRyKQogICAgICAgICAgICB7
CiAgICAgICAgICAgICAgIGlmIChwYy0+cHJldi0+dHlwZSA9PSBDVF9TVFJJTkcpCiAgICAg
ICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgaWYgKHVuY190ZXh0Ojpjb21wYXJlKHBj
LT5wcmV2LT50ZXh0KCksICJcIkNcIiIpID09IDApCiAgICAgICAgICAgICAgICAgIHsKICAg
ICAgICAgICAgICAgICAgICAgaWYgKHBjLT5wcmV2LT5wcmV2LT50eXBlID09IENUX0VYVEVS
TikKICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBzZXRf
Y2h1bmtfdHlwZShwYywgQ1RfVFlQRSk7ICAgICAgICAgICAgLy8gY2hhbmdlIENUX1dPUkQg
PT4gQ1RfVFlQRQogICAgICAgICAgICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYy0+
bmV4dCwgQ1RfUFRSX1RZUEUpOyAgLy8gY2hhbmdlIENUX1NUQVIgPT4gQ1RfUFRSX1RZUEUK
ICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSXNzdWUgIzMyMiBTVERNRVRI
T0QoR2V0VmFsdWVzKShCU1RSIGJzTmFtZSwgUkVGREFUQSoqIHBEYXRhKTsKICAgICAgICAg
ICAgaWYgKCAgKHBjLT5uZXh0LT5uZXh0ICE9IG51bGxwdHIpCiAgICAgICAgICAgICAgICYm
IHBjLT5uZXh0LT5uZXh0LT50eXBlID09IENUX1NUQVIKICAgICAgICAgICAgICAgJiYgcGMt
PmZsYWdzLnRlc3QoUENGX0lOX0NPTlNUX0FSR1MpKQogICAgICAgICAgICB7CiAgICAgICAg
ICAgICAgIC8vIGNoYW5nZSBDVF9TVEFSID0+IENUX1BUUl9UWVBFCiAgICAgICAgICAgICAg
IHNldF9jaHVua190eXBlKHBjLT5uZXh0LCBDVF9QVFJfVFlQRSk7CiAgICAgICAgICAgICAg
IHNldF9jaHVua190eXBlKHBjLT5uZXh0LT5uZXh0LCBDVF9QVFJfVFlQRSk7CiAgICAgICAg
ICAgIH0KCiAgICAgICAgICAgIC8vIElzc3VlICMyMjIgd2hhdGV2ZXIzICooZnVuY19wdHIp
KCB3aGF0ZXZlcjQgKmZvbzIsIC4uLgogICAgICAgICAgICBpZiAoICAocGMtPm5leHQtPm5l
eHQgIT0gbnVsbHB0cikKICAgICAgICAgICAgICAgJiYgcGMtPm5leHQtPm5leHQtPnR5cGUg
PT0gQ1RfV09SRAogICAgICAgICAgICAgICAmJiBwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fRkNO
X0RFRikpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgLy8gbG9vayBmb3IgdGhlIG9w
ZW5pbmcgcGFyZW50aGVzaXMKICAgICAgICAgICAgICAgLy8gSXNzdWUgMTQwMwogICAgICAg
ICAgICAgICB0bXAgPSBjaHVua19nZXRfcHJldl90eXBlKHBjLCBDVF9GUEFSRU5fT1BFTiwg
cGMtPmxldmVsIC0gMSk7CgogICAgICAgICAgICAgICBpZiAoICB0bXAgIT0gbnVsbHB0cgog
ICAgICAgICAgICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUodG1wKSAhPSBDVF9G
VU5DX0NUT1JfVkFSKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHNldF9j
aHVua190eXBlKHBjLT5uZXh0LCBDVF9QVFJfVFlQRSk7CiAgICAgICAgICAgICAgIH0KICAg
ICAgICAgICAgfQogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgLyoKICAgICogQnVnICMg
NjM0CiAgICAqIENoZWNrIGZvciBfX2F0dHJpYnV0ZV9fKCh2aXNpYmlsaXR5ICgiZGVmYXVs
dCIpKSkgTlNTdHJpbmcqIGk7CiAgICAqIE5TU3RyaW5nIGlzIGEgdHlwZQogICAgKiBjaGFu
Z2UgQ1RfV09SRCA9PiBDVF9UWVBFICAgICBmb3IgcGMKICAgICogY2hhbmdlIENUX1NUQVIg
PT4gQ1RfUFRSX1RZUEUgZm9yIHBjLW5leHQKICAgICovCiAgIGlmIChjaHVua19pc190b2tl
bihwYywgQ1RfV09SRCkpICAgICAvLyBoZXJlIE5TU3RyaW5nCiAgIHsKICAgICAgaWYgKHBj
LT5uZXh0ICE9IG51bGxwdHIpICAgICAgICAgIC8vIGhlcmUgKgogICAgICB7CiAgICAgICAg
IGlmIChwYy0+bmV4dC0+dHlwZSA9PSBDVF9TVEFSKSAvLyBoZXJlICoKICAgICAgICAgewog
ICAgICAgICAgICB0bXAgPSBwYzsKCiAgICAgICAgICAgIHdoaWxlICgodG1wICE9IG51bGxw
dHIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGlmIChjaHVua19pc190b2tlbih0
bXAsIENUX0FUVFJJQlVURSkpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg
TE9HX0ZNVChMRkNOUiwgIiVzKCVkKTogQVRUUklCVVRFIGZvdW5kLCB0eXBlIGlzICVzLCB0
ZXh0KCkgJyVzJ1xuIiwKICAgICAgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19M
SU5FX18sIGdldF90b2tlbl9uYW1lKHRtcC0+dHlwZSksIHRtcC0+dGV4dCgpKTsKICAgICAg
ICAgICAgICAgICAgTE9HX0ZNVChMRkNOUiwgImZvciB0b2tlbiwgdHlwZSBpcyAlcywgdGV4
dCgpICclcydcbiIsIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSwgcGMtPnRleHQoKSk7CiAg
ICAgICAgICAgICAgICAgIC8vIGNoYW5nZSBDVF9XT1JEID0+IENUX1RZUEUKICAgICAgICAg
ICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX1RZUEUpOwogICAgICAgICAgICAgICAg
ICAvLyBjaGFuZ2UgQ1RfU1RBUiA9PiBDVF9QVFJfVFlQRQogICAgICAgICAgICAgICAgICBz
ZXRfY2h1bmtfdHlwZShwYy0+bmV4dCwgQ1RfUFRSX1RZUEUpOwogICAgICAgICAgICAgICB9
CgogICAgICAgICAgICAgICBpZiAodG1wLT5mbGFncy50ZXN0KFBDRl9TVE1UX1NUQVJUKSkK
ICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAvLyB3ZSBhcmUgYXQgYmVnaW5u
aW5nIG9mIHRoZSBsaW5lCiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg
ICB9CiAgICAgICAgICAgICAgIHRtcCA9IGNodW5rX2dldF9wcmV2KHRtcCk7CiAgICAgICAg
ICAgIH0KICAgICAgICAgfQogICAgICB9CiAgIH0KCiAgIC8qCiAgICAqIElzc3VlICMgMTY4
OQogICAgKiBDaGVjayBmb3IgdXNpbmcgcmVmZXJlbmNlID0gdmFsdWVfdHlwZSY7CiAgICAq
IGlzIGl0IGEgVHlwZSBhbGlhcywgYWxpYXMgdGVtcGxhdGU/CiAgICAqLwogICBpZiAoY2h1
bmtfaXNfdG9rZW4ocGMsIENUX1VTSU5HKSkKICAgewogICAgICAvLyBsb29rIGZvciBDVF9B
U1NJR04gYmVmb3JlIENUX1NFTUlDT0xPTiBhdCB0aGUgZW5kIG9mIHRoZSBzdGF0ZW1lbnQK
ICAgICAgYm9vbCAgICBhc3NpZ25fZm91bmQgPSBmYWxzZTsKICAgICAgYm9vbCAgICBpc19w
cmVwcm9jICAgPSBwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQyk7CiAgICAgIGNodW5r
X3QgKnRlbXA7CgogICAgICBmb3IgKHRlbXAgPSBwYzsgdGVtcCAhPSBudWxscHRyOyB0ZW1w
ID0gY2h1bmtfZ2V0X25leHRfbmNubCh0ZW1wKSkKICAgICAgewogICAgICAgICBMT0dfRk1U
KExGQ05SLCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRl
eHQoKSAnJXMnLCB0eXBlIGlzICVzXG4iLAogICAgICAgICAgICAgICAgIF9fZnVuY19fLCBf
X0xJTkVfXywgdGVtcC0+b3JpZ19saW5lLCB0ZW1wLT5vcmlnX2NvbCwgdGVtcC0+dGV4dCgp
LCBnZXRfdG9rZW5fbmFtZSh0ZW1wLT50eXBlKSk7CgogICAgICAgICBpZiAoY2h1bmtfaXNf
dG9rZW4odGVtcCwgQ1RfQVNTSUdOKSkKICAgICAgICAgewogICAgICAgICAgICBhc3NpZ25f
Zm91bmQgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgfQoKICAgICAgICAg
aWYgKCAgY2h1bmtfaXNfdG9rZW4odGVtcCwgQ1RfU0VNSUNPTE9OKQogICAgICAgICAgICB8
fCAoICBpc19wcmVwcm9jCiAgICAgICAgICAgICAgICYmICggICF0ZW1wLT5mbGFncy50ZXN0
KFBDRl9JTl9QUkVQUk9DKQogICAgICAgICAgICAgICAgICB8fCBjaHVua19pc190b2tlbih0
ZW1wLCBDVF9QUkVQUk9DKSkpKQogICAgICAgICB7CiAgICAgICAgICAgIGJyZWFrOwogICAg
ICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChhc3NpZ25fZm91bmQpCiAgICAgIHsKICAgICAg
ICAgLy8gaXQgaXMgYSBUeXBlIGFsaWFzLCBhbGlhcyB0ZW1wbGF0ZQogICAgICAgICBmb3Ig
KHRlbXAgPSBwYzsgdGVtcCAhPSBudWxscHRyOyB0ZW1wID0gY2h1bmtfZ2V0X25leHRfbmNu
bCh0ZW1wKSkKICAgICAgICAgewogICAgICAgICAgICBpZiAoZ2V0X2NodW5rX3BhcmVudF90
eXBlKHRlbXApID09IENUX05PTkUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgc2V0
X2NodW5rX3BhcmVudCh0ZW1wLCBDVF9VU0lOR19BTElBUyk7CiAgICAgICAgICAgIH0KCiAg
ICAgICAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKHRlbXAsIENUX1NFTUlDT0xPTikKICAg
ICAgICAgICAgICAgfHwgKCAgaXNfcHJlcHJvYwogICAgICAgICAgICAgICAgICAmJiAoICAh
dGVtcC0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykKICAgICAgICAgICAgICAgICAgICAg
fHwgY2h1bmtfaXNfdG9rZW4odGVtcCwgQ1RfUFJFUFJPQykpKSkKICAgICAgICAgICAgewog
ICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgIH0K
ICAgfQoKICAgLy8gSXNzdWUgIzU0ODogaW5saW5lIFQgJiYgc29tZUZ1bmMoZm9vICogKnAs
IGJhciAmJiBxKSB7IH0KICAgaWYgKCAgcGMtPnR5cGUgPT0gQ1RfQk9PTAogICAgICAmJiAh
cGMtPmZsYWdzLnRlc3QoUENGX0lOX1BSRVBST0MpCiAgICAgICYmIGNodW5rX2lzX3N0cihw
YywgIiYmIiwgMikKICAgICAgJiYgY2h1bmtfZW5kc190eXBlKHBjLT5wcmV2KSkKICAgewog
ICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfQllSRUYpOwogICB9CgogICAvLyBJc3N1ZSAj
MTcwNAogICBpZiAoICBjaHVua19pc190b2tlbihwYywgQ1RfSU5DREVDX0FGVEVSKQogICAg
ICAmJiBwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykpCiAgIHsKICAgICAgY2h1bmtf
dCAqdG1wXzIgPSBjaHVua19nZXRfbmV4dChwYyk7CiAgICAgIGxvZ19wY2ZfZmxhZ3MoTEZU
WVBFLCBwYy0+ZmxhZ3MpOwoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcF8yLCBDVF9X
T1JEKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfSU5DREVDX0JF
Rk9SRSk7CiAgICAgIH0KICAgfQp9IC8vIGRvX3N5bWJvbF9jaGVjawoKCnN0YXRpYyB2b2lk
IGNoZWNrX2RvdWJsZV9icmFjZV9pbml0KGNodW5rX3QgKmJvMSkKewogICBMT0dfRlVOQ19F
TlRSWSgpOwogICBMT0dfRk1UKExKREJJLCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1LCBv
cmlnX2NvbCBpcyAlenUiLCBfX2Z1bmNfXywgX19MSU5FX18sIGJvMS0+b3JpZ19saW5lLCBi
bzEtPm9yaWdfY29sKTsKICAgY2h1bmtfdCAqcGMgPSBjaHVua19nZXRfcHJldl9uY25sbmko
Ym8xKTsgICAvLyBJc3N1ZSAjMjI3OQoKICAgaWYgKHBjID09IG51bGxwdHIpCiAgIHsKICAg
ICAgcmV0dXJuOwogICB9CgogICBpZiAoY2h1bmtfaXNfcGFyZW5fY2xvc2UocGMpKQogICB7
CiAgICAgIGNodW5rX3QgKmJvMiA9IGNodW5rX2dldF9uZXh0KGJvMSk7CgogICAgICBpZiAo
Ym8yID09IG51bGxwdHIpCiAgICAgIHsKICAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAg
ICBpZiAoY2h1bmtfaXNfdG9rZW4oYm8yLCBDVF9CUkFDRV9PUEVOKSkKICAgICAgewogICAg
ICAgICAvLyBmb3VuZCBhIHBvdGVudGlhbCBkb3VibGUgYnJhY2UKICAgICAgICAgY2h1bmtf
dCAqYmMyID0gY2h1bmtfc2tpcF90b19tYXRjaChibzIpOwoKICAgICAgICAgaWYgKGJjMiA9
PSBudWxscHRyKQogICAgICAgICB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQog
ICAgICAgICBjaHVua190ICpiYzEgPSBjaHVua19nZXRfbmV4dChiYzIpOwoKICAgICAgICAg
aWYgKGJjMSA9PSBudWxscHRyKQogICAgICAgICB7CiAgICAgICAgICAgIHJldHVybjsKICAg
ICAgICAgfQoKICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKGJjMSwgQ1RfQlJBQ0VfQ0xP
U0UpKQogICAgICAgICB7CiAgICAgICAgICAgIExPR19GTVQoTEpEQkksICIgLSBlbmQsIG9y
aWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dVxuIiwgYmMyLT5vcmlnX2xpbmUsIGJj
Mi0+b3JpZ19jb2wpOwogICAgICAgICAgICAvLyBkZWxldGUgYm8yIGFuZCBiYzEKICAgICAg
ICAgICAgYm8xLT5zdHIgICAgICAgICArPSBibzItPnN0cjsKICAgICAgICAgICAgYm8xLT5v
cmlnX2NvbF9lbmQgPSBibzItPm9yaWdfY29sX2VuZDsKICAgICAgICAgICAgY2h1bmtfZGVs
KGJvMik7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQoYm8xLCBDVF9ET1VCTEVfQlJB
Q0UpOwoKICAgICAgICAgICAgYmMyLT5zdHIgICAgICAgICArPSBiYzEtPnN0cjsKICAgICAg
ICAgICAgYmMyLT5vcmlnX2NvbF9lbmQgPSBiYzEtPm9yaWdfY29sX2VuZDsKICAgICAgICAg
ICAgY2h1bmtfZGVsKGJjMSk7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQoYmMyLCBD
VF9ET1VCTEVfQlJBQ0UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICAg
fQogICB9CiAgIExPR19GTVQoTEpEQkksICIgLSBub1xuIik7Cn0gLy8gY2hlY2tfZG91Ymxl
X2JyYWNlX2luaXQKCgp2b2lkIGZpeF9zeW1ib2xzKHZvaWQpCnsKICAgTE9HX0ZVTkNfRU5U
UlkoKTsKICAgY2h1bmtfdCAqcGM7CiAgIGNodW5rX3QgZHVtbXk7CgogICBjcGQudW5jX3N0
YWdlID0gdW5jX3N0YWdlX2U6OkZJWF9TWU1CT0xTOwoKICAgbWFya19kZWZpbmVfZXhwcmVz
c2lvbnMoKTsKCiAgIGJvb2wgaXNfY3BwICA9IGxhbmd1YWdlX2lzX3NldChMQU5HX0NQUCk7
CiAgIGJvb2wgaXNfamF2YSA9IGxhbmd1YWdlX2lzX3NldChMQU5HX0pBVkEpOwoKICAgZm9y
IChwYyA9IGNodW5rX2dldF9oZWFkKCk7IHBjICE9IG51bGxwdHI7IHBjID0gY2h1bmtfZ2V0
X25leHRfbmNubChwYykpCiAgIHsKICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENU
X0ZVTkNfV1JBUCkKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RZUEVfV1JB
UCkpCiAgICAgIHsKICAgICAgICAgaGFuZGxlX3dyYXAocGMpOwogICAgICB9CgogICAgICBp
ZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FTU0lHTikpCiAgICAgIHsKICAgICAgICAgbWFy
a19sdmFsdWUocGMpOwogICAgICB9CiAgICAgIC8vIGEgYnJhY2UgaW1tZWRpYXRlbHkgcHJl
Y2VlZGVkIGJ5IHdvcmQgaW4gQysrMTEgaXMgYW4gaW5pdGlhbGl6ZXIgbGlzdCB0aG91Z2gg
aXQgbWF5IGFsc28KICAgICAgLy8gYnkgYSB0eXBlIGNhc3RpbmcgaW5pdGlhbGl6ZXIgbGlz
dCBpZiB0aGUgd29yZCBpcyByZWFsbHkgYSB0eXBlOyBzYWRseSB1bnVjdXN0aWZ5IGtub3dz
CiAgICAgIC8vIG9ubHkgYnVpbHRpbiB0eXBlcyBhbmQga25vd3Mgbm90aGluZyBvZiB1c2Vy
LWRlZmluZWQgdHlwZXMKICAgICAgY2h1bmtfdCAqcHJldiA9IGNodW5rX2dldF9wcmV2X25j
bmxuaShwYyk7ICAgLy8gSXNzdWUgIzIyNzkKCiAgICAgIGlmICggIGlzX2NwcAogICAgICAg
ICAmJiBjaHVua19pc190b2tlbihwYywgQ1RfQlJBQ0VfT1BFTikKICAgICAgICAgJiYgKCAg
Y2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfV09SRCkKICAgICAgICAgICAgfHwgY2h1bmtfaXNf
dG9rZW4ocHJldiwgQ1RfVFlQRSkpKQogICAgICB7CiAgICAgICAgIG1hcmtfbHZhbHVlKHBj
KTsKICAgICAgfQoKICAgICAgaWYgKCAgaXNfamF2YQogICAgICAgICAmJiBjaHVua19pc190
b2tlbihwYywgQ1RfQlJBQ0VfT1BFTikpCiAgICAgIHsKICAgICAgICAgY2hlY2tfZG91Ymxl
X2JyYWNlX2luaXQocGMpOwogICAgICB9CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMs
IENUX0FUVFJJQlVURSkpCiAgICAgIHsKICAgICAgICAgY2h1bmtfdCAqbmV4dCA9IGNodW5r
X2dldF9uZXh0X25jbmwocGMsIHNjb3BlX2U6OlBSRVBST0MpOwoKICAgICAgICAgaWYgKCAg
bmV4dCAhPSBudWxscHRyCiAgICAgICAgICAgICYmIGNodW5rX2lzX3Rva2VuKG5leHQsIENU
X1BBUkVOX09QRU4pKQogICAgICAgICB7CiAgICAgICAgICAgIGZsYWdfcGFyZW5zKG5leHQs
IFBDRl9OT05FLCBDVF9GUEFSRU5fT1BFTiwgQ1RfQVRUUklCVVRFLCBmYWxzZSk7CiAgICAg
ICAgIH0KICAgICAgfQogICB9CgogICBwYyA9IGNodW5rX2dldF9oZWFkKCk7CgogICBpZiAo
cGMgPT0gbnVsbHB0cikKICAgewogICAgICByZXR1cm47CiAgIH0KCiAgIGlmICggIGNodW5r
X2lzX25ld2xpbmUocGMpCiAgICAgIHx8IGNodW5rX2lzX2NvbW1lbnQocGMpKQogICB7CiAg
ICAgIHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7CiAgIH0KCiAgIHdoaWxlIChwYyAh
PSBudWxscHRyKQogICB7CiAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfSUdOT1JF
RCkpCiAgICAgIHsKICAgICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKICAg
ICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgTE9HX0ZNVChMRkNOUiwgIiVzKCVkKTog
cGMtPm9yaWdfbGluZSAgICAgICBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpIGlz
ICclcycsIHR5cGUgaXMgJXNcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9f
LCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIHBjLT50ZXh0KCksIGdldF90b2tlbl9u
YW1lKHBjLT50eXBlKSk7CiAgICAgIGNodW5rX3QgKnByZXYgPSBjaHVua19nZXRfcHJldl9u
Y25sbmkocGMsIHNjb3BlX2U6OlBSRVBST0MpOyAgIC8vIElzc3VlICMyMjc5CgogICAgICBp
ZiAocHJldiA9PSBudWxscHRyKQogICAgICB7CiAgICAgICAgIHByZXYgPSAmZHVtbXk7CiAg
ICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgIC8vIElzc3VlICMyMjc5CiAgICAg
ICAgIExPR19GTVQoTEZDTlIsICIlcyglZCk6IHByZXYobmkpLT5vcmlnX2xpbmUgaXMgJXp1
LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSBpcyAnJXMnLCB0eXBlIGlzICVzXG4iLAogICAg
ICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcHJldi0+b3JpZ19saW5lLCBwcmV2
LT5vcmlnX2NvbCwgcHJldi0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZShwcmV2LT50eXBlKSk7
CiAgICAgIH0KICAgICAgY2h1bmtfdCAqbmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwocGMs
IHNjb3BlX2U6OlBSRVBST0MpOwoKICAgICAgaWYgKG5leHQgPT0gbnVsbHB0cikKICAgICAg
ewogICAgICAgICBuZXh0ID0gJmR1bW15OwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewog
ICAgICAgICAvLyBJc3N1ZSAjMjI3OQogICAgICAgICBMT0dfRk1UKExGQ05SLCAiJXMoJWQp
OiBuZXh0LT5vcmlnX2xpbmUgICAgIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkg
aXMgJyVzJywgdHlwZSBpcyAlc1xuIiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19M
SU5FX18sIG5leHQtPm9yaWdfbGluZSwgbmV4dC0+b3JpZ19jb2wsIG5leHQtPnRleHQoKSwg
Z2V0X3Rva2VuX25hbWUobmV4dC0+dHlwZSkpOwogICAgICB9CiAgICAgIExPR19GTVQoTEZD
TlIsICIlcyglZCk6IGRvX3N5bWJvbF9jaGVjayglcywgJXMsICVzKVxuIiwKICAgICAgICAg
ICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHByZXYtPnRleHQoKSwgcGMtPnRleHQoKSwgbmV4
dC0+dGV4dCgpKTsKICAgICAgZG9fc3ltYm9sX2NoZWNrKHByZXYsIHBjLCBuZXh0KTsKICAg
ICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKICAgfQogICBwYXduX2FkZF92aXJ0
dWFsX3NlbWljb2xvbnMoKTsKICAgcHJvY2Vzc19yZXR1cm5zKCk7CgogICAvKgogICAgKiAy
bmQgcGFzcyAtIGhhbmRsZSB2YXJpYWJsZSBkZWZpbml0aW9ucwogICAgKiBSRVZJU0lUOiBX
ZSBuZWVkIGZ1bmN0aW9uIHBhcmFtcyBtYXJrZWQgdG8gZG8gdGhpcyAoPykKICAgICovCiAg
IHBjID0gY2h1bmtfZ2V0X2hlYWQoKTsKICAgaW50IHNxdWFyZV9sZXZlbCA9IC0xOwoKICAg
d2hpbGUgKHBjICE9IG51bGxwdHIpCiAgIHsKICAgICAgTE9HX0ZNVChMRkNOUiwgIiVzKCVk
KTogcGMtPm9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpIGlzICcl
cycsIHR5cGUgaXMgJXMsIHBhcmVudF90eXBlIGlzICVzXG4iLAogICAgICAgICAgICAgIF9f
ZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4
dCgpLCBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSksIGdldF90b2tlbl9uYW1lKHBjLT5wYXJl
bnRfdHlwZSkpOwoKICAgICAgLy8gQ2FuJ3QgaGF2ZSBhIHZhcmlhYmxlIGRlZmluaXRpb24g
aW5zaWRlIFsgXQogICAgICBpZiAoc3F1YXJlX2xldmVsIDwgMCkKICAgICAgewogICAgICAg
ICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NRVUFSRV9PUEVOKSkKICAgICAgICAgewog
ICAgICAgICAgICBzcXVhcmVfbGV2ZWwgPSBwYy0+bGV2ZWw7CiAgICAgICAgIH0KICAgICAg
fQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAgaWYgKHBjLT5sZXZlbCA8PSBzdGF0aWNf
Y2FzdDxzaXplX3Q+KHNxdWFyZV9sZXZlbCkpCiAgICAgICAgIHsKICAgICAgICAgICAgc3F1
YXJlX2xldmVsID0gLTE7CiAgICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCAgY2h1bmtf
aXNfdG9rZW4ocGMsIENUX0VYVEVSTikKICAgICAgICAgJiYgbGFuZ3VhZ2VfaXNfc2V0KExB
TkdfQUxMQykpCiAgICAgIHsKICAgICAgICAgY2h1bmtfdCAqbmV4dCA9IGNodW5rX2dldF9u
ZXh0X25jbmwocGMpOwoKICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1NU
UklORykpCiAgICAgICAgIHsKICAgICAgICAgICAgY2h1bmtfdCAqdG1wID0gY2h1bmtfZ2V0
X25leHRfbmNubChuZXh0KTsKCiAgICAgICAgICAgIHdoaWxlICh0bXAgIT0gbnVsbHB0cikK
ICAgICAgICAgICAgewogICAgICAgICAgICAgICBpZiAoICAoY2h1bmtfaXNfdG9rZW4odG1w
LCBDVF9UWVBFKSkKICAgICAgICAgICAgICAgICAgfHwgKGNodW5rX2lzX3Rva2VuKHRtcCwg
Q1RfQlJBQ0VfT1BFTikpCiAgICAgICAgICAgICAgICAgIHx8IChjaHVua19pc190b2tlbih0
bXAsIENUX0FUVFJJQlVURSkpKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAg
IGJyZWFrOwogICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICBpZiAoY2h1bmtfaXNf
dG9rZW4odG1wLCBDVF9XT1JEKSkKICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
ICBjaHVua19mbGFnc19zZXQodG1wLCBQQ0ZfU1RNVF9TVEFSVCB8IFBDRl9FWFBSX1NUQVJU
KTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgIH0KICAgICAgICAg
ICAgICAgdG1wID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXApOwogICAgICAgICAgICB9CiAg
ICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FU
VFJJQlVURSkKICAgICAgICAgJiYgbGFuZ3VhZ2VfaXNfc2V0KExBTkdfQUxMQykpCiAgICAg
IHsKICAgICAgICAgY2h1bmtfdCAqdG1wID0gc2tpcF9hdHRyaWJ1dGVfbmV4dChwYyk7Cgog
ICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9XT1JEKSkKICAgICAgICAgewog
ICAgICAgICAgICBjaHVua19mbGFnc19zZXQodG1wLCBQQ0ZfU1RNVF9TVEFSVCB8IFBDRl9F
WFBSX1NUQVJUKTsKICAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoICBjaHVua19pc190
b2tlbihwYywgQ1RfQlJBQ0VfT1BFTikgICAgICAgICAgICAgICAgICAgICAgIC8vIElzc3Vl
ICMyMzMyCiAgICAgICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgPT0gQ1RfQlJB
Q0VEX0lOSVRfTElTVCkKICAgICAgewogICAgICAgICBMT0dfRk1UKExGQ05SLCAiJXMoJWQp
OiBwYy0+b3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgaXMgJyVz
JywgbG9vayBmb3IgQ1RfQlJBQ0VfT1BFTlxuIiwKICAgICAgICAgICAgICAgICBfX2Z1bmNf
XywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQoKSk7
CiAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRfdHlwZShwYywgQ1RfQlJBQ0VfQ0xPU0Us
IHBjLT5sZXZlbCk7CiAgICAgIH0KICAgICAgLyoKICAgICAgICogQSB2YXJpYWJsZSBkZWZp
bml0aW9uIGlzIHBvc3NpYmxlIGFmdGVyIGF0IHRoZSBzdGFydCBvZiBhIHN0YXRlbWVudAog
ICAgICAgKiB0aGF0IHN0YXJ0cyB3aXRoOiBEQ19NRU1CRVIsIFFVQUxJRklFUiwgVFlQRSwg
b3IgV09SRAogICAgICAgKi8KICAgICAgLy8gSXNzdWUgIzIyNzkKICAgICAgLy8gSXNzdWUg
IzI0NzgKICAgICAgTE9HX0ZNVChMRkNOUiwgIiVzKCVkKTogcGMtPm9yaWdfbGluZSBpcyAl
enUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpIGlzICclcycsIHR5cGUgaXMgJXMsIHBhcmVu
dF90eXBlIGlzICVzXG4gICAiLAogICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywg
cGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpLCBnZXRfdG9rZW5fbmFt
ZShwYy0+dHlwZSksIGdldF90b2tlbl9uYW1lKHBjLT5wYXJlbnRfdHlwZSkpOwogICAgICBs
b2dfcGNmX2ZsYWdzKExGQ05SLCBwYy0+ZmxhZ3MpOwoKICAgICAgaWYgKCAgKHNxdWFyZV9s
ZXZlbCA8IDApCiAgICAgICAgICYmIHBjLT5mbGFncy50ZXN0KFBDRl9TVE1UX1NUQVJUKQog
ICAgICAgICAmJiAoICBjaHVua19pc190b2tlbihwYywgQ1RfUVVBTElGSUVSKQogICAgICAg
ICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfVFlQRSkKICAgICAgICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX1RZUEVOQU1FKQogICAgICAgICAgICB8fCBjaHVua19pc190
b2tlbihwYywgQ1RfRENfTUVNQkVSKSAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJc3N1
ZSAjMjQ3OAogICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfV09SRCkpCiAg
ICAgICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgIT0gQ1RfRU5VTQogICAgICAg
ICAmJiAhcGMtPmZsYWdzLnRlc3QoUENGX0lOX0VOVU0pKQogICAgICB7CiAgICAgICAgIHBj
ID0gZml4X3ZhcmlhYmxlX2RlZmluaXRpb24ocGMpOwogICAgICB9CiAgICAgIGVsc2UKICAg
ICAgewogICAgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGMpOwogICAgICB9CiAg
IH0KfSAvLyBmaXhfc3ltYm9scwoKCnN0YXRpYyB2b2lkIHByb2Nlc3NfcmV0dXJucyh2b2lk
KQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CiAgIGNodW5rX3QgKnBjOwoKICAgcGMgPSBjaHVu
a19nZXRfaGVhZCgpOwoKICAgd2hpbGUgKHBjICE9IG51bGxwdHIpCiAgIHsKICAgICAgaWYg
KHBjLT50eXBlICE9IENUX1JFVFVSTikKICAgICAgewogICAgICAgICBwYyA9IGNodW5rX2dl
dF9uZXh0X3R5cGUocGMsIENUX1JFVFVSTiwgLTEpOwogICAgICAgICBjb250aW51ZTsKICAg
ICAgfQogICAgICBwYyA9IHByb2Nlc3NfcmV0dXJuKHBjKTsKICAgfQp9CgoKc3RhdGljIGNo
dW5rX3QgKnByb2Nlc3NfcmV0dXJuKGNodW5rX3QgKnBjKQp7CiAgIExPR19GVU5DX0VOVFJZ
KCk7CiAgIGNodW5rX3QgKm5leHQ7CiAgIGNodW5rX3QgKnRlbXA7CiAgIGNodW5rX3QgKnNl
bWk7CiAgIGNodW5rX3QgKmNwYXI7CiAgIGNodW5rX3QgY2h1bms7CgogICAvLyBncmFiIG5l
eHQgYW5kIGJhaWwgaWYgaXQgaXMgYSBzZW1pY29sb24KICAgbmV4dCA9IGNodW5rX3BwYV9n
ZXRfbmV4dF9uY25sKHBjKTsKCiAgIGlmICggIG5leHQgPT0gbnVsbHB0ciB8fCBjaHVua19p
c19zZW1pY29sb24obmV4dCkKICAgICAgfHwgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfTkVX
TElORSkpCiAgIHsKICAgICAgcmV0dXJuKG5leHQpOwogICB9CiAgIGxvZ19ydWxlX0IoIm5s
X3JldHVybl9leHByIik7CgogICBpZiAoICBvcHRpb25zOjpubF9yZXR1cm5fZXhwcigpICE9
IElBUkZfSUdOT1JFCiAgICAgICYmICFwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykp
CiAgIHsKICAgICAgbmV3bGluZV9pYXJmKHBjLCBvcHRpb25zOjpubF9yZXR1cm5fZXhwcigp
KTsKICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1BBUkVOX09QRU4pKQog
ICB7CiAgICAgIC8vIFNlZSBpZiB0aGUgcmV0dXJuIGlzIGZ1bGx5IHBhcmVuJ2QKICAgICAg
Y3BhciA9IGNodW5rX2dldF9uZXh0X3R5cGUobmV4dCwgQ1RfUEFSRU5fQ0xPU0UsIG5leHQt
PmxldmVsKTsKCiAgICAgIGlmIChjcGFyID09IG51bGxwdHIpCiAgICAgIHsKICAgICAgICAg
cmV0dXJuKG51bGxwdHIpOwogICAgICB9CiAgICAgIHNlbWkgPSBjaHVua19wcGFfZ2V0X25l
eHRfbmNubChjcGFyKTsKCiAgICAgIGlmIChzZW1pID09IG51bGxwdHIpCiAgICAgIHsKICAg
ICAgICAgcmV0dXJuKG51bGxwdHIpOwogICAgICB9CgogICAgICBpZiAoY2h1bmtfaXNfdG9r
ZW4oc2VtaSwgQ1RfTkVXTElORSkgfHwgY2h1bmtfaXNfc2VtaWNvbG9uKHNlbWkpKQogICAg
ICB7CiAgICAgICAgIGxvZ19ydWxlX0IoIm1vZF9wYXJlbl9vbl9yZXR1cm4iKTsKCiAgICAg
ICAgIGlmIChvcHRpb25zOjptb2RfcGFyZW5fb25fcmV0dXJuKCkgPT0gSUFSRl9SRU1PVkUp
CiAgICAgICAgIHsKICAgICAgICAgICAgTE9HX0ZNVChMUkVUVVJOLCAiJXMoJWQpOiByZW1v
dmluZyBwYXJlbnMgb24gb3JpZ19saW5lICV6dVxuIiwKICAgICAgICAgICAgICAgICAgICBf
X2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUpOwoKICAgICAgICAgICAgLy8gbG93
ZXIgdGhlIGxldmVsIG9mIGV2ZXJ5dGhpbmcKICAgICAgICAgICAgZm9yICh0ZW1wID0gbmV4
dDsgdGVtcCAhPSBjcGFyOyB0ZW1wID0gY2h1bmtfZ2V0X25leHQodGVtcCkpCiAgICAgICAg
ICAgIHsKICAgICAgICAgICAgICAgaWYgKHRlbXAtPmxldmVsID09IDApCiAgICAgICAgICAg
ICAgIHsKICAgICAgICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsICIlcyglZCk6IHRlbXAt
PmxldmVsIGlzIFpFUk8sIGNhbm5vdCBiZSBkZWNyZW1lbnRlZCwgYXQgbGluZSAlenUsIGNv
bHVtbiAlenVcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElO
RV9fLCB0ZW1wLT5vcmlnX2xpbmUsIHRlbXAtPm9yaWdfY29sKTsKICAgICAgICAgICAgICAg
ICAgbG9nX2ZsdXNoKHRydWUpOwogICAgICAgICAgICAgICAgICBleGl0KEVYX1NPRlRXQVJF
KTsKICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICB0ZW1wLT5sZXZlbC0tOwogICAg
ICAgICAgICB9CgogICAgICAgICAgICAvLyBkZWxldGUgdGhlIHBhcmVudGhlc2lzCiAgICAg
ICAgICAgIGNodW5rX2RlbChuZXh0KTsKICAgICAgICAgICAgY2h1bmtfZGVsKGNwYXIpOwoK
ICAgICAgICAgICAgLy8gYmFjayB1cCBmb2xsb3dpbmcgY2h1bmtzCiAgICAgICAgICAgIHRl
bXAgPSBzZW1pOwoKICAgICAgICAgICAgd2hpbGUgKHRlbXAgIT0gbnVsbHB0ciAmJiB0ZW1w
LT50eXBlICE9IENUX05FV0xJTkUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgdGVt
cC0+Y29sdW1uICAgICAgID0gdGVtcC0+Y29sdW1uIC0gMjsKICAgICAgICAgICAgICAgdGVt
cC0+b3JpZ19jb2wgICAgID0gdGVtcC0+b3JpZ19jb2wgLSAyOwogICAgICAgICAgICAgICB0
ZW1wLT5vcmlnX2NvbF9lbmQgPSB0ZW1wLT5vcmlnX2NvbF9lbmQgLSAyOwogICAgICAgICAg
ICAgICB0ZW1wICAgICAgICAgICAgICAgPSBjaHVua19nZXRfbmV4dCh0ZW1wKTsKICAgICAg
ICAgICAgfQogICAgICAgICB9CiAgICAgICAgIGVsc2UKICAgICAgICAgewogICAgICAgICAg
ICBMT0dfRk1UKExSRVRVUk4sICIlcyglZCk6IGtlZXBpbmcgcGFyZW5zIG9uIG9yaWdfbGlu
ZSAlenVcbiIsCiAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+
b3JpZ19saW5lKTsKCiAgICAgICAgICAgIC8vIG1hcmsgJiBrZWVwIHRoZW0KICAgICAgICAg
ICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBDVF9SRVRVUk4pOwogICAgICAgICAgICBzZXRf
Y2h1bmtfcGFyZW50KGNwYXIsIENUX1JFVFVSTik7CiAgICAgICAgIH0KICAgICAgICAgcmV0
dXJuKHNlbWkpOwogICAgICB9CiAgIH0KICAgLy8gV2UgZG9uJ3QgaGF2ZSBhIGZ1bGx5IHBh
cmVuJ2QgcmV0dXJuLiBTaG91bGQgd2UgYWRkIHNvbWU/CiAgIGxvZ19ydWxlX0IoIm1vZF9w
YXJlbl9vbl9yZXR1cm4iKTsKCiAgIGlmICghKG9wdGlvbnM6Om1vZF9wYXJlbl9vbl9yZXR1
cm4oKSAmIElBUkZfQUREKSkKICAgewogICAgICByZXR1cm4obmV4dCk7CiAgIH0KCiAgIC8v
IElzc3VlICMxOTE3CiAgIC8vIE5ldmVyIGFkZCBwYXJlbnMgdG8gYSBicmFjZWQgaW5pdCBs
aXN0OyB0aGF0IGJyZWFrcyB0aGUgY29kZQogICAvLyAgIHJldHVybiB7YXJncy4uLn07ICAg
IC8vIEMrKzExIHR5cGUgZWxpc2lvbjsgb2theQogICAvLyAgIHJldHVybiAoe2FyZ3MuLi59
KTsgIC8vIGlsbC1mb3JtZWQKICAgaWYgKCAgbGFuZ3VhZ2VfaXNfc2V0KExBTkdfQ1BQKSAm
JiBjaHVua19pc190b2tlbihuZXh0LCBDVF9CUkFDRV9PUEVOKQogICAgICAmJiBnZXRfY2h1
bmtfcGFyZW50X3R5cGUobmV4dCkgPT0gQ1RfQlJBQ0VEX0lOSVRfTElTVCkKICAgewogICAg
ICBMT0dfRk1UKExSRVRVUk4sICIlcyglZCk6IG5vdCBhZGRpbmcgcGFyZW5zIGFyb3VuZCBi
cmFjZWQgaW5pdGlhbGl6ZXIiCiAgICAgICAgICAgICAgIiBvbiBvcmlnX2xpbmUgJXpkXG4i
LAogICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSk7CiAg
ICAgIHJldHVybihuZXh0KTsKICAgfQogICAvLyBmaW5kIHRoZSBuZXh0IHNlbWljb2xvbiBv
biB0aGUgc2FtZSBsZXZlbAogICBzZW1pID0gbmV4dDsKCiAgIGlmIChwYy0+ZmxhZ3MudGVz
dChQQ0ZfSU5fUFJFUFJPQykpCiAgIHsKICAgICAgd2hpbGUgKChzZW1pID0gc2VtaS0+bmV4
dCkgIT0gbnVsbHB0cikKICAgICAgewogICAgICAgICBpZiAoIXNlbWktPmZsYWdzLnRlc3Qo
UENGX0lOX1BSRVBST0MpKQogICAgICAgICB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAg
ICB9CgogICAgICAgICBpZiAoc2VtaS0+bGV2ZWwgPCBwYy0+bGV2ZWwpCiAgICAgICAgIHsK
ICAgICAgICAgICAgcmV0dXJuKHNlbWkpOwogICAgICAgICB9CgogICAgICAgICBpZiAoY2h1
bmtfaXNfc2VtaWNvbG9uKHNlbWkpICYmIHBjLT5sZXZlbCA9PSBzZW1pLT5sZXZlbCkKICAg
ICAgICAgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogICAgICB9CiAgIH0KICAg
ZWxzZQogICB7CiAgICAgIHdoaWxlICgoc2VtaSA9IGNodW5rX2dldF9uZXh0KHNlbWkpKSAh
PSBudWxscHRyKQogICAgICB7CiAgICAgICAgIGlmIChzZW1pLT5sZXZlbCA8IHBjLT5sZXZl
bCkKICAgICAgICAgewogICAgICAgICAgICByZXR1cm4oc2VtaSk7CiAgICAgICAgIH0KCiAg
ICAgICAgIGlmIChjaHVua19pc19zZW1pY29sb24oc2VtaSkgJiYgcGMtPmxldmVsID09IHNl
bWktPmxldmVsKQogICAgICAgICB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAg
ICAgIH0KICAgfQoKICAgaWYgKHNlbWkpCiAgIHsKICAgICAgLy8gYWRkIHRoZSBwYXJlbnRo
ZXNpcwogICAgICBzZXRfY2h1bmtfdHlwZSgmY2h1bmssIENUX1BBUkVOX09QRU4pOwogICAg
ICBzZXRfY2h1bmtfcGFyZW50KCZjaHVuaywgQ1RfUkVUVVJOKTsKICAgICAgY2h1bmsuc3Ry
ICAgICAgICAgPSAiKCI7CiAgICAgIGNodW5rLmxldmVsICAgICAgID0gcGMtPmxldmVsOwog
ICAgICBjaHVuay5icmFjZV9sZXZlbCA9IHBjLT5icmFjZV9sZXZlbDsKICAgICAgY2h1bmsu
b3JpZ19saW5lICAgPSBwYy0+b3JpZ19saW5lOwogICAgICBjaHVuay5vcmlnX2NvbCAgICA9
IG5leHQtPm9yaWdfY29sIC0gMTsKICAgICAgY2h1bmsuZmxhZ3MgICAgICAgPSBwYy0+Zmxh
Z3MgJiBQQ0ZfQ09QWV9GTEFHUzsKICAgICAgY2h1bmtfYWRkX2JlZm9yZSgmY2h1bmssIG5l
eHQpOwoKICAgICAgc2V0X2NodW5rX3R5cGUoJmNodW5rLCBDVF9QQVJFTl9DTE9TRSk7CiAg
ICAgIGNodW5rLnN0ciAgICAgICA9ICIpIjsKICAgICAgY2h1bmsub3JpZ19saW5lID0gc2Vt
aS0+b3JpZ19saW5lOwogICAgICBjaHVuay5vcmlnX2NvbCAgPSBzZW1pLT5vcmlnX2NvbCAt
IDE7CiAgICAgIGNwYXIgICAgICAgICAgICA9IGNodW5rX2FkZF9iZWZvcmUoJmNodW5rLCBz
ZW1pKTsKCiAgICAgIExPR19GTVQoTFJFVFVSTiwgIiVzKCVkKTogYWRkZWQgcGFyZW5zIG9u
IG9yaWdfbGluZSAlenVcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBw
Yy0+b3JpZ19saW5lKTsKCiAgICAgIGZvciAodGVtcCA9IG5leHQ7IHRlbXAgIT0gY3Bhcjsg
dGVtcCA9IGNodW5rX2dldF9uZXh0KHRlbXApKQogICAgICB7CiAgICAgICAgIHRlbXAtPmxl
dmVsKys7CiAgICAgIH0KICAgfQogICByZXR1cm4oc2VtaSk7Cn0gLy8gcHJvY2Vzc19yZXR1
cm4KCgpzdGF0aWMgYm9vbCBpc191Y2FzZV9zdHIoY29uc3QgY2hhciAqc3RyLCBzaXplX3Qg
bGVuKQp7CiAgIHdoaWxlIChsZW4tLSA+IDApCiAgIHsKICAgICAgaWYgKHVuY190b3VwcGVy
KCpzdHIpICE9ICpzdHIpCiAgICAgIHsKICAgICAgICAgcmV0dXJuKGZhbHNlKTsKICAgICAg
fQogICAgICBzdHIrKzsKICAgfQogICByZXR1cm4odHJ1ZSk7Cn0KCgpzdGF0aWMgYm9vbCBp
c19vY19ibG9jayhjaHVua190ICpwYykKewogICByZXR1cm4oICBwYyAhPSBudWxscHRyCiAg
ICAgICAgICYmICggIGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgPT0gQ1RfT0NfQkxPQ0tf
VFlQRQogICAgICAgICAgICB8fCBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09IENUX09D
X0JMT0NLX0VYUFIKICAgICAgICAgICAgfHwgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9
PSBDVF9PQ19CTE9DS19BUkcKICAgICAgICAgICAgfHwgZ2V0X2NodW5rX3BhcmVudF90eXBl
KHBjKSA9PSBDVF9PQ19CTE9DSwogICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywg
Q1RfT0NfQkxPQ0tfQ0FSRVQpCiAgICAgICAgICAgIHx8IChwYy0+bmV4dCAhPSBudWxscHRy
ICYmIHBjLT5uZXh0LT50eXBlID09IENUX09DX0JMT0NLX0NBUkVUKQogICAgICAgICAgICB8
fCAocGMtPnByZXYgIT0gbnVsbHB0ciAmJiBwYy0+cHJldi0+dHlwZSA9PSBDVF9PQ19CTE9D
S19DQVJFVCkpKTsKfQoKCnN0YXRpYyB2b2lkIGZpeF9jYXN0cyhjaHVua190ICpzdGFydCkK
ewogICBMT0dfRlVOQ19FTlRSWSgpOwogICBjaHVua190ICAgICpwYzsKICAgY2h1bmtfdCAg
ICAqcHJldjsKICAgY2h1bmtfdCAgICAqZmlyc3Q7CiAgIGNodW5rX3QgICAgKmFmdGVyOwog
ICBjaHVua190ICAgICpsYXN0ID0gbnVsbHB0cjsKICAgY2h1bmtfdCAgICAqcGFyZW5fY2xv
c2U7CiAgIGNvbnN0IGNoYXIgKnZlcmIgICAgICA9ICJsaWtlbHkiOwogICBjb25zdCBjaGFy
ICpkZXRhaWwgICAgPSAiIjsKICAgc2l6ZV90ICAgICBjb3VudCAgICAgID0gMDsKICAgaW50
ICAgICAgICB3b3JkX2NvdW50ID0gMDsKICAgYm9vbCAgICAgICBub3BlOwogICBib29sICAg
ICAgIGRvdWJ0ZnVsX2Nhc3QgPSBmYWxzZTsKCgogICBMT0dfRk1UKExDQVNUUywgIiVzKCVk
KTogc3RhcnQtPnRleHQoKSBpcyAnJXMnLCBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBp
cyAlenVcbiIsCiAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBzdGFydC0+dGV4dCgp
LCBzdGFydC0+b3JpZ19saW5lLCBzdGFydC0+b3JpZ19jb2wpOwoKICAgcHJldiA9IGNodW5r
X2dldF9wcmV2X25jbmxuaShzdGFydCk7ICAgLy8gSXNzdWUgIzIyNzkKCiAgIGlmIChwcmV2
ID09IG51bGxwdHIpCiAgIHsKICAgICAgcmV0dXJuOwogICB9CgogICBpZiAoY2h1bmtfaXNf
dG9rZW4ocHJldiwgQ1RfUFBfREVGSU5FRCkpCiAgIHsKICAgICAgTE9HX0ZNVChMQ0FTVFMs
ICIlcyglZCk6ICAtLSBub3QgYSBjYXN0IC0gYWZ0ZXIgZGVmaW5lZFxuIiwKICAgICAgICAg
ICAgICBfX2Z1bmNfXywgX19MSU5FX18pOwogICAgICByZXR1cm47CiAgIH0KCiAgIGlmIChj
aHVua19pc190b2tlbihwcmV2LCBDVF9BTkdMRV9DTE9TRSkpCiAgIHsKICAgICAgTE9HX0ZN
VChMQ0FTVFMsICIlcyglZCk6ICAtLSBub3QgYSBjYXN0IC0gYWZ0ZXIgPiAodGVtcGxhdGUp
XG4iLAogICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXyk7CiAgICAgIHJldHVybjsK
ICAgfQogICAvLyBNYWtlIHN1cmUgdGhlcmUgaXMgb25seSBXT1JELCBUWVBFLCBhbmQgJyon
IG9yICdeJyBiZWZvcmUgdGhlIGNsb3NlIHBhcmVuCiAgIHBjICAgID0gY2h1bmtfZ2V0X25l
eHRfbmNubChzdGFydCk7CiAgIGZpcnN0ID0gcGM7CgogICB3aGlsZSAoICBwYyAhPSBudWxs
cHRyCiAgICAgICAgICYmICggIGNodW5rX2lzX3R5cGUocGMpCiAgICAgICAgICAgIHx8IGNo
dW5rX2lzX3Rva2VuKHBjLCBDVF9XT1JEKQogICAgICAgICAgICB8fCBjaHVua19pc190b2tl
bihwYywgQ1RfUVVBTElGSUVSKQogICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywg
Q1RfRENfTUVNQkVSKQogICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfUFAp
CiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TVEFSKQogICAgICAgICAg
ICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfUVVFU1RJT04pCiAgICAgICAgICAgIHx8IGNo
dW5rX2lzX3Rva2VuKHBjLCBDVF9DQVJFVCkKICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX1RTUVVBUkUpCiAgICAgICAgICAgIHx8ICggICggIGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9BTkdMRV9PUEVOKQogICAgICAgICAgICAgICAgICB8fCBjaHVua19pc190b2tl
bihwYywgQ1RfQU5HTEVfQ0xPU0UpKQogICAgICAgICAgICAgICAmJiBsYW5ndWFnZV9pc19z
ZXQoTEFOR19PQyB8IExBTkdfSkFWQSkpCiAgICAgICAgICAgIHx8ICggICggIGNodW5rX2lz
X3Rva2VuKHBjLCBDVF9RVUVTVElPTikKICAgICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNf
dG9rZW4ocGMsIENUX0NPTU1BKQogICAgICAgICAgICAgICAgICB8fCBjaHVua19pc190b2tl
bihwYywgQ1RfTUVNQkVSKSkKICAgICAgICAgICAgICAgJiYgbGFuZ3VhZ2VfaXNfc2V0KExB
TkdfSkFWQSkpCiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BTVApKSkK
ICAgewogICAgICBMT0dfRk1UKExDQVNUUywgIiVzKCVkKTogcGMtPnRleHQoKSBpcyAnJXMn
LCBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHR5cGUgaXMgJXNcbiIsCiAg
ICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19s
aW5lLCBwYy0+b3JpZ19jb2wsIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CgogICAgICBp
ZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1dPUkQpIHx8IChjaHVua19pc190b2tlbihsYXN0
LCBDVF9BTkdMRV9DTE9TRSkgJiYgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0RDX01FTUJFUikp
KQogICAgICB7CiAgICAgICAgIHdvcmRfY291bnQrKzsKICAgICAgfQogICAgICBlbHNlIGlm
IChjaHVua19pc190b2tlbihwYywgQ1RfRENfTUVNQkVSKSB8fCBjaHVua19pc190b2tlbihw
YywgQ1RfTUVNQkVSKSB8fCBjaHVua19pc190b2tlbihwYywgQ1RfUFApKQogICAgICB7CiAg
ICAgICAgIC8vIG1pZ2h0IGJlIG5lZ2F0aXYsIHN1Y2ggYXMgd2l0aDoKICAgICAgICAgLy8g
YSA9IHZhbCArIChDRm9vOjpiYXJfdCk3OwogICAgICAgICB3b3JkX2NvdW50LS07CiAgICAg
IH0KICAgICAgbGFzdCA9IHBjOwogICAgICBwYyAgID0gY2h1bmtfZ2V0X25leHRfbmNubChw
Yyk7CiAgICAgIGNvdW50Kys7CiAgIH0KCiAgIGlmICggIHBjID09IG51bGxwdHIKICAgICAg
fHwgcGMtPnR5cGUgIT0gQ1RfUEFSRU5fQ0xPU0UKICAgICAgfHwgY2h1bmtfaXNfdG9rZW4o
cHJldiwgQ1RfT0NfQ0xBU1MpKQogICB7CiAgICAgIExPR19GTVQoTENBU1RTLCAiJXMoJWQp
OiAgLS0gbm90IGEgY2FzdCwgaGl0IHR5cGUgaXMgJXNcbiIsCiAgICAgICAgICAgICAgX19m
dW5jX18sIF9fTElORV9fLCBwYyA9PSBudWxscHRyID8gIk5VTEwiIDogZ2V0X3Rva2VuX25h
bWUocGMtPnR5cGUpKTsKICAgICAgcmV0dXJuOwogICB9CgogICBpZiAod29yZF9jb3VudCA+
IDEpCiAgIHsKICAgICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6ICAtLSB0b28gbWFueSB3
b3JkczogJWRcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB3b3JkX2Nv
dW50KTsKICAgICAgcmV0dXJuOwogICB9CiAgIHBhcmVuX2Nsb3NlID0gcGM7CgogICAvLyBJ
ZiBsYXN0IGlzIGEgdHlwZSBvciBzdGFyL2NhcmV0LCB3ZSBoYXZlIGEgY2FzdCBmb3Igc3Vy
ZQogICBpZiAoICBjaHVua19pc190b2tlbihsYXN0LCBDVF9TVEFSKQogICAgICB8fCBjaHVu
a19pc190b2tlbihsYXN0LCBDVF9DQVJFVCkKICAgICAgfHwgY2h1bmtfaXNfdG9rZW4obGFz
dCwgQ1RfUFRSX1RZUEUpCiAgICAgIHx8IGNodW5rX2lzX3Rva2VuKGxhc3QsIENUX1RZUEUp
CiAgICAgIHx8IChjaHVua19pc190b2tlbihsYXN0LCBDVF9BTkdMRV9DTE9TRSkgJiYgbGFu
Z3VhZ2VfaXNfc2V0KExBTkdfT0MgfCBMQU5HX0pBVkEpKSkKICAgewogICAgICB2ZXJiID0g
ImZvciBzdXJlIjsKICAgfQogICBlbHNlIGlmIChjb3VudCA9PSAxKQogICB7CiAgICAgIC8q
CiAgICAgICAqIFdlIGFyZSBvbiBhIHBvdGVudGlhbCBjYXN0IG9mIHRoZSBmb3JtICIod29y
ZCkiLgogICAgICAgKiBXZSBkb24ndCBrbm93IGlmIHRoZSB3b3JkIGlzIGEgdHlwZS4gU28g
bGV0cyBndWVzcyBiYXNlZCBvbiBzb21lCiAgICAgICAqIHNpbXBsZSBydWxlczoKICAgICAg
ICogIC0gaWYgYWxsIGNhcHMsIGxpa2VseSBhIHR5cGUKICAgICAgICogIC0gaWYgaXQgZW5k
cyBpbiBfdCwgbGlrZWx5IGEgdHlwZQogICAgICAgKiAgLSBpZiBpdCdzIG9iamVjdGl2ZS1j
IGFuZCB0aGUgdHlwZSBpcyBpZCwgbGlrZWx5IHZhbGlkCiAgICAgICAqLwogICAgICB2ZXJi
ID0gImd1ZXNzZWQiOwoKICAgICAgaWYgKCAgKGxhc3QtPmxlbigpID4gMykKICAgICAgICAg
JiYgKGxhc3QtPnN0cltsYXN0LT5sZW4oKSAtIDJdID09ICdfJykKICAgICAgICAgJiYgKGxh
c3QtPnN0cltsYXN0LT5sZW4oKSAtIDFdID09ICd0JykpCiAgICAgIHsKICAgICAgICAgZGV0
YWlsID0gIiAtLSAnX3QnIjsKICAgICAgfQogICAgICBlbHNlIGlmIChpc191Y2FzZV9zdHIo
bGFzdC0+dGV4dCgpLCBsYXN0LT5sZW4oKSkpCiAgICAgIHsKICAgICAgICAgZGV0YWlsID0g
IiAtLSB1cHBlciBjYXNlIjsKICAgICAgfQogICAgICBlbHNlIGlmIChsYW5ndWFnZV9pc19z
ZXQoTEFOR19PQykgJiYgY2h1bmtfaXNfc3RyKGxhc3QsICJpZCIsIDIpKQogICAgICB7CiAg
ICAgICAgIGRldGFpbCA9ICIgLS0gT2JqZWN0aXZlLUMgaWQiOwogICAgICB9CiAgICAgIGVs
c2UKICAgICAgewogICAgICAgICAvLyBJZiB3ZSBjYW4ndCB0ZWxsIGZvciBzdXJlIHdoZXRo
ZXIgdGhpcyBpcyBhIGNhc3QsIGRlY2lkZSBhZ2FpbnN0IGl0CiAgICAgICAgIGRldGFpbCAg
ICAgICAgPSAiIC0tIG1peGVkIGNhc2UiOwogICAgICAgICBkb3VidGZ1bF9jYXN0ID0gdHJ1
ZTsKICAgICAgfQogICAgICAvKgogICAgICAgKiBJZiB0aGUgbmV4dCBpdGVtIGlzIGEgKiBv
ciAmLCB0aGUgbmV4dCBpdGVtIGFmdGVyIHRoYXQgY2FuJ3QgYmUgYQogICAgICAgKiBudW1i
ZXIgb3Igc3RyaW5nLgogICAgICAgKgogICAgICAgKiBJZiB0aGUgbmV4dCBpdGVtIGlzIGEg
KywgdGhlIG5leHQgaXRlbSBoYXMgdG8gYmUgYSBudW1iZXIuCiAgICAgICAqCiAgICAgICAq
IElmIHRoZSBuZXh0IGl0ZW0gaXMgYSAtLCB0aGUgbmV4dCBpdGVtIGNhbid0IGJlIGEgc3Ry
aW5nLgogICAgICAgKgogICAgICAgKiBGb3IgdGhpcyB0byBiZSBhIGNhc3QsIHRoZSBjbG9z
ZSBwYXJlbiBtdXN0IGJlIGZvbGxvd2VkIGJ5OgogICAgICAgKiAgLSBjb25zdGFudCAobnVt
YmVyIG9yIHN0cmluZykKICAgICAgICogIC0gcGFyZW4gb3BlbgogICAgICAgKiAgLSB3b3Jk
CiAgICAgICAqCiAgICAgICAqIEZpbmQgdGhlIG5leHQgbm9uLW9wZW4gcGFyZW4gaXRlbS4K
ICAgICAgICovCiAgICAgIHBjICAgID0gY2h1bmtfZ2V0X25leHRfbmNubChwYXJlbl9jbG9z
ZSk7CiAgICAgIGFmdGVyID0gcGM7CgogICAgICBkbwogICAgICB7CiAgICAgICAgIGFmdGVy
ID0gY2h1bmtfZ2V0X25leHRfbmNubChhZnRlcik7CiAgICAgIH0gd2hpbGUgKGNodW5rX2lz
X3Rva2VuKGFmdGVyLCBDVF9QQVJFTl9PUEVOKSk7CgogICAgICBpZiAoYWZ0ZXIgPT0gbnVs
bHB0cikKICAgICAgewogICAgICAgICBMT0dfRk1UKExDQVNUUywgIiVzKCVkKTogIC0tIG5v
dCBhIGNhc3QgLSBoaXQgTlVMTFxuIiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19M
SU5FX18pOwogICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbm9wZSA9IGZhbHNlOwoK
ICAgICAgaWYgKGNodW5rX2lzX3B0cl9vcGVyYXRvcihwYykpCiAgICAgIHsKICAgICAgICAg
Ly8gc3RhciAoKikgYW5kIGFkZHJlc3MgKCYpIGFyZSBhbWJpZ3VvdXMKICAgICAgICAgaWYg
KCAgY2h1bmtfaXNfdG9rZW4oYWZ0ZXIsIENUX05VTUJFUl9GUCkKICAgICAgICAgICAgfHwg
Y2h1bmtfaXNfdG9rZW4oYWZ0ZXIsIENUX05VTUJFUikKICAgICAgICAgICAgfHwgY2h1bmtf
aXNfdG9rZW4oYWZ0ZXIsIENUX1NUUklORykKICAgICAgICAgICAgfHwgZG91YnRmdWxfY2Fz
dCkKICAgICAgICAgewogICAgICAgICAgICBub3BlID0gdHJ1ZTsKICAgICAgICAgfQogICAg
ICB9CiAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9NSU5VUykpCiAgICAg
IHsKICAgICAgICAgLy8gKFVJTlQ4KS0xIG9yIChmb28pLTEgb3IgKEZPTyktJ2EnCiAgICAg
ICAgIGlmIChjaHVua19pc190b2tlbihhZnRlciwgQ1RfU1RSSU5HKSB8fCBkb3VidGZ1bF9j
YXN0KQogICAgICAgICB7CiAgICAgICAgICAgIG5vcGUgPSB0cnVlOwogICAgICAgICB9CiAg
ICAgIH0KICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1BMVVMpKQogICAg
ICB7CiAgICAgICAgIC8vIChVSU5UOCkrMSBvciAoZm9vKSsxCiAgICAgICAgIGlmICggIChh
ZnRlci0+dHlwZSAhPSBDVF9OVU1CRVIgJiYgYWZ0ZXItPnR5cGUgIT0gQ1RfTlVNQkVSX0ZQ
KQogICAgICAgICAgICB8fCBkb3VidGZ1bF9jYXN0KQogICAgICAgICB7CiAgICAgICAgICAg
IG5vcGUgPSB0cnVlOwogICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSBpZiAoICBwYy0+
dHlwZSAhPSBDVF9OVU1CRVJfRlAKICAgICAgICAgICAgICAmJiBwYy0+dHlwZSAhPSBDVF9O
VU1CRVIKICAgICAgICAgICAgICAmJiBwYy0+dHlwZSAhPSBDVF9XT1JECiAgICAgICAgICAg
ICAgJiYgcGMtPnR5cGUgIT0gQ1RfVEhJUwogICAgICAgICAgICAgICYmIHBjLT50eXBlICE9
IENUX1RZUEUKICAgICAgICAgICAgICAmJiBwYy0+dHlwZSAhPSBDVF9QQVJFTl9PUEVOCiAg
ICAgICAgICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfU1RSSU5HCiAgICAgICAgICAgICAgJiYg
cGMtPnR5cGUgIT0gQ1RfREVDTFRZUEUKICAgICAgICAgICAgICAmJiBwYy0+dHlwZSAhPSBD
VF9TSVpFT0YKICAgICAgICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpICE9
IENUX1NJWkVPRgogICAgICAgICAgICAgICYmIHBjLT50eXBlICE9IENUX0ZVTkNfQ0FMTAog
ICAgICAgICAgICAgICYmIHBjLT50eXBlICE9IENUX0ZVTkNfQ0FMTF9VU0VSCiAgICAgICAg
ICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfRlVOQ1RJT04KICAgICAgICAgICAgICAmJiBwYy0+
dHlwZSAhPSBDVF9CUkFDRV9PUEVOCiAgICAgICAgICAgICAgJiYgKCEoICBjaHVua19pc190
b2tlbihwYywgQ1RfU1FVQVJFX09QRU4pCiAgICAgICAgICAgICAgICAgICAmJiBsYW5ndWFn
ZV9pc19zZXQoTEFOR19PQykpKSkKICAgICAgewogICAgICAgICBMT0dfRk1UKExDQVNUUywg
IiVzKCVkKTogIC0tIG5vdCBhIGNhc3QgLSBmb2xsb3dlZCBieSB0ZXh0KCkgJyVzJywgdHlw
ZSBpcyAlc1xuIiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50
ZXh0KCksIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CiAgICAgICAgIHJldHVybjsKICAg
ICAgfQoKICAgICAgaWYgKG5vcGUpCiAgICAgIHsKICAgICAgICAgTE9HX0ZNVChMQ0FTVFMs
ICIlcyglZCk6ICAtLSBub3QgYSBjYXN0IC0gdGV4dCgpICclcycgZm9sbG93ZWQgYnkgdHlw
ZSAlc1xuIiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0
KCksIGdldF90b2tlbl9uYW1lKGFmdGVyLT50eXBlKSk7CiAgICAgICAgIHJldHVybjsKICAg
ICAgfQogICB9CiAgIC8vIGlmIHRoZSAnY2FzdCcgaXMgZm9sbG93ZWQgYnkgYSBzZW1pY29s
b24sIGNvbW1hLCBib29sIG9yIGNsb3NlIHBhcmVudGhlc2lzLCBpdCBpc24ndAogICBwYyA9
IGNodW5rX2dldF9uZXh0X25jbmwocGFyZW5fY2xvc2UpOwoKICAgaWYgKHBjID09IG51bGxw
dHIpCiAgIHsKICAgICAgcmV0dXJuOwogICB9CgogICBpZiAoICBjaHVua19pc19zZW1pY29s
b24ocGMpCiAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DT01NQSkKICAgICAgfHwg
Y2h1bmtfaXNfdG9rZW4ocGMsIENUX0JPT0wpICAgICAgICAgICAgICAgLy8gSXNzdWUgIzIx
NTEKICAgICAgfHwgY2h1bmtfaXNfcGFyZW5fY2xvc2UocGMpKQogICB7CiAgICAgIExPR19G
TVQoTENBU1RTLCAiJXMoJWQpOiAgLS0gbm90IGEgY2FzdCAtIGZvbGxvd2VkIGJ5IHR5cGUg
JXNcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBnZXRfdG9rZW5fbmFt
ZShwYy0+dHlwZSkpOwogICAgICByZXR1cm47CiAgIH0KICAgc2V0X2NodW5rX3BhcmVudChz
dGFydCwgQ1RfQ19DQVNUKTsKICAgc2V0X2NodW5rX3BhcmVudChwYXJlbl9jbG9zZSwgQ1Rf
Q19DQVNUKTsKCiAgIExPR19GTVQoTENBU1RTLCAiJXMoJWQpOiAgLS0gJXMgYy1jYXN0OiAo
IiwKICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHZlcmIpOwoKICAgZm9yIChwYyA9
IGZpcnN0OwogICAgICAgIHBjICE9IG51bGxwdHIgJiYgcGMgIT0gcGFyZW5fY2xvc2U7CiAg
ICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKSkKICAgewogICAgICBzZXRfY2h1
bmtfcGFyZW50KHBjLCBDVF9DX0NBU1QpOwogICAgICBtYWtlX3R5cGUocGMpOwogICAgICBM
T0dfRk1UKExDQVNUUywgIiAlcyIsIHBjLT50ZXh0KCkpOwogICB9CgogICBMT0dfRk1UKExD
QVNUUywgIiApJXNcbiIsIGRldGFpbCk7CgogICAvLyBNYXJrIHRoZSBuZXh0IGl0ZW0gYXMg
YW4gZXhwcmVzc2lvbiBzdGFydAogICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGFyZW5f
Y2xvc2UpOwoKICAgaWYgKHBjICE9IG51bGxwdHIpCiAgIHsKICAgICAgY2h1bmtfZmxhZ3Nf
c2V0KHBjLCBQQ0ZfRVhQUl9TVEFSVCk7CgogICAgICBpZiAoY2h1bmtfaXNfb3BlbmluZ19i
cmFjZShwYykpCiAgICAgIHsKICAgICAgICAgc2V0X3BhcmVuX3BhcmVudChwYywgZ2V0X2No
dW5rX3BhcmVudF90eXBlKHN0YXJ0KSk7CiAgICAgIH0KICAgfQp9IC8vIGZpeF9jYXN0cwoK
CnN0YXRpYyB2b2lkIGZpeF90eXBlX2Nhc3QoY2h1bmtfdCAqc3RhcnQpCnsKICAgTE9HX0ZV
TkNfRU5UUlkoKTsKICAgY2h1bmtfdCAqcGM7CgogICBwYyA9IGNodW5rX2dldF9uZXh0X25j
bmwoc3RhcnQpOwoKICAgaWYgKHBjID09IG51bGxwdHIgfHwgcGMtPnR5cGUgIT0gQ1RfQU5H
TEVfT1BFTikKICAgewogICAgICByZXR1cm47CiAgIH0KCiAgIHdoaWxlICggICgocGMgPSBj
aHVua19nZXRfbmV4dF9uY25sKHBjKSkgIT0gbnVsbHB0cikKICAgICAgICAgJiYgcGMtPmxl
dmVsID49IHN0YXJ0LT5sZXZlbCkKICAgewogICAgICBpZiAocGMtPmxldmVsID09IHN0YXJ0
LT5sZXZlbCAmJiBjaHVua19pc190b2tlbihwYywgQ1RfQU5HTEVfQ0xPU0UpKQogICAgICB7
CiAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7CgogICAgICAgICBpZiAo
cGMgPT0gbnVsbHB0cikKICAgICAgICAgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAg
IH0KCiAgICAgICAgIGlmIChjaHVua19pc19zdHIocGMsICIoIiwgMSkpCiAgICAgICAgIHsK
ICAgICAgICAgICAgc2V0X3BhcmVuX3BhcmVudChwYywgQ1RfVFlQRV9DQVNUKTsKICAgICAg
ICAgfQogICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbWFrZV90eXBlKHBjKTsKICAg
fQp9CgoKc3RhdGljIHZvaWQgZml4X2VudW1fc3RydWN0X3VuaW9uKGNodW5rX3QgKnBjKQp7
CiAgIExPR19GVU5DX0VOVFJZKCk7CiAgIGNodW5rX3QgICAgICpuZXh0OwogICBjaHVua190
ICAgICAqcHJldiAgICAgICAgPSBudWxscHRyOwogICBwY2ZfZmxhZ3NfdCBmbGFncyAgICAg
ICAgPSBQQ0ZfVkFSXzFTVF9ERUY7CiAgIGF1dG8gY29uc3QgIGluX2Zjbl9wYXJlbiA9IHBj
LT5mbGFncyAmIFBDRl9JTl9GQ05fREVGOwoKICAgLy8gTWFrZSBzdXJlIHRoaXMgd2Fzbid0
IGEgY2FzdAogICBpZiAoZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9DX0NBU1Qp
CiAgIHsKICAgICAgcmV0dXJuOwogICB9CiAgIC8vIHRoZSBuZXh0IGl0ZW0gaXMgZWl0aGVy
IGEgdHlwZSBvciBvcGVuIGJyYWNlCiAgIG5leHQgPSBjaHVua19nZXRfbmV4dF9uY25sKHBj
KTsKCiAgIC8vIHRoZSBlbnVtLWtleSBtaWdodCBiZSBlbnVtLCBlbnVtIGNsYXNzIG9yIGVu
dW0gc3RydWN0IChUT0RPKQogICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfRU5VTV9D
TEFTUykpCiAgIHsKICAgICAgbmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwobmV4dCk7IC8v
IGdldCB0aGUgbmV4dCBvbmUKICAgfQoKICAgaWYgKGxhbmd1YWdlX2lzX3NldChMQU5HX0NQ
UCkpCiAgIHsKICAgICAgbmV4dCA9IHNraXBfYXR0cmlidXRlX25leHQobmV4dCk7IC8vIGdl
dCB0aGUgbmV4dCBvbmUKICAgfQoKICAgLy8gdGhlIG5leHQgaXRlbSBpcyBlaXRoZXIgYSB0
eXBlLCBhbiBhdHRyaWJ1dGUgKFRPRE8pLCBhbiBpZGVudGlmaWVyLCBhIGNvbG9uIG9yIG9w
ZW4gYnJhY2UKICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1RZUEUpIHx8IGNodW5r
X2lzX3Rva2VuKG5leHQsIENUX1dPUkQpIHx8IGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0NP
TE9OKSkKICAgewogICAgICAvLyBpLmUuICJlbnVtIHh5eiA6IHVuc2lnbmVkIGludCB7IC4u
LiB9OyIKICAgICAgLy8gaS5lLiAiZW51bSBjbGFzcyB4eXogOiB1bnNpZ25lZCBpbnQgeyAu
Li4gfTsiCiAgICAgIC8vIGkuZS4gImVudW0gOiB1bnNpZ25lZCBpbnQgeyAuLi4gfTsiCiAg
ICAgIC8vIHh5eiBpcyBhIHR5cGUKCiAgICAgIC8vIHNhdmUgdGhlIHR5cGUgaWYgaXQgZXhp
c3RzCiAgICAgIGlmICghY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfQ09MT04pKQogICAgICB7
CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgcGMtPnR5cGUpOwogICAgICAgICBw
cmV2ID0gbmV4dDsKICAgICAgICAgbmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwobmV4dCk7
CiAgICAgIH0KCiAgICAgIGlmIChuZXh0ID09IG51bGxwdHIpCiAgICAgIHsKICAgICAgICAg
cmV0dXJuOwogICAgICB9CiAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgcGMtPnR5cGUp
OwogICAgICBhdXRvIGNvbnN0IGlzX3N0cnVjdF9vcl9jbGFzcyA9CiAgICAgICAgIChjaHVu
a19pc190b2tlbihwYywgQ1RfU1RSVUNUKSB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQ0xB
U1MpKTsKCiAgICAgIC8vIG5leHQgdXAgaXMgZWl0aGVyIGEgY29sb24sIG9wZW4gYnJhY2Us
IG9yIG9wZW4gcGFyZW50aGVzaXMgKHBhd24pCiAgICAgIGlmIChsYW5ndWFnZV9pc19zZXQo
TEFOR19QQVdOKSAmJiBjaHVua19pc190b2tlbihuZXh0LCBDVF9QQVJFTl9PUEVOKSkKICAg
ICAgewogICAgICAgICBuZXh0ID0gc2V0X3BhcmVuX3BhcmVudChuZXh0LCBDVF9FTlVNKTsK
ICAgICAgfQogICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9DT0xPTikp
CiAgICAgIHsKICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9FTlVNKSkKICAg
ICAgICAgewogICAgICAgICAgICAvLyBlbnVtIFRZUEUgOiBJTlRfVFlQRSB7IC4uLiB9Owog
ICAgICAgICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0KTsKCiAgICAgICAg
ICAgIGlmIChuZXh0ICE9IG51bGxwdHIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg
bWFrZV90eXBlKG5leHQpOwogICAgICAgICAgICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHRf
bmNubChuZXh0KTsKCiAgICAgICAgICAgICAgIC8vIGVudW0gVFlQRSA6IHVuc2lnbmVkIGlu
dCB7IC4uLiB9OwogICAgICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1Rf
VFlQRSkpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBu
ZXh0IHBhcnQgb2YgdGhlIHR5cGUKICAgICAgICAgICAgICAgICAgbmV4dCA9IGNodW5rX2dl
dF9uZXh0X25jbmwobmV4dCk7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg
ICAgICB9CiAgICAgICAgIGVsc2UgaWYgKGlzX3N0cnVjdF9vcl9jbGFzcykKICAgICAgICAg
ewogICAgICAgICAgICBuZXh0ID0gc2tpcF9wYXJlbnRfdHlwZXMobmV4dCk7CiAgICAgICAg
IH0KICAgICAgfQogICAgICBlbHNlIGlmIChpc19zdHJ1Y3Rfb3JfY2xhc3MgJiYgY2h1bmtf
aXNfdG9rZW4obmV4dCwgQ1RfUEFSRU5fT1BFTikpCiAgICAgIHsKICAgICAgICAgLy8gRml4
ICMxMjY3IHN0cnVjdHVyZSBhdHRyaWJ1dGVzCiAgICAgICAgIC8vIHN0cnVjdCBfX2F0dHJp
YnV0ZV9fKGFsaWduKHgpKSBzdHJ1Y3RfbmFtZTsKICAgICAgICAgLy8gc2tpcCB0byBtYXRj
aGluZyBwYXJlbmNsb3NlIGFuZCBtYWtlIG5leHQgdG9rZW4gYXMgdHlwZS4KICAgICAgICAg
bmV4dCA9IGNodW5rX3NraXBfdG9fbWF0Y2gobmV4dCk7CiAgICAgICAgIG5leHQgPSBjaHVu
a19nZXRfbmV4dF9uY25sKG5leHQpOwogICAgICAgICBzZXRfY2h1bmtfdHlwZShuZXh0LCBD
VF9UWVBFKTsKICAgICAgICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBwYy0+dHlwZSk7CiAg
ICAgIH0KCiAgICAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9TRU1JQ09MT04pKSAv
LyBjKysgZm9yd2FyZCBkZWNsYXJhdGlvbgogICAgICB7CiAgICAgICAgIHNldF9jaHVua19w
YXJlbnQobmV4dCwgcGMtPnR5cGUpOwogICAgICAgICBmbGFnX3NlcmllcyhwYywgcHJldiwg
UENGX0lOQ09NUExFVEUpOwogICAgICAgICByZXR1cm47CiAgICAgIH0KICAgfQoKICAgaWYg
KGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0JSQUNFX09QRU4pKQogICB7CiAgICAgIGF1dG8g
Y29uc3QgZmxhZyA9IFtwY10gewogICAgICAgICBzd2l0Y2ggKHBjLT50eXBlKQogICAgICAg
ICB7CiAgICAgICAgIGNhc2UgQ1RfRU5VTToKICAgICAgICAgICAgcmV0dXJuKFBDRl9JTl9F
TlVNKTsKCiAgICAgICAgIGNhc2UgQ1RfU1RSVUNUOgogICAgICAgICAgICByZXR1cm4oUENG
X0lOX1NUUlVDVCk7CgogICAgICAgICBjYXNlIENUX0NMQVNTOgogICAgICAgICAgICByZXR1
cm4oUENGX0lOX0NMQVNTKTsKCiAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVy
bihQQ0ZfTk9ORSk7CiAgICAgICAgIH0KICAgICAgfSgpOwoKICAgICAgZmxhZ19wYXJlbnMo
bmV4dCwgZmxhZywgQ1RfTk9ORSwgQ1RfTk9ORSwgZmFsc2UpOwoKICAgICAgaWYgKCAgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX1VOSU9OKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihw
YywgQ1RfU1RSVUNUKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQ0xBU1Mp
KQogICAgICB7CiAgICAgICAgIG1hcmtfc3RydWN0X3VuaW9uX2JvZHkobmV4dCk7CiAgICAg
IH0KICAgICAgLy8gU2tpcCB0byB0aGUgY2xvc2luZyBicmFjZQogICAgICBzZXRfY2h1bmtf
cGFyZW50KG5leHQsIHBjLT50eXBlKTsKICAgICAgbmV4dCAgID0gY2h1bmtfZ2V0X25leHRf
dHlwZShuZXh0LCBDVF9CUkFDRV9DTE9TRSwgcGMtPmxldmVsKTsKICAgICAgZmxhZ3MgfD0g
UENGX1ZBUl9JTkxJTkU7CgogICAgICBpZiAobmV4dCAhPSBudWxscHRyKQogICAgICB7CiAg
ICAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgcGMtPnR5cGUpOwogICAgICAgICBuZXh0
ID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0KTsKICAgICAgfQogICAgICBwcmV2ID0gbnVs
bHB0cjsKICAgfQogICAvLyByZXNldCB2YXIgbmFtZSBwYXJlbnQgdHlwZQogICBlbHNlIGlm
IChuZXh0ICYmIHByZXYpCiAgIHsKICAgICAgc2V0X2NodW5rX3BhcmVudChwcmV2LCBDVF9O
T05FKTsKICAgfQoKICAgaWYgKG5leHQgPT0gbnVsbHB0ciB8fCBjaHVua19pc190b2tlbihu
ZXh0LCBDVF9QQVJFTl9DTE9TRSkpCiAgIHsKICAgICAgcmV0dXJuOwogICB9CgogICBpZiAo
IWNodW5rX2lzX3NlbWljb2xvbihuZXh0KSkKICAgewogICAgICAvLyBQYXduIGRvZXMgbm90
IHJlcXVpcmUgYSBzZW1pY29sb24gYWZ0ZXIgYW4gZW51bQogICAgICBpZiAobGFuZ3VhZ2Vf
aXNfc2V0KExBTkdfUEFXTikpCiAgICAgIHsKICAgICAgICAgcmV0dXJuOwogICAgICB9Cgog
ICAgICAvKgogICAgICAgKiBEIGRvZXMgbm90IHJlcXVpcmUgYSBzZW1pY29sb24gYWZ0ZXIg
YW4gZW51bSwgYnV0IHdlIGFkZCBvbmUgdG8gbWFrZQogICAgICAgKiBvdGhlciBjb2RlIGhh
cHB5LgogICAgICAgKi8KICAgICAgaWYgKGxhbmd1YWdlX2lzX3NldChMQU5HX0QpKQogICAg
ICB7CiAgICAgICAgIG5leHQgPSBwYXduX2FkZF92c2VtaV9hZnRlcihjaHVua19nZXRfcHJl
dl9uY25sbmkobmV4dCkpOyAgIC8vIElzc3VlICMyMjc5CiAgICAgIH0KICAgfQoKICAgLy8g
V2UgYXJlIGVpdGhlciBwb2ludGluZyB0byBhICc7JyBvciBhIHZhcmlhYmxlCiAgIHdoaWxl
ICggIG5leHQgIT0gbnVsbHB0cgogICAgICAgICAmJiAhY2h1bmtfaXNfc2VtaWNvbG9uKG5l
eHQpCiAgICAgICAgICYmIG5leHQtPnR5cGUgIT0gQ1RfQVNTSUdOCiAgICAgICAgICYmICEo
aW5fZmNuX3BhcmVuIF4gKG5leHQtPmZsYWdzICYgUENGX0lOX0ZDTl9ERUYpKS50ZXN0X2Fu
eSgpKQogICB7CiAgICAgIGlmIChuZXh0LT5sZXZlbCA9PSBwYy0+bGV2ZWwpCiAgICAgIHsK
ICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1dPUkQpKQogICAgICAgICB7
CiAgICAgICAgICAgIGNodW5rX2ZsYWdzX3NldChuZXh0LCBmbGFncyk7CiAgICAgICAgICAg
IGZsYWdzICY9IH5QQ0ZfVkFSXzFTVDsgICAvLyBjbGVhciB0aGUgZmlyc3QgZmxhZyBmb3Ig
dGhlIG5leHQgaXRlbXMKICAgICAgICAgICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6IG9y
aWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcycsIHNldCBQQ0Zf
VkFSXzFTVFxuIiwKICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBj
LT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQoKSk7CiAgICAgICAgIH0KCiAg
ICAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1NUQVIpCiAgICAgICAgICAg
IHx8IChsYW5ndWFnZV9pc19zZXQoTEFOR19DUFApICYmIGNodW5rX2lzX3Rva2VuKG5leHQs
IENUX0NBUkVUKSkpCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUobmV4
dCwgQ1RfUFRSX1RZUEUpOwogICAgICAgICB9CgogICAgICAgICAvLyBJZiB3ZSBoaXQgYSBj
b21tYSBpbiBhIGZ1bmN0aW9uIHBhcmFtLCB3ZSBhcmUgZG9uZQogICAgICAgICBpZiAoICAo
Y2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfQ09NTUEpIHx8IGNodW5rX2lzX3Rva2VuKG5leHQs
IENUX0ZQQVJFTl9DTE9TRSkpCiAgICAgICAgICAgICYmIChuZXh0LT5mbGFncy50ZXN0X2Fu
eShQQ0ZfSU5fRkNOX0RFRiB8IFBDRl9JTl9GQ05fQ0FMTCkpKQogICAgICAgICB7CiAgICAg
ICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgICB9CiAgICAgIG5leHQgPSBjaHVua19n
ZXRfbmV4dF9uY25sKG5leHQpOwogICB9CgogICBpZiAoICBuZXh0ICE9IG51bGxwdHIKICAg
ICAgJiYgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfU0VNSUNPTE9OKSkKICAgewogICAgICBz
ZXRfY2h1bmtfcGFyZW50KG5leHQsIHBjLT50eXBlKTsKICAgfQp9IC8vIGZpeF9lbnVtX3N0
cnVjdF91bmlvbgoKCnN0YXRpYyB2b2lkIGZpeF90eXBlZGVmKGNodW5rX3QgKnN0YXJ0KQp7
CiAgIExPR19GVU5DX0VOVFJZKCk7CgogICBpZiAoc3RhcnQgPT0gbnVsbHB0cikKICAgewog
ICAgICByZXR1cm47CiAgIH0KICAgTE9HX0ZNVChMVFlQRURFRiwgIiVzKCVkKTogdHlwZWRl
ZiBAIG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dVxuIiwKICAgICAgICAgICBfX2Z1bmNf
XywgX19MSU5FX18sIHN0YXJ0LT5vcmlnX2xpbmUsIHN0YXJ0LT5vcmlnX2NvbCk7CgogICBj
aHVua190ICp0aGVfdHlwZSA9IG51bGxwdHI7CiAgIGNodW5rX3QgKmxhc3Rfb3AgID0gbnVs
bHB0cjsKCiAgIC8qCiAgICAqIE1hcmsgZXZlcnl0aGluZyBpbiB0aGUgdHlwZWRlZiBhbmQg
c2NhbiBmb3IgIikoIiwgd2hpY2ggbWFrZXMgaXQgYQogICAgKiBmdW5jdGlvbiB0eXBlCiAg
ICAqLwogICBmb3IgKGNodW5rX3QgKm5leHQgPSBjaHVua19nZXRfbmV4dF9uY25sKHN0YXJ0
LCBzY29wZV9lOjpQUkVQUk9DKQogICAgICAgIDsgbmV4dCAhPSBudWxscHRyICYmIG5leHQt
PmxldmVsID49IHN0YXJ0LT5sZXZlbAogICAgICAgIDsgbmV4dCA9IGNodW5rX2dldF9uZXh0
X25jbmwobmV4dCwgc2NvcGVfZTo6UFJFUFJPQykpCiAgIHsKICAgICAgY2h1bmtfZmxhZ3Nf
c2V0KG5leHQsIFBDRl9JTl9UWVBFREVGKTsKCiAgICAgIGlmIChzdGFydC0+bGV2ZWwgPT0g
bmV4dC0+bGV2ZWwpCiAgICAgIHsKICAgICAgICAgaWYgKGNodW5rX2lzX3NlbWljb2xvbihu
ZXh0KSkKICAgICAgICAgewogICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KG5leHQsIENU
X1RZUEVERUYpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgfQoKICAgICAgICAgaWYg
KGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0FUVFJJQlVURSkpCiAgICAgICAgIHsKICAgICAg
ICAgICAgYnJlYWs7CiAgICAgICAgIH0KCiAgICAgICAgIGlmIChsYW5ndWFnZV9pc19zZXQo
TEFOR19EKSAmJiBjaHVua19pc190b2tlbihuZXh0LCBDVF9BU1NJR04pKQogICAgICAgICB7
CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgQ1RfVFlQRURFRik7CiAgICAg
ICAgICAgIGJyZWFrOwogICAgICAgICB9CiAgICAgICAgIG1ha2VfdHlwZShuZXh0KTsKCiAg
ICAgICAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9UWVBFKSkKICAgICAgICAgewog
ICAgICAgICAgICB0aGVfdHlwZSA9IG5leHQ7CiAgICAgICAgIH0KICAgICAgICAgY2h1bmtf
ZmxhZ3NfY2xyKG5leHQsIFBDRl9WQVJfMVNUX0RFRik7CgogICAgICAgICBpZiAoKm5leHQt
PnN0ci5jX3N0cigpID09ICcoJykKICAgICAgICAgewogICAgICAgICAgICBsYXN0X29wID0g
bmV4dDsKICAgICAgICAgfQogICAgICB9CiAgIH0KCiAgIC8vIGF2b2lkIGludGVycHJldGlu
ZyB0eXBlZGVmIE5TX0VOVU0gKE5TSW50ZWdlciwgTXlFbnVtKSBhcyBhIGZ1bmN0aW9uIGRl
ZgogICBpZiAoICBsYXN0X29wICE9IG51bGxwdHIKICAgICAgJiYgIShsYW5ndWFnZV9pc19z
ZXQoTEFOR19PQykgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKGxhc3Rfb3ApID09IENUX0VO
VU0pKQogICB7CiAgICAgIGZsYWdfcGFyZW5zKGxhc3Rfb3AsIFBDRl9OT05FLCBDVF9GUEFS
RU5fT1BFTiwgQ1RfVFlQRURFRiwgZmFsc2UpOwogICAgICBmaXhfZmNuX2RlZl9wYXJhbXMo
bGFzdF9vcCk7CgogICAgICB0aGVfdHlwZSA9IGNodW5rX2dldF9wcmV2X25jbmxuaShsYXN0
X29wLCBzY29wZV9lOjpQUkVQUk9DKTsgICAvLyBJc3N1ZSAjMjI3OQoKICAgICAgaWYgKHRo
ZV90eXBlID09IG51bGxwdHIpCiAgICAgIHsKICAgICAgICAgcmV0dXJuOwogICAgICB9CiAg
ICAgIGNodW5rX3QgKm9wZW5fcGFyZW4gPSBudWxscHRyOwoKICAgICAgaWYgKGNodW5rX2lz
X3BhcmVuX2Nsb3NlKHRoZV90eXBlKSkKICAgICAgewogICAgICAgICBvcGVuX3BhcmVuID0g
Y2h1bmtfc2tpcF90b19tYXRjaF9yZXYodGhlX3R5cGUpOwogICAgICAgICBtYXJrX2Z1bmN0
aW9uX3R5cGUodGhlX3R5cGUpOwogICAgICAgICB0aGVfdHlwZSA9IGNodW5rX2dldF9wcmV2
X25jbmxuaSh0aGVfdHlwZSwgc2NvcGVfZTo6UFJFUFJPQyk7ICAgLy8gSXNzdWUgIzIyNzkK
CiAgICAgICAgIGlmICh0aGVfdHlwZSA9PSBudWxscHRyKQogICAgICAgICB7CiAgICAgICAg
ICAgIHJldHVybjsKICAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAg
ICAgICAvLyBtdXN0IGJlOiAidHlwZWRlZiA8cmV0dXJuIHR5cGU+ZnVuYyhwYXJhbXMpOyIK
ICAgICAgICAgc2V0X2NodW5rX3R5cGUodGhlX3R5cGUsIENUX0ZVTkNfVFlQRSk7CiAgICAg
IH0KICAgICAgc2V0X2NodW5rX3BhcmVudCh0aGVfdHlwZSwgQ1RfVFlQRURFRik7CgogICAg
ICBMT0dfRk1UKExUWVBFREVGLCAiJXMoJWQpOiBmY24gdHlwZWRlZiB0ZXh0KCkgJyVzJywg
b24gb3JpZ19saW5lICV6dVxuIiwKICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18s
IHRoZV90eXBlLT50ZXh0KCksIHRoZV90eXBlLT5vcmlnX2xpbmUpOwoKICAgICAgLy8gSWYg
d2UgYXJlIGFsaWduaW5nIG9uIHRoZSBvcGVuIHBhcmVudGhlc2lzLCBncmFiIHRoYXQgaW5z
dGVhZAogICAgICBsb2dfcnVsZV9CKCJhbGlnbl90eXBlZGVmX2Z1bmMiKTsKCiAgICAgIGlm
IChvcGVuX3BhcmVuICE9IG51bGxwdHIgJiYgb3B0aW9uczo6YWxpZ25fdHlwZWRlZl9mdW5j
KCkgPT0gMSkKICAgICAgewogICAgICAgICB0aGVfdHlwZSA9IG9wZW5fcGFyZW47CiAgICAg
IH0KICAgICAgbG9nX3J1bGVfQigiYWxpZ25fdHlwZWRlZl9mdW5jIik7CgogICAgICBpZiAo
b3B0aW9uczo6YWxpZ25fdHlwZWRlZl9mdW5jKCkgIT0gMCkKICAgICAgewogICAgICAgICBM
T0dfRk1UKExUWVBFREVGLCAiJXMoJWQpOiAgLS0gYWxpZ24gYW5jaG9yIG9uIHRleHQoKSAl
cywgQCBvcmlnX2xpbmUgJXp1LCBvcmlnX2NvbCAlenVcbiIsCiAgICAgICAgICAgICAgICAg
X19mdW5jX18sIF9fTElORV9fLCB0aGVfdHlwZS0+dGV4dCgpLCB0aGVfdHlwZS0+b3JpZ19s
aW5lLCB0aGVfdHlwZS0+b3JpZ19jb2wpOwogICAgICAgICBjaHVua19mbGFnc19zZXQodGhl
X3R5cGUsIFBDRl9BTkNIT1IpOwogICAgICB9CiAgICAgIC8vIGFscmVhZHkgZGlkIGV2ZXJ5
dGhpbmcgd2UgbmVlZCB0byBkbwogICAgICByZXR1cm47CiAgIH0KICAgLyoKICAgICogU2tp
cCBvdmVyIGVudW0vc3RydWN0L3VuaW9uIHN0dWZmLCBhcyB3ZSBrbm93IGl0IGlzbid0IGEg
cmV0dXJuIHR5cGUKICAgICogZm9yIGEgZnVuY3Rpb24gdHlwZQogICAgKi8KICAgY2h1bmtf
dCAqYWZ0ZXIgPSBjaHVua19nZXRfbmV4dF9uY25sKHN0YXJ0LCBzY29wZV9lOjpQUkVQUk9D
KTsKCiAgIGlmIChhZnRlciA9PSBudWxscHRyKQogICB7CiAgICAgIHJldHVybjsKICAgfQoK
ICAgaWYgKCAgYWZ0ZXItPnR5cGUgIT0gQ1RfRU5VTQogICAgICAmJiBhZnRlci0+dHlwZSAh
PSBDVF9TVFJVQ1QKICAgICAgJiYgYWZ0ZXItPnR5cGUgIT0gQ1RfVU5JT04pCiAgIHsKICAg
ICAgaWYgKHRoZV90eXBlICE9IG51bGxwdHIpCiAgICAgIHsKICAgICAgICAgLy8gV2UgaGF2
ZSBqdXN0IGEgcmVndWxhciB0eXBlZGVmCiAgICAgICAgIExPR19GTVQoTFRZUEVERUYsICIl
cyglZCk6IHJlZ3VsYXIgdHlwZWRlZiB0ZXh0KCkgJXMsIG9uIG9yaWdfbGluZSAlenVcbiIs
CiAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0aGVfdHlwZS0+dGV4dCgp
LCB0aGVfdHlwZS0+b3JpZ19saW5lKTsKICAgICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHRoZV90
eXBlLCBQQ0ZfQU5DSE9SKTsKICAgICAgfQogICAgICByZXR1cm47CiAgIH0KICAgLy8gV2Ug
aGF2ZSBhIHN0cnVjdC91bmlvbi9lbnVtLCBuZXh0IHNob3VsZCBiZSBlaXRoZXIgYSB0eXBl
IG9yIHsKICAgY2h1bmtfdCAqbmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwoYWZ0ZXIsIHNj
b3BlX2U6OlBSRVBST0MpOwoKICAgaWYgKG5leHQgPT0gbnVsbHB0cikKICAgewogICAgICBy
ZXR1cm47CiAgIH0KCiAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9UWVBFKSkKICAg
ewogICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0LCBzY29wZV9lOjpQUkVQ
Uk9DKTsKCiAgICAgIGlmIChuZXh0ID09IG51bGxwdHIpCiAgICAgIHsKICAgICAgICAgcmV0
dXJuOwogICAgICB9CiAgIH0KCiAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9CUkFD
RV9PUEVOKSkKICAgewogICAgICAvLyBTa2lwIHRvIHRoZSBjbG9zaW5nIGJyYWNlCiAgICAg
IGNodW5rX3QgKmJyX2MgPSBjaHVua19nZXRfbmV4dF90eXBlKG5leHQsIENUX0JSQUNFX0NM
T1NFLCBuZXh0LT5sZXZlbCwgc2NvcGVfZTo6UFJFUFJPQyk7CgogICAgICBpZiAoYnJfYyAh
PSBudWxscHRyKQogICAgICB7CiAgICAgICAgIGNvbnN0IGNfdG9rZW5fdCB0YWcgPSBhZnRl
ci0+dHlwZTsKICAgICAgICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCB0YWcpOwogICAgICAg
ICBzZXRfY2h1bmtfcGFyZW50KGJyX2MsIHRhZyk7CgogICAgICAgICBpZiAodGFnID09IENU
X0VOVU0pCiAgICAgICAgIHsKICAgICAgICAgICAgZmxhZ19zZXJpZXMoYWZ0ZXIsIGJyX2Ms
IFBDRl9JTl9FTlVNKTsKICAgICAgICAgfQogICAgICAgICBlbHNlIGlmICh0YWcgPT0gQ1Rf
U1RSVUNUKQogICAgICAgICB7CiAgICAgICAgICAgIGZsYWdfc2VyaWVzKGFmdGVyLCBicl9j
LCBQQ0ZfSU5fU1RSVUNUKTsKICAgICAgICAgfQogICAgICB9CiAgIH0KCiAgIGlmICh0aGVf
dHlwZSAhPSBudWxscHRyKQogICB7CiAgICAgIExPR19GTVQoTFRZUEVERUYsICIlcyglZCk6
ICVzIHR5cGVkZWYgdGV4dCgpICVzLCBvbiBvcmlnX2xpbmUgJXp1XG4iLAogICAgICAgICAg
ICAgIF9fZnVuY19fLCBfX0xJTkVfXywgZ2V0X3Rva2VuX25hbWUoYWZ0ZXItPnR5cGUpLCB0
aGVfdHlwZS0+dGV4dCgpLAogICAgICAgICAgICAgIHRoZV90eXBlLT5vcmlnX2xpbmUpOwog
ICAgICBjaHVua19mbGFnc19zZXQodGhlX3R5cGUsIFBDRl9BTkNIT1IpOwogICB9Cn0gLy8g
Zml4X3R5cGVkZWYKCgovL3N0YXRpYyB2b2lkIG1hcmtfdmFyaWFibGVfc3RhY2soQ2h1bmtT
dGFjayAmY3MsIGxvZ19zZXZfdCBzZXYpCi8vewovLyAgIFVOVVNFRChzZXYpOwovLyAgIExP
R19GVU5DX0VOVFJZKCk7Ci8vCi8vICAgLy8gdGhyb3cgb3V0IHRoZSBsYXN0IHdvcmQgYW5k
IG1hcmsgdGhlIHJlc3QKLy8gICBjaHVua190ICp2YXJfbmFtZSA9IGNzLlBvcF9CYWNrKCk7
Ci8vCi8vICAgaWYgKHZhcl9uYW1lICYmIHZhcl9uYW1lLT5wcmV2LT50eXBlID09IENUX0RD
X01FTUJFUikKLy8gICB7Ci8vICAgICAgY3MuUHVzaF9CYWNrKHZhcl9uYW1lKTsKLy8gICB9
Ci8vCi8vICAgaWYgKHZhcl9uYW1lICE9IG51bGxwdHIpCi8vICAgewovLyAgICAgIExPR19G
TVQoTEZDTlAsICIlcyglZCk6IHBhcmFtZXRlciBvbiBvcmlnX2xpbmUgJXp1LCBvcmlnX2Nv
bCAlenU6XG4iLAovLyAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB2YXJfbmFt
ZS0+b3JpZ19saW5lLCB2YXJfbmFtZS0+b3JpZ19jb2wpOwovLwovLyAgICAgIHNpemVfdCAg
d29yZF9jbnQgPSAwOwovLyAgICAgIGNodW5rX3QgKndvcmRfdHlwZTsKLy8KLy8gICAgICB3
aGlsZSAoKHdvcmRfdHlwZSA9IGNzLlBvcF9CYWNrKCkpICE9IG51bGxwdHIpCi8vICAgICAg
ewovLyAgICAgICAgIGlmIChjaHVua19pc190b2tlbih3b3JkX3R5cGUsIENUX1dPUkQpIHx8
IGNodW5rX2lzX3Rva2VuKHdvcmRfdHlwZSwgQ1RfVFlQRSkpCi8vICAgICAgICAgewovLyAg
ICAgICAgICAgIExPR19GTVQoTEZDTlAsICIlcyglZCk6IHBhcmFtZXRlciBvbiBvcmlnX2xp
bmUgJXp1LCBvcmlnX2NvbCAlenU6IDwlcz4gYXMgVFlQRVxuIiwKLy8gICAgICAgICAgICAg
ICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgdmFyX25hbWUtPm9yaWdfbGluZSwgdmFyX25h
bWUtPm9yaWdfY29sLCB3b3JkX3R5cGUtPnRleHQoKSk7Ci8vICAgICAgICAgICAgc2V0X2No
dW5rX3R5cGUod29yZF90eXBlLCBDVF9UWVBFKTsKLy8gICAgICAgICAgICBjaHVua19mbGFn
c19zZXQod29yZF90eXBlLCBQQ0ZfVkFSX1RZUEUpOwovLyAgICAgICAgIH0KLy8gICAgICAg
ICB3b3JkX2NudCsrOwovLyAgICAgIH0KLy8KLy8gICAgICBpZiAoY2h1bmtfaXNfdG9rZW4o
dmFyX25hbWUsIENUX1dPUkQpKQovLyAgICAgIHsKLy8gICAgICAgICBpZiAod29yZF9jbnQg
PiAwKQovLyAgICAgICAgIHsKLy8gICAgICAgICAgICBMT0dfRk1UKExGQ05QLCAiJXMoJWQp
OiBwYXJhbWV0ZXIgb24gb3JpZ19saW5lICV6dSwgb3JpZ19jb2wgJXp1OiA8JXM+IGFzIFZB
UlxuIiwKLy8gICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgdmFyX25h
bWUtPm9yaWdfbGluZSwgdmFyX25hbWUtPm9yaWdfY29sLCB2YXJfbmFtZS0+dGV4dCgpKTsK
Ly8gICAgICAgICAgICBjaHVua19mbGFnc19zZXQodmFyX25hbWUsIFBDRl9WQVJfREVGKTsK
Ly8gICAgICAgICB9Ci8vICAgICAgICAgZWxzZQovLyAgICAgICAgIHsKLy8gICAgICAgICAg
ICBMT0dfRk1UKExGQ05QLCAiJXMoJWQpOiBwYXJhbWV0ZXIgb24gb3JpZ19saW5lICV6dSwg
b3JpZ19jb2wgJXp1OiA8JXM+IGFzIFRZUEVcbiIsCi8vICAgICAgICAgICAgICAgICAgICBf
X2Z1bmNfXywgX19MSU5FX18sIHZhcl9uYW1lLT5vcmlnX2xpbmUsIHZhcl9uYW1lLT5vcmln
X2NvbCwgdmFyX25hbWUtPnRleHQoKSk7Ci8vICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUo
dmFyX25hbWUsIENUX1RZUEUpOwovLyAgICAgICAgICAgIGNodW5rX2ZsYWdzX3NldCh2YXJf
bmFtZSwgUENGX1ZBUl9UWVBFKTsKLy8gICAgICAgICB9Ci8vICAgICAgfQovLyAgIH0KLy99
IC8vIG1hcmtfdmFyaWFibGVfc3RhY2sKCgovL3N0YXRpYyB2b2lkIGZpeF9mY25fZGVmX3Bh
cmFtcyhjaHVua190ICpzdGFydCkKLy97Ci8vICAgTE9HX0ZVTkNfRU5UUlkoKTsKLy8KLy8g
ICBpZiAoc3RhcnQgPT0gbnVsbHB0cikKLy8gICB7Ci8vICAgICAgcmV0dXJuOwovLyAgIH0K
Ly8gICBMT0dfRk1UKExGQ05QLCAiJXMoJWQpOiB0ZXh0KCkgJyVzJywgdHlwZSBpcyAlcywg
b24gb3JpZ19saW5lICV6dSwgbGV2ZWwgaXMgJXp1XG4iLAovLyAgICAgICAgICAgX19mdW5j
X18sIF9fTElORV9fLCBzdGFydC0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZShzdGFydC0+dHlw
ZSksIHN0YXJ0LT5vcmlnX2xpbmUsIHN0YXJ0LT5sZXZlbCk7Ci8vCi8vICAgd2hpbGUgKHN0
YXJ0ICE9IG51bGxwdHIgJiYgIWNodW5rX2lzX3BhcmVuX29wZW4oc3RhcnQpKQovLyAgIHsK
Ly8gICAgICBzdGFydCA9IGNodW5rX2dldF9uZXh0X25jbmwoc3RhcnQpOwovLyAgIH0KLy8K
Ly8gICBpZiAoc3RhcnQgPT0gbnVsbHB0cikvLyBDb3Zlcml0eSBDSUQgNzYwMDMsIDExMDA3
ODIKLy8gICB7Ci8vICAgICAgcmV0dXJuOwovLyAgIH0KLy8gICAvLyBlbnN1cmUgc3RhcnQg
Y2h1bmsgaG9sZHMgYSBzaW5nbGUgJygnIGNoYXJhY3RlcgovLyAgIGFzc2VydCgoc3RhcnQt
PmxlbigpID09IDEpICYmIChzdGFydC0+c3RyWzBdID09ICcoJykpOwovLwovLyAgIENodW5r
U3RhY2sgY3M7Ci8vICAgc2l6ZV90ICAgICBsZXZlbCA9IHN0YXJ0LT5sZXZlbCArIDE7Ci8v
ICAgY2h1bmtfdCAgICAqcGMgICA9IHN0YXJ0OwovLwovLyAgIHdoaWxlICgocGMgPSBjaHVu
a19nZXRfbmV4dF9uY25sKHBjKSkgIT0gbnVsbHB0cikKLy8gICB7Ci8vICAgICAgaWYgKCAg
KChzdGFydC0+bGVuKCkgPT0gMSkgJiYgKHN0YXJ0LT5zdHJbMF0gPT0gJyknKSkKLy8gICAg
ICAgICB8fCBwYy0+bGV2ZWwgPCBsZXZlbCkKLy8gICAgICB7Ci8vICAgICAgICAgTE9HX0ZN
VChMRkNOUCwgIiVzKCVkKTogYmFpbGVkIG9uIHRleHQoKSAnJXMnLCBvbiBvcmlnX2xpbmUg
JXp1XG4iLAovLyAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+dGV4
dCgpLCBwYy0+b3JpZ19saW5lKTsKLy8gICAgICAgICBicmVhazsKLy8gICAgICB9Ci8vICAg
ICAgTE9HX0ZNVChMRkNOUCwgIiVzKCVkKTogJXMsIHRleHQoKSAnJXMnIG9uIG9yaWdfbGlu
ZSAlenUsIGxldmVsICV6dVxuIiwKLy8gICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVf
XywgKHBjLT5sZXZlbCA+IGxldmVsKSA/ICJza2lwcGluZyIgOiAibG9va2luZyBhdCIsCi8v
ICAgICAgICAgICAgICBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5lLCBwYy0+bGV2ZWwpOwov
LwovLyAgICAgIGlmIChwYy0+bGV2ZWwgPiBsZXZlbCkKLy8gICAgICB7Ci8vICAgICAgICAg
Y29udGludWU7Ci8vICAgICAgfQovLwovLyAgICAgIGlmIChjaHVua19pc19zdGFyKHBjKSB8
fCBjaHVua19pc19tc3JlZihwYykgfHwgY2h1bmtfaXNfbnVsbGFibGUocGMpKQovLyAgICAg
IHsKLy8gICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfUFRSX1RZUEUpOwovLyAgICAg
ICAgIGNzLlB1c2hfQmFjayhwYyk7Ci8vICAgICAgfQovLyAgICAgIGVsc2UgaWYgKCAgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX0FNUCkKLy8gICAgICAgICAgICAgIHx8IChsYW5ndWFnZV9p
c19zZXQoTEFOR19DUFApICYmIGNodW5rX2lzX3N0cihwYywgIiYmIiwgMikpKQovLyAgICAg
IHsKLy8gICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfQllSRUYpOwovLyAgICAgICAg
IGNzLlB1c2hfQmFjayhwYyk7Ci8vICAgICAgfQovLyAgICAgIGVsc2UgaWYgKGNodW5rX2lz
X3Rva2VuKHBjLCBDVF9UWVBFX1dSQVApKQovLyAgICAgIHsKLy8gICAgICAgICBjcy5QdXNo
X0JhY2socGMpOwovLyAgICAgIH0KLy8gICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihw
YywgQ1RfV09SRCkgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RZUEUpKQovLyAgICAgIHsK
Ly8gICAgICAgICBjcy5QdXNoX0JhY2socGMpOwovLyAgICAgIH0KLy8gICAgICBlbHNlIGlm
IChjaHVua19pc190b2tlbihwYywgQ1RfQ09NTUEpIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9BU1NJR04pKQovLyAgICAgIHsKLy8gICAgICAgICBtYXJrX3ZhcmlhYmxlX3N0YWNrKGNz
LCBMRkNOUCk7Ci8vCi8vICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BU1NJ
R04pKQovLyAgICAgICAgIHsKLy8gICAgICAgICAgICAvLyBNYXJrIGFzc2lnbm1lbnQgZm9y
IGRlZmF1bHQgcGFyYW0gc3BhY2luZwovLyAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQo
cGMsIENUX0ZVTkNfUFJPVE8pOwovLyAgICAgICAgIH0KLy8gICAgICB9Ci8vICAgfQovLyAg
IG1hcmtfdmFyaWFibGVfc3RhY2soY3MsIExGQ05QKTsKLy99IC8vIGZpeF9mY25fZGVmX3Bh
cmFtcwoKCnN0YXRpYyB2b2lkIGhhbmRsZV9jcHBfdGVtcGxhdGUoY2h1bmtfdCAqcGMpCnsK
ICAgTE9HX0ZVTkNfRU5UUlkoKTsKCiAgIGNodW5rX3QgKnRtcCA9IGNodW5rX2dldF9uZXh0
X25jbmwocGMpOwoKICAgaWYgKHRtcC0+dHlwZSAhPSBDVF9BTkdMRV9PUEVOKQogICB7CiAg
ICAgIHJldHVybjsKICAgfQogICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfVEVNUExBVEUp
OwoKICAgc2l6ZV90IGxldmVsID0gdG1wLT5sZXZlbDsKCiAgIHdoaWxlICgodG1wID0gY2h1
bmtfZ2V0X25leHQodG1wKSkgIT0gbnVsbHB0cikKICAgewogICAgICBpZiAoY2h1bmtfaXNf
dG9rZW4odG1wLCBDVF9DTEFTUykgfHwgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9TVFJVQ1Qp
KQogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHRtcCwgQ1RfVFlQRSk7CiAgICAg
IH0KICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9BTkdMRV9DTE9TRSkg
JiYgdG1wLT5sZXZlbCA9PSBsZXZlbCkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfcGFy
ZW50KHRtcCwgQ1RfVEVNUExBVEUpOwogICAgICAgICBicmVhazsKICAgICAgfQogICB9Cgog
ICBpZiAodG1wICE9IG51bGxwdHIpCiAgIHsKICAgICAgdG1wID0gY2h1bmtfZ2V0X25leHRf
bmNubCh0bXApOwoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfQ0xBU1MpIHx8
IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfU1RSVUNUKSkKICAgICAgewogICAgICAgICBzZXRf
Y2h1bmtfcGFyZW50KHRtcCwgQ1RfVEVNUExBVEUpOwoKICAgICAgICAgLy8gUkVWSVNJVDog
VGhpcyBtYXkgYmUgYSBiaXQgcmlza3kgLSBtaWdodCBuZWVkIHRvIHRyYWNrIHRoZSB7IH07
CiAgICAgICAgIHRtcCA9IGNodW5rX2dldF9uZXh0X3R5cGUodG1wLCBDVF9TRU1JQ09MT04s
IHRtcC0+bGV2ZWwpOwoKICAgICAgICAgaWYgKHRtcCAhPSBudWxscHRyKQogICAgICAgICB7
CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBDVF9URU1QTEFURSk7CiAgICAg
ICAgIH0KICAgICAgfQogICB9Cn0gLy8gaGFuZGxlX2NwcF90ZW1wbGF0ZQoKCnN0YXRpYyB2
b2lkIGhhbmRsZV9jcHBfbGFtYmRhKGNodW5rX3QgKnNxX28pCnsKICAgTE9HX0ZVTkNfRU5U
UlkoKTsKCiAgIGNodW5rX3QgKnJldCA9IG51bGxwdHI7CgogICAvLyBhYm9ydCBpZiB0eXBl
IG9mIHRoZSBwcmV2aW91cyB0b2tlbiBpcyBub3QgY29udGFpbmVkIGluIHRoaXMgd2hpdGVs
aXN0CiAgIGNodW5rX3QgKnByZXYgPSBjaHVua19nZXRfcHJldl9uY25sbmkoc3Ffbyk7ICAg
Ly8gSXNzdWUgIzIyNzkKCiAgIGlmICggIHByZXYgPT0gbnVsbHB0cgogICAgICB8fCAoICBw
cmV2LT50eXBlICE9IENUX0FTU0lHTgogICAgICAgICAmJiBwcmV2LT50eXBlICE9IENUX0NP
TU1BCiAgICAgICAgICYmIHByZXYtPnR5cGUgIT0gQ1RfUEFSRU5fT1BFTiAgIC8vIGFsbG93
IEpzIGxpa2Ugc2VsZiBpbnZva2luZyBsYW1iZGEgc3ludGF4OiAoW10oKXt9KSgpOwogICAg
ICAgICAmJiBwcmV2LT50eXBlICE9IENUX0ZQQVJFTl9PUEVOCiAgICAgICAgICYmIHByZXYt
PnR5cGUgIT0gQ1RfU1FVQVJFX09QRU4KICAgICAgICAgJiYgcHJldi0+dHlwZSAhPSBDVF9C
UkFDRV9PUEVOCiAgICAgICAgICYmIHByZXYtPnR5cGUgIT0gQ1RfU0VNSUNPTE9OCiAgICAg
ICAgICYmIHByZXYtPnR5cGUgIT0gQ1RfUkVUVVJOKSkKICAgewogICAgICByZXR1cm47CiAg
IH0KICAgY2h1bmtfdCAqc3FfYyA9IHNxX287IC8vIGFzc3VtaW5nICdbXScKCiAgIGlmIChj
aHVua19pc190b2tlbihzcV9vLCBDVF9TUVVBUkVfT1BFTikpCiAgIHsKICAgICAgLy8gbWFr
ZSBzdXJlIHRoZXJlIGlzIGEgJ10nCiAgICAgIHNxX2MgPSBjaHVua19za2lwX3RvX21hdGNo
KHNxX28pOwoKICAgICAgaWYgKCFzcV9jKQogICAgICB7CiAgICAgICAgIHJldHVybjsKICAg
ICAgfQogICB9CiAgIGNodW5rX3QgKnBhX28gPSBjaHVua19nZXRfbmV4dF9uY25sKHNxX2Mp
OwoKICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZXJlIGlzIGEgbGFtYmRhLXNwZWNpZmllciBp
biB0aGUgcGFfbyBjaHVuazsKICAgLy8gYXNzdW1pbmcgY2h1bmsgaXMgQ1RfRVhFQ1VUSU9O
X0NPTlRFWFQsIGlnbm9yZSBsYW1iZGEtc3BlY2lmaWVyCiAgIHdoaWxlIChwYV9vLT50eXBl
ID09IENUX0VYRUNVVElPTl9DT05URVhUKQogICB7CiAgICAgIC8vIHNldCBwYV9vIHRvIG5l
eHQgY2h1bmsgYWZ0ZXIgdGhpcyBzcGVjaWZpZXIKICAgICAgcGFfbyA9IGNodW5rX2dldF9u
ZXh0X25jbmwocGFfbyk7CiAgIH0KCiAgIGlmIChwYV9vID09IG51bGxwdHIpCiAgIHsKICAg
ICAgcmV0dXJuOwogICB9CiAgIGNodW5rX3QgKnBhX2MgPSBudWxscHRyOwoKICAgLy8gbGFt
YmRhLWRlY2xhcmF0b3IgJyggcGFyYW1zICknIGlzIG9wdGlvbmFsCiAgIGlmIChjaHVua19p
c190b2tlbihwYV9vLCBDVF9QQVJFTl9PUEVOKSkKICAgewogICAgICAvLyBhbmQgbm93IGZp
bmQgdGhlICcpJwogICAgICBwYV9jID0gY2h1bmtfc2tpcF90b19tYXRjaChwYV9vKTsKCiAg
ICAgIGlmIChwYV9jID09IG51bGxwdHIpCiAgICAgIHsKICAgICAgICAgcmV0dXJuOwogICAg
ICB9CiAgIH0KICAgLy8gQ2hlY2sgZm9yICdtdXRhYmxlJyBrZXl3b3JkOiAnW10oKSBtdXRh
YmxlIHt9JyBvciBbXSgpIG11dGFibGUgLT4gcmV0IHt9CiAgIGNodW5rX3QgKmJyX28gPSBw
YV9jID8gY2h1bmtfZ2V0X25leHRfbmNubChwYV9jKSA6IHBhX287CgogICBpZiAoY2h1bmtf
aXNfc3RyKGJyX28sICJtdXRhYmxlIiwgNykpCiAgIHsKICAgICAgYnJfbyA9IGNodW5rX2dl
dF9uZXh0X25jbmwoYnJfbyk7CiAgIH0KICAgLy9UT0RPOiBhbHNvIGNoZWNrIGZvciBleGNl
cHRpb24gYW5kIGF0dHJpYnV0ZSBiZXR3ZWVuIFtdIC4uLiB7fQoKICAgLy8gc2tpcCBwb3Nz
aWJsZSBhcnJvdyBzeW50YXg6ICctPiByZXQnCiAgIGlmIChjaHVua19pc19zdHIoYnJfbywg
Ii0+IiwgMikpCiAgIHsKICAgICAgcmV0ID0gYnJfbzsKICAgICAgLy8gUkVWSVNJVDogcmVh
bGx5IHNob3VsZCBjaGVjayB0aGUgc3R1ZmYgd2UgYXJlIHNraXBwaW5nCiAgICAgIGJyX28g
PSBjaHVua19nZXRfbmV4dF90eXBlKGJyX28sIENUX0JSQUNFX09QRU4sIGJyX28tPmxldmVs
KTsKICAgfQoKICAgaWYgKCAgYnJfbyA9PSBudWxscHRyCiAgICAgIHx8IGJyX28tPnR5cGUg
IT0gQ1RfQlJBQ0VfT1BFTikKICAgewogICAgICByZXR1cm47CiAgIH0KICAgLy8gYW5kIG5v
dyBmaW5kIHRoZSAnfScKICAgY2h1bmtfdCAqYnJfYyA9IGNodW5rX3NraXBfdG9fbWF0Y2go
YnJfbyk7CgogICBpZiAoYnJfYyA9PSBudWxscHRyKQogICB7CiAgICAgIHJldHVybjsKICAg
fQoKICAgLy8gVGhpcyBsb29rcyBsaWtlIGEgbGFtYmRhIGV4cHJlc3Npb24KICAgaWYgKGNo
dW5rX2lzX3Rva2VuKHNxX28sIENUX1RTUVVBUkUpKQogICB7CiAgICAgIC8vIHNwbGl0IGlu
dG8gdHdvIGNodW5rcwogICAgICBjaHVua190IG5jOwoKICAgICAgbmMgPSAqc3FfbzsKICAg
ICAgc2V0X2NodW5rX3R5cGUoc3FfbywgQ1RfU1FVQVJFX09QRU4pOwogICAgICBzcV9vLT5z
dHIucmVzaXplKDEpOwogICAgICAvKgogICAgICAgKiBidWcgIyA2NjQKICAgICAgICoKICAg
ICAgICogVGhlIG9yaWdpbmFsIG9yaWdfY29sIG9mIENUX1NRVUFSRV9DTE9TRSBpcyBzdG9y
ZWQgYXQgb3JpZ19jb2xfZW5kCiAgICAgICAqIG9mIENUX1RTUVVBUkUuIENUX1NRVUFSRV9D
TE9TRSBvcmlnX2NvbCBhbmQgb3JpZ19jb2xfZW5kIHZhbHVlcwogICAgICAgKiBhcmUgY2Fs
Y3VsYXRlIGZyb20gb3JpZ19jb2xfZW5kIG9mIENUX1RTUVVBUkUuCiAgICAgICAqLwogICAg
ICBuYy5vcmlnX2NvbCAgICAgICAgPSBzcV9vLT5vcmlnX2NvbF9lbmQgLSAxOwogICAgICBu
Yy5jb2x1bW4gICAgICAgICAgPSBzdGF0aWNfY2FzdDxpbnQ+KG5jLm9yaWdfY29sKTsKICAg
ICAgbmMub3JpZ19jb2xfZW5kICAgID0gc3Ffby0+b3JpZ19jb2xfZW5kOwogICAgICBzcV9v
LT5vcmlnX2NvbF9lbmQgPSBzcV9vLT5vcmlnX2NvbCArIDE7CgogICAgICBzZXRfY2h1bmtf
dHlwZSgmbmMsIENUX1NRVUFSRV9DTE9TRSk7CiAgICAgIG5jLnN0ci5wb3BfZnJvbnQoKTsK
ICAgICAgc3FfYyA9IGNodW5rX2FkZF9hZnRlcigmbmMsIHNxX28pOwogICB9CiAgIHNldF9j
aHVua19wYXJlbnQoc3FfbywgQ1RfQ1BQX0xBTUJEQSk7CiAgIHNldF9jaHVua19wYXJlbnQo
c3FfYywgQ1RfQ1BQX0xBTUJEQSk7CgogICBpZiAocGFfYyAhPSBudWxscHRyKQogICB7CiAg
ICAgIHNldF9jaHVua190eXBlKHBhX28sIENUX0ZQQVJFTl9PUEVOKTsKICAgICAgc2V0X2No
dW5rX3BhcmVudChwYV9vLCBDVF9DUFBfTEFNQkRBKTsKICAgICAgc2V0X2NodW5rX3R5cGUo
cGFfYywgQ1RfRlBBUkVOX0NMT1NFKTsKICAgICAgc2V0X2NodW5rX3BhcmVudChwYV9jLCBD
VF9DUFBfTEFNQkRBKTsKICAgfQogICBzZXRfY2h1bmtfcGFyZW50KGJyX28sIENUX0NQUF9M
QU1CREEpOwogICBzZXRfY2h1bmtfcGFyZW50KGJyX2MsIENUX0NQUF9MQU1CREEpOwoKICAg
aWYgKHJldCAhPSBudWxscHRyKQogICB7CiAgICAgIHNldF9jaHVua190eXBlKHJldCwgQ1Rf
Q1BQX0xBTUJEQV9SRVQpOwogICAgICByZXQgPSBjaHVua19nZXRfbmV4dF9uY25sKHJldCk7
CgogICAgICB3aGlsZSAocmV0ICE9IGJyX28pCiAgICAgIHsKICAgICAgICAgbWFrZV90eXBl
KHJldCk7CiAgICAgICAgIHJldCA9IGNodW5rX2dldF9uZXh0X25jbmwocmV0KTsKICAgICAg
fQogICB9CgogICBpZiAocGFfYyAhPSBudWxscHRyKQogICB7CiAgICAgIGZpeF9mY25fZGVm
X3BhcmFtcyhwYV9vKTsKICAgfQogICAvL2hhbmRsZSBzZWxmIGNhbGxpbmcgbGFtYmRhIHBh
cmVuCiAgIGNodW5rX3QgKmNhbGxfcGFfbyA9IGNodW5rX2dldF9uZXh0X25jbmwoYnJfYyk7
CgogICBpZiAoY2h1bmtfaXNfdG9rZW4oY2FsbF9wYV9vLCBDVF9QQVJFTl9PUEVOKSkKICAg
ewogICAgICBjaHVua190ICpjYWxsX3BhX2MgPSBjaHVua19za2lwX3RvX21hdGNoKGNhbGxf
cGFfbyk7CgogICAgICBpZiAoY2FsbF9wYV9jICE9IG51bGxwdHIpCiAgICAgIHsKICAgICAg
ICAgc2V0X2NodW5rX3R5cGUoY2FsbF9wYV9vLCBDVF9GUEFSRU5fT1BFTik7CiAgICAgICAg
IHNldF9jaHVua19wYXJlbnQoY2FsbF9wYV9vLCBDVF9GVU5DX0NBTEwpOwogICAgICAgICBz
ZXRfY2h1bmtfdHlwZShjYWxsX3BhX2MsIENUX0ZQQVJFTl9DTE9TRSk7CiAgICAgICAgIHNl
dF9jaHVua19wYXJlbnQoY2FsbF9wYV9jLCBDVF9GVU5DX0NBTEwpOwogICAgICB9CiAgIH0K
fSAvLyBoYW5kbGVfY3BwX2xhbWJkYQoKCnN0YXRpYyB2b2lkIGhhbmRsZV9kX3RlbXBsYXRl
KGNodW5rX3QgKnBjKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CgogICBjaHVua190ICpuYW1l
ID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7CiAgIGNodW5rX3QgKnBvICAgPSBjaHVua19n
ZXRfbmV4dF9uY25sKG5hbWUpOwoKICAgLy9pZiAoIW5hbWUgfHwgKG5hbWUtPnR5cGUgIT0g
Q1RfV09SRCAmJiBuYW1lLT50eXBlICE9IENUX1dPUkQpKSAgQ292ZXJpdHkgQ0lEIDc2MDAw
IFNhbWUgb24gYm90aCBzaWRlcywgMjAxNi0wMy0xNgogICBpZiAoIW5hbWUgfHwgbmFtZS0+
dHlwZSAhPSBDVF9XT1JEKQogICB7CiAgICAgIC8vIFRPRE86IGxvZyBhbiBlcnJvciwgZXhw
ZWN0ZWQgTkFNRQogICAgICByZXR1cm47CiAgIH0KCiAgIGlmICggIHBvID09IG51bGxwdHIK
ICAgICAgfHwgcG8tPnR5cGUgIT0gQ1RfUEFSRU5fT1BFTikKICAgewogICAgICAvLyBUT0RP
OiBsb2cgYW4gZXJyb3IsIGV4cGVjdGVkICcoJwogICAgICByZXR1cm47CiAgIH0KICAgc2V0
X2NodW5rX3R5cGUobmFtZSwgQ1RfVFlQRSk7CiAgIHNldF9jaHVua19wYXJlbnQobmFtZSwg
Q1RfVEVNUExBVEUpOwogICBzZXRfY2h1bmtfcGFyZW50KHBvLCBDVF9URU1QTEFURSk7Cgog
ICBDaHVua1N0YWNrIGNzOwogICBjaHVua190ICAgICp0bXAgPSBnZXRfZF90ZW1wbGF0ZV90
eXBlcyhjcywgcG8pOwoKICAgaWYgKCAgdG1wID09IG51bGxwdHIKICAgICAgfHwgdG1wLT50
eXBlICE9IENUX1BBUkVOX0NMT1NFKQogICB7CiAgICAgIC8vIFRPRE86IGxvZyBhbiBlcnJv
ciwgZXhwZWN0ZWQgJyknCiAgICAgIHJldHVybjsKICAgfQogICBzZXRfY2h1bmtfcGFyZW50
KHRtcCwgQ1RfVEVNUExBVEUpOwoKICAgdG1wID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXAp
OwoKICAgaWYgKHRtcC0+dHlwZSAhPSBDVF9CUkFDRV9PUEVOKQogICB7CiAgICAgIC8vIFRP
RE86IGxvZyBhbiBlcnJvciwgZXhwZWN0ZWQgJ3snCiAgICAgIHJldHVybjsKICAgfQogICBz
ZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfVEVNUExBVEUpOwogICBwbyA9IHRtcDsKCiAgIHRt
cCA9IHBvOwoKICAgd2hpbGUgKCAgKCh0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcCkp
ICE9IG51bGxwdHIpCiAgICAgICAgICYmIHRtcC0+bGV2ZWwgPiBwby0+bGV2ZWwpCiAgIHsK
ICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfV09SRCkgJiYgY2h1bmtzdGFja19t
YXRjaChjcywgdG1wKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZSh0bXAsIENU
X1RZUEUpOwogICAgICB9CiAgIH0KLy8gICBpZiAoIWNodW5rX2lzX3Rva2VuKHRtcCwgQ1Rf
QlJBQ0VfQ0xPU0UpKQovLyAgIHsKLy8gICAgICAvLyBUT0RPOiBsb2cgYW4gZXJyb3IsIGV4
cGVjdGVkICd9JwovLyAgIH0KICAgc2V0X2NodW5rX3BhcmVudCh0bXAsIENUX1RFTVBMQVRF
KTsKfSAvLyBoYW5kbGVfZF90ZW1wbGF0ZQoKCmNodW5rX3QgKnNraXBfdGVtcGxhdGVfbmV4
dChjaHVua190ICphbmdfb3BlbikKewogICBpZiAoY2h1bmtfaXNfdG9rZW4oYW5nX29wZW4s
IENUX0FOR0xFX09QRU4pKQogICB7CiAgICAgIGNodW5rX3QgKnBjID0gY2h1bmtfZ2V0X25l
eHRfdHlwZShhbmdfb3BlbiwgQ1RfQU5HTEVfQ0xPU0UsIGFuZ19vcGVuLT5sZXZlbCk7CiAg
ICAgIHJldHVybihjaHVua19nZXRfbmV4dF9uY25sKHBjKSk7CiAgIH0KICAgcmV0dXJuKGFu
Z19vcGVuKTsKfQoKCnN0YXRpYyB2b2lkIGhhbmRsZV9vY19jbGFzcyhjaHVua190ICpwYykK
ewogICBlbnVtIGNsYXNzIGFuZ2xlX3N0YXRlX2UgOiB1bnNpZ25lZCBpbnQKICAgewogICAg
ICBOT05FICA9IDAsCiAgICAgIE9QRU4gID0gMSwgLy8gJzwnIGZvdW5kCiAgICAgIENMT1NF
ID0gMiwgLy8gJz4nIGZvdW5kCiAgIH07CgogICBMT0dfRlVOQ19FTlRSWSgpOwogICBjaHVu
a190ICAgICAgICp0bXA7CiAgIGJvb2wgICAgICAgICAgaGl0X3Njb3BlICAgICA9IGZhbHNl
OwogICBib29sICAgICAgICAgIHBhc3NlZF9uYW1lICAgPSBmYWxzZTsgLy8gRGlkIHdlIHBh
c3MgdGhlIG5hbWUgb2YgdGhlIGNsYXNzIGFuZCBub3cgdGhlcmUgY2FuIGJlIG9ubHkgcHJv
dG9jb2xzLCBub3QgZ2VuZXJpY3MKICAgaW50ICAgICAgICAgICBnZW5lcmljX2xldmVsID0g
MDsgICAgIC8vIGxldmVsIG9mIGRlcHRoIG9mIGdlbmVyaWMKICAgYW5nbGVfc3RhdGVfZSBh
cyAgICAgICAgICAgID0gYW5nbGVfc3RhdGVfZTo6Tk9ORTsKCiAgIExPR19GTVQoTE9DQ0xB
U1MsICIlcyglZCk6IHN0YXJ0IFslc10gWyVzXSBsaW5lICV6dVxuIiwKICAgICAgICAgICBf
X2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIGdldF90b2tlbl9uYW1lKGdldF9jaHVu
a19wYXJlbnRfdHlwZShwYykpLCBwYy0+b3JpZ19saW5lKTsKCiAgIGlmIChnZXRfY2h1bmtf
cGFyZW50X3R5cGUocGMpID09IENUX09DX1BST1RPQ09MKQogICB7CiAgICAgIHRtcCA9IGNo
dW5rX2dldF9uZXh0X25jbmwocGMpOwoKICAgICAgaWYgKGNodW5rX2lzX3NlbWljb2xvbih0
bXApKQogICAgICB7CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBnZXRfY2h1bmtf
cGFyZW50X3R5cGUocGMpKTsKICAgICAgICAgTE9HX0ZNVChMT0NDTEFTUywgIiVzKCVkKTog
ICBiYWlsIG9uIHNlbWljb2xvblxuIiwgX19mdW5jX18sIF9fTElORV9fKTsKICAgICAgICAg
cmV0dXJuOwogICAgICB9CiAgIH0KICAgdG1wID0gcGM7CgogICB3aGlsZSAoKHRtcCA9IGNo
dW5rX2dldF9uZXh0X25ubCh0bXApKSAhPSBudWxscHRyKQogICB7CiAgICAgIExPR19GTVQo
TE9DQ0xBU1MsICIlcyglZCk6ICAgICAgIG9yaWdfbGluZSBpcyAlenUsIFslc11cbiIsCiAg
ICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0bXAtPm9yaWdfbGluZSwgdG1wLT50
ZXh0KCkpOwoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfT0NfRU5EKSkKICAg
ICAgewogICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgaWYgKGNodW5rX2lzX3Rva2Vu
KHRtcCwgQ1RfUEFSRU5fT1BFTikpCiAgICAgIHsKICAgICAgICAgcGFzc2VkX25hbWUgPSB0
cnVlOwogICAgICB9CgogICAgICBpZiAoY2h1bmtfaXNfc3RyKHRtcCwgIjwiLCAxKSkKICAg
ICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZSh0bXAsIENUX0FOR0xFX09QRU4pOwoKICAg
ICAgICAgaWYgKHBhc3NlZF9uYW1lKQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVu
a19wYXJlbnQodG1wLCBDVF9PQ19QUk9UT19MSVNUKTsKICAgICAgICAgfQogICAgICAgICBl
bHNlCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVudCh0bXAsIENUX09D
X0dFTkVSSUNfU1BFQyk7CiAgICAgICAgICAgIGdlbmVyaWNfbGV2ZWwrKzsKICAgICAgICAg
fQogICAgICAgICBhcyA9IGFuZ2xlX3N0YXRlX2U6Ok9QRU47CiAgICAgIH0KCiAgICAgIGlm
IChjaHVua19pc19zdHIodG1wLCAiPiIsIDEpKQogICAgICB7CiAgICAgICAgIHNldF9jaHVu
a190eXBlKHRtcCwgQ1RfQU5HTEVfQ0xPU0UpOwoKICAgICAgICAgaWYgKHBhc3NlZF9uYW1l
KQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBDVF9PQ19Q
Uk9UT19MSVNUKTsKICAgICAgICAgICAgYXMgPSBhbmdsZV9zdGF0ZV9lOjpDTE9TRTsKICAg
ICAgICAgfQogICAgICAgICBlbHNlCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5r
X3BhcmVudCh0bXAsIENUX09DX0dFTkVSSUNfU1BFQyk7CgogICAgICAgICAgICBpZiAoZ2Vu
ZXJpY19sZXZlbCA9PSAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGZwcmludGYo
c3RkZXJyLCAiJXMoJWQpOiBnZW5lcmljX2xldmVsIGlzIFpFUk8sIGNhbm5vdCBiZSBkZWNy
ZW1lbnRlZCwgYXQgbGluZSAlenUsIGNvbHVtbiAlenVcbiIsCiAgICAgICAgICAgICAgICAg
ICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0bXAtPm9yaWdfbGluZSwgdG1wLT5vcmlnX2Nv
bCk7CiAgICAgICAgICAgICAgIGxvZ19mbHVzaCh0cnVlKTsKICAgICAgICAgICAgICAgZXhp
dChFWF9TT0ZUV0FSRSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2VuZXJpY19sZXZl
bC0tOwoKICAgICAgICAgICAgaWYgKGdlbmVyaWNfbGV2ZWwgPT0gMCkKICAgICAgICAgICAg
ewogICAgICAgICAgICAgICBhcyA9IGFuZ2xlX3N0YXRlX2U6OkNMT1NFOwogICAgICAgICAg
ICB9CiAgICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGNodW5rX2lzX3N0cih0bXAsICI+
PiIsIDIpKQogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHRtcCwgQ1RfQU5HTEVf
Q0xPU0UpOwogICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfT0NfR0VORVJJQ19T
UEVDKTsKICAgICAgICAgc3BsaXRfb2ZmX2FuZ2xlX2Nsb3NlKHRtcCk7CiAgICAgICAgIGdl
bmVyaWNfbGV2ZWwgLT0gMTsKCiAgICAgICAgIGlmIChnZW5lcmljX2xldmVsID09IDApCiAg
ICAgICAgIHsKICAgICAgICAgICAgYXMgPSBhbmdsZV9zdGF0ZV9lOjpDTE9TRTsKICAgICAg
ICAgfQogICAgICB9CgogICAgICBpZiAoICBjaHVua19pc190b2tlbih0bXAsIENUX0JSQUNF
X09QRU4pCiAgICAgICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlwZSh0bXApICE9IENUX0FT
U0lHTikKICAgICAgewogICAgICAgICBhcyA9IGFuZ2xlX3N0YXRlX2U6OkNMT1NFOwogICAg
ICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfT0NfQ0xBU1MpOwogICAgICAgICB0bXAg
PSBjaHVua19nZXRfbmV4dF90eXBlKHRtcCwgQ1RfQlJBQ0VfQ0xPU0UsIHRtcC0+bGV2ZWwp
OwoKICAgICAgICAgaWYgKCAgdG1wICE9IG51bGxwdHIKICAgICAgICAgICAgJiYgZ2V0X2No
dW5rX3BhcmVudF90eXBlKHRtcCkgIT0gQ1RfQVNTSUdOKQogICAgICAgICB7CiAgICAgICAg
ICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBDVF9PQ19DTEFTUyk7CiAgICAgICAgIH0KICAg
ICAgfQogICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX0NPTE9OKSkKICAg
ICAgewogICAgICAgICBpZiAoYXMgIT0gYW5nbGVfc3RhdGVfZTo6T1BFTikKICAgICAgICAg
ewogICAgICAgICAgICBwYXNzZWRfbmFtZSA9IHRydWU7CiAgICAgICAgIH0KICAgICAgICAg
c2V0X2NodW5rX3R5cGUodG1wLCBoaXRfc2NvcGUgPyBDVF9PQ19DT0xPTiA6IENUX0NMQVNT
X0NPTE9OKTsKCiAgICAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX0NMQVNTX0NP
TE9OKSkKICAgICAgICAgewogICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1Rf
T0NfQ0xBU1MpOwogICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSBpZiAoY2h1bmtfaXNf
c3RyKHRtcCwgIi0iLCAxKSB8fCBjaHVua19pc19zdHIodG1wLCAiKyIsIDEpKQogICAgICB7
CiAgICAgICAgIGFzID0gYW5nbGVfc3RhdGVfZTo6Q0xPU0U7CgogICAgICAgICBpZiAoY2h1
bmtfaXNfbmV3bGluZShjaHVua19nZXRfcHJldih0bXApKSkKICAgICAgICAgewogICAgICAg
ICAgICBzZXRfY2h1bmtfdHlwZSh0bXAsIENUX09DX1NDT1BFKTsKICAgICAgICAgICAgY2h1
bmtfZmxhZ3Nfc2V0KHRtcCwgUENGX1NUTVRfU1RBUlQpOwogICAgICAgICAgICBoaXRfc2Nv
cGUgPSB0cnVlOwogICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChhcyA9PSBhbmdsZV9z
dGF0ZV9lOjpPUEVOKQogICAgICB7CiAgICAgICAgIGlmIChwYXNzZWRfbmFtZSkKICAgICAg
ICAgewogICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfT0NfUFJPVE9fTElT
VCk7CiAgICAgICAgIH0KICAgICAgICAgZWxzZQogICAgICAgICB7CiAgICAgICAgICAgIHNl
dF9jaHVua19wYXJlbnQodG1wLCBDVF9PQ19HRU5FUklDX1NQRUMpOwogICAgICAgICB9CiAg
ICAgIH0KICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfQlJBQ0VfT1BFTikp
CiAgIHsKICAgICAgdG1wID0gY2h1bmtfZ2V0X25leHRfdHlwZSh0bXAsIENUX0JSQUNFX0NM
T1NFLCB0bXAtPmxldmVsKTsKCiAgICAgIGlmICh0bXAgIT0gbnVsbHB0cikKICAgICAgewog
ICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfT0NfQ0xBU1MpOwogICAgICB9CiAg
IH0KfSAvLyBoYW5kbGVfb2NfY2xhc3MKCgpzdGF0aWMgdm9pZCBoYW5kbGVfb2NfYmxvY2tf
bGl0ZXJhbChjaHVua190ICpwYykKewogICBMT0dfRlVOQ19FTlRSWSgpOwogICBjaHVua190
ICpwcmV2ID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHBjKTsgICAvLyBJc3N1ZSAjMjI3OQog
ICBjaHVua190ICpuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7CgogICBpZiAoICBw
YyA9PSBudWxscHRyCiAgICAgIHx8IHByZXYgPT0gbnVsbHB0cgogICAgICB8fCBuZXh0ID09
IG51bGxwdHIpCiAgIHsKICAgICAgcmV0dXJuOyAvLyBsZXQncyBiZSBwYXJhbm9pZAogICB9
CiAgIC8qCiAgICAqIGJsb2NrIGxpdGVyYWw6ICdeIFJUWVBFICggQVJHUyApIHsgfScKICAg
ICogUlRZUEUgYW5kIEFSR1MgYXJlIG9wdGlvbmFsCiAgICAqLwogICBMT0dfRk1UKExPQ0JM
SywgIiVzKCVkKTogYmxvY2sgbGl0ZXJhbCBAIG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29s
IGlzICV6dVxuIiwKICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xp
bmUsIHBjLT5vcmlnX2NvbCk7CgogICBjaHVua190ICphcG8gPSBudWxscHRyOyAvLyBhcmcg
cGFyZW4gb3BlbgogICBjaHVua190ICpiYm8gPSBudWxscHRyOyAvLyBibG9jayBicmFjZSBv
cGVuCiAgIGNodW5rX3QgKmJiYzsgICAgICAgICAgIC8vIGJsb2NrIGJyYWNlIGNsb3NlCgog
ICBMT0dfRk1UKExPQ0JMSywgIiVzKCVkKTogICsgc2NhbiIsIF9fZnVuY19fLCBfX0xJTkVf
Xyk7CiAgIGNodW5rX3QgKnRtcDsKCiAgIGZvciAodG1wID0gbmV4dDsgdG1wOyB0bXAgPSBj
aHVua19nZXRfbmV4dF9uY25sKHRtcCkpCiAgIHsKICAgICAgLyogaGFuZGxlICc8IHByb3Rv
Y29sID4nICovCiAgICAgIGlmIChjaHVua19pc19zdHIodG1wLCAiPCIsIDEpKQogICAgICB7
CiAgICAgICAgIGNodW5rX3QgKmFvID0gdG1wOwogICAgICAgICBjaHVua190ICphYyA9IGNo
dW5rX2dldF9uZXh0X3N0cihhbywgIj4iLCAxLCBhby0+bGV2ZWwpOwoKICAgICAgICAgaWYg
KGFjKQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKGFvLCBDVF9BTkdM
RV9PUEVOKTsKICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVudChhbywgQ1RfT0NfUFJPVE9f
TElTVCk7CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKGFjLCBDVF9BTkdMRV9DTE9TRSk7
CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQoYWMsIENUX09DX1BST1RPX0xJU1QpOwoK
ICAgICAgICAgICAgZm9yICh0bXAgPSBjaHVua19nZXRfbmV4dChhbyk7IHRtcCAhPSBhYzsg
dG1wID0gY2h1bmtfZ2V0X25leHQodG1wKSkKICAgICAgICAgICAgewogICAgICAgICAgICAg
ICB0bXAtPmxldmVsICs9IDE7CiAgICAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1w
LCBDVF9PQ19QUk9UT19MSVNUKTsKICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgICAg
IHRtcCA9IGNodW5rX2dldF9uZXh0X25jbmwoYWMpOwogICAgICB9CiAgICAgIExPR19GTVQo
TE9DQkxLLCAiICclcyciLCB0bXAtPnRleHQoKSk7CgogICAgICBpZiAodG1wLT5sZXZlbCA8
IHBjLT5sZXZlbCB8fCBjaHVua19pc190b2tlbih0bXAsIENUX1NFTUlDT0xPTikpCiAgICAg
IHsKICAgICAgICAgTE9HX0ZNVChMT0NCTEssICJbRE9ORV0iKTsKICAgICAgICAgYnJlYWs7
CiAgICAgIH0KCiAgICAgIGlmICh0bXAtPmxldmVsID09IHBjLT5sZXZlbCkKICAgICAgewog
ICAgICAgICBpZiAoY2h1bmtfaXNfcGFyZW5fb3Blbih0bXApKQogICAgICAgICB7CiAgICAg
ICAgICAgIGFwbyA9IHRtcDsKICAgICAgICAgICAgTE9HX0ZNVChMT0NCTEssICJbUEFSRU5d
Iik7CiAgICAgICAgIH0KCiAgICAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX0JS
QUNFX09QRU4pKQogICAgICAgICB7CiAgICAgICAgICAgIExPR19GTVQoTE9DQkxLLCAiW0JS
QUNFXSIpOwogICAgICAgICAgICBiYm8gPSB0bXA7CiAgICAgICAgICAgIGJyZWFrOwogICAg
ICAgICB9CiAgICAgIH0KICAgfQoKICAgLy8gbWFrZSBzdXJlIHdlIGhhdmUgYnJhY2VzCiAg
IGJiYyA9IGNodW5rX3NraXBfdG9fbWF0Y2goYmJvKTsKCiAgIGlmICggIGJibyA9PSBudWxs
cHRyCiAgICAgIHx8IGJiYyA9PSBudWxscHRyKQogICB7CiAgICAgIExPR19GTVQoTE9DQkxL
LCAiIC0tIG5vIGJyYWNlcyBmb3VuZFxuIik7CiAgICAgIHJldHVybjsKICAgfQogICBMT0df
Rk1UKExPQ0JMSywgIlxuIik7CgogICAvLyB3ZSBhcmUgb24gYSBibG9jayBsaXRlcmFsIGZv
ciBzdXJlCiAgIHNldF9jaHVua190eXBlKHBjLCBDVF9PQ19CTE9DS19DQVJFVCk7CiAgIHNl
dF9jaHVua19wYXJlbnQocGMsIENUX09DX0JMT0NLX0VYUFIpOwoKICAgLy8gaGFuZGxlIHRo
ZSBvcHRpb25hbCBhcmdzCiAgIGNodW5rX3QgKmxicDsgLy8gbGFzdCBiZWZvcmUgcGFyZW4g
LSBlbmQgb2YgcmV0dXJuIHR5cGUsIGlmIGFueQoKICAgaWYgKGFwbykKICAgewogICAgICBj
aHVua190ICphcGMgPSBjaHVua19za2lwX3RvX21hdGNoKGFwbyk7ICAvLyBhcmcgcGFyZW50
aGVzaXMgY2xvc2UKCiAgICAgIGlmIChjaHVua19pc19wYXJlbl9jbG9zZShhcGMpKQogICAg
ICB7CiAgICAgICAgIExPR19GTVQoTE9DQkxLLCAiIC0tIG1hcmtpbmcgcGFyZW5zIEAgYXBv
LT5vcmlnX2xpbmUgaXMgJXp1LCBhcG8tPm9yaWdfY29sIGlzICV6dSBhbmQgYXBjLT5vcmln
X2xpbmUgaXMgJXp1LCBhcGMtPm9yaWdfY29sIGlzICV6dVxuIiwKICAgICAgICAgICAgICAg
ICBhcG8tPm9yaWdfbGluZSwgYXBvLT5vcmlnX2NvbCwgYXBjLT5vcmlnX2xpbmUsIGFwYy0+
b3JpZ19jb2wpOwogICAgICAgICBmbGFnX3BhcmVucyhhcG8sIFBDRl9PQ19BVFlQRSwgQ1Rf
RlBBUkVOX09QRU4sIENUX09DX0JMT0NLX0VYUFIsIHRydWUpOwogICAgICAgICBmaXhfZmNu
X2RlZl9wYXJhbXMoYXBvKTsKICAgICAgfQogICAgICBsYnAgPSBjaHVua19nZXRfcHJldl9u
Y25sbmkoYXBvKTsgICAvLyBJc3N1ZSAjMjI3OQogICB9CiAgIGVsc2UKICAgewogICAgICBs
YnAgPSBjaHVua19nZXRfcHJldl9uY25sbmkoYmJvKTsgICAvLyBJc3N1ZSAjMjI3OQogICB9
CgogICAvLyBtYXJrIHRoZSByZXR1cm4gdHlwZSwgaWYgYW55CiAgIHdoaWxlIChsYnAgIT0g
cGMpCiAgIHsKICAgICAgTE9HX0ZNVChMT0NCTEssICIgLS0gbGJwICVzWyVzXVxuIiwgbGJw
LT50ZXh0KCksIGdldF90b2tlbl9uYW1lKGxicC0+dHlwZSkpOwogICAgICBtYWtlX3R5cGUo
bGJwKTsKICAgICAgY2h1bmtfZmxhZ3Nfc2V0KGxicCwgUENGX09DX1JUWVBFKTsKICAgICAg
c2V0X2NodW5rX3BhcmVudChsYnAsIENUX09DX0JMT0NLX0VYUFIpOwogICAgICBsYnAgPSBj
aHVua19nZXRfcHJldl9uY25sbmkobGJwKTsgICAvLyBJc3N1ZSAjMjI3OQogICB9CiAgIC8v
IG1hcmsgdGhlIGJyYWNlcwogICBzZXRfY2h1bmtfcGFyZW50KGJibywgQ1RfT0NfQkxPQ0tf
RVhQUik7CiAgIHNldF9jaHVua19wYXJlbnQoYmJjLCBDVF9PQ19CTE9DS19FWFBSKTsKfSAv
LyBoYW5kbGVfb2NfYmxvY2tfbGl0ZXJhbAoKCnN0YXRpYyB2b2lkIGhhbmRsZV9vY19ibG9j
a190eXBlKGNodW5rX3QgKnBjKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CgogICBpZiAocGMg
PT0gbnVsbHB0cikKICAgewogICAgICByZXR1cm47CiAgIH0KCiAgIGlmIChwYy0+ZmxhZ3Mu
dGVzdChQQ0ZfSU5fVFlQRURFRikpCiAgIHsKICAgICAgTE9HX0ZNVChMT0NCTEssICIlcygl
ZCk6IHNraXAgYmxvY2sgdHlwZSBAIG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6
dSwgLS0gaW4gdHlwZWRlZlxuIiwKICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18s
IHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCk7CiAgICAgIHJldHVybjsKICAgfQogICAv
LyBtYWtlIHN1cmUgd2UgaGF2ZSAnKCBeJwogICBjaHVua190ICp0cG8gPSBjaHVua19nZXRf
cHJldl9uY25sbmkocGMpOyAvLyB0eXBlIHBhcmVuIG9wZW4gICBJc3N1ZSAjMjI3OQoKICAg
aWYgKGNodW5rX2lzX3BhcmVuX29wZW4odHBvKSkKICAgewogICAgICAvKgogICAgICAgKiBi
bG9jayB0eXBlOiAnUlRZUEUgKF5MQUJFTCkoQVJHUyknCiAgICAgICAqIExBQkVMIGlzIG9w
dGlvbmFsLgogICAgICAgKi8KICAgICAgY2h1bmtfdCAqdHBjID0gY2h1bmtfc2tpcF90b19t
YXRjaCh0cG8pOyAgIC8vIHR5cGUgY2xvc2UgcGFyZW4gKGFmdGVyICdeJykKICAgICAgY2h1
bmtfdCAqbmFtID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHRwYyk7IC8vIG5hbWUgKGlmIGFu
eSkgb3IgJ14nICAgSXNzdWUgIzIyNzkKICAgICAgY2h1bmtfdCAqYXBvID0gY2h1bmtfZ2V0
X25leHRfbmNubCh0cGMpOyAgIC8vIGFyZyBvcGVuIHBhcmVuCiAgICAgIGNodW5rX3QgKmFw
YyA9IGNodW5rX3NraXBfdG9fbWF0Y2goYXBvKTsgICAvLyBhcmcgY2xvc2UgcGFyZW4KCiAg
ICAgIC8qCiAgICAgICAqIElmIHRoaXMgaXMgYSBibG9jayBsaXRlcmFsIGluc3RlYWQgb2Yg
YSBibG9jayB0eXBlLCAnbmFtJwogICAgICAgKiB3aWxsIGFjdHVhbGx5IGJlIHRoZSBjbG9z
aW5nIGJyYWNrZXQgb2YgdGhlIGJsb2NrLiBXZSBydW4gaW50bwogICAgICAgKiB0aGlzIHNp
dHVhdGlvbiBpZiBhIGJsb2NrIGxpdGVyYWwgaXMgZW5jbG9zZWQgaW4gcGFyZW50aGVzZXMu
CiAgICAgICAqLwogICAgICBpZiAoY2h1bmtfaXNfY2xvc2luZ19icmFjZShuYW0pKQogICAg
ICB7CiAgICAgICAgIHJldHVybihoYW5kbGVfb2NfYmxvY2tfbGl0ZXJhbChwYykpOwogICAg
ICB9CgogICAgICAvLyBDaGVjayBhcG8gaXMgJygnIG9yIGVsc2UgdGhpcyBtaWdodCBiZSBh
IGJsb2NrIGxpdGVyYWwuIElzc3VlIDI2NDMuCiAgICAgIGlmICghY2h1bmtfaXNfcGFyZW5f
b3BlbihhcG8pKQogICAgICB7CiAgICAgICAgIHJldHVybihoYW5kbGVfb2NfYmxvY2tfbGl0
ZXJhbChwYykpOwogICAgICB9CgogICAgICBpZiAoY2h1bmtfaXNfcGFyZW5fY2xvc2UoYXBj
KSkKICAgICAgewogICAgICAgICBjaHVua190ICAgKmFmdCA9IGNodW5rX2dldF9uZXh0X25j
bmwoYXBjKTsKICAgICAgICAgY190b2tlbl90IHB0OwoKICAgICAgICAgaWYgKGNodW5rX2lz
X3N0cihuYW0sICJeIiwgMSkpCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3R5
cGUobmFtLCBDVF9QVFJfVFlQRSk7CiAgICAgICAgICAgIHB0ID0gQ1RfRlVOQ19UWVBFOwog
ICAgICAgICB9CiAgICAgICAgIGVsc2UgaWYgKCAgY2h1bmtfaXNfdG9rZW4oYWZ0LCBDVF9B
U1NJR04pCiAgICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4oYWZ0LCBDVF9TRU1J
Q09MT04pKQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKG5hbSwgQ1Rf
RlVOQ19WQVIpOwogICAgICAgICAgICBwdCA9IENUX0ZVTkNfVkFSOwogICAgICAgICB9CiAg
ICAgICAgIGVsc2UKICAgICAgICAgewogICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShuYW0s
IENUX0ZVTkNfVFlQRSk7CiAgICAgICAgICAgIHB0ID0gQ1RfRlVOQ19UWVBFOwogICAgICAg
ICB9CiAgICAgICAgIExPR19GTVQoTE9DQkxLLCAiJXMoJWQpOiBibG9jayB0eXBlIEAgb3Jp
Z19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1slc11cbiIsCiAg
ICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+
b3JpZ19jb2wsIG5hbS0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZShuYW0tPnR5cGUpKTsKICAg
ICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX1BUUl9UWVBFKTsKICAgICAgICAgc2V0X2No
dW5rX3BhcmVudChwYywgcHQpOyAgLy9DVF9PQ19CTE9DS19UWVBFOwogICAgICAgICBzZXRf
Y2h1bmtfdHlwZSh0cG8sIENUX1RQQVJFTl9PUEVOKTsKICAgICAgICAgc2V0X2NodW5rX3Bh
cmVudCh0cG8sIHB0KTsgLy9DVF9PQ19CTE9DS19UWVBFOwogICAgICAgICBzZXRfY2h1bmtf
dHlwZSh0cGMsIENUX1RQQVJFTl9DTE9TRSk7CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQo
dHBjLCBwdCk7IC8vQ1RfT0NfQkxPQ0tfVFlQRTsKICAgICAgICAgc2V0X2NodW5rX3R5cGUo
YXBvLCBDVF9GUEFSRU5fT1BFTik7CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQoYXBvLCBD
VF9GVU5DX1BST1RPKTsKICAgICAgICAgc2V0X2NodW5rX3R5cGUoYXBjLCBDVF9GUEFSRU5f
Q0xPU0UpOwogICAgICAgICBzZXRfY2h1bmtfcGFyZW50KGFwYywgQ1RfRlVOQ19QUk9UTyk7
CiAgICAgICAgIGZpeF9mY25fZGVmX3BhcmFtcyhhcG8pOwogICAgICAgICBtYXJrX2Z1bmN0
aW9uX3JldHVybl90eXBlKG5hbSwgY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHRwbyksIHB0KTsg
ICAvLyBJc3N1ZSAjMjI3OQogICAgICB9CiAgIH0KfSAvLyBoYW5kbGVfb2NfYmxvY2tfdHlw
ZQoKCnN0YXRpYyBjaHVua190ICpoYW5kbGVfb2NfbWRfdHlwZShjaHVua190ICpwYXJlbl9v
cGVuLCBjX3Rva2VuX3QgcHR5cGUsIHBjZl9mbGFnc190IGZsYWdzLCBib29sICZkaWRfaXQp
CnsKICAgY2h1bmtfdCAqcGFyZW5fY2xvc2U7CgogICBpZiAoICAhY2h1bmtfaXNfcGFyZW5f
b3BlbihwYXJlbl9vcGVuKQogICAgICB8fCAoKHBhcmVuX2Nsb3NlID0gY2h1bmtfc2tpcF90
b19tYXRjaChwYXJlbl9vcGVuKSkgPT0gbnVsbHB0cikpCiAgIHsKICAgICAgZGlkX2l0ID0g
ZmFsc2U7CiAgICAgIHJldHVybihwYXJlbl9vcGVuKTsKICAgfQogICBkaWRfaXQgPSB0cnVl
OwoKICAgc2V0X2NodW5rX3BhcmVudChwYXJlbl9vcGVuLCBwdHlwZSk7CiAgIGNodW5rX2Zs
YWdzX3NldChwYXJlbl9vcGVuLCBmbGFncyk7CiAgIHNldF9jaHVua19wYXJlbnQocGFyZW5f
Y2xvc2UsIHB0eXBlKTsKICAgY2h1bmtfZmxhZ3Nfc2V0KHBhcmVuX2Nsb3NlLCBmbGFncyk7
CgogICBmb3IgKGNodW5rX3QgKmN1ciA9IGNodW5rX2dldF9uZXh0X25jbmwocGFyZW5fb3Bl
bik7CiAgICAgICAgY3VyICE9IHBhcmVuX2Nsb3NlOwogICAgICAgIGN1ciA9IGNodW5rX2dl
dF9uZXh0X25jbmwoY3VyKSkKICAgewogICAgICBMT0dfRk1UKExPQ01TR0QsICIgPCVzfCVz
PiIsIGN1ci0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZShjdXItPnR5cGUpKTsKICAgICAgY2h1
bmtfZmxhZ3Nfc2V0KGN1ciwgZmxhZ3MpOwogICAgICBtYWtlX3R5cGUoY3VyKTsKICAgfQoK
ICAgLy8gcmV0dXJuaW5nIHRoZSBjaHVuayBhZnRlciB0aGUgcGFyZW4gY2xvc2UKICAgcmV0
dXJuKGNodW5rX2dldF9uZXh0X25jbmwocGFyZW5fY2xvc2UpKTsKfQoKCnN0YXRpYyB2b2lk
IGhhbmRsZV9vY19tZXNzYWdlX2RlY2woY2h1bmtfdCAqcGMpCnsKICAgTE9HX0ZVTkNfRU5U
UlkoKTsKCiAgIGJvb2wgZGlkX2l0OwogICAvL2Jvb2wgICAgICBpbl9wYXJlbiAgPSBmYWxz
ZTsKICAgLy9pbnQgICAgICAgcGFyZW5fY250ID0gMDsKICAgLy9pbnQgICAgICAgYXJnX2Nu
dCAgID0gMDsKCiAgIC8vIEZpZ3VyZSBvdXQgaWYgdGhpcyBpcyBhIHNwZWMgb3IgZGVjbAog
ICBjaHVua190ICp0bXAgPSBwYzsKCiAgIHdoaWxlICgodG1wID0gY2h1bmtfZ2V0X25leHQo
dG1wKSkgIT0gbnVsbHB0cikKICAgewogICAgICBpZiAodG1wLT5sZXZlbCA8IHBjLT5sZXZl
bCkKICAgICAgewogICAgICAgICAvLyBzaG91bGQgbm90IGhhcHBlbgogICAgICAgICByZXR1
cm47CiAgICAgIH0KCiAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX1NFTUlDT0xP
TikgfHwgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9CUkFDRV9PUEVOKSkKICAgICAgewogICAg
ICAgICBicmVhazsKICAgICAgfQogICB9CgogICBpZiAodG1wID09IG51bGxwdHIpCiAgIHsK
ICAgICAgcmV0dXJuOwogICB9CiAgIGNfdG9rZW5fdCBwdCA9ICh0bXAtPnR5cGUgPT0gQ1Rf
U0VNSUNPTE9OKSA/IENUX09DX01TR19TUEVDIDogQ1RfT0NfTVNHX0RFQ0w7CgogICBzZXRf
Y2h1bmtfdHlwZShwYywgQ1RfT0NfU0NPUEUpOwogICBzZXRfY2h1bmtfcGFyZW50KHBjLCBw
dCk7CgogICBMT0dfRk1UKExPQ01TR0QsICIlcyglZCk6ICVzIEAgb3JpZ19saW5lIGlzICV6
dSwgb3JpZ19jb2wgaXMgJXp1IC0iLAogICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywg
Z2V0X3Rva2VuX25hbWUocHQpLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wpOwoKICAg
Ly8gZm9ybWF0OiAtKFRZUEUpIE5BTUUgWzogKFRZUEUpTkFNRQoKICAgLy8gaGFuZGxlIHRo
ZSByZXR1cm4gdHlwZQogICB0bXAgPSBoYW5kbGVfb2NfbWRfdHlwZShjaHVua19nZXRfbmV4
dF9uY25sKHBjKSwgcHQsIFBDRl9PQ19SVFlQRSwgZGlkX2l0KTsKCiAgIGlmICghZGlkX2l0
KQogICB7CiAgICAgIExPR19GTVQoTE9DTVNHRCwgIiAtLSBtaXNzaW5nIHR5cGUgcGFyZW5z
XG4iKTsKICAgICAgcmV0dXJuOwogICB9CgogICAvLyBleHBlY3QgdGhlIG1ldGhvZCBuYW1l
L2xhYmVsCiAgIGlmICghY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9XT1JEKSkKICAgewogICAg
ICBMT0dfRk1UKExPQ01TR0QsICIgLS0gbWlzc2luZyBtZXRob2QgbmFtZVxuIik7CiAgICAg
IHJldHVybjsKICAgfSAgLy8gZXhwZWN0IHRoZSBtZXRob2QgbmFtZS9sYWJlbAoKICAgY2h1
bmtfdCAqbGFiZWwgPSB0bXA7CgogICBzZXRfY2h1bmtfdHlwZSh0bXAsIHB0KTsKICAgc2V0
X2NodW5rX3BhcmVudCh0bXAsIHB0KTsKICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHRt
cCk7CgogICBMT0dfRk1UKExPQ01TR0QsICIgWyVzXSVzIiwgcGMtPnRleHQoKSwgZ2V0X3Rv
a2VuX25hbWUocGMtPnR5cGUpKTsKCiAgIC8vIGlmIHdlIGhhdmUgYSBjb2xvbiBuZXh0LCB3
ZSBoYXZlIGFyZ3MKICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DT0xPTikgfHwgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX09DX0NPTE9OKSkKICAgewogICAgICBwYyA9IGxhYmVsOwoK
ICAgICAgd2hpbGUgKHRydWUpCiAgICAgIHsKICAgICAgICAgLy8gc2tpcCBvcHRpb25hbCBs
YWJlbAogICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1dPUkQpIHx8IGNodW5r
X2lzX3Rva2VuKHBjLCBwdCkpCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3Bh
cmVudChwYywgcHQpOwogICAgICAgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGMp
OwogICAgICAgICB9CgogICAgICAgICAvLyBhIGNvbG9uIG11c3QgYmUgbmV4dAogICAgICAg
ICBpZiAoIWNodW5rX2lzX3N0cihwYywgIjoiLCAxKSkKICAgICAgICAgewogICAgICAgICAg
ICBicmVhazsKICAgICAgICAgfQogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfT0Nf
Q09MT04pOwogICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBwdCk7CiAgICAgICAgIHBj
ID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7CgogICAgICAgICAvLyBuZXh0IGlzIHRoZSB0
eXBlIGluIHBhcmVucwogICAgICAgICBMT0dfRk1UKExPQ01TR0QsICIgICglcykiLCBwYy0+
dGV4dCgpKTsKICAgICAgICAgdG1wID0gaGFuZGxlX29jX21kX3R5cGUocGMsIHB0LCBQQ0Zf
T0NfQVRZUEUsIGRpZF9pdCk7CgogICAgICAgICBpZiAoIWRpZF9pdCkKICAgICAgICAgewog
ICAgICAgICAgICBMT0dfRk1UKExXQVJOLCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1LCBv
cmlnX2NvbCBpcyAlenUgZXhwZWN0ZWQgdHlwZVxuIiwKICAgICAgICAgICAgICAgICAgICBf
X2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCk7CiAgICAg
ICAgICAgIGJyZWFrOwogICAgICAgICB9CiAgICAgICAgIC8vIGF0dHJpYnV0ZXMgZm9yIGEg
bWV0aG9kIHBhcmFtZXRlciBzaXQgYmV0d2VlbiB0aGUgcGFyYW1ldGVyIHR5cGUgYW5kIHRo
ZSBwYXJhbWV0ZXIgbmFtZQogICAgICAgICBwYyA9IHNraXBfYXR0cmlidXRlX25leHQodG1w
KTsKICAgICAgICAgLy8gd2Ugc2hvdWxkIG5vdyBiZSBvbiB0aGUgYXJnIG5hbWUKICAgICAg
ICAgY2h1bmtfZmxhZ3Nfc2V0KHBjLCBQQ0ZfVkFSX0RFRik7CiAgICAgICAgIExPR19GTVQo
TE9DTVNHRCwgIiBhcmdbJXNdIiwgcGMtPnRleHQoKSk7CiAgICAgICAgIHBjID0gY2h1bmtf
Z2V0X25leHRfbmNubChwYyk7CiAgICAgIH0KICAgfQogICBMT0dfRk1UKExPQ01TR0QsICIg
ZW5kWyVzXSIsIHBjLT50ZXh0KCkpOwoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9C
UkFDRV9PUEVOKSkKICAgewogICAgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBwdCk7CiAgICAg
IHBjID0gY2h1bmtfc2tpcF90b19tYXRjaChwYyk7CgogICAgICBpZiAocGMgIT0gbnVsbHB0
cikKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBwdCk7CiAgICAgIH0K
ICAgfQogICBlbHNlIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfU0VNSUNPTE9OKSkKICAg
ewogICAgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBwdCk7CiAgIH0KICAgTE9HX0ZNVChMT0NN
U0dELCAiXG4iKTsKfSAvLyBoYW5kbGVfb2NfbWVzc2FnZV9kZWNsCgoKc3RhdGljIHZvaWQg
aGFuZGxlX29jX21lc3NhZ2Vfc2VuZChjaHVua190ICpvcykKewogICBMT0dfRlVOQ19FTlRS
WSgpOwoKICAgY2h1bmtfdCAqY3MgPSBjaHVua19nZXRfbmV4dChvcyk7CgogICB3aGlsZSAo
Y3MgIT0gbnVsbHB0ciAmJiBjcy0+bGV2ZWwgPiBvcy0+bGV2ZWwpCiAgIHsKICAgICAgY3Mg
PSBjaHVua19nZXRfbmV4dChjcyk7CiAgIH0KCiAgIGlmIChjcyA9PSBudWxscHRyIHx8IGNz
LT50eXBlICE9IENUX1NRVUFSRV9DTE9TRSkKICAgewogICAgICByZXR1cm47CiAgIH0KICAg
TE9HX0ZNVChMT0NNU0csICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlz
ICV6dVxuIiwKICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIG9zLT5vcmlnX2xpbmUs
IG9zLT5vcmlnX2NvbCk7CgogICBjaHVua190ICp0bXAgPSBjaHVua19nZXRfbmV4dF9uY25s
KGNzKTsKCiAgIGlmIChjaHVua19pc19zZW1pY29sb24odG1wKSkKICAgewogICAgICBzZXRf
Y2h1bmtfcGFyZW50KHRtcCwgQ1RfT0NfTVNHKTsKICAgfQogICAvLyBleHBlY3QgYSB3b3Jk
IGZpcnN0IHRoaW5nIG9yIFsuLi5dCiAgIHRtcCA9IGNodW5rX2dldF9uZXh0X25jbmwob3Mp
OwoKICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9TUVVBUkVfT1BFTikgfHwgY2h1
bmtfaXNfdG9rZW4odG1wLCBDVF9QQVJFTl9PUEVOKQogICAgICB8fCAoY2h1bmtfaXNfdG9r
ZW4odG1wLCBDVF9PQ19BVCkpKQogICB7CiAgICAgIGNodW5rX3QgKnR0ID0gY2h1bmtfZ2V0
X25leHRfbmNubCh0bXApOwoKICAgICAgaWYgKChjaHVua19pc190b2tlbih0bXAsIENUX09D
X0FUKSkgJiYgdHQpCiAgICAgIHsKICAgICAgICAgaWYgKCAgKGNodW5rX2lzX3Rva2VuKHR0
LCBDVF9QQVJFTl9PUEVOKSkKICAgICAgICAgICAgfHwgKGNodW5rX2lzX3Rva2VuKHR0LCBD
VF9CUkFDRV9PUEVOKSkKICAgICAgICAgICAgfHwgKGNodW5rX2lzX3Rva2VuKHR0LCBDVF9T
UVVBUkVfT1BFTikpKQogICAgICAgICB7CiAgICAgICAgICAgIHRtcCA9IHR0OwogICAgICAg
ICB9CiAgICAgICAgIGVsc2UKICAgICAgICAgewogICAgICAgICAgICBMT0dfRk1UKExPQ01T
RywgIiVzKCVkKTogdG1wLT5vcmlnX2xpbmUgaXMgJXp1LCB0bXAtPm9yaWdfY29sIGlzICV6
dSwgZXhwZWN0ZWQgaWRlbnRpZmllciwgbm90ICclcycgWyVzXVxuIiwKICAgICAgICAgICAg
ICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHRtcC0+b3JpZ19saW5lLCB0bXAtPm9yaWdf
Y29sLAogICAgICAgICAgICAgICAgICAgIHRtcC0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZSh0
bXAtPnR5cGUpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgIH0KICAg
ICAgdG1wID0gY2h1bmtfc2tpcF90b19tYXRjaCh0bXApOwogICB9CiAgIGVsc2UgaWYgKCAg
dG1wLT50eXBlICE9IENUX1dPUkQKICAgICAgICAgICAmJiB0bXAtPnR5cGUgIT0gQ1RfVFlQ
RQogICAgICAgICAgICYmIHRtcC0+dHlwZSAhPSBDVF9USElTCiAgICAgICAgICAgJiYgdG1w
LT50eXBlICE9IENUX1NUQVIKICAgICAgICAgICAmJiB0bXAtPnR5cGUgIT0gQ1RfU1RSSU5H
KQogICB7CiAgICAgIExPR19GTVQoTE9DTVNHLCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1
LCBvcmlnX2NvbCBpcyAlenUsIGV4cGVjdGVkIGlkZW50aWZpZXIsIG5vdCAnJXMnIFslc11c
biIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0bXAtPm9yaWdfbGluZSwg
dG1wLT5vcmlnX2NvbCwKICAgICAgICAgICAgICB0bXAtPnRleHQoKSwgZ2V0X3Rva2VuX25h
bWUodG1wLT50eXBlKSk7CiAgICAgIHJldHVybjsKICAgfQogICBlbHNlCiAgIHsKICAgICAg
aWYgKGNodW5rX2lzX3N0YXIodG1wKSkgLy8gSXNzdWUgIzI3MjIKICAgICAgewogICAgICAg
ICBzZXRfY2h1bmtfdHlwZSh0bXAsIENUX1BUUl9UWVBFKTsKICAgICAgICAgdG1wID0gY2h1
bmtfZ2V0X25leHRfbmNubCh0bXApOwogICAgICB9CiAgICAgIGNodW5rX3QgKnR0ID0gY2h1
bmtfZ2V0X25leHRfbmNubCh0bXApOwoKICAgICAgaWYgKGNodW5rX2lzX3BhcmVuX29wZW4o
dHQpKQogICAgICB7CiAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogKDE4KSBTRVQg
VE8gQ1RfRlVOQ19DQUxMOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRl
eHQoKSAnJXMnXG4iLAogICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgdG1w
LT5vcmlnX2xpbmUsIHRtcC0+b3JpZ19jb2wsIHRtcC0+dGV4dCgpKTsKICAgICAgICAgc2V0
X2NodW5rX3R5cGUodG1wLCBDVF9GVU5DX0NBTEwpOwogICAgICAgICB0bXAgPSBjaHVua19n
ZXRfcHJldl9uY25sbmkoc2V0X3BhcmVuX3BhcmVudCh0dCwgQ1RfRlVOQ19DQUxMKSk7ICAg
Ly8gSXNzdWUgIzIyNzkKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAgc2V0
X2NodW5rX3R5cGUodG1wLCBDVF9PQ19NU0dfQ0xBU1MpOwogICAgICB9CiAgIH0KICAgc2V0
X2NodW5rX3BhcmVudChvcywgQ1RfT0NfTVNHKTsKICAgY2h1bmtfZmxhZ3Nfc2V0KG9zLCBQ
Q0ZfSU5fT0NfTVNHKTsKICAgc2V0X2NodW5rX3BhcmVudChjcywgQ1RfT0NfTVNHKTsKICAg
Y2h1bmtfZmxhZ3Nfc2V0KGNzLCBQQ0ZfSU5fT0NfTVNHKTsKCiAgIC8vIGhhbmRsZSAnPCBw
cm90b2NvbCA+JwogICB0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcCk7CgogICBpZiAo
Y2h1bmtfaXNfc3RyKHRtcCwgIjwiLCAxKSkKICAgewogICAgICBjaHVua190ICphbyA9IHRt
cDsKICAgICAgY2h1bmtfdCAqYWMgPSBjaHVua19nZXRfbmV4dF9zdHIoYW8sICI+IiwgMSwg
YW8tPmxldmVsKTsKCiAgICAgIGlmIChhYykKICAgICAgewogICAgICAgICBzZXRfY2h1bmtf
dHlwZShhbywgQ1RfQU5HTEVfT1BFTik7CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQoYW8s
IENUX09DX1BST1RPX0xJU1QpOwogICAgICAgICBzZXRfY2h1bmtfdHlwZShhYywgQ1RfQU5H
TEVfQ0xPU0UpOwogICAgICAgICBzZXRfY2h1bmtfcGFyZW50KGFjLCBDVF9PQ19QUk9UT19M
SVNUKTsKCiAgICAgICAgIGZvciAodG1wID0gY2h1bmtfZ2V0X25leHQoYW8pOyB0bXAgIT0g
YWM7IHRtcCA9IGNodW5rX2dldF9uZXh0KHRtcCkpCiAgICAgICAgIHsKICAgICAgICAgICAg
dG1wLT5sZXZlbCArPSAxOwogICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1Rf
T0NfUFJPVE9fTElTVCk7CiAgICAgICAgIH0KICAgICAgfQogICAgICB0bXAgPSBjaHVua19n
ZXRfbmV4dF9uY25sKGFjKTsKICAgfQogICAvLyBoYW5kbGUgJ29iamVjdC5wcm9wZXJ0eScg
YW5kICdjb2xsZWN0aW9uW2luZGV4XScKICAgZWxzZQogICB7CiAgICAgIHdoaWxlICh0bXAp
CiAgICAgIHsKICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfTUVNQkVSKSkg
IC8vIG1vdmUgcGFzdCBbb2JqZWN0LnByb3AxLnByb3AyCiAgICAgICAgIHsKICAgICAgICAg
ICAgY2h1bmtfdCAqdHlwID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXApOwoKICAgICAgICAg
ICAgaWYgKGNodW5rX2lzX3Rva2VuKHR5cCwgQ1RfV09SRCkgfHwgY2h1bmtfaXNfdG9rZW4o
dHlwLCBDVF9UWVBFKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICB0bXAgPSBjaHVu
a19nZXRfbmV4dF9uY25sKHR5cCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQog
ICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAg
ICAgIH0KICAgICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9TUVVBUkVf
T1BFTikpICAvLyBtb3ZlIHBhc3QgW2NvbGxlY3Rpb25baW5kZXhdCiAgICAgICAgIHsKICAg
ICAgICAgICAgY2h1bmtfdCAqdGNzID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXApOwoKICAg
ICAgICAgICAgd2hpbGUgKHRjcyAhPSBudWxscHRyICYmIHRjcy0+bGV2ZWwgPiB0bXAtPmxl
dmVsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIHRjcyA9IGNodW5rX2dldF9uZXh0
X25jbmwodGNzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rv
a2VuKHRjcywgQ1RfU1FVQVJFX0NMT1NFKSkKICAgICAgICAgICAgewogICAgICAgICAgICAg
ICB0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKHRjcyk7CiAgICAgICAgICAgIH0KICAgICAg
ICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg
ICAgICB9CiAgICAgICAgIH0KICAgICAgICAgZWxzZQogICAgICAgICB7CiAgICAgICAgICAg
IGJyZWFrOwogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgLy8gWyhzZWxmLmZvby5iYXIp
IG1ldGhvZF0KICAgaWYgKGNodW5rX2lzX3BhcmVuX29wZW4odG1wKSkKICAgewogICAgICB0
bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKGNodW5rX3NraXBfdG9fbWF0Y2godG1wKSk7CiAg
IH0KCiAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX1dPUkQpIHx8IGNodW5rX2lzX3Rv
a2VuKHRtcCwgQ1RfVFlQRSkpCiAgIHsKICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9P
Q19NU0dfRlVOQyk7CiAgIH0KICAgY2h1bmtfdCAqcHJldiA9IG51bGxwdHI7CgogICBmb3Ig
KHRtcCA9IGNodW5rX2dldF9uZXh0KG9zKTsgdG1wICE9IGNzOyB0bXAgPSBjaHVua19nZXRf
bmV4dCh0bXApKQogICB7CiAgICAgIGNodW5rX2ZsYWdzX3NldCh0bXAsIFBDRl9JTl9PQ19N
U0cpOwoKICAgICAgaWYgKHRtcC0+bGV2ZWwgPT0gY3MtPmxldmVsICsgMSkKICAgICAgewog
ICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9DT0xPTikpCiAgICAgICAgIHsK
ICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9PQ19DT0xPTik7CgogICAgICAg
ICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfV09SRCkgfHwgY2h1bmtfaXNfdG9r
ZW4ocHJldiwgQ1RfVFlQRSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgLy8gTWln
aHQgYmUgYSBuYW1lZCBwYXJhbSwgY2hlY2sgcHJldmlvdXMgYmxvY2sKICAgICAgICAgICAg
ICAgY2h1bmtfdCAqcHAgPSBjaHVua19nZXRfcHJldihwcmV2KTsKCiAgICAgICAgICAgICAg
IGlmICggIHBwICE9IG51bGxwdHIKICAgICAgICAgICAgICAgICAgJiYgcHAtPnR5cGUgIT0g
Q1RfT0NfQ09MT04KICAgICAgICAgICAgICAgICAgJiYgcHAtPnR5cGUgIT0gQ1RfQVJJVEgK
ICAgICAgICAgICAgICAgICAgJiYgcHAtPnR5cGUgIT0gQ1RfQ0FSRVQpCiAgICAgICAgICAg
ICAgIHsKICAgICAgICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUocHJldiwgQ1RfT0NfTVNH
X05BTUUpOwogICAgICAgICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfT0Nf
TVNHX05BTUUpOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgfQog
ICAgICB9CiAgICAgIHByZXYgPSB0bXA7CiAgIH0KfSAvLyBoYW5kbGVfb2NfbWVzc2FnZV9z
ZW5kCgoKc3RhdGljIHZvaWQgaGFuZGxlX29jX2F2YWlsYWJsZShjaHVua190ICpvcykKewog
ICBvcyA9IGNodW5rX2dldF9uZXh0KG9zKTsKCiAgIHdoaWxlIChvcyAhPSBudWxscHRyKQog
ICB7CiAgICAgIGNfdG9rZW5fdCBvcmlnVHlwZSA9IG9zLT50eXBlOwogICAgICBzZXRfY2h1
bmtfdHlwZShvcywgQ1RfT0NfQVZBSUxBQkxFX1ZBTFVFKTsKCiAgICAgIGlmIChvcmlnVHlw
ZSA9PSBDVF9QQVJFTl9DTE9TRSkKICAgICAgewogICAgICAgICBicmVhazsKICAgICAgfQog
ICAgICBvcyA9IGNodW5rX2dldF9uZXh0KG9zKTsKICAgfQp9CgoKc3RhdGljIHZvaWQgaGFu
ZGxlX29jX3Byb3BlcnR5X2RlY2woY2h1bmtfdCAqb3MpCnsKICAgbG9nX3J1bGVfQigibW9k
X3NvcnRfb2NfcHJvcGVydGllcyIpOwoKICAgaWYgKG9wdGlvbnM6Om1vZF9zb3J0X29jX3By
b3BlcnRpZXMoKSkKICAgewogICAgICB0eXBlZGVmIHN0ZDo6dmVjdG9yPGNodW5rX3QgKj4g
Q2h1bmtHcm91cDsKCiAgICAgIGNodW5rX3QgICAgICAgICAgICAgICAgICpuZXh0ICAgICAg
ID0gY2h1bmtfZ2V0X25leHQob3MpOwogICAgICBjaHVua190ICAgICAgICAgICAgICAgICAq
b3Blbl9wYXJlbiA9IG51bGxwdHI7CgogICAgICBzdGQ6OnZlY3RvcjxDaHVua0dyb3VwPiBj
bGFzc19jaHVua3M7ICAgICAgIC8vIGNsYXNzCiAgICAgIHN0ZDo6dmVjdG9yPENodW5rR3Jv
dXA+IHRocmVhZF9jaHVua3M7ICAgICAgLy8gYXRvbWljLCBub25hdG9taWMKICAgICAgc3Rk
Ojp2ZWN0b3I8Q2h1bmtHcm91cD4gcmVhZHdyaXRlX2NodW5rczsgICAvLyByZWFkd3JpdGUs
IHJlYWRvbmx5CiAgICAgIHN0ZDo6dmVjdG9yPENodW5rR3JvdXA+IHJlZl9jaHVua3M7ICAg
ICAgICAgLy8gcmV0YWluLCBjb3B5LCBhc3NpZ24sIHdlYWssIHN0cm9uZywgdW5zYWZlX3Vu
cmV0YWluZWQKICAgICAgc3RkOjp2ZWN0b3I8Q2h1bmtHcm91cD4gZ2V0dGVyX2NodW5rczsg
ICAgICAvLyBnZXR0ZXIKICAgICAgc3RkOjp2ZWN0b3I8Q2h1bmtHcm91cD4gc2V0dGVyX2No
dW5rczsgICAgICAvLyBzZXR0ZXIKICAgICAgc3RkOjp2ZWN0b3I8Q2h1bmtHcm91cD4gbnVs
bGFiaWxpdHlfY2h1bmtzOyAvLyBub25udWxsLCBudWxsYWJsZSwgbnVsbF91bnNwZWNpZmll
ZCwgbnVsbF9yZXNldHRhYmxlCiAgICAgIHN0ZDo6dmVjdG9yPENodW5rR3JvdXA+IG90aGVy
X2NodW5rczsgICAgICAgLy8gYW55IHdvcmRzIG90aGVyIHRoYW4gYWJvdmUKCiAgICAgIGlm
IChjaHVua19pc190b2tlbihuZXh0LCBDVF9QQVJFTl9PUEVOKSkKICAgICAgewogICAgICAg
ICBvcGVuX3BhcmVuID0gbmV4dDsKICAgICAgICAgbmV4dCAgICAgICA9IGNodW5rX2dldF9u
ZXh0KG5leHQpOwoKICAgICAgICAgLyoKICAgICAgICAgICogRGV0ZXJtaW5lIGxvY2F0aW9u
IG9mIHRoZSBwcm9wZXJ0eSBhdHRyaWJ1dGVzCiAgICAgICAgICAqIE5PVEU6IERpZCBub3Qg
ZG8gdGhpcyBpbiB0aGUgY29tYmluZS5jcHAgZG9fc3ltYm9sX2NoZWNrIGFzCiAgICAgICAg
ICAqIEkgd2FzIG5vdCBzdXJlIHdoYXQgdGhlIHJhbWlmaWNhdGlvbnMgb2YgYWRkaW5nIGEg
bmV3IHR5cGUKICAgICAgICAgICogZm9yIGVhY2ggb2YgdGhlIGJlbG93IHR5cGVzIHdvdWxk
IGJlLiBJdCBkaWQgYnJlYWsgc29tZSBpdGVtcwogICAgICAgICAgKiB3aGVuIEkgYXR0ZW1w
dGVkIHRvIGFkZCB0aGVtIHNvIHRoaXMgaXMgbXkgaGFjayBmb3Igbm93LgogICAgICAgICAg
Ki8KICAgICAgICAgd2hpbGUgKG5leHQgIT0gbnVsbHB0ciAmJiBuZXh0LT50eXBlICE9IENU
X1BBUkVOX0NMT1NFKQogICAgICAgICB7CiAgICAgICAgICAgIGlmIChjaHVua19pc190b2tl
bihuZXh0LCBDVF9PQ19QUk9QRVJUWV9BVFRSKSkKICAgICAgICAgICAgewogICAgICAgICAg
ICAgICBpZiAoICBjaHVua19pc19zdHIobmV4dCwgImF0b21pYyIsIDYpCiAgICAgICAgICAg
ICAgICAgIHx8IGNodW5rX2lzX3N0cihuZXh0LCAibm9uYXRvbWljIiwgOSkpCiAgICAgICAg
ICAgICAgIHsKICAgICAgICAgICAgICAgICAgQ2h1bmtHcm91cCBjaHVua0dyb3VwOwogICAg
ICAgICAgICAgICAgICBjaHVua0dyb3VwLnB1c2hfYmFjayhuZXh0KTsKICAgICAgICAgICAg
ICAgICAgdGhyZWFkX2NodW5rcy5wdXNoX2JhY2soY2h1bmtHcm91cCk7CiAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgICAgZWxzZSBpZiAoICBjaHVua19pc19zdHIobmV4dCwgInJl
YWRvbmx5IiwgOCkKICAgICAgICAgICAgICAgICAgICAgICB8fCBjaHVua19pc19zdHIobmV4
dCwgInJlYWR3cml0ZSIsIDkpKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAg
IENodW5rR3JvdXAgY2h1bmtHcm91cDsKICAgICAgICAgICAgICAgICAgY2h1bmtHcm91cC5w
dXNoX2JhY2sobmV4dCk7CiAgICAgICAgICAgICAgICAgIHJlYWR3cml0ZV9jaHVua3MucHVz
aF9iYWNrKGNodW5rR3JvdXApOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGVs
c2UgaWYgKCAgY2h1bmtfaXNfc3RyKG5leHQsICJhc3NpZ24iLCA2KQogICAgICAgICAgICAg
ICAgICAgICAgIHx8IGNodW5rX2lzX3N0cihuZXh0LCAicmV0YWluIiwgNikKICAgICAgICAg
ICAgICAgICAgICAgICB8fCBjaHVua19pc19zdHIobmV4dCwgImNvcHkiLCA0KQogICAgICAg
ICAgICAgICAgICAgICAgIHx8IGNodW5rX2lzX3N0cihuZXh0LCAic3Ryb25nIiwgNikKICAg
ICAgICAgICAgICAgICAgICAgICB8fCBjaHVua19pc19zdHIobmV4dCwgIndlYWsiLCA0KQog
ICAgICAgICAgICAgICAgICAgICAgIHx8IGNodW5rX2lzX3N0cihuZXh0LCAidW5zYWZlX3Vu
cmV0YWluZWQiLCAxNykpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgQ2h1
bmtHcm91cCBjaHVua0dyb3VwOwogICAgICAgICAgICAgICAgICBjaHVua0dyb3VwLnB1c2hf
YmFjayhuZXh0KTsKICAgICAgICAgICAgICAgICAgcmVmX2NodW5rcy5wdXNoX2JhY2soY2h1
bmtHcm91cCk7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgZWxzZSBpZiAoY2h1
bmtfaXNfc3RyKG5leHQsICJnZXR0ZXIiLCA2KSkKICAgICAgICAgICAgICAgewogICAgICAg
ICAgICAgICAgICBDaHVua0dyb3VwIGNodW5rR3JvdXA7CgogICAgICAgICAgICAgICAgICBk
bwogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIGNodW5rR3JvdXAu
cHVzaF9iYWNrKG5leHQpOwogICAgICAgICAgICAgICAgICAgICBuZXh0ID0gY2h1bmtfZ2V0
X25leHQobmV4dCk7CiAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKCAgbmV4dAogICAgICAg
ICAgICAgICAgICAgICAgICAgICYmIG5leHQtPnR5cGUgIT0gQ1RfQ09NTUEKICAgICAgICAg
ICAgICAgICAgICAgICAgICAmJiBuZXh0LT50eXBlICE9IENUX1BBUkVOX0NMT1NFKTsKCiAg
ICAgICAgICAgICAgICAgIG5leHQgPSBuZXh0LT5wcmV2OwoKICAgICAgICAgICAgICAgICAg
Ly8gY292ZXJpdHkgQ0lEIDE2MDk0NgogICAgICAgICAgICAgICAgICBpZiAobmV4dCA9PSBu
dWxscHRyKQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIGJyZWFr
OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGdldHRlcl9jaHVua3Mu
cHVzaF9iYWNrKGNodW5rR3JvdXApOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg
IGVsc2UgaWYgKGNodW5rX2lzX3N0cihuZXh0LCAic2V0dGVyIiwgNikpCiAgICAgICAgICAg
ICAgIHsKICAgICAgICAgICAgICAgICAgQ2h1bmtHcm91cCBjaHVua0dyb3VwOwoKICAgICAg
ICAgICAgICAgICAgZG8KICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAg
ICBjaHVua0dyb3VwLnB1c2hfYmFjayhuZXh0KTsKICAgICAgICAgICAgICAgICAgICAgbmV4
dCA9IGNodW5rX2dldF9uZXh0KG5leHQpOwogICAgICAgICAgICAgICAgICB9IHdoaWxlICgg
IG5leHQKICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBuZXh0LT50eXBlICE9IENUX0NP
TU1BCiAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgbmV4dC0+dHlwZSAhPSBDVF9QQVJF
Tl9DTE9TRSk7CgogICAgICAgICAgICAgICAgICBuZXh0ID0gY2h1bmtfZ2V0X3ByZXYobmV4
dCk7CgogICAgICAgICAgICAgICAgICBpZiAobmV4dCA9PSBudWxscHRyKQogICAgICAgICAg
ICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg
ICB9CiAgICAgICAgICAgICAgICAgIHNldHRlcl9jaHVua3MucHVzaF9iYWNrKGNodW5rR3Jv
dXApOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGVsc2UgaWYgKCAgY2h1bmtf
aXNfc3RyKG5leHQsICJudWxsYWJsZSIsIDgpCiAgICAgICAgICAgICAgICAgICAgICAgfHwg
Y2h1bmtfaXNfc3RyKG5leHQsICJub25udWxsIiwgNykKICAgICAgICAgICAgICAgICAgICAg
ICB8fCBjaHVua19pc19zdHIobmV4dCwgIm51bGxfcmVzZXR0YWJsZSIsIDE1KQogICAgICAg
ICAgICAgICAgICAgICAgIHx8IGNodW5rX2lzX3N0cihuZXh0LCAibnVsbF91bnNwZWNpZmll
ZCIsIDE2KSkKICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBDaHVua0dyb3Vw
IGNodW5rR3JvdXA7CiAgICAgICAgICAgICAgICAgIGNodW5rR3JvdXAucHVzaF9iYWNrKG5l
eHQpOwogICAgICAgICAgICAgICAgICBudWxsYWJpbGl0eV9jaHVua3MucHVzaF9iYWNrKGNo
dW5rR3JvdXApOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGVsc2UgaWYgKGNo
dW5rX2lzX3N0cihuZXh0LCAiY2xhc3MiLCA1KSkKICAgICAgICAgICAgICAgewogICAgICAg
ICAgICAgICAgICBDaHVua0dyb3VwIGNodW5rR3JvdXA7CiAgICAgICAgICAgICAgICAgIGNo
dW5rR3JvdXAucHVzaF9iYWNrKG5leHQpOwogICAgICAgICAgICAgICAgICBjbGFzc19jaHVu
a3MucHVzaF9iYWNrKGNodW5rR3JvdXApOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAg
ICAgIGVsc2UKICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBDaHVua0dyb3Vw
IGNodW5rR3JvdXA7CiAgICAgICAgICAgICAgICAgIGNodW5rR3JvdXAucHVzaF9iYWNrKG5l
eHQpOwogICAgICAgICAgICAgICAgICBvdGhlcl9jaHVua3MucHVzaF9iYWNrKGNodW5rR3Jv
dXApOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBp
ZiAoY2h1bmtfaXNfd29yZChuZXh0KSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBp
ZiAoY2h1bmtfaXNfc3RyKG5leHQsICJjbGFzcyIsIDUpKQogICAgICAgICAgICAgICB7CiAg
ICAgICAgICAgICAgICAgIENodW5rR3JvdXAgY2h1bmtHcm91cDsKICAgICAgICAgICAgICAg
ICAgY2h1bmtHcm91cC5wdXNoX2JhY2sobmV4dCk7CiAgICAgICAgICAgICAgICAgIGNsYXNz
X2NodW5rcy5wdXNoX2JhY2soY2h1bmtHcm91cCk7CiAgICAgICAgICAgICAgIH0KICAgICAg
ICAgICAgICAgZWxzZQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIENodW5r
R3JvdXAgY2h1bmtHcm91cDsKICAgICAgICAgICAgICAgICAgY2h1bmtHcm91cC5wdXNoX2Jh
Y2sobmV4dCk7CiAgICAgICAgICAgICAgICAgIG90aGVyX2NodW5rcy5wdXNoX2JhY2soY2h1
bmtHcm91cCk7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBu
ZXh0ID0gY2h1bmtfZ2V0X25leHQobmV4dCk7CiAgICAgICAgIH0KICAgICAgICAgbG9nX3J1
bGVfQigibW9kX3NvcnRfb2NfcHJvcGVydHlfY2xhc3Nfd2VpZ2h0Iik7CiAgICAgICAgIGlu
dCBjbGFzc193ID0gb3B0aW9uczo6bW9kX3NvcnRfb2NfcHJvcGVydHlfY2xhc3Nfd2VpZ2h0
KCk7CiAgICAgICAgIGxvZ19ydWxlX0IoIm1vZF9zb3J0X29jX3Byb3BlcnR5X3RocmVhZF9z
YWZlX3dlaWdodCIpOwogICAgICAgICBpbnQgdGhyZWFkX3cgPSBvcHRpb25zOjptb2Rfc29y
dF9vY19wcm9wZXJ0eV90aHJlYWRfc2FmZV93ZWlnaHQoKTsKICAgICAgICAgbG9nX3J1bGVf
QigibW9kX3NvcnRfb2NfcHJvcGVydHlfcmVhZHdyaXRlX3dlaWdodCIpOwogICAgICAgICBp
bnQgcmVhZHdyaXRlX3cgPSBvcHRpb25zOjptb2Rfc29ydF9vY19wcm9wZXJ0eV9yZWFkd3Jp
dGVfd2VpZ2h0KCk7CiAgICAgICAgIGxvZ19ydWxlX0IoIm1vZF9zb3J0X29jX3Byb3BlcnR5
X3JlZmVyZW5jZV93ZWlnaHQiKTsKICAgICAgICAgaW50IHJlZl93ID0gb3B0aW9uczo6bW9k
X3NvcnRfb2NfcHJvcGVydHlfcmVmZXJlbmNlX3dlaWdodCgpOwogICAgICAgICBsb2dfcnVs
ZV9CKCJtb2Rfc29ydF9vY19wcm9wZXJ0eV9nZXR0ZXJfd2VpZ2h0Iik7CiAgICAgICAgIGlu
dCBnZXR0ZXJfdyA9IG9wdGlvbnM6Om1vZF9zb3J0X29jX3Byb3BlcnR5X2dldHRlcl93ZWln
aHQoKTsKICAgICAgICAgbG9nX3J1bGVfQigibW9kX3NvcnRfb2NfcHJvcGVydHlfc2V0dGVy
X3dlaWdodCIpOwogICAgICAgICBpbnQgc2V0dGVyX3cgPSBvcHRpb25zOjptb2Rfc29ydF9v
Y19wcm9wZXJ0eV9zZXR0ZXJfd2VpZ2h0KCk7CiAgICAgICAgIGxvZ19ydWxlX0IoIm1vZF9z
b3J0X29jX3Byb3BlcnR5X251bGxhYmlsaXR5X3dlaWdodCIpOwogICAgICAgICBpbnQgbnVs
bGFiaWxpdHlfdyA9IG9wdGlvbnM6Om1vZF9zb3J0X29jX3Byb3BlcnR5X251bGxhYmlsaXR5
X3dlaWdodCgpOwoKICAgICAgICAgLy8KICAgICAgICAgc3RkOjptdWx0aW1hcDxpbnQsIHN0
ZDo6dmVjdG9yPENodW5rR3JvdXA+ID4gc29ydGVkX2NodW5rX21hcDsKICAgICAgICAgc29y
dGVkX2NodW5rX21hcC5pbnNlcnQocGFpcjxpbnQsIHN0ZDo6dmVjdG9yPENodW5rR3JvdXA+
ID4oY2xhc3NfdywgY2xhc3NfY2h1bmtzKSk7CiAgICAgICAgIHNvcnRlZF9jaHVua19tYXAu
aW5zZXJ0KHBhaXI8aW50LCBzdGQ6OnZlY3RvcjxDaHVua0dyb3VwPiA+KHRocmVhZF93LCB0
aHJlYWRfY2h1bmtzKSk7CiAgICAgICAgIHNvcnRlZF9jaHVua19tYXAuaW5zZXJ0KHBhaXI8
aW50LCBzdGQ6OnZlY3RvcjxDaHVua0dyb3VwPiA+KHJlYWR3cml0ZV93LCByZWFkd3JpdGVf
Y2h1bmtzKSk7CiAgICAgICAgIHNvcnRlZF9jaHVua19tYXAuaW5zZXJ0KHBhaXI8aW50LCBz
dGQ6OnZlY3RvcjxDaHVua0dyb3VwPiA+KHJlZl93LCByZWZfY2h1bmtzKSk7CiAgICAgICAg
IHNvcnRlZF9jaHVua19tYXAuaW5zZXJ0KHBhaXI8aW50LCBzdGQ6OnZlY3RvcjxDaHVua0dy
b3VwPiA+KGdldHRlcl93LCBnZXR0ZXJfY2h1bmtzKSk7CiAgICAgICAgIHNvcnRlZF9jaHVu
a19tYXAuaW5zZXJ0KHBhaXI8aW50LCBzdGQ6OnZlY3RvcjxDaHVua0dyb3VwPiA+KHNldHRl
cl93LCBzZXR0ZXJfY2h1bmtzKSk7CiAgICAgICAgIHNvcnRlZF9jaHVua19tYXAuaW5zZXJ0
KHBhaXI8aW50LCBzdGQ6OnZlY3RvcjxDaHVua0dyb3VwPiA+KG51bGxhYmlsaXR5X3csIG51
bGxhYmlsaXR5X2NodW5rcykpOwogICAgICAgICBzb3J0ZWRfY2h1bmtfbWFwLmluc2VydChw
YWlyPGludCwgc3RkOjp2ZWN0b3I8Q2h1bmtHcm91cD4gPihzdGQ6Om51bWVyaWNfbGltaXRz
PGludD46Om1pbigpLCBvdGhlcl9jaHVua3MpKTsKCiAgICAgICAgIGNodW5rX3QgKmN1cnJf
Y2h1bmsgPSBvcGVuX3BhcmVuOwoKICAgICAgICAgZm9yIChtdWx0aW1hcDxpbnQsIHN0ZDo6
dmVjdG9yPENodW5rR3JvdXA+ID46OnJldmVyc2VfaXRlcmF0b3IgaXQgPSBzb3J0ZWRfY2h1
bmtfbWFwLnJiZWdpbigpOyBpdCAhPSBzb3J0ZWRfY2h1bmtfbWFwLnJlbmQoKTsgKytpdCkK
ICAgICAgICAgewogICAgICAgICAgICBzdGQ6OnZlY3RvcjxDaHVua0dyb3VwPiBjaHVua19n
cm91cHMgPSAoKml0KS5zZWNvbmQ7CgogICAgICAgICAgICBmb3IgKGF1dG8gY2h1bmtfZ3Jv
dXAgOiBjaHVua19ncm91cHMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgZm9yIChh
dXRvIGNodW5rIDogY2h1bmtfZ3JvdXApCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAg
ICAgICAgY2h1bmstPm9yaWdfcHJldl9zcCA9IDA7CgogICAgICAgICAgICAgICAgICBpZiAo
Y2h1bmsgIT0gY3Vycl9jaHVuaykKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAg
ICAgICAgICBjaHVua19tb3ZlX2FmdGVyKGNodW5rLCBjdXJyX2NodW5rKTsKICAgICAgICAg
ICAgICAgICAgICAgY3Vycl9jaHVuayA9IGNodW5rOwogICAgICAgICAgICAgICAgICB9CiAg
ICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAg
ICAgICAgICBjdXJyX2NodW5rID0gY2h1bmtfZ2V0X25leHQoY3Vycl9jaHVuayk7CiAgICAg
ICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgLy8gYWRk
IHRoZSBwYXJlbnRoZXNpcwogICAgICAgICAgICAgICBjaHVua190IGVuZGNodW5rOwogICAg
ICAgICAgICAgICBzZXRfY2h1bmtfdHlwZSgmZW5kY2h1bmssIENUX0NPTU1BKTsKICAgICAg
ICAgICAgICAgc2V0X2NodW5rX3BhcmVudCgmZW5kY2h1bmssIGdldF9jaHVua19wYXJlbnRf
dHlwZShjdXJyX2NodW5rKSk7CiAgICAgICAgICAgICAgIGVuZGNodW5rLnN0ciAgICAgICAg
ID0gIiwiOwogICAgICAgICAgICAgICBlbmRjaHVuay5sZXZlbCAgICAgICA9IGN1cnJfY2h1
bmstPmxldmVsOwogICAgICAgICAgICAgICBlbmRjaHVuay5icmFjZV9sZXZlbCA9IGN1cnJf
Y2h1bmstPmJyYWNlX2xldmVsOwogICAgICAgICAgICAgICBlbmRjaHVuay5vcmlnX2xpbmUg
ICA9IGN1cnJfY2h1bmstPm9yaWdfbGluZTsKICAgICAgICAgICAgICAgZW5kY2h1bmsub3Jp
Z19jb2wgICAgPSBjdXJyX2NodW5rLT5vcmlnX2NvbDsKICAgICAgICAgICAgICAgZW5kY2h1
bmsuY29sdW1uICAgICAgPSBjdXJyX2NodW5rLT5vcmlnX2NvbF9lbmQgKyAxOwogICAgICAg
ICAgICAgICBlbmRjaHVuay5mbGFncyAgICAgICA9IGN1cnJfY2h1bmstPmZsYWdzICYgUENG
X0NPUFlfRkxBR1M7CiAgICAgICAgICAgICAgIGNodW5rX2FkZF9hZnRlcigmZW5kY2h1bmss
IGN1cnJfY2h1bmspOwogICAgICAgICAgICAgICBjdXJyX2NodW5rID0gY3Vycl9jaHVuay0+
bmV4dDsKICAgICAgICAgICAgfQogICAgICAgICB9CgogICAgICAgICAvLyBSZW1vdmUgdGhl
IGV4dHJhIGNvbW1hJ3MgdGhhdCB3ZSBkaWQgbm90IG1vdmUKICAgICAgICAgd2hpbGUgKGN1
cnJfY2h1bmsgJiYgY3Vycl9jaHVuay0+dHlwZSAhPSBDVF9QQVJFTl9DTE9TRSkKICAgICAg
ICAgewogICAgICAgICAgICBjaHVua190ICpybV9jaHVuayA9IGN1cnJfY2h1bms7CiAgICAg
ICAgICAgIGN1cnJfY2h1bmsgPSBjaHVua19nZXRfbmV4dChjdXJyX2NodW5rKTsKICAgICAg
ICAgICAgY2h1bmtfZGVsKHJtX2NodW5rKTsKICAgICAgICAgfQogICAgICB9CiAgIH0KICAg
Y2h1bmtfdCAqdG1wID0gY2h1bmtfZ2V0X25leHRfbmNubChvcyk7CgogICBpZiAoY2h1bmtf
aXNfcGFyZW5fb3Blbih0bXApKQogICB7CiAgICAgIHRtcCA9IGNodW5rX2dldF9uZXh0X25j
bmwoY2h1bmtfc2tpcF90b19tYXRjaCh0bXApKTsKICAgfQogICBmaXhfdmFyaWFibGVfZGVm
aW5pdGlvbih0bXApOwp9IC8vIGhhbmRsZV9vY19wcm9wZXJ0eV9kZWNsCgoKc3RhdGljIHZv
aWQgaGFuZGxlX2NzX3NxdWFyZV9zdG10KGNodW5rX3QgKm9zKQp7CiAgIExPR19GVU5DX0VO
VFJZKCk7CgogICBjaHVua190ICpjcyA9IGNodW5rX2dldF9uZXh0KG9zKTsKCiAgIHdoaWxl
IChjcyAhPSBudWxscHRyICYmIGNzLT5sZXZlbCA+IG9zLT5sZXZlbCkKICAgewogICAgICBj
cyA9IGNodW5rX2dldF9uZXh0KGNzKTsKICAgfQoKICAgaWYgKGNzID09IG51bGxwdHIgfHwg
Y3MtPnR5cGUgIT0gQ1RfU1FVQVJFX0NMT1NFKQogICB7CiAgICAgIHJldHVybjsKICAgfQog
ICBzZXRfY2h1bmtfcGFyZW50KG9zLCBDVF9DU19TUV9TVE1UKTsKICAgc2V0X2NodW5rX3Bh
cmVudChjcywgQ1RfQ1NfU1FfU1RNVCk7CgogICBjaHVua190ICp0bXA7CgogICBmb3IgKHRt
cCA9IGNodW5rX2dldF9uZXh0KG9zKTsgdG1wICE9IGNzOyB0bXAgPSBjaHVua19nZXRfbmV4
dCh0bXApKQogICB7CiAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBDVF9DU19TUV9TVE1U
KTsKCiAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX0NPTE9OKSkKICAgICAgewog
ICAgICAgICBzZXRfY2h1bmtfdHlwZSh0bXAsIENUX0NTX1NRX0NPTE9OKTsKICAgICAgfQog
ICB9CgogICB0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKGNzKTsKCiAgIGlmICh0bXAgIT0g
bnVsbHB0cikKICAgewogICAgICBjaHVua19mbGFnc19zZXQodG1wLCBQQ0ZfU1RNVF9TVEFS
VCB8IFBDRl9FWFBSX1NUQVJUKTsKICAgfQp9CgoKc3RhdGljIHZvaWQgaGFuZGxlX2NzX3By
b3BlcnR5KGNodW5rX3QgKmJybykKewogICBMT0dfRlVOQ19FTlRSWSgpOwoKICAgc2V0X3Bh
cmVuX3BhcmVudChicm8sIENUX0NTX1BST1BFUlRZKTsKCiAgIGJvb2wgICAgZGlkX3Byb3Ag
PSBmYWxzZTsKICAgY2h1bmtfdCAqcGMgICAgICA9IGJybzsKCiAgIHdoaWxlICgocGMgPSBj
aHVua19nZXRfcHJldl9uY25sbmkocGMpKSAhPSBudWxscHRyKSAgIC8vIElzc3VlICMyMjc5
CiAgIHsKICAgICAgaWYgKHBjLT5sZXZlbCA9PSBicm8tPmxldmVsKQogICAgICB7CiAgICAg
ICAgIC8vcHJldmVudCBzY2FubmluZyBiYWNrIHBhc3QgJ25ldycgaW4gZXhwcmVzc2lvbnMg
bGlrZSBuZXcgTGlzdDxpbnQ+IHsxLDIsM30KICAgICAgICAgLy8gSXNzdWUgIyAxNjIwLCBV
TkktMjQwOTAuY3MKICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9ORVcpKQog
ICAgICAgICB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CgogICAgICAgICBpZiAo
ICAhZGlkX3Byb3AKICAgICAgICAgICAgJiYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9XT1JE
KSB8fCBjaHVua19pc190b2tlbihwYywgQ1RfVEhJUykpKQogICAgICAgICB7CiAgICAgICAg
ICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9DU19QUk9QRVJUWSk7CiAgICAgICAgICAgIGRp
ZF9wcm9wID0gdHJ1ZTsKICAgICAgICAgfQogICAgICAgICBlbHNlCiAgICAgICAgIHsKICAg
ICAgICAgICAgc2V0X2NodW5rX3BhcmVudChwYywgQ1RfQ1NfUFJPUEVSVFkpOwogICAgICAg
ICAgICBtYWtlX3R5cGUocGMpOwogICAgICAgICB9CgogICAgICAgICBpZiAocGMtPmZsYWdz
LnRlc3QoUENGX1NUTVRfU1RBUlQpKQogICAgICAgICB7CiAgICAgICAgICAgIGJyZWFrOwog
ICAgICAgICB9CiAgICAgIH0KICAgfQp9CgoKc3RhdGljIHZvaWQgaGFuZGxlX2NzX2FycmF5
X3R5cGUoY2h1bmtfdCAqcGMpCnsKICAgY2h1bmtfdCAqcHJldjsKCiAgIGZvciAocHJldiA9
IGNodW5rX2dldF9wcmV2KHBjKTsKICAgICAgICBjaHVua19pc190b2tlbihwcmV2LCBDVF9D
T01NQSk7CiAgICAgICAgcHJldiA9IGNodW5rX2dldF9wcmV2KHByZXYpKQogICB7CiAgICAg
IC8vIGVtcHR5CiAgIH0KCiAgIGlmIChjaHVua19pc190b2tlbihwcmV2LCBDVF9TUVVBUkVf
T1BFTikpCiAgIHsKICAgICAgd2hpbGUgKHBjICE9IHByZXYpCiAgICAgIHsKICAgICAgICAg
c2V0X2NodW5rX3BhcmVudChwYywgQ1RfVFlQRSk7CiAgICAgICAgIHBjID0gY2h1bmtfZ2V0
X3ByZXYocGMpOwogICAgICB9CiAgICAgIHNldF9jaHVua19wYXJlbnQocHJldiwgQ1RfVFlQ
RSk7CiAgIH0KfQoKCnN0YXRpYyB2b2lkIGhhbmRsZV93cmFwKGNodW5rX3QgKnBjKQp7CiAg
IExPR19GVU5DX0VOVFJZKCk7CiAgIGNodW5rX3QgKm9wcCAgPSBjaHVua19nZXRfbmV4dChw
Yyk7CiAgIGNodW5rX3QgKm5hbWUgPSBjaHVua19nZXRfbmV4dChvcHApOwogICBjaHVua190
ICpjbHAgID0gY2h1bmtfZ2V0X25leHQobmFtZSk7CgogICBsb2dfcnVsZV9CKCJzcF9mdW5j
X2NhbGxfcGFyZW4iKTsKICAgbG9nX3J1bGVfQigic3BfY3BwX2Nhc3RfcGFyZW4iKTsKICAg
aWFyZl9lIHBhdiA9IChwYy0+dHlwZSA9PSBDVF9GVU5DX1dSQVApID8KICAgICAgICAgICAg
ICAgIG9wdGlvbnM6OnNwX2Z1bmNfY2FsbF9wYXJlbigpIDoKICAgICAgICAgICAgICAgIG9w
dGlvbnM6OnNwX2NwcF9jYXN0X3BhcmVuKCk7CgogICBsb2dfcnVsZV9CKCJzcF9pbnNpZGVf
ZnBhcmVuIik7CiAgIGxvZ19ydWxlX0IoInNwX2luc2lkZV9wYXJlbl9jYXN0Iik7CiAgIGlh
cmZfZSBhdiA9IChwYy0+dHlwZSA9PSBDVF9GVU5DX1dSQVApID8KICAgICAgICAgICAgICAg
b3B0aW9uczo6c3BfaW5zaWRlX2ZwYXJlbigpIDoKICAgICAgICAgICAgICAgb3B0aW9uczo6
c3BfaW5zaWRlX3BhcmVuX2Nhc3QoKTsKCiAgIGlmICggIGNodW5rX2lzX3Rva2VuKGNscCwg
Q1RfUEFSRU5fQ0xPU0UpCiAgICAgICYmIGNodW5rX2lzX3Rva2VuKG9wcCwgQ1RfUEFSRU5f
T1BFTikKICAgICAgJiYgKGNodW5rX2lzX3Rva2VuKG5hbWUsIENUX1dPUkQpIHx8IGNodW5r
X2lzX3Rva2VuKG5hbWUsIENUX1RZUEUpKSkKICAgewogICAgICBjb25zdCBjaGFyICpwc3Ag
PSAocGF2ICYgSUFSRl9BREQpID8gIiAiIDogIiI7CiAgICAgIGNvbnN0IGNoYXIgKmZzcCA9
IChhdiAmIElBUkZfQUREKSA/ICIgIiA6ICIiOwoKICAgICAgcGMtPnN0ci5hcHBlbmQocHNw
KTsKICAgICAgcGMtPnN0ci5hcHBlbmQoIigiKTsKICAgICAgcGMtPnN0ci5hcHBlbmQoZnNw
KTsKICAgICAgcGMtPnN0ci5hcHBlbmQobmFtZS0+c3RyKTsKICAgICAgcGMtPnN0ci5hcHBl
bmQoZnNwKTsKICAgICAgcGMtPnN0ci5hcHBlbmQoIikiKTsKCiAgICAgIHNldF9jaHVua190
eXBlKHBjLCAocGMtPnR5cGUgPT0gQ1RfRlVOQ19XUkFQKSA/IENUX0ZVTkNUSU9OIDogQ1Rf
VFlQRSk7CgogICAgICBwYy0+b3JpZ19jb2xfZW5kID0gcGMtPm9yaWdfY29sICsgcGMtPmxl
bigpOwoKICAgICAgY2h1bmtfZGVsKG9wcCk7CiAgICAgIGNodW5rX2RlbChuYW1lKTsKICAg
ICAgY2h1bmtfZGVsKGNscCk7CiAgIH0KfSAvLyBoYW5kbGVfd3JhcAoKCnN0YXRpYyB2b2lk
IGhhbmRsZV9wcm90b193cmFwKGNodW5rX3QgKnBjKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7
CiAgIGNodW5rX3QgKm9wcCAgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKICAgY2h1bmtf
dCAqbmFtZSA9IGNodW5rX2dldF9uZXh0X25jbmwob3BwKTsKICAgY2h1bmtfdCAqdG1wICA9
IGNodW5rX2dldF9uZXh0X25jbmwoY2h1bmtfZ2V0X25leHRfbmNubChuYW1lKSk7CiAgIGNo
dW5rX3QgKmNscCAgPSBjaHVua19za2lwX3RvX21hdGNoKG9wcCk7CiAgIGNodW5rX3QgKmNt
YSAgPSBjaHVua19nZXRfbmV4dF9uY25sKGNscCk7CgogICBpZiAoICAhb3BwCiAgICAgIHx8
ICFuYW1lCiAgICAgIHx8ICFjbHAKICAgICAgfHwgIWNtYQogICAgICB8fCAhdG1wCiAgICAg
IHx8IChuYW1lLT50eXBlICE9IENUX1dPUkQgJiYgbmFtZS0+dHlwZSAhPSBDVF9UWVBFKQog
ICAgICB8fCBvcHAtPnR5cGUgIT0gQ1RfUEFSRU5fT1BFTikKICAgewogICAgICByZXR1cm47
CiAgIH0KCiAgIGlmIChjaHVua19pc190b2tlbihjbWEsIENUX1NFTUlDT0xPTikpCiAgIHsK
ICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0ZVTkNfUFJPVE8pOwogICB9CiAgIGVsc2Ug
aWYgKGNodW5rX2lzX3Rva2VuKGNtYSwgQ1RfQlJBQ0VfT1BFTikpCiAgIHsKICAgICAgTE9H
X0ZNVChMRkNOLCAiJXMoJWQpOiAoMTkpIFNFVCBUTyBDVF9GVU5DX0RFRjogb3JpZ19saW5l
IGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xuIiwKICAgICAgICAgICAg
ICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMt
PnRleHQoKSk7CiAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DX0RFRik7CiAgIH0K
ICAgZWxzZQogICB7CiAgICAgIHJldHVybjsKICAgfQogICBzZXRfY2h1bmtfcGFyZW50KG9w
cCwgcGMtPnR5cGUpOwogICBzZXRfY2h1bmtfcGFyZW50KGNscCwgcGMtPnR5cGUpOwoKICAg
c2V0X2NodW5rX3BhcmVudCh0bXAsIENUX1BST1RPX1dSQVApOwoKICAgaWYgKGNodW5rX2lz
X3Rva2VuKHRtcCwgQ1RfUEFSRU5fT1BFTikpCiAgIHsKICAgICAgZml4X2Zjbl9kZWZfcGFy
YW1zKHRtcCk7CiAgIH0KICAgZWxzZQogICB7CiAgICAgIGZpeF9mY25fZGVmX3BhcmFtcyhv
cHApOwogICAgICBzZXRfY2h1bmtfdHlwZShuYW1lLCBDVF9XT1JEKTsKICAgfQogICB0bXAg
PSBjaHVua19za2lwX3RvX21hdGNoKHRtcCk7CgogICBpZiAodG1wKQogICB7CiAgICAgIHNl
dF9jaHVua19wYXJlbnQodG1wLCBDVF9QUk9UT19XUkFQKTsKICAgfQogICAvLyBNYXJrIHJl
dHVybiB0eXBlIChUT0RPOiBtb3ZlIHRvIG93biBmdW5jdGlvbikKICAgdG1wID0gcGM7Cgog
ICB3aGlsZSAoKHRtcCA9IGNodW5rX2dldF9wcmV2X25jbmxuaSh0bXApKSAhPSBudWxscHRy
KSAgIC8vIElzc3VlICMyMjc5CiAgIHsKICAgICAgaWYgKCAgIWNodW5rX2lzX3R5cGUodG1w
KQogICAgICAgICAmJiB0bXAtPnR5cGUgIT0gQ1RfT1BFUkFUT1IKICAgICAgICAgJiYgdG1w
LT50eXBlICE9IENUX1dPUkQKICAgICAgICAgJiYgdG1wLT50eXBlICE9IENUX0FERFIpCiAg
ICAgIHsKICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgc2V0X2NodW5rX3BhcmVudCh0
bXAsIHBjLT50eXBlKTsKICAgICAgbWFrZV90eXBlKHRtcCk7CiAgIH0KfSAvLyBoYW5kbGVf
cHJvdG9fd3JhcAoKCi8qKgogKiBKYXZhIGFzc2VydCBzdGF0ZW1lbnRzIGFyZTogImFzc2Vy
dCBFWFAxIFs6IEVYUDJdIDsiCiAqIE1hcmsgdGhlIHBhcmVudCBvZiB0aGUgY29sb24gYW5k
IHNlbWljb2xvbgogKi8Kc3RhdGljIHZvaWQgaGFuZGxlX2phdmFfYXNzZXJ0KGNodW5rX3Qg
KnBjKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CiAgIGJvb2wgICAgZGlkX2NvbG9uID0gZmFs
c2U7CiAgIGNodW5rX3QgKnRtcCAgICAgID0gcGM7CgogICB3aGlsZSAoKHRtcCA9IGNodW5r
X2dldF9uZXh0KHRtcCkpICE9IG51bGxwdHIpCiAgIHsKICAgICAgaWYgKHRtcC0+bGV2ZWwg
PT0gcGMtPmxldmVsKQogICAgICB7CiAgICAgICAgIGlmICghZGlkX2NvbG9uICYmIGNodW5r
X2lzX3Rva2VuKHRtcCwgQ1RfQ09MT04pKQogICAgICAgICB7CiAgICAgICAgICAgIGRpZF9j
b2xvbiA9IHRydWU7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBwYy0+dHlw
ZSk7CiAgICAgICAgIH0KCiAgICAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX1NF
TUlDT0xPTikpCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVudCh0bXAs
IHBjLT50eXBlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgIH0KICAgICAgfQogICB9
Cn0K
--------------E0C971C11DC220B22925FC86
Content-Type: text/plain; charset=UTF-8;
 name="combine.cpp-2020-04-16-R"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="combine.cpp-2020-04-16-R"

LyoqCiAqIEBmaWxlIGNvbWJpbmUuY3BwCiAqIExhYmVscyB0aGUgY2h1bmtzIGFzIG5lZWRl
ZC4KICoKICogQGF1dGhvciAgQmVuIEdhcmRuZXIKICogQGF1dGhvciAgR3V5IE1hdXJlbCBz
aW5jZSB2ZXJzaW9uIDAuNjIgZm9yIHVuY3J1c3RpZnk0UXQKICogICAgICAgICAgT2N0b2Jl
ciAyMDE1LCAyMDE2CiAqIEBsaWNlbnNlIEdQTCB2MisKICovCgojaW5jbHVkZSAiY29tYmlu
ZS5oIgoKI2luY2x1ZGUgImNodW5rX2xpc3QuaCIKI2luY2x1ZGUgImNvbWJpbmVfbGFiZWxz
LmgiCiNpbmNsdWRlICJDaHVua1N0YWNrLmgiCiNpbmNsdWRlICJlcnJvcl90eXBlcy5oIgoj
aW5jbHVkZSAiZmxhZ19wYXJlbnMuaCIKI2luY2x1ZGUgImxhbmdfcGF3bi5oIgojaW5jbHVk
ZSAibGFuZ3VhZ2VfdG9vbHMuaCIKI2luY2x1ZGUgImxvZ19ydWxlcy5oIgojaW5jbHVkZSAi
bmV3bGluZXMuaCIKI2luY2x1ZGUgInByb3RvdHlwZXMuaCIKI2luY2x1ZGUgInRva2VuaXpl
X2NsZWFudXAuaCIKI2luY2x1ZGUgInVuY19jdHlwZS5oIgojaW5jbHVkZSAidW5jcnVzdGlm
eS5oIgojaW5jbHVkZSAidW5jcnVzdGlmeV90eXBlcy5oIgoKI2luY2x1ZGUgPGNhc3NlcnQ+
CiNpbmNsdWRlIDxjc3RkaW8+CiNpbmNsdWRlIDxjc3RkbGliPgojaW5jbHVkZSA8bGltaXRz
PgojaW5jbHVkZSA8bWFwPgoKdXNpbmcgbmFtZXNwYWNlIHN0ZDsKdXNpbmcgbmFtZXNwYWNl
IHVuY3J1c3RpZnk7CgoKLyoqCiAqIE1hcmsgdGhlIHBhcmVucyBhbmQgY29sb25zIGluOgog
KiAgIGFzbSB2b2xhdGlsZSAoICJ4eCIgOiAieHgiIChsKSwgInl5IihoKSA6IC4uLiAgKTsK
ICoKICogQHBhcmFtIHBjICB0aGUgQ1RfQVNNIGl0ZW0KICovCnN0YXRpYyB2b2lkIGZsYWdf
YXNtKGNodW5rX3QgKnBjKTsKCgovKioKICogQ29tYmluZXMgdHdvIHRva2VucyBpbnRvIHt7
IGFuZCB9fSBpZiBpbnNpZGUgcGFyZW5zIGFuZCBub3RoaW5nIGlzIGJldHdlZW4KICogZWl0
aGVyIHBhaXIuCiAqLwpzdGF0aWMgdm9pZCBjaGVja19kb3VibGVfYnJhY2VfaW5pdChjaHVu
a190ICpibzEpOwoKCi8qKgogKiBXZSBhcmUgb24gYSB0eXBlZGVmLgogKiBJZiB0aGUgbmV4
dCB3b3JkIGlzIG5vdCBlbnVtL3VuaW9uL3N0cnVjdCwgdGhlbiB0aGUgbGFzdCB3b3JkIGJl
Zm9yZSB0aGUKICogbmV4dCAnLCcgb3IgJzsnIG9yICdfX2F0dHJpYnV0ZV9fJyBpcyBhIHR5
cGUuCiAqCiAqIHR5cGVkZWYgW3R5cGUuLi5dIFsqXSB0eXBlIFssIFsqXXR5cGVdIDsKICog
dHlwZWRlZiA8cmV0dXJuIHR5cGU+KFsqXWZ1bmMpKCk7CiAqIHR5cGVkZWYgPHJldHVybiB0
eXBlPihbKl1mdW5jKShwYXJhbXMpOwogKiB0eXBlZGVmIDxyZXR1cm4gdHlwZT4oX19zdGRj
YWxsICpmdW5jKSgpOyBCdWcgIyA2MzMgICAgTVMtc3BlY2lmaWMgZXh0ZW5zaW9uCiAqICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGUgdGhlIGNv
bmZpZy1maWxlICJ0ZXN0L2NvbmZpZy9NUy1jYWxsaW5nX2NvbnZlbnRpb25zLmNmZyIKICog
dHlwZWRlZiA8cmV0dXJuIHR5cGU+ZnVuYyhwYXJhbXMpOwogKiB0eXBlZGVmIDxlbnVtL3N0
cnVjdC91bmlvbj4gW3R5cGVdIFsqXSB0eXBlIFssIFsqXXR5cGVdIDsKICogdHlwZWRlZiA8
ZW51bS9zdHJ1Y3QvdW5pb24+IFt0eXBlXSB7IC4uLiB9IFsqXSB0eXBlIFssIFsqXXR5cGVd
IDsKICovCnN0YXRpYyB2b2lkIGZpeF90eXBlZGVmKGNodW5rX3QgKnBjKTsKCgovKioKICog
V2UgYXJlIG9uIGFuIGVudW0vc3RydWN0L3VuaW9uIHRhZyB0aGF0IGlzIE5PVCBpbnNpZGUg
YSB0eXBlZGVmLgogKiBJZiB0aGVyZSBpcyBhIHsuLi59IGFuZCB3b3JkcyBiZWZvcmUgdGhl
ICc7JywgdGhlbiB0aGV5IGFyZSB2YXJpYWJsZXMuCiAqCiAqIHRhZyB7IC4uLiB9IFsqXSB3
b3JkIFssIFsqXXdvcmRdIDsKICogdGFnIFt3b3JkL3R5cGVdIHsgLi4uIH0gWypdIHdvcmQg
WywgWypdd29yZF0gOwogKiBlbnVtIFt3b3JkL3R5cGUgWzogaW50X3R5cGVdXSB7IC4uLiB9
IFsqXSB3b3JkIFssIFsqXXdvcmRdIDsKICogdGFnIFt3b3JkL3R5cGVdIFt3b3JkXTsgLS0g
dGhpcyBnZXRzIGNhdWdodCBsYXRlci4KICogZmNuKHRhZyBbd29yZC90eXBlXSBbd29yZF0p
CiAqIGEgPSAodGFnIFt3b3JkL3R5cGVdIFsqXSkmYjsKICoKICogUkVWSVNJVDogc2hvdWxk
IHRoaXMgYmUgY29uc29saWRhdGVkIHdpdGggdGhlIHR5cGVkZWYgY29kZT8KICovCnN0YXRp
YyB2b2lkIGZpeF9lbnVtX3N0cnVjdF91bmlvbihjaHVua190ICpwYyk7CgoKLyoqCiAqIENo
ZWNrcyB0byBzZWUgaWYgdGhlIGN1cnJlbnQgcGFyZW4gaXMgcGFydCBvZiBhIGNhc3QuCiAq
IFdlIGFscmVhZHkgdmVyaWZpZWQgdGhhdCB0aGlzIGRvZXNuJ3QgZm9sbG93IGZ1bmN0aW9u
LCBUWVBFLCBJRiwgRk9SLAogKiBTV0lUQ0gsIG9yIFdISUxFIGFuZCBpcyBmb2xsb3dlZCBi
eSBXT1JELCBUWVBFLCBTVFJVQ1QsIEVOVU0sIG9yIFVOSU9OLgogKgogKiBAcGFyYW0gc3Rh
cnQgIFBvaW50ZXIgdG8gdGhlIG9wZW4gcGFyZW4KICovCnN0YXRpYyB2b2lkIGZpeF9jYXN0
cyhjaHVua190ICpwYyk7CgoKLyoqCiAqIENUX1RZUEVfQ0FTVCBmb2xsb3dzIHRoaXMgcGF0
dGVybjoKICogZHluYW1pY19jYXN0PC4uLj4oLi4uKQogKgogKiBNYXJrIGV2ZXJ5dGhpbmcg
YmV0d2VlbiB0aGUgPD4gYXMgYSB0eXBlIGFuZCBzZXQgdGhlIHBhcmVuIHBhcmVudAogKi8K
c3RhdGljIHZvaWQgZml4X3R5cGVfY2FzdChjaHVua190ICpwYyk7CgoKc3RhdGljIHZvaWQg
cHJvY2Vzc19yZXR1cm5zKHZvaWQpOwoKCi8qKgogKiBQcm9jZXNzZXMgYSByZXR1cm4gc3Rh
dGVtZW50LCBsYWJlbGluZyB0aGUgcGFyZW5zIGFuZCBtYXJraW5nIHRoZSBwYXJlbnQuCiAq
IE1heSByZW1vdmUgb3IgYWRkIHBhcmVucyBhcm91bmQgdGhlIHJldHVybiBzdGF0ZW1lbnQK
ICoKICogQHBhcmFtIHBjICBQb2ludGVyIHRvIHRoZSByZXR1cm4gY2h1bmsKICovCnN0YXRp
YyBjaHVua190ICpwcm9jZXNzX3JldHVybihjaHVua190ICpwYyk7CgoKLyoqCiAqIFRPRE86
IGFkZCBkb2MgY210CiAqCiAqLwpzdGF0aWMgcGNmX2ZsYWdzX3QgbWFya193aGVyZV9jaHVu
ayhjaHVua190ICpwYywgY190b2tlbl90IHBhcmVudF90eXBlLCBwY2ZfZmxhZ3NfdCBmbGFn
cyk7CgoKLyoqCiAqIFdlJ3JlIG9uIGEgJ2NsYXNzJyBvciAnc3RydWN0Jy4KICogU2NhbiBm
b3IgQ1RfRlVOQ1RJT04gd2l0aCBhIHN0cmluZyB0aGF0IG1hdGNoZXMgcGNsYXNzLT5zdHIK
ICovCnN0YXRpYyB2b2lkIG1hcmtfY2xhc3NfY3RvcihjaHVua190ICpwY2xhc3MpOwoKCnN0
YXRpYyB2b2lkIG1hcmtfY3BwX2NvbnN0cnVjdG9yKGNodW5rX3QgKnBjKTsKCgovKioKICog
IEp1c3QgaGl0IGFuIGFzc2lnbi4gR28gYmFja3dhcmRzIHVudGlsIHdlIGhpdCBhbiBvcGVu
IGJyYWNlL3BhcmVuL3NxdWFyZSBvcgogKiBzZW1pY29sb24gKFRPRE86IG90aGVyIGxpbWl0
ZXI/KSBhbmQgbWFyayBhcyBhIExWYWx1ZS4KICovCnN0YXRpYyB2b2lkIG1hcmtfbHZhbHVl
KGNodW5rX3QgKnBjKTsKCgovKioKICogV2UgYXJlIG9uIGEgd29yZCBmb2xsb3dlZCBieSBh
IGFuZ2xlIG9wZW4gd2hpY2ggaXMgcGFydCBvZiBhIHRlbXBsYXRlLgogKiBJZiB0aGUgYW5n
bGUgY2xvc2UgaXMgZm9sbG93ZWQgYnkgYSBvcGVuIHBhcmVuLCB0aGVuIHdlIGFyZSBvbiBh
IHRlbXBsYXRlCiAqIGZ1bmN0aW9uIGRlZiBvciBhIHRlbXBsYXRlIGZ1bmN0aW9uIGNhbGw6
CiAqICAgVmVjdG9yMjxmbG9hdD4oLi4uKSBbOiAuLi5bLCAuLi5dXSB7IC4uLiB9CiAqIE9y
IHdlIGNvdWxkIGJlIG9uIGEgdmFyaWFibGUgZGVmIGlmIGl0J3MgZm9sbG93ZWQgYnkgYSB3
b3JkOgogKiAgIFJlbmRlcmVyPHJnYjMyPiByZW5kOwogKi8Kc3RhdGljIHZvaWQgbWFya190
ZW1wbGF0ZV9mdW5jKGNodW5rX3QgKnBjLCBjaHVua190ICpwY19uZXh0KTsKCgovKioKICog
SnVzdCBtYXJrIGV2ZXJ5IENUX1dPUkQgdW50aWwgYSBzZW1pY29sb24gYXMgQ1RfU1FMX1dP
UkQuCiAqIEFkanVzdCB0aGUgbGV2ZWxzIGlmIHBjIGlzIENUX1NRTF9CRUdJTgogKi8Kc3Rh
dGljIHZvaWQgbWFya19leGVjX3NxbChjaHVua190ICpwYyk7CgoKLyoqCiAqIFByb2Nlc3Mg
YW4gT2JqQyAnY2xhc3MnCiAqIHBjIGlzIHRoZSBjaHVuayBhZnRlciAnQGltcGxlbWVudGF0
aW9uJyBvciAnQGludGVyZmFjZScgb3IgJ0Bwcm90b2NvbCcuCiAqIENoYW5nZSBjb2xvbnMs
IGV0Yy4gUHJvY2Vzc2VzIHN0dWZmIHVudGlsICdAZW5kJy4KICogU2tpcHMgYW55dGhpbmcg
aW4gYnJhY2VzLgogKi8Kc3RhdGljIHZvaWQgaGFuZGxlX29jX2NsYXNzKGNodW5rX3QgKnBj
KTsKCgovKioKICogIE1hcmsgT2JqZWN0aXZlLUMgYmxvY2tzIChha2EgbGFtYmRhcyBvciBj
bG9zdXJlcykKICogIFRoZSBzeW50YXggYW5kIHVzYWdlIGlzIGV4YWN0bHkgbGlrZSBDIGZ1
bmN0aW9uIHBvaW50ZXJzCiAqICBidXQgaW5zdGVhZCBvZiBhbiBhc3RlcmlzayB0aGV5IGhh
dmUgYSBjYXJldCBhcyBwb2ludGVyIHN5bWJvbC4KICogIEFsdGhvdWdoIGl0IG1heSBsb29r
IGV4cGVuc2l2ZSB0aGlzIGZ1bmN0aW9ucyBpcyBvbmx5IHRyaWdnZXJlZAogKiAgb24gYXBw
ZWFyYW5jZSBvZiBhbiBPQ19CTE9DS19DQVJFVCBmb3IgTEFOR19PQy4KICogIHJlcGVhdCgx
MCwgXnsgcHV0YygnMCcrZCk7IH0pOwogKiAgdHlwZWRlZiB2b2lkIChed29ya0Jsa190KSh2
b2lkKTsKICoKICogQHBhcmFtIHBjICBwb2ludHMgdG8gdGhlICdeJwogKi8Kc3RhdGljIHZv
aWQgaGFuZGxlX29jX2Jsb2NrX2xpdGVyYWwoY2h1bmtfdCAqcGMpOwoKCi8qKgogKiBNYXJr
IE9iamVjdGl2ZS1DIGJsb2NrIHR5cGVzLgogKiBUaGUgc3ludGF4IGFuZCB1c2FnZSBpcyBl
eGFjdGx5IGxpa2UgQyBmdW5jdGlvbiBwb2ludGVycwogKiBidXQgaW5zdGVhZCBvZiBhbiBh
c3RlcmlzayB0aGV5IGhhdmUgYSBjYXJldCBhcyBwb2ludGVyIHN5bWJvbC4KICogIHR5cGVk
ZWYgdm9pZCAoXndvcmtCbGtfdCkodm9pZCk7CiAqICBjb25zdCBjaGFyICogKF53b3JrVmFy
KSh2b2lkKTsKICogIC0odm9pZClGb286KHZvaWQoXikoKSlibGsgeyB9CiAqCiAqIFRoaXMg
aXMgdHJpZ2dlcmVkIHdoZW4gdGhlIHNlcXVlbmNlICcoJyAnXicgaXMgZm91bmQuCiAqCiAq
IEBwYXJhbSBwYyAgcG9pbnRzIHRvIHRoZSAnXicKICovCnN0YXRpYyB2b2lkIGhhbmRsZV9v
Y19ibG9ja190eXBlKGNodW5rX3QgKnBjKTsKCgovKioKICogUHJvY2VzcyBhbiBPYmpDIG1l
c3NhZ2Ugc3BlYy9kZWMKICoKICogU3BlY3M6CiAqIC0odm9pZCkgZm9vIEFSR1M7CiAqCiAq
IERlY2xhcmF0aW9uOgogKiAtKHZvaWQpIGZvbyBBUkdTIHsgIH0KICoKICogTEFCRUwgOiAo
QVJHVFlQRSkgQVJHTkFNRQogKgogKiBBUkdTIGlzICc6IChBUkdUWVBFKSBBUkdOQU1FIFtN
T1JFQVJHUy4uLl0nCiAqIE1PUkVBUkdTIGlzICcgWyBMQUJFTF0gOiAoQVJHVFlQRSkgQVJH
TkFNRSAnCiAqIC0odm9pZCkgZm9vOiAoaW50KSBhcmc6IHsgIH0KICogLSh2b2lkKSBmb286
IChpbnQpIGFyZzogeyAgfQogKiAtKHZvaWQpIGluc2VydE9iamVjdDooaWQpYW5PYmplY3Qg
YXRJbmRleDooaW50KWluZGV4CiAqLwpzdGF0aWMgdm9pZCBoYW5kbGVfb2NfbWVzc2FnZV9k
ZWNsKGNodW5rX3QgKnBjKTsKCgovKioKICogUHJvY2VzcyBhbiBPYmpDIG1lc3NhZ2Ugc2Vu
ZCBzdGF0ZW1lbnQ6CiAqIFsgY2xhc3MgZnVuYzogdmFsMSBuYW1lMjogdmFsMiBuYW1lMzog
dmFsM10gOyAvLyBuYW1lZCBwYXJhbXMKICogWyBjbGFzcyBmdW5jOiB2YWwxICAgICAgOiB2
YWwyICAgICAgOiB2YWwzXSA7IC8vIHVubmFtZWQgcGFyYW1zCiAqIFsgY2xhc3MgPHByb3Rv
PiBzZWxmIG1ldGhvZCBdIDsgLy8gd2l0aCBwcm90b2NvbAogKiBbW05TTXV0YWJsZVN0cmlu
ZyBhbGxvY10gaW5pdFdpdGhTdHJpbmc6IEAiIiBdIC8vIGNsYXNzIGZyb20gbXNnCiAqIFtm
dW5jKGEsYixjKSBsYXN0T2JqZWN0IF0gLy8gY2xhc3MgZnJvbSBmdW5jCiAqCiAqIE1haW5s
eSBmaW5kIHRoZSBtYXRjaGluZyAnXScgYW5kICc7JyBhbmQgbWFyayB0aGUgY29sb25zLgog
KgogKiBAcGFyYW0gcGMgIHBvaW50cyB0byB0aGUgb3BlbiBzcXVhcmUgJ1snCiAqLwpzdGF0
aWMgdm9pZCBoYW5kbGVfb2NfbWVzc2FnZV9zZW5kKGNodW5rX3QgKnBjKTsKCgovLyEgUHJv
Y2VzcyBAUHJvcGVydHkgdmFsdWVzIGFuZCByZS1hcnJhbmdlIHRoZW0gaWYgbmVjZXNzYXJ5
CnN0YXRpYyB2b2lkIGhhbmRsZV9vY19wcm9wZXJ0eV9kZWNsKGNodW5rX3QgKnBjKTsKCi8v
ISBQcm9jZXNzIEBhdmFpbGFibGUgYW5ub3RhdGlvbgpzdGF0aWMgdm9pZCBoYW5kbGVfb2Nf
YXZhaWxhYmxlKGNodW5rX3QgKnBjKTsKCi8qKgogKiBQcm9jZXNzIGEgdHlwZSB0aGF0IGlz
IGVuY2xvc2VkIGluIHBhcmVucyBpbiBtZXNzYWdlIGRlY2xhcmF0aW9ucy4KICogVE9ETzog
aGFuZGxlIGJsb2NrIHR5cGVzLCB3aGljaCBnZXQgc3BlY2lhbCBmb3JtYXR0aW5nCiAqCiAq
IEBwYXJhbSBwYyAgcG9pbnRzIHRvIHRoZSBvcGVuIHBhcmVuCiAqCiAqIEByZXR1cm4gdGhl
IGNodW5rIGFmdGVyIHRoZSB0eXBlCiAqLwpzdGF0aWMgY2h1bmtfdCAqaGFuZGxlX29jX21k
X3R5cGUoY2h1bmtfdCAqcGFyZW5fb3BlbiwgY190b2tlbl90IHB0eXBlLCBwY2ZfZmxhZ3Nf
dCBmbGFncywgYm9vbCAmZGlkX2l0KTsKCi8qKgogKiBQcm9jZXNzIGFuIEMjIFtdIHRoaW5n
eToKICogICAgW2Fzc2VtYmx5OiB4eHhdCiAqICAgIFtBdHRyaWJ1dGVVc2FnZSgpXQogKiAg
ICBbQFhdCiAqCiAqIFNldCB0aGUgbmV4dCBjaHVuayB0byBhIHN0YXRlbWVudCBzdGFydCBh
ZnRlciB0aGUgY2xvc2UgJ10nCiAqCiAqIEBwYXJhbSBwYyAgcG9pbnRzIHRvIHRoZSBvcGVu
IHNxdWFyZSAnWycKICovCnN0YXRpYyB2b2lkIGhhbmRsZV9jc19zcXVhcmVfc3RtdChjaHVu
a190ICpwYyk7CgoKLyoqCiAqIFdlIGFyZSBvbiBhIGJyYWNlIG9wZW4gdGhhdCBpcyBwcmVj
ZWRlZCBieSBhIHdvcmQgb3Igc3F1YXJlIGNsb3NlLgogKiBTZXQgdGhlIGJyYWNlIHBhcmVu
dCB0byBDVF9DU19QUk9QRVJUWSBhbmQgZmluZCB0aGUgZmlyc3QgaXRlbSBpbiB0aGUKICog
cHJvcGVydHkgYW5kIHNldCBpdHMgcGFyZW50LCB0b28uCiAqLwpzdGF0aWMgdm9pZCBoYW5k
bGVfY3NfcHJvcGVydHkoY2h1bmtfdCAqcGMpOwoKCi8qKgogKiBXZSBoaXQgYSAnXScgZm9s
bG93ZWQgYnkgYSBXT1JELiBUaGlzIG1heSBiZSBhIG11bHRpZGltZW5zaW9uYWwgYXJyYXkg
dHlwZS4KICogRXhhbXBsZTogaW50WywsXSB4OwogKiBJZiB0aGVyZSBpcyBub3RoaW5nIGJ1
dCBjb21tYXMgYmV0d2VlbiB0aGUgb3BlbiBhbmQgY2xvc2UsIHRoZW4gbWFyayBpdC4KICov
CnN0YXRpYyB2b2lkIGhhbmRsZV9jc19hcnJheV90eXBlKGNodW5rX3QgKnBjKTsKCgovKioK
ICogV2UgYXJlIG9uIHRoZSBDKysgJ3RlbXBsYXRlJyBrZXl3b3JkLgogKiBXaGF0IGZvbGxv
d3Mgc2hvdWxkIGJlIHRoZSBmb2xsb3dpbmc6CiAqCiAqIHRlbXBsYXRlIDxjbGFzcyBpZGVu
dGlmaWVyPiBmdW5jdGlvbl9kZWNsYXJhdGlvbjsKICogdGVtcGxhdGUgPHR5cGVuYW1lIGlk
ZW50aWZpZXI+IGZ1bmN0aW9uX2RlY2xhcmF0aW9uOwogKiB0ZW1wbGF0ZSA8Y2xhc3MgaWRl
bnRpZmllcj4gY2xhc3MgY2xhc3NfZGVjbGFyYXRpb247CiAqIHRlbXBsYXRlIDx0eXBlbmFt
ZSBpZGVudGlmaWVyPiBjbGFzcyBjbGFzc19kZWNsYXJhdGlvbjsKICoKICogQ2hhbmdlIHRo
ZSAnY2xhc3MnIGluc2lkZSB0aGUgPD4gdG8gQ1RfVFlQRS4KICogU2V0IHRoZSBwYXJlbnQg
dG8gdGhlIGNsYXNzIGFmdGVyIHRoZSA8PiB0byBDVF9URU1QTEFURS4KICogU2V0IHRoZSBw
YXJlbnQgb2YgdGhlIHNlbWljb2xvbiB0byBDVF9URU1QTEFURS4KICovCnN0YXRpYyB2b2lk
IGhhbmRsZV9jcHBfdGVtcGxhdGUoY2h1bmtfdCAqcGMpOwoKCi8qKgogKiBWZXJpZnkgYW5k
IHRoZW4gbWFyayBDKysgbGFtYmRhIGV4cHJlc3Npb25zLgogKiBUaGUgZXhwZWN0ZWQgZm9y
bWF0IGlzICdbLi4uXSguLi4pey4uLn0nIG9yICdbLi4uXSguLi4pIC0+IHR5cGUgey4uLn0n
CiAqIHNxX28gaXMgJ1snIENUX1NRVUFSRV9PUEVOIG9yICdbXScgQ1RfVFNRVUFSRQogKiBT
cGxpdCB0aGUgJ1tdJyBzbyB3ZSBjYW4gY29udHJvbCB0aGUgc3BhY2UKICovCnN0YXRpYyB2
b2lkIGhhbmRsZV9jcHBfbGFtYmRhKGNodW5rX3QgKnBjKTsKCgovKioKICogV2UgYXJlIG9u
IHRoZSBEICd0ZW1wbGF0ZScga2V5d29yZC4KICogV2hhdCBmb2xsb3dzIHNob3VsZCBiZSB0
aGUgZm9sbG93aW5nOgogKgogKiB0ZW1wbGF0ZSBOQU1FICggVFlQRUxJU1QgKSB7IEJPRFkg
fQogKgogKiBTZXQgdGhlIHBhcmVudCBvZiBOQU1FIHRvIHRlbXBsYXRlLCBjaGFuZ2UgTkFN
RSB0byBDVF9UWVBFLgogKiBTZXQgdGhlIHBhcmVudCBvZiB0aGUgcGFyZW5zIGFuZCBicmFj
ZXMgdG8gQ1RfVEVNUExBVEUuCiAqIFNjYW4gdGhlIGJvZHkgZm9yIGVhY2ggdHlwZSBpbiBU
WVBFTElTVCBhbmQgY2hhbmdlIHRoZSB0eXBlIHRvIENUX1RZUEUuCiAqLwpzdGF0aWMgdm9p
ZCBoYW5kbGVfZF90ZW1wbGF0ZShjaHVua190ICpwYyk7CgoKLyoqCiAqIEEgZnVuYyB3cmFw
IGNodW5rIGFuZCB3aGF0IGZvbGxvd3Mgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYSBmdW5jdGlv
biBuYW1lLgogKiBDcmVhdGUgbmV3IHRleHQgZm9yIHRoZSBjaHVuayBhbmQgY2FsbCBpdCBh
IENUX0ZVTkNUSU9OLgogKgogKiBBIHR5cGUgd3JhcCBjaHVuayBhbmQgd2hhdCBmb2xsb3dz
IHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgc2ltcGxlIHR5cGUuCiAqIENyZWF0ZSBuZXcgdGV4
dCBmb3IgdGhlIGNodW5rIGFuZCBjYWxsIGl0IGEgQ1RfVFlQRS4KICovCnN0YXRpYyB2b2lk
IGhhbmRsZV93cmFwKGNodW5rX3QgKnBjKTsKCgovKioKICogQSBwcm90byB3cmFwIGNodW5r
IGFuZCB3aGF0IGZvbGxvd3Mgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYSBmdW5jdGlvbiBwcm90
by4KICoKICogUkVUVFlQRSBQUk9UT19XUkFQKCBOQU1FLCBQQVJBTVMgKTsgb3IgUkVUVFlQ
RSBQUk9UT19XUkFQKCBOQU1FLCAoUEFSQU1TKSApOwogKiBSRVRUWVBFIGdldHMgY2hhbmdl
ZCB3aXRoIG1ha2VfdHlwZSgpLgogKiBQUk9UT19XUkFQIGlzIG1hcmtlZCBhcyBDVF9GVU5D
X1BST1RPIG9yIENUX0ZVTkNfREVGLgogKiBOQU1FIGlzIG1hcmtlZCBhcyBDVF9XT1JELgog
KiBQQVJBTVMgaXMgYWxsIG1hcmtlZCBhcyBwcm90b3R5cGUgcGFyYW1ldGVycy4KICovCnN0
YXRpYyB2b2lkIGhhbmRsZV9wcm90b193cmFwKGNodW5rX3QgKnBjKTsKCgpzdGF0aWMgYm9v
bCBpc19vY19ibG9jayhjaHVua190ICpwYyk7CgoKLyoqCiAqIEphdmEgYXNzZXJ0IHN0YXRl
bWVudHMgYXJlOiAiYXNzZXJ0IEVYUDEgWzogRVhQMl0gOyIKICogTWFyayB0aGUgcGFyZW50
IG9mIHRoZSBjb2xvbiBhbmQgc2VtaWNvbG9uCiAqLwpzdGF0aWMgdm9pZCBoYW5kbGVfamF2
YV9hc3NlcnQoY2h1bmtfdCAqcGMpOwoKCi8qKgogKiBQYXJzZSBvZmYgdGhlIHR5cGVzIGlu
IHRoZSBEIHRlbXBsYXRlIGFyZ3MsIGFkZHMgdG8gY3MKICogcmV0dXJucyB0aGUgY2xvc2Vf
cGFyZW4KICovCnN0YXRpYyBjaHVua190ICpnZXRfZF90ZW1wbGF0ZV90eXBlcyhDaHVua1N0
YWNrICZjcywgY2h1bmtfdCAqb3Blbl9wYXJlbik7CgoKc3RhdGljIGJvb2wgY2h1bmtzdGFj
a19tYXRjaChDaHVua1N0YWNrICZjcywgY2h1bmtfdCAqcGMpOwoKCnZvaWQgbWFrZV90eXBl
KGNodW5rX3QgKnBjKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CgogICBpZiAocGMgIT0gbnVs
bHB0cikKICAgewogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1dPUkQpKQogICAg
ICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9UWVBFKTsKICAgICAgfQogICAg
ICBlbHNlIGlmICggICggIGNodW5rX2lzX3N0YXIocGMpCiAgICAgICAgICAgICAgICAgfHwg
Y2h1bmtfaXNfbXNyZWYocGMpCiAgICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfbnVsbGFi
bGUocGMpKQogICAgICAgICAgICAgICYmIGNodW5rX2lzX3R5cGUocGMtPnByZXYpKSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElzc3VlICMgMjY0MAogICAgICB7CiAgICAg
ICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9QVFJfVFlQRSk7CiAgICAgIH0KICAgICAgZWxz
ZSBpZiAoICBjaHVua19pc19hZGRyKHBjKQogICAgICAgICAgICAgICYmICFjaHVua19pc190
b2tlbihwYy0+cHJldiwgQ1RfU1FVQVJFX09QRU4pKSAgICAgICAgICAgIC8vIElzc3VlICMg
MjE2NgogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9CWVJFRik7CiAg
ICAgIH0KICAgfQp9CgoKdm9pZCBmbGFnX3NlcmllcyhjaHVua190ICpzdGFydCwgY2h1bmtf
dCAqZW5kLCBwY2ZfZmxhZ3NfdCBzZXRfZmxhZ3MsIHBjZl9mbGFnc190IGNscl9mbGFncywg
c2NvcGVfZSBuYXYpCnsKICAgTE9HX0ZVTkNfRU5UUlkoKTsKCiAgIHdoaWxlIChzdGFydCAh
PSBudWxscHRyICYmIHN0YXJ0ICE9IGVuZCkKICAgewogICAgICBjaHVua19mbGFnc191cGQo
c3RhcnQsIGNscl9mbGFncywgc2V0X2ZsYWdzKTsKCiAgICAgIHN0YXJ0ID0gY2h1bmtfZ2V0
X25leHQoc3RhcnQsIG5hdik7CgogICAgICBpZiAoc3RhcnQgPT0gbnVsbHB0cikKICAgICAg
ewogICAgICAgICByZXR1cm47CiAgICAgIH0KICAgfQoKICAgaWYgKGVuZCAhPSBudWxscHRy
KQogICB7CiAgICAgIGNodW5rX2ZsYWdzX3VwZChlbmQsIGNscl9mbGFncywgc2V0X2ZsYWdz
KTsKICAgfQp9CgoKY2h1bmtfdCAqc2V0X3BhcmVuX3BhcmVudChjaHVua190ICpzdGFydCwg
Y190b2tlbl90IHBhcmVudCkKewogICBMT0dfRlVOQ19FTlRSWSgpOwogICBjaHVua190ICpl
bmQ7CgogICBlbmQgPSBjaHVua19za2lwX3RvX21hdGNoKHN0YXJ0LCBzY29wZV9lOjpQUkVQ
Uk9DKTsKCiAgIGlmIChlbmQgIT0gbnVsbHB0cikKICAgewogICAgICBMT0dfRk1UKExGTFBB
UkVOLCAiJXMoJWQpOiAlenU6JXp1ICclcycgYW5kICV6dTolenUgJyVzJyB0eXBlIGlzICVz
LCBwYXJlbnRfdHlwZSBpcyAlcyIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9f
LCBzdGFydC0+b3JpZ19saW5lLCBzdGFydC0+b3JpZ19jb2wsIHN0YXJ0LT50ZXh0KCksCiAg
ICAgICAgICAgICAgZW5kLT5vcmlnX2xpbmUsIGVuZC0+b3JpZ19jb2wsIGVuZC0+dGV4dCgp
LAogICAgICAgICAgICAgIGdldF90b2tlbl9uYW1lKHN0YXJ0LT50eXBlKSwgZ2V0X3Rva2Vu
X25hbWUocGFyZW50KSk7CiAgICAgIGxvZ19mdW5jX3N0YWNrX2lubGluZShMRkxQQVJFTik7
CiAgICAgIHNldF9jaHVua19wYXJlbnQoc3RhcnQsIHBhcmVudCk7CiAgICAgIHNldF9jaHVu
a19wYXJlbnQoZW5kLCBwYXJlbnQpOwogICB9CiAgIExPR19GTVQoTEZMUEFSRU4sICIlcygl
ZCk6XG4iLCBfX2Z1bmNfXywgX19MSU5FX18pOwogICByZXR1cm4oY2h1bmtfZ2V0X25leHRf
bmNubChlbmQsIHNjb3BlX2U6OlBSRVBST0MpKTsKfQoKCnN0YXRpYyB2b2lkIGZsYWdfYXNt
KGNodW5rX3QgKnBjKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CgogICBjaHVua190ICp0bXAg
PSBjaHVua19nZXRfbmV4dF9uY25sKHBjLCBzY29wZV9lOjpQUkVQUk9DKTsKCiAgIGlmICgh
Y2h1bmtfaXNfdG9rZW4odG1wLCBDVF9RVUFMSUZJRVIpKQogICB7CiAgICAgIHJldHVybjsK
ICAgfQogICBjaHVua190ICpwbyA9IGNodW5rX2dldF9uZXh0X25jbmwodG1wLCBzY29wZV9l
OjpQUkVQUk9DKTsKCiAgIGlmICghY2h1bmtfaXNfcGFyZW5fb3BlbihwbykpCiAgIHsKICAg
ICAgcmV0dXJuOwogICB9CiAgIGNodW5rX3QgKmVuZCA9IGNodW5rX3NraXBfdG9fbWF0Y2go
cG8sIHNjb3BlX2U6OlBSRVBST0MpOwoKICAgaWYgKGVuZCA9PSBudWxscHRyKQogICB7CiAg
ICAgIHJldHVybjsKICAgfQogICBzZXRfY2h1bmtfcGFyZW50KHBvLCBDVF9BU00pOwogICBz
ZXRfY2h1bmtfcGFyZW50KGVuZCwgQ1RfQVNNKTsKCiAgIGZvciAoICB0bXAgPSBjaHVua19n
ZXRfbmV4dF9uY25sKHBvLCBzY29wZV9lOjpQUkVQUk9DKTsKICAgICAgICAgIHRtcCAhPSBu
dWxscHRyCiAgICAgICAmJiB0bXAgIT0gZW5kOwogICAgICAgICAgdG1wID0gY2h1bmtfZ2V0
X25leHRfbmNubCh0bXAsIHNjb3BlX2U6OlBSRVBST0MpKQogICB7CiAgICAgIGlmIChjaHVu
a19pc190b2tlbih0bXAsIENUX0NPTE9OKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtf
dHlwZSh0bXAsIENUX0FTTV9DT0xPTik7CiAgICAgIH0KICAgICAgZWxzZSBpZiAoY2h1bmtf
aXNfdG9rZW4odG1wLCBDVF9EQ19NRU1CRVIpKQogICAgICB7CiAgICAgICAgIC8vIGlmIHRo
ZXJlIGlzIGEgc3RyaW5nIG9uIGJvdGggc2lkZXMsIHRoZW4gdGhpcyBpcyB0d28gQVNNX0NP
TE9OcwogICAgICAgICBpZiAoICBjaHVua19pc190b2tlbihjaHVua19nZXRfbmV4dF9uY25s
KHRtcCwgc2NvcGVfZTo6UFJFUFJPQyksIENUX1NUUklORykKICAgICAgICAgICAgJiYgY2h1
bmtfaXNfdG9rZW4oY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHRtcCwgc2NvcGVfZTo6UFJFUFJP
QyksIENUX1NUUklORykpIC8vIElzc3VlICMyMjc5CiAgICAgICAgIHsKICAgICAgICAgICAg
Y2h1bmtfdCBuYzsKCiAgICAgICAgICAgIG5jID0gKnRtcDsKCiAgICAgICAgICAgIHRtcC0+
c3RyLnJlc2l6ZSgxKTsKICAgICAgICAgICAgdG1wLT5vcmlnX2NvbF9lbmQgPSB0bXAtPm9y
aWdfY29sICsgMTsKICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9BU01fQ09M
T04pOwoKICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUoJm5jLCB0bXAtPnR5cGUpOwogICAg
ICAgICAgICBuYy5zdHIucG9wX2Zyb250KCk7CiAgICAgICAgICAgIG5jLm9yaWdfY29sKys7
CiAgICAgICAgICAgIG5jLmNvbHVtbisrOwogICAgICAgICAgICBjaHVua19hZGRfYWZ0ZXIo
Jm5jLCB0bXApOwogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgdG1wID0gY2h1bmtfZ2V0
X25leHRfbmNubChlbmQsIHNjb3BlX2U6OlBSRVBST0MpOwoKICAgaWYgKHRtcCA9PSBudWxs
cHRyKQogICB7CiAgICAgIHJldHVybjsKICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHRt
cCwgQ1RfU0VNSUNPTE9OKSkKICAgewogICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1Rf
QVNNKTsKICAgfQp9IC8vIGZsYWdfYXNtCgoKc3RhdGljIGJvb2wgY2h1bmtfZW5kc190eXBl
KGNodW5rX3QgKnN0YXJ0KQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CiAgIGNodW5rX3QgKnBj
ICAgICAgID0gc3RhcnQ7CiAgIGJvb2wgICAgcmV0ICAgICAgID0gZmFsc2U7CiAgIHNpemVf
dCAgY250ICAgICAgID0gMDsKICAgYm9vbCAgICBsYXN0X2V4cHIgPSBmYWxzZTsKICAgYm9v
bCAgICBsYXN0X2x2YWwgPSBmYWxzZTsKCiAgIGZvciAoIDsgcGMgIT0gbnVsbHB0cjsgcGMg
PSBjaHVua19nZXRfcHJldl9uY25sbmkocGMpKSAvLyBJc3N1ZSAjMjI3OQogICB7CiAgICAg
IExPR19GTVQoTEZUWVBFLCAiJXMoJWQpOiB0eXBlIGlzICVzLCB0ZXh0KCkgJyVzJywgb3Jp
Z19saW5lICV6dSwgb3JpZ19jb2wgJXp1XG4gICAiLAogICAgICAgICAgICAgIF9fZnVuY19f
LCBfX0xJTkVfXywgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUpLCBwYy0+dGV4dCgpLAogICAg
ICAgICAgICAgIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCk7CiAgICAgIGxvZ19wY2Zf
ZmxhZ3MoTEZUWVBFLCBwYy0+ZmxhZ3MpOwoKICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4o
cGMsIENUX1dPUkQpCiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9UWVBFKQog
ICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfUFRSX1RZUEUpCiAgICAgICAgIHx8
IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TVEFSKQogICAgICAgICB8fCBjaHVua19pc190b2tl
bihwYywgQ1RfU1RSVUNUKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfRENf
TUVNQkVSKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfUFApCiAgICAgICAg
IHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9RVUFMSUZJRVIpCiAgICAgICAgIHx8ICggIGxh
bmd1YWdlX2lzX3NldChMQU5HX0NQUCB8IExBTkdfT0MpICAgICAgICAgICAgICAgICAgICAg
ICAvLyBJc3N1ZSAjMjcyNwogICAgICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUo
cGMpID09IENUX1RFTVBMQVRFCiAgICAgICAgICAgICYmICggIGNodW5rX2lzX3Rva2VuKHBj
LCBDVF9BTkdMRV9PUEVOKQogICAgICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywg
Q1RfQU5HTEVfQ0xPU0UpKSkKICAgICAgICAgfHwgKCAgbGFuZ3VhZ2VfaXNfc2V0KExBTkdf
Q1MpCiAgICAgICAgICAgICYmIChjaHVua19pc190b2tlbihwYywgQ1RfTUVNQkVSKSkpKQog
ICAgICB7CiAgICAgICAgIGNudCsrOwogICAgICAgICBsYXN0X2V4cHIgPSBwYy0+ZmxhZ3Mu
dGVzdChQQ0ZfRVhQUl9TVEFSVCkKICAgICAgICAgICAgICAgICAgICAgJiYgIXBjLT5mbGFn
cy50ZXN0KFBDRl9JTl9GQ05fQ0FMTCk7CiAgICAgICAgIGxhc3RfbHZhbCA9IHBjLT5mbGFn
cy50ZXN0KFBDRl9MVkFMVUUpOwogICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAg
aWYgKCAgKCAgY2h1bmtfaXNfc2VtaWNvbG9uKHBjKQogICAgICAgICAgICAmJiAhcGMtPmZs
YWdzLnRlc3QoUENGX0lOX0ZPUikpCiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9UWVBFREVGKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQlJBQ0VfT1BF
TikKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0JSQUNFX0NMT1NFKQogICAg
ICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfVkJSQUNFX0NMT1NFKQogICAgICAgICB8
fCBjaHVua19pc190b2tlbihwYywgQ1RfRlBBUkVOX0NMT1NFKQogICAgICAgICB8fCBjaHVu
a19pc19mb3JpbihwYykKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX01BQ1JP
KQogICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfUFBfSUYpCiAgICAgICAgIHx8
IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9QUF9FTFNFKQogICAgICAgICB8fCBjaHVua19pc190
b2tlbihwYywgQ1RfUFBfRU5ESUYpCiAgICAgICAgIHx8ICggICggIGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9DT01NQSkKICAgICAgICAgICAgICAgJiYgIXBjLT5mbGFncy50ZXN0KFBDRl9J
Tl9GQ05fQ0FMTCkpCiAgICAgICAgICAgICYmIGxhc3RfZXhwcikKICAgICAgICAgfHwgKCAg
Y2h1bmtfaXNfdG9rZW4ocGMsIENUX1NQQVJFTl9PUEVOKQogICAgICAgICAgICAmJiBsYXN0
X2x2YWwpKQogICAgICB7CiAgICAgICAgIHJldCA9IGNudCA+IDA7CiAgICAgIH0KICAgICAg
YnJlYWs7CiAgIH0KCiAgIGlmIChwYyA9PSBudWxscHRyKQogICB7CiAgICAgIC8vIGZpcnN0
IHRva2VuCiAgICAgIHJldCA9IHRydWU7CiAgIH0KICAgTE9HX0ZNVChMRlRZUEUsICIlcygl
ZCk6IGZpcnN0IHRva2VuIHZlcmRpY3Q6ICVzXG4iLAogICAgICAgICAgIF9fZnVuY19fLCBf
X0xJTkVfXywgcmV0ID8gInllcyIgOiAibm8iKTsKCiAgIHJldHVybihyZXQpOwp9IC8vIGNo
dW5rX2VuZHNfdHlwZQoKCnZvaWQgZG9fc3ltYm9sX2NoZWNrKGNodW5rX3QgKnByZXYsIGNo
dW5rX3QgKnBjLCBjaHVua190ICpuZXh0KQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CiAgIGNo
dW5rX3QgKnRtcDsKCiAgIC8vIHNlcGFyYXRlIHRoZSB1c2VzIG9mIENUX0FTU0lHTiBzaWdu
ICc9JwogICAvLyBpbnRvIENUX0FTU0lHTl9ERUZBVUxUX0FSRywgQ1RfQVNTSUdOX0ZVTkNf
UFJPVE8KICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FTU0lHTikKICAgICAgJiYg
Z2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9GVU5DX1BST1RPCiAgICAgICYmICgg
IHBjLT5mbGFncy50ZXN0KFBDRl9JTl9GQ05fREVGKSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAvLyBJc3N1ZSAjMjIzNgogICAgICAgICB8fCBwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5f
Q09OU1RfQVJHUykpKQogICB7CiAgICAgIExPR19GTVQoTEZDTlIsICIlcyglZCk6IG9yaWdf
bGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcydcbiIsCiAgICAgICAg
ICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2ws
IHBjLT50ZXh0KCkpOwogICAgICBsb2dfcGNmX2ZsYWdzKExGQ05SLCBwYy0+ZmxhZ3MpOwog
ICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfQVNTSUdOX0RFRkFVTFRfQVJHKTsKICAgfQoK
ICAgaWYgKCAgKCAgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfRlBBUkVOX0NMT1NFKQogICAg
ICAgICB8fCAoICAoICBjaHVua19pc19zdHIocHJldiwgImNvbnN0IiwgNSkKICAgICAgICAg
ICAgICAgfHwgY2h1bmtfaXNfc3RyKHByZXYsICJvdmVycmlkZSIsIDgpKQogICAgICAgICAg
ICAmJiBjaHVua19pc190b2tlbihwcmV2LT5wcmV2LCBDVF9GUEFSRU5fQ0xPU0UpKSkKICAg
ICAgJiYgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FTU0lHTikKICAgICAgJiYgKCAgY2h1bmtf
aXNfdG9rZW4obmV4dCwgQ1RfREVGQVVMVCkKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4o
bmV4dCwgQ1RfREVMRVRFKQogICAgICAgICB8fCBjaHVua19pc19zdHIobmV4dCwgIjAiLCAx
KSkpCiAgIHsKICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0FTU0lHTl9GVU5DX1BST1RP
KTsKICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9PQ19BVCkpCiAgIHsKICAg
ICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfUEFSRU5fT1BFTikKICAgICAgICAg
fHwgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfQlJBQ0VfT1BFTikKICAgICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4obmV4dCwgQ1RfU1FVQVJFX09QRU4pKQogICAgICB7CiAgICAgICAgIGZs
YWdfcGFyZW5zKG5leHQsIFBDRl9PQ19CT1hFRCwgbmV4dC0+dHlwZSwgQ1RfT0NfQVQsIGZh
bHNlKTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3Bh
cmVudChuZXh0LCBDVF9PQ19BVCk7CiAgICAgIH0KICAgfQoKICAgLy8gRCBzdHVmZgogICBp
ZiAoICBsYW5ndWFnZV9pc19zZXQoTEFOR19EKQogICAgICAmJiBjaHVua19pc190b2tlbihw
YywgQ1RfUVVBTElGSUVSKQogICAgICAmJiBjaHVua19pc19zdHIocGMsICJjb25zdCIsIDUp
CiAgICAgICYmIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1BBUkVOX09QRU4pKQogICB7CiAg
ICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9EX0NBU1QpOwogICAgICBzZXRfcGFyZW5fcGFy
ZW50KG5leHQsIHBjLT50eXBlKTsKICAgfQoKICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4obmV4
dCwgQ1RfUEFSRU5fT1BFTikKICAgICAgJiYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0Rf
Q0FTVCkKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0RFTEVHQVRFKQogICAg
ICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQUxJR04pKSkKICAgewogICAgICAvLyBt
YXJrIHRoZSBwYXJlbnRoZXNpcyBwYXJlbnQKICAgICAgdG1wID0gc2V0X3BhcmVuX3BhcmVu
dChuZXh0LCBwYy0+dHlwZSk7CgogICAgICAvLyBGb3IgYSBEIGNhc3QgLSBjb252ZXJ0IHRo
ZSBuZXh0IGl0ZW0KICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0RfQ0FTVCkK
ICAgICAgICAgJiYgdG1wICE9IG51bGxwdHIpCiAgICAgIHsKICAgICAgICAgaWYgKGNodW5r
X2lzX3Rva2VuKHRtcCwgQ1RfU1RBUikpCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2No
dW5rX3R5cGUodG1wLCBDVF9ERVJFRik7CiAgICAgICAgIH0KICAgICAgICAgZWxzZSBpZiAo
Y2h1bmtfaXNfdG9rZW4odG1wLCBDVF9BTVApKQogICAgICAgICB7CiAgICAgICAgICAgIHNl
dF9jaHVua190eXBlKHRtcCwgQ1RfQUREUik7CiAgICAgICAgIH0KICAgICAgICAgZWxzZSBp
ZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9NSU5VUykpCiAgICAgICAgIHsKICAgICAgICAg
ICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9ORUcpOwogICAgICAgICB9CiAgICAgICAgIGVs
c2UgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfUExVUykpCiAgICAgICAgIHsKICAgICAg
ICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9QT1MpOwogICAgICAgICB9CiAgICAgIH0K
CiAgICAgIC8qCiAgICAgICAqIEZvciBhIGRlbGVnYXRlLCBtYXJrIHByZXZpb3VzIHdvcmRz
IGFzIHR5cGVzIGFuZCB0aGUgaXRlbSBhZnRlciB0aGUKICAgICAgICogY2xvc2UgcGFyZW4g
YXMgYSB2YXJpYWJsZSBkZWYKICAgICAgICovCiAgICAgIGlmIChjaHVua19pc190b2tlbihw
YywgQ1RfREVMRUdBVEUpKQogICAgICB7CiAgICAgICAgIGlmICh0bXAgIT0gbnVsbHB0cikK
ICAgICAgICAgewogICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfREVMRUdB
VEUpOwoKICAgICAgICAgICAgaWYgKHRtcC0+bGV2ZWwgPT0gdG1wLT5icmFjZV9sZXZlbCkK
ICAgICAgICAgICAgewogICAgICAgICAgICAgICBjaHVua19mbGFnc19zZXQodG1wLCBQQ0Zf
VkFSXzFTVF9ERUYpOwogICAgICAgICAgICB9CiAgICAgICAgIH0KCiAgICAgICAgIGZvciAo
dG1wID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHBjKTsgdG1wICE9IG51bGxwdHI7IHRtcCA9
IGNodW5rX2dldF9wcmV2X25jbmxuaSh0bXApKSAvLyBJc3N1ZSAjMjI3OQogICAgICAgICB7
CiAgICAgICAgICAgIGlmICggIGNodW5rX2lzX3NlbWljb2xvbih0bXApCiAgICAgICAgICAg
ICAgIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfQlJBQ0VfT1BFTikKICAgICAgICAgICAg
ICAgfHwgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9WQlJBQ0VfT1BFTikpCiAgICAgICAgICAg
IHsKICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWFr
ZV90eXBlKHRtcCk7CiAgICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCAgY2h1bmtfaXNf
dG9rZW4ocGMsIENUX0FMSUdOKQogICAgICAgICAmJiB0bXAgIT0gbnVsbHB0cikKICAgICAg
ewogICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9CUkFDRV9PUEVOKSkKICAg
ICAgICAgewogICAgICAgICAgICBzZXRfcGFyZW5fcGFyZW50KHRtcCwgcGMtPnR5cGUpOwog
ICAgICAgICB9CiAgICAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfQ09M
T04pKQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBwYy0+
dHlwZSk7CiAgICAgICAgIH0KICAgICAgfQogICB9IC8vIHBhcmVuIG9wZW4gKyBjYXN0L2Fs
aWduL2RlbGVnYXRlCgogICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0lOVkFSSUFOVCkp
CiAgIHsKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1BBUkVOX09QRU4pKQog
ICAgICB7CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgcGMtPnR5cGUpOwogICAg
ICAgICB0bXAgPSBjaHVua19nZXRfbmV4dChuZXh0KTsKCiAgICAgICAgIHdoaWxlICh0bXAg
IT0gbnVsbHB0cikKICAgICAgICAgewogICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4o
dG1wLCBDVF9QQVJFTl9DTE9TRSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgc2V0
X2NodW5rX3BhcmVudCh0bXAsIHBjLT50eXBlKTsKICAgICAgICAgICAgICAgYnJlYWs7CiAg
ICAgICAgICAgIH0KICAgICAgICAgICAgbWFrZV90eXBlKHRtcCk7CiAgICAgICAgICAgIHRt
cCA9IGNodW5rX2dldF9uZXh0KHRtcCk7CiAgICAgICAgIH0KICAgICAgfQogICAgICBlbHNl
CiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX1FVQUxJRklFUik7CiAg
ICAgIH0KICAgfQoKICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfQlJBQ0VfT1BF
TikKICAgICAgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHByZXYpICE9IENUX0NTX1BST1BF
UlRZCiAgICAgICYmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9HRVRTRVQpCiAgICAgICAg
IHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9HRVRTRVRfRU1QVFkpKSkKICAgewogICAgICBm
bGFnX3BhcmVucyhwcmV2LCBQQ0ZfTk9ORSwgQ1RfTk9ORSwgQ1RfR0VUU0VULCBmYWxzZSk7
CiAgIH0KCiAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfQVNNKSkKICAgewogICAgICBm
bGFnX2FzbShwYyk7CiAgIH0KCiAgIC8vIGNsYW5nIHN0dWZmIC0gQSBuZXcgZGVyaXZlZCB0
eXBlIGlzIGludHJvZHVjZWQgdG8gQyBhbmQsIGJ5IGV4dGVuc2lvbiwgT2JqZWN0aXZlLUMs
IEMrKywgYW5kIE9iamVjdGl2ZS1DKysKICAgaWYgKGxhbmd1YWdlX2lzX3NldChMQU5HX0Mg
fCBMQU5HX0NQUCB8IExBTkdfT0MpKQogICB7CiAgICAgIGlmIChjaHVua19pc190b2tlbihw
YywgQ1RfQ0FSRVQpKQogICAgICB7CiAgICAgICAgIGlmICggIHBjLT5mbGFncy50ZXN0KFBD
Rl9FWFBSX1NUQVJUKQogICAgICAgICAgICB8fCBwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJF
UFJPQykpCiAgICAgICAgIHsKICAgICAgICAgICAgaGFuZGxlX29jX2Jsb2NrX2xpdGVyYWwo
cGMpOwogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgLy8gT2JqZWN0aXZlIEMgc3R1ZmYK
ICAgaWYgKGxhbmd1YWdlX2lzX3NldChMQU5HX09DKSkKICAgewogICAgICAvLyBDaGVjayBm
b3IgbWVzc2FnZSBkZWNsYXJhdGlvbnMKICAgICAgaWYgKHBjLT5mbGFncy50ZXN0KFBDRl9T
VE1UX1NUQVJUKSkKICAgICAgewogICAgICAgICBpZiAoICAoICBjaHVua19pc19zdHIocGMs
ICItIiwgMSkKICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfc3RyKHBjLCAiKyIsIDEpKQog
ICAgICAgICAgICAmJiBjaHVua19pc19zdHIobmV4dCwgIigiLCAxKSkKICAgICAgICAgewog
ICAgICAgICAgICBoYW5kbGVfb2NfbWVzc2FnZV9kZWNsKHBjKTsKICAgICAgICAgfQogICAg
ICB9CgogICAgICBpZiAoICBwYy0+ZmxhZ3MudGVzdChQQ0ZfRVhQUl9TVEFSVCkKICAgICAg
ICAgfHwgcGMtPmZsYWdzLnRlc3QoUENGX0lOX1BSRVBST0MpKQogICAgICB7CiAgICAgICAg
IGlmIChjaHVua19pc190b2tlbihwYywgQ1RfU1FVQVJFX09QRU4pKQogICAgICAgICB7CiAg
ICAgICAgICAgIGhhbmRsZV9vY19tZXNzYWdlX3NlbmQocGMpOwogICAgICAgICB9CiAgICAg
IH0KCiAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfT0NfUFJPUEVSVFkpKQogICAg
ICB7CiAgICAgICAgIGhhbmRsZV9vY19wcm9wZXJ0eV9kZWNsKHBjKTsKICAgICAgfQoKICAg
ICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9PQ19BVkFJTEFCTEUpKQogICAgICB7CiAg
ICAgICAgIGhhbmRsZV9vY19hdmFpbGFibGUocGMpOwogICAgICB9CiAgIH0KCiAgIC8vIEMj
IHN0dWZmCiAgIGlmIChsYW5ndWFnZV9pc19zZXQoTEFOR19DUykpCiAgIHsKICAgICAgLy8g
J1thc3NlbWJseTogeHh4XScgc3R1ZmYKICAgICAgaWYgKCAgcGMtPmZsYWdzLnRlc3QoUENG
X0VYUFJfU1RBUlQpCiAgICAgICAgICYmIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TUVVBUkVf
T1BFTikpCiAgICAgIHsKICAgICAgICAgaGFuZGxlX2NzX3NxdWFyZV9zdG10KHBjKTsKICAg
ICAgfQoKICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfQlJBQ0VfT1BFTikK
ICAgICAgICAgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKG5leHQpID09IENUX05PTkUKICAg
ICAgICAgJiYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NRVUFSRV9DTE9TRSkKICAgICAg
ICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FOR0xFX0NMT1NFKQogICAgICAgICAg
ICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfV09SRCkpKQogICAgICB7CiAgICAgICAgIGhh
bmRsZV9jc19wcm9wZXJ0eShuZXh0KTsKICAgICAgfQoKICAgICAgaWYgKCAgY2h1bmtfaXNf
dG9rZW4ocGMsIENUX1NRVUFSRV9DTE9TRSkKICAgICAgICAgJiYgY2h1bmtfaXNfdG9rZW4o
bmV4dCwgQ1RfV09SRCkpCiAgICAgIHsKICAgICAgICAgaGFuZGxlX2NzX2FycmF5X3R5cGUo
cGMpOwogICAgICB9CgogICAgICBpZiAoICAoICBjaHVua19pc190b2tlbihwYywgQ1RfTEFN
QkRBKQogICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfREVMRUdBVEUpKQog
ICAgICAgICAmJiBjaHVua19pc190b2tlbihuZXh0LCBDVF9CUkFDRV9PUEVOKSkKICAgICAg
ewogICAgICAgICBzZXRfcGFyZW5fcGFyZW50KG5leHQsIHBjLT50eXBlKTsKICAgICAgfQoK
ICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9XSEVOKSAmJiBwYy0+bmV4dC0+dHlw
ZSAhPSBDVF9TUEFSRU5fT1BFTikKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZShw
YywgQ1RfV09SRCk7CiAgICAgIH0KICAgfQoKICAgaWYgKCAgbGFuZ3VhZ2VfaXNfc2V0KExB
TkdfSkFWQSkKICAgICAgJiYgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0xBTUJEQSkKICAgICAg
JiYgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfQlJBQ0VfT1BFTikpCiAgIHsKICAgICAgc2V0
X3BhcmVuX3BhcmVudChuZXh0LCBwYy0+dHlwZSk7CiAgIH0KCiAgIGlmIChjaHVua19pc190
b2tlbihwYywgQ1RfTkVXKSkKICAgewogICAgICBjaHVua190ICp0cyA9IG51bGxwdHI7CiAg
ICAgIHRtcCA9IG5leHQ7CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9UU1FV
QVJFKSkKICAgICAgewogICAgICAgICB0cyAgPSB0bXA7CiAgICAgICAgIHRtcCA9IGNodW5r
X2dldF9uZXh0X25jbmwodG1wKTsKICAgICAgfQoKICAgICAgaWYgKCAgY2h1bmtfaXNfdG9r
ZW4odG1wLCBDVF9CUkFDRV9PUEVOKQogICAgICAgICB8fCBjaHVua19pc190b2tlbih0bXAs
IENUX1BBUkVOX09QRU4pKQogICAgICB7CiAgICAgICAgIHNldF9wYXJlbl9wYXJlbnQodG1w
LCBwYy0+dHlwZSk7CgogICAgICAgICBpZiAodHMgIT0gbnVsbHB0cikKICAgICAgICAgewog
ICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRzLCBwYy0+dHlwZSk7CiAgICAgICAgIH0K
ICAgICAgfQogICB9CgogICAvLyBDKysxMSBMYW1iZGEgc3R1ZmYKICAgaWYgKCAgbGFuZ3Vh
Z2VfaXNfc2V0KExBTkdfQ1BQKQogICAgICAmJiAoICBjaHVua19pc190b2tlbihwYywgQ1Rf
U1FVQVJFX09QRU4pCiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9UU1FVQVJF
KSkpCiAgIHsKICAgICAgaGFuZGxlX2NwcF9sYW1iZGEocGMpOwogICB9CgogICAvLyBGSVhN
RTogd2hpY2ggbGFuZ3VhZ2UgZG9lcyB0aGlzIGFwcGx5IHRvPwogICAvLyBJc3N1ZSAjMjQz
MgogICBpZiAoIWxhbmd1YWdlX2lzX3NldChMQU5HX09DKSkKICAgewogICAgICBpZiAoICBj
aHVua19pc190b2tlbihwYywgQ1RfQVNTSUdOKQogICAgICAgICAmJiBjaHVua19pc190b2tl
bihuZXh0LCBDVF9TUVVBUkVfT1BFTikpCiAgICAgIHsKICAgICAgICAgc2V0X3BhcmVuX3Bh
cmVudChuZXh0LCBDVF9BU1NJR04pOwoKICAgICAgICAgLy8gTWFyayBvbmUtbGluZXIgYXNz
aWdubWVudAogICAgICAgICB0bXAgPSBuZXh0OwoKICAgICAgICAgd2hpbGUgKCh0bXAgPSBj
aHVua19nZXRfbmV4dF9uYyh0bXApKSAhPSBudWxscHRyKQogICAgICAgICB7CiAgICAgICAg
ICAgIGlmIChjaHVua19pc19uZXdsaW5lKHRtcCkpCiAgICAgICAgICAgIHsKICAgICAgICAg
ICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjaHVua19pc190
b2tlbih0bXAsIENUX1NRVUFSRV9DTE9TRSkgJiYgbmV4dC0+bGV2ZWwgPT0gdG1wLT5sZXZl
bCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBjaHVua19mbGFnc19zZXQodG1wLCBQ
Q0ZfT05FX0xJTkVSKTsKICAgICAgICAgICAgICAgY2h1bmtfZmxhZ3Nfc2V0KG5leHQsIFBD
Rl9PTkVfTElORVIpOwogICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAg
ICAgICB9CiAgICAgIH0KICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BU1NF
UlQpKQogICB7CiAgICAgIGhhbmRsZV9qYXZhX2Fzc2VydChwYyk7CiAgIH0KCiAgIGlmIChj
aHVua19pc190b2tlbihwYywgQ1RfQU5OT1RBVElPTikpCiAgIHsKICAgICAgdG1wID0gY2h1
bmtfZ2V0X25leHRfbmNubChwYyk7CgogICAgICBpZiAoY2h1bmtfaXNfcGFyZW5fb3Blbih0
bXApKQogICAgICB7CiAgICAgICAgIHNldF9wYXJlbl9wYXJlbnQodG1wLCBDVF9BTk5PVEFU
SU9OKTsKICAgICAgfQogICB9CgogICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NJWkVP
RikgJiYgbGFuZ3VhZ2VfaXNfc2V0KExBTkdfQUxMQykpCiAgIHsKICAgICAgdG1wID0gY2h1
bmtfZ2V0X25leHRfbmNubChwYyk7CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBD
VF9FTExJUFNJUykpCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3BhcmVudCh0bXAsIENU
X1NJWkVPRik7CiAgICAgIH0KICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9E
RUNMVFlQRSkpCiAgIHsKICAgICAgdG1wID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7Cgog
ICAgICBpZiAoY2h1bmtfaXNfcGFyZW5fb3Blbih0bXApKQogICAgICB7CiAgICAgICAgIC8v
IGRlY2x0eXBlIG1heSBiZSBmb2xsb3dlZCBieSBhIGJyYWNlZC1pbml0LWxpc3QKICAgICAg
ICAgdG1wID0gc2V0X3BhcmVuX3BhcmVudCh0bXAsIENUX0RFQ0xUWVBFKTsKCiAgICAgICAg
IGlmIChjaHVua19pc19vcGVuaW5nX2JyYWNlKHRtcCkpCiAgICAgICAgIHsKICAgICAgICAg
ICAgdG1wID0gc2V0X3BhcmVuX3BhcmVudCh0bXAsIENUX0JSQUNFRF9JTklUX0xJU1QpOwoK
ICAgICAgICAgICAgaWYgKHRtcCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBjaHVu
a19mbGFnc19jbHIodG1wLCBQQ0ZfRVhQUl9TVEFSVCB8IFBDRl9TVE1UX1NUQVJUKTsKICAg
ICAgICAgICAgfQogICAgICAgICB9CiAgICAgICAgIGVsc2UKICAgICAgICAgewogICAgICAg
ICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9XT1JEKSkKICAgICAgICAgICAgewog
ICAgICAgICAgICAgICBjaHVua19mbGFnc19zZXQodG1wLCBQQ0ZfVkFSXzFTVF9ERUYpOwog
ICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgfQogICB9CgogICAvLyBBIFtdIGluIEMj
IGFuZCBEIG9ubHkgZm9sbG93cyBhIHR5cGUKICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMs
IENUX1RTUVVBUkUpCiAgICAgICYmIGxhbmd1YWdlX2lzX3NldChMQU5HX0QgfCBMQU5HX0NT
IHwgTEFOR19WQUxBKSkKICAgewogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1Rf
V09SRCkpCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5cGUocHJldiwgQ1RfVFlQRSk7
CiAgICAgIH0KCiAgICAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9XT1JEKSkKICAg
ICAgewogICAgICAgICBjaHVua19mbGFnc19zZXQobmV4dCwgUENGX1ZBUl8xU1RfREVGKTsK
ICAgICAgfQogICB9CgogICBpZiAoICBjaHVua19pc190b2tlbihwYywgQ1RfU1FMX0VYRUMp
CiAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TUUxfQkVHSU4pCiAgICAgIHx8IGNo
dW5rX2lzX3Rva2VuKHBjLCBDVF9TUUxfRU5EKSkKICAgewogICAgICBtYXJrX2V4ZWNfc3Fs
KHBjKTsKICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9QUk9UT19XUkFQKSkK
ICAgewogICAgICBoYW5kbGVfcHJvdG9fd3JhcChwYyk7CiAgIH0KCiAgIC8vIEhhbmRsZSB0
aGUgdHlwZWRlZgogICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RZUEVERUYpKQogICB7
CiAgICAgIGZpeF90eXBlZGVmKHBjKTsKICAgfQoKICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4o
cGMsIENUX0VOVU0pCiAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TVFJVQ1QpCiAg
ICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9VTklPTikKICAgICAgfHwgKCAgY2h1bmtf
aXNfdG9rZW4ocGMsIENUX0NMQVNTKQogICAgICAgICAmJiAhbGFuZ3VhZ2VfaXNfc2V0KExB
TkdfRCkpKQogICB7CiAgICAgIGlmIChwcmV2LT50eXBlICE9IENUX1RZUEVERUYpCiAgICAg
IHsKICAgICAgICAgZml4X2VudW1fc3RydWN0X3VuaW9uKHBjKTsKICAgICAgfQogICB9Cgog
ICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0VYVEVSTikpCiAgIHsKICAgICAgaWYgKGNo
dW5rX2lzX3BhcmVuX29wZW4obmV4dCkpCiAgICAgIHsKICAgICAgICAgdG1wID0gZmxhZ19w
YXJlbnMobmV4dCwgUENGX05PTkUsIENUX05PTkUsIENUX0VYVEVSTiwgdHJ1ZSk7CgogICAg
ICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9CUkFDRV9PUEVOKSkKICAgICAgICAg
ewogICAgICAgICAgICBzZXRfcGFyZW5fcGFyZW50KHRtcCwgQ1RfRVhURVJOKTsKICAgICAg
ICAgfQogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICAvLyBuZXh0IGxpa2Vs
eSBpcyBhIHN0cmluZyAoc2VlIHRva2VuaXplX2NsZWFudXAuY3BwKQogICAgICAgICBzZXRf
Y2h1bmtfcGFyZW50KG5leHQsIENUX0VYVEVSTik7CiAgICAgICAgIHRtcCA9IGNodW5rX2dl
dF9uZXh0X25jbmwobmV4dCk7CgogICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBD
VF9CUkFDRV9PUEVOKSkKICAgICAgICAgewogICAgICAgICAgICBzZXRfcGFyZW5fcGFyZW50
KHRtcCwgQ1RfRVhURVJOKTsKICAgICAgICAgfQogICAgICB9CiAgIH0KCiAgIGlmIChjaHVu
a19pc190b2tlbihwYywgQ1RfVEVNUExBVEUpKQogICB7CiAgICAgIGlmIChsYW5ndWFnZV9p
c19zZXQoTEFOR19EKSkKICAgICAgewogICAgICAgICBoYW5kbGVfZF90ZW1wbGF0ZShwYyk7
CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgIGhhbmRsZV9jcHBfdGVtcGxh
dGUocGMpOwogICAgICB9CiAgIH0KCiAgIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9X
T1JEKQogICAgICAmJiBjaHVua19pc190b2tlbihuZXh0LCBDVF9BTkdMRV9PUEVOKQogICAg
ICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUobmV4dCkgPT0gQ1RfVEVNUExBVEUpCiAgIHsK
ICAgICAgbWFya190ZW1wbGF0ZV9mdW5jKHBjLCBuZXh0KTsKICAgfQoKICAgaWYgKCAgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX1NRVUFSRV9DTE9TRSkKICAgICAgJiYgY2h1bmtfaXNfdG9r
ZW4obmV4dCwgQ1RfUEFSRU5fT1BFTikpCiAgIHsKICAgICAgZmxhZ19wYXJlbnMobmV4dCwg
UENGX05PTkUsIENUX0ZQQVJFTl9PUEVOLCBDVF9OT05FLCBmYWxzZSk7CiAgIH0KCiAgIGlm
IChjaHVua19pc190b2tlbihwYywgQ1RfVFlQRV9DQVNUKSkKICAgewogICAgICBmaXhfdHlw
ZV9jYXN0KHBjKTsKICAgfQoKICAgaWYgKCAgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9
PSBDVF9BU1NJR04KICAgICAgJiYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9CUkFDRV9PUEVO
KSB8fCBjaHVua19pc190b2tlbihwYywgQ1RfU1FVQVJFX09QRU4pKSkKICAgewogICAgICAv
LyBNYXJrIGV2ZXJ5dGhpbmcgaW4gaGVyZSBhcyBpbiBhc3NpZ24KICAgICAgZmxhZ19wYXJl
bnMocGMsIFBDRl9JTl9BUlJBWV9BU1NJR04sIHBjLT50eXBlLCBDVF9OT05FLCBmYWxzZSk7
CiAgIH0KCiAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfRF9URU1QTEFURSkpCiAgIHsK
ICAgICAgc2V0X3BhcmVuX3BhcmVudChuZXh0LCBwYy0+dHlwZSk7CiAgIH0KCiAgIC8qCiAg
ICAqIEEgd29yZCBiZWZvcmUgYW4gb3BlbiBwYXJlbiBpcyBhIGZ1bmN0aW9uIGNhbGwgb3Ig
ZGVmaW5pdGlvbi4KICAgICogQ1RfV09SRCA9PiBDVF9GVU5DX0NBTEwgb3IgQ1RfRlVOQ19E
RUYKICAgICovCiAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9QQVJFTl9PUEVOKSkK
ICAgewogICAgICB0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKG5leHQpOwoKICAgICAgaWYg
KCAgbGFuZ3VhZ2VfaXNfc2V0KExBTkdfQyB8IExBTkdfQ1BQIHwgTEFOR19PQykKICAgICAg
ICAgJiYgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9DQVJFVCkpCiAgICAgIHsKICAgICAgICAg
aGFuZGxlX29jX2Jsb2NrX3R5cGUodG1wKTsKCiAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGNh
c2Ugd2hlcmUgYSBibG9jayBsaXRlcmFsIGlzIHBhc3NlZCBhcyB0aGUgZmlyc3QgYXJndW1l
bnQgb2YgYSBDLXN0eWxlIG1ldGhvZCBpbnZvY2F0aW9uLgogICAgICAgICBpZiAoICAoICBj
aHVua19pc190b2tlbih0bXAsIENUX09DX0JMT0NLX0NBUkVUKQogICAgICAgICAgICAgICB8
fCBjaHVua19pc190b2tlbih0bXAsIENUX0NBUkVUKSkKICAgICAgICAgICAgJiYgY2h1bmtf
aXNfdG9rZW4ocGMsIENUX1dPUkQpKQogICAgICAgICB7CiAgICAgICAgICAgIExPR19GTVQo
TEZDTiwgIiVzKCVkKTogKDEpIFNFVCBUTyBDVF9GVU5DX0NBTEw6IG9yaWdfbGluZSBpcyAl
enUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcydcbiIsCiAgICAgICAgICAgICAgICAg
ICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIHBj
LT50ZXh0KCkpOwogICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfRlVOQ19DQUxM
KTsKICAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgaWYgKCAgY2h1bmtfaXNfdG9rZW4o
cGMsIENUX1dPUkQpCiAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX09Q
RVJBVE9SX1ZBTCkpCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0ZV
TkNUSU9OKTsKICAgICAgfQogICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihwYywgQ1Rf
RklYRUQpKQogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DVElP
Tik7CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQocGMsIENUX0ZJWEVEKTsKICAgICAgfQog
ICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfVFlQRSkpCiAgICAgIHsKICAg
ICAgICAgLyoKICAgICAgICAgICogSWYgd2UgYXJlIG9uIGEgdHlwZSwgdGhlbiB3ZSBhcmUg
ZWl0aGVyIG9uIGEgQysrIHN0eWxlIGNhc3QsIGFuCiAgICAgICAgICAqIGFycmF5IHJlZmVy
ZW5jZSwgYSBmdW5jdGlvbiBvciB3ZSBhcmUgb24gYSBmdW5jdGlvbiB0eXBlLgogICAgICAg
ICAgKiBUaGUgb25seSB3YXkgdG8gdGVsbCBmb3Igc3VyZSBpcyB0byBmaW5kIHRoZSBjbG9z
ZSBwYXJlbiBhbmQgc2VlCiAgICAgICAgICAqIGlmIGl0IGlzIGZvbGxvd2VkIGJ5IGFuIG9w
ZW4gcGFyZW4uCiAgICAgICAgICAqICJpbnQoNS42KSIKICAgICAgICAgICogImludCgpIgog
ICAgICAgICAgKiAiaW50KGZvbykodm9pZCkiCiAgICAgICAgICAqCiAgICAgICAgICAqIEZJ
WE1FOiB0aGlzIGNoZWNrIGNhbiBiZSBkb25lIGJldHRlci4uLgogICAgICAgICAgKi8KICAg
ICAgICAgTE9HX0ZNVChMRkNOUiwgIiVzKCVkKTogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19j
b2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xuIiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywg
X19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQoKSk7Cgog
ICAgICAgICBib29sIGlzX2J5cmVmX2FycmF5ID0gZmFsc2U7CgogICAgICAgICBpZiAobGFu
Z3VhZ2VfaXNfc2V0KExBTkdfQ1BQKSkKICAgICAgICAgewogICAgICAgICAgICAvLyBJZiB0
aGUgb3BlbiBwYXJlbiBpcyBmb2xsb3dlZCBieSBhbiBhbXBlcnNhbmQsIGFuIG9wdGlvbmFs
IHdvcmQsCiAgICAgICAgICAgIC8vIGEgY2xvc2UgcGFyZW50aGVzaXMsIGFuZCBhbiBvcGVu
IHNxdWFyZSBicmFja2V0LCB0aGVuIGl0IGlzIGFuCiAgICAgICAgICAgIC8vIGFycmF5IGJl
aW5nIHBhc3NlZCBieSByZWZlcmVuY2UsIG5vdCBhIGNhc3QKICAgICAgICAgICAgdG1wID0g
Y2h1bmtfZ2V0X25leHRfbmNubChuZXh0KTsKCiAgICAgICAgICAgIGlmIChjaHVua19pc190
b2tlbih0bXAsIENUX0FNUCkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgYXV0byB0
bXAyID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXApOwoKICAgICAgICAgICAgICAgaWYgKGNo
dW5rX2lzX3Rva2VuKHRtcDIsIENUX1dPUkQpKQogICAgICAgICAgICAgICB7CiAgICAgICAg
ICAgICAgICAgIHRtcDIgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcDIpOwogICAgICAgICAg
ICAgICB9CgogICAgICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wMiwgQ1RfUEFS
RU5fQ0xPU0UpKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHRtcDIgPSBj
aHVua19nZXRfbmV4dF9uY25sKHRtcDIpOwoKICAgICAgICAgICAgICAgICAgaWYgKGNodW5r
X2lzX3Rva2VuKHRtcDIsIENUX1NRVUFSRV9PUEVOKSkKICAgICAgICAgICAgICAgICAgewog
ICAgICAgICAgICAgICAgICAgICBpc19ieXJlZl9hcnJheSA9IHRydWU7CiAgICAgICAgICAg
ICAgICAgICAgIHNldF9jaHVua190eXBlKHRtcCwgQ1RfQllSRUYpOwogICAgICAgICAgICAg
ICAgICB9CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICB9CgogICAg
ICAgICBpZiAoIWlzX2J5cmVmX2FycmF5KQogICAgICAgICB7CiAgICAgICAgICAgIHRtcCA9
IGNodW5rX2dldF9uZXh0X3R5cGUobmV4dCwgQ1RfUEFSRU5fQ0xPU0UsIG5leHQtPmxldmVs
KTsKCiAgICAgICAgICAgIGlmICh0bXAgIT0gbnVsbHB0cikKICAgICAgICAgICAgewogICAg
ICAgICAgICAgICB0bXAgPSBjaHVua19nZXRfbmV4dCh0bXApOwoKICAgICAgICAgICAgICAg
aWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfUEFSRU5fT1BFTikpCiAgICAgICAgICAgICAg
IHsKICAgICAgICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0ZVTkNUSU9OKTsK
ICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgIHsK
ICAgICAgICAgICAgICAgICAgaWYgKCAgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBD
VF9OT05FCiAgICAgICAgICAgICAgICAgICAgICYmICFwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5f
VFlQRURFRikpCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgdG1w
ID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0KTsKCiAgICAgICAgICAgICAgICAgICAgIGlm
IChjaHVua19pc190b2tlbih0bXAsIENUX1BBUkVOX0NMT1NFKSkKICAgICAgICAgICAgICAg
ICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBoYXZlIFRZUEUoKQogICAg
ICAgICAgICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfRlVOQ1RJT04pOwog
ICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAg
ICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBoYXZlIFRZ
UEUoLi4uKQogICAgICAgICAgICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1Rf
Q1BQX0NBU1QpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRfcGFyZW5fcGFyZW50KG5l
eHQsIENUX0NQUF9DQVNUKTsKICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg
ICAgICB9CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAg
IH0KICAgfQoKICAgaWYgKGxhbmd1YWdlX2lzX3NldChMQU5HX1BBV04pKQogICB7CiAgICAg
IGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9GVU5DVElPTikKICAgICAgICAgJiYgcGMt
PmJyYWNlX2xldmVsID4gMCkKICAgICAgewogICAgICAgICBMT0dfRk1UKExGQ04sICIlcygl
ZCk6ICgyKSBTRVQgVE8gQ1RfRlVOQ19DQUxMOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2Nv
bCBpcyAlenUsIHRleHQoKSAnJXMnXG4iLAogICAgICAgICAgICAgICAgIF9fZnVuY19fLCBf
X0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpKTsKICAg
ICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0ZVTkNfQ0FMTCk7CiAgICAgIH0KCiAgICAg
IGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TVEFURSkKICAgICAgICAgJiYgY2h1bmtf
aXNfdG9rZW4obmV4dCwgQ1RfUEFSRU5fT1BFTikpCiAgICAgIHsKICAgICAgICAgc2V0X3Bh
cmVuX3BhcmVudChuZXh0LCBwYy0+dHlwZSk7CiAgICAgIH0KICAgfQogICBlbHNlCiAgIHsK
ICAgICAgaWYgKCAgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0ZVTkNUSU9OKQogICAgICAg
ICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfRlVOQ19ERUYpKQogICAgICAgICAmJiAo
ICAoZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9PQ19CTE9DS19FWFBSKQogICAg
ICAgICAgICB8fCAhaXNfb2NfYmxvY2socGMpKSkKICAgICAgewogICAgICAgICBtYXJrX2Z1
bmN0aW9uKHBjKTsKICAgICAgfQogICB9CgogICAvLyBEZXRlY3QgQzk5IG1lbWJlciBzdHVm
ZgogICBpZiAoICBjaHVua19pc190b2tlbihwYywgQ1RfTUVNQkVSKQogICAgICAmJiAoICBj
aHVua19pc190b2tlbihwcmV2LCBDVF9DT01NQSkKICAgICAgICAgfHwgY2h1bmtfaXNfdG9r
ZW4ocHJldiwgQ1RfQlJBQ0VfT1BFTikpKQogICB7CiAgICAgIHNldF9jaHVua190eXBlKHBj
LCBDVF9DOTlfTUVNQkVSKTsKICAgICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBDVF9DOTlf
TUVNQkVSKTsKICAgfQoKICAgLy8gTWFyayBmdW5jdGlvbiBwYXJlbnMgYW5kIGJyYWNlcwog
ICBpZiAoICBjaHVua19pc190b2tlbihwYywgQ1RfRlVOQ19ERUYpCiAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHBjLCBDVF9GVU5DX0NBTEwpCiAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBj
LCBDVF9GVU5DX0NBTExfVVNFUikKICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0ZV
TkNfUFJPVE8pKQogICB7CiAgICAgIHRtcCA9IG5leHQ7CgogICAgICBpZiAoY2h1bmtfaXNf
dG9rZW4odG1wLCBDVF9TUVVBUkVfT1BFTikpCiAgICAgIHsKICAgICAgICAgdG1wID0gc2V0
X3BhcmVuX3BhcmVudCh0bXAsIHBjLT50eXBlKTsKICAgICAgfQogICAgICBlbHNlIGlmIChj
aHVua19pc190b2tlbih0bXAsIENUX1RTUVVBUkUpIHx8IGdldF9jaHVua19wYXJlbnRfdHlw
ZSh0bXApID09IENUX09QRVJBVE9SKQogICAgICB7CiAgICAgICAgIHRtcCA9IGNodW5rX2dl
dF9uZXh0X25jbmwodG1wKTsKICAgICAgfQoKICAgICAgaWYgKHRtcCAhPSBudWxscHRyKQog
ICAgICB7CiAgICAgICAgIGlmIChjaHVua19pc19wYXJlbl9vcGVuKHRtcCkpCiAgICAgICAg
IHsKICAgICAgICAgICAgdG1wID0gZmxhZ19wYXJlbnModG1wLCBQQ0ZfTk9ORSwgQ1RfRlBB
UkVOX09QRU4sIHBjLT50eXBlLCBmYWxzZSk7CgogICAgICAgICAgICBpZiAodG1wICE9IG51
bGxwdHIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2Vu
KHRtcCwgQ1RfQlJBQ0VfT1BFTikpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg
ICAgaWYgKCAgZ2V0X2NodW5rX3BhcmVudF90eXBlKHRtcCkgIT0gQ1RfRE9VQkxFX0JSQUNF
CiAgICAgICAgICAgICAgICAgICAgICYmICFwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fQ09OU1Rf
QVJHUykpCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgc2V0X3Bh
cmVuX3BhcmVudCh0bXAsIHBjLT50eXBlKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAg
ICAgICAgICB9CiAgICAgICAgICAgICAgIGVsc2UgaWYgKCAgY2h1bmtfaXNfc2VtaWNvbG9u
KHRtcCkKICAgICAgICAgICAgICAgICAgICAgICAmJiBjaHVua19pc190b2tlbihwYywgQ1Rf
RlVOQ19QUk9UTykpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgc2V0X2No
dW5rX3BhcmVudCh0bXAsIHBjLT50eXBlKTsKICAgICAgICAgICAgICAgfQogICAgICAgICAg
ICB9CiAgICAgICAgIH0KICAgICAgfQogICB9CgogICAvLyBNYXJrIHRoZSBwYXJhbWV0ZXJz
IGluIGNhdGNoKCkKICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DQVRDSCkgJiYgY2h1
bmtfaXNfdG9rZW4obmV4dCwgQ1RfU1BBUkVOX09QRU4pKQogICB7CiAgICAgIGZpeF9mY25f
ZGVmX3BhcmFtcyhuZXh0KTsKICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9U
SFJPVykgJiYgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfRlBBUkVOX0NMT1NFKSkKICAgewog
ICAgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBnZXRfY2h1bmtfcGFyZW50X3R5cGUocHJldikp
OwoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1BBUkVOX09QRU4pKQogICAg
ICB7CiAgICAgICAgIHNldF9wYXJlbl9wYXJlbnQobmV4dCwgQ1RfVEhST1cpOwogICAgICB9
CiAgIH0KCiAgIC8vIE1hcmsgdGhlIGJyYWNlcyBpbjogImZvcl9lYWNoX2VudHJ5KHh4eCkg
eyB9IgogICBpZiAoICBjaHVua19pc190b2tlbihwYywgQ1RfQlJBQ0VfT1BFTikKICAgICAg
JiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSAhPSBDVF9ET1VCTEVfQlJBQ0UKICAgICAg
JiYgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfRlBBUkVOX0NMT1NFKQogICAgICAmJiAoICBn
ZXRfY2h1bmtfcGFyZW50X3R5cGUocHJldikgPT0gQ1RfRlVOQ19DQUxMCiAgICAgICAgIHx8
IGdldF9jaHVua19wYXJlbnRfdHlwZShwcmV2KSA9PSBDVF9GVU5DX0NBTExfVVNFUikKICAg
ICAgJiYgIXBjLT5mbGFncy50ZXN0KFBDRl9JTl9DT05TVF9BUkdTKSkKICAgewogICAgICBM
T0dfRk1UKExGQ04sICIlcyglZCk6ICgzKSBTRVQgVE8gQ1RfRlVOQ19DQUxMOiBvcmlnX2xp
bmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSAnJXMnXG4iLAogICAgICAgICAg
ICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBw
Yy0+dGV4dCgpKTsKICAgICAgc2V0X3BhcmVuX3BhcmVudChwYywgQ1RfRlVOQ19DQUxMKTsK
ICAgfQoKICAgLyoKICAgICogQ2hlY2sgZm9yIGEgY2xvc2UgcGFyZW50aGVzaXMgZm9sbG93
ZWQgYnkgYW4gb3BlbiBwYXJlbnRoZXNpcywKICAgICogd2hpY2ggbWVhbnMgdGhhdCB3ZSBh
cmUgb24gYSBmdW5jdGlvbiB0eXBlIGRlY2xhcmF0aW9uIChDL0MrKyBvbmx5PykuCiAgICAq
IE5vdGUgdGhhdCB0eXBlZGVmcyBhcmUgYWxyZWFkeSB0YWtlbiBjYXJlIG9mLgogICAgKi8K
ICAgaWYgKCAgIXBjLT5mbGFncy50ZXN0X2FueShQQ0ZfSU5fVFlQRURFRiB8IFBDRl9JTl9U
RU1QTEFURSkKICAgICAgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSAhPSBDVF9DUFBf
Q0FTVAogICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpICE9IENUX0NfQ0FTVAog
ICAgICAmJiAhcGMtPmZsYWdzLnRlc3QoUENGX0lOX1BSRVBST0MpCiAgICAgICYmICFpc19v
Y19ibG9jayhwYykKICAgICAgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSAhPSBDVF9P
Q19NU0dfREVDTAogICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpICE9IENUX09D
X01TR19TUEVDCiAgICAgICYmIGNodW5rX2lzX3N0cihwYywgIikiLCAxKQogICAgICAmJiBj
aHVua19pc19zdHIobmV4dCwgIigiLCAxKSkKICAgewogICAgICBpZiAobGFuZ3VhZ2VfaXNf
c2V0KExBTkdfRCkpCiAgICAgIHsKICAgICAgICAgZmxhZ19wYXJlbnMobmV4dCwgUENGX05P
TkUsIENUX0ZQQVJFTl9PUEVOLCBDVF9GVU5DX0NBTEwsIGZhbHNlKTsKICAgICAgfQogICAg
ICBlbHNlCiAgICAgIHsKICAgICAgICAgbWFya19mdW5jdGlvbl90eXBlKHBjKTsKICAgICAg
fQogICB9CgogICBpZiAoICAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0NMQVNTKSB8fCBjaHVu
a19pc190b2tlbihwYywgQ1RfU1RSVUNUKSkKICAgICAgJiYgcGMtPmxldmVsID09IHBjLT5i
cmFjZV9sZXZlbCkKICAgewogICAgICBpZiAocGMtPnR5cGUgIT0gQ1RfU1RSVUNUIHx8ICFs
YW5ndWFnZV9pc19zZXQoTEFOR19DKSkKICAgICAgewogICAgICAgICBtYXJrX2NsYXNzX2N0
b3IocGMpOwogICAgICB9CiAgIH0KCiAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfT0Nf
Q0xBU1MpKQogICB7CiAgICAgIGhhbmRsZV9vY19jbGFzcyhwYyk7CiAgIH0KICAgLy8gVE9E
TzogQ2hlY2sgZm9yIHN0dWZmIHRoYXQgY2FuIG9ubHkgb2NjdXIgYXQgdGhlIHN0YXJ0IG9m
IGFuIHN0YXRlbWVudAoKICAgaWYgKCFsYW5ndWFnZV9pc19zZXQoTEFOR19EKSkKICAgewog
ICAgICAvKgogICAgICAgKiBDaGVjayBhIHBhcmVudGhlc2lzIHBhaXIgdG8gc2VlIGlmIGl0
IGlzIGEgY2FzdC4KICAgICAgICogTm90ZSB0aGF0IFNQQVJFTiBhbmQgRlBBUkVOIGhhdmUg
YWxyZWFkeSBiZWVuIG1hcmtlZC4KICAgICAgICovCiAgICAgIGlmICggIGNodW5rX2lzX3Rv
a2VuKHBjLCBDVF9QQVJFTl9PUEVOKQogICAgICAgICAmJiAoICBnZXRfY2h1bmtfcGFyZW50
X3R5cGUocGMpID09IENUX05PTkUKICAgICAgICAgICAgfHwgZ2V0X2NodW5rX3BhcmVudF90
eXBlKHBjKSA9PSBDVF9PQ19NU0cKICAgICAgICAgICAgfHwgZ2V0X2NodW5rX3BhcmVudF90
eXBlKHBjKSA9PSBDVF9PQ19CTE9DS19FWFBSCiAgICAgICAgICAgIHx8IGdldF9jaHVua19w
YXJlbnRfdHlwZShwYykgPT0gQ1RfQ1NfU1FfU1RNVCkgICAgICAgICAgIC8vIElzc3VlICMg
MTI1NgogICAgICAgICAmJiAoICBjaHVua19pc190b2tlbihuZXh0LCBDVF9XT1JEKQogICAg
ICAgICAgICB8fCBjaHVua19pc190b2tlbihuZXh0LCBDVF9UWVBFKQogICAgICAgICAgICB8
fCBjaHVua19pc190b2tlbihuZXh0LCBDVF9TVFJVQ1QpCiAgICAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKG5leHQsIENUX1FVQUxJRklFUikKICAgICAgICAgICAgfHwgY2h1bmtfaXNf
dG9rZW4obmV4dCwgQ1RfTUVNQkVSKQogICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihu
ZXh0LCBDVF9EQ19NRU1CRVIpCiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKG5leHQs
IENUX0VOVU0pCiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1VOSU9O
KSkKICAgICAgICAgJiYgcHJldi0+dHlwZSAhPSBDVF9ERUNMVFlQRQogICAgICAgICAmJiBw
cmV2LT50eXBlICE9IENUX1NJWkVPRgogICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5
cGUocHJldikgIT0gQ1RfU0laRU9GCiAgICAgICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlw
ZShwcmV2KSAhPSBDVF9PUEVSQVRPUgogICAgICAgICAmJiAhcGMtPmZsYWdzLnRlc3QoUENG
X0lOX1RZUEVERUYpKQogICAgICB7CiAgICAgICAgIGZpeF9jYXN0cyhwYyk7CiAgICAgIH0K
ICAgfQoKICAgaWYgKGxhbmd1YWdlX2lzX3NldChMQU5HX0NQUCkpCiAgIHsKICAgICAgY2h1
bmtfdCAqbm5leHQgPSBjaHVua19nZXRfbmV4dF9uY25sKG5leHQpOwoKICAgICAgLy8gaGFu
ZGxlIHBhcmVudF90eXBlIG9mIGFzc2lnbnMgaW4gc3BlY2lhbCBmdW5jdGlvbnMgKHJvNSAr
IHB1cmUgdmlydHVhbCkKICAgICAgaWYgKCAgcGMtPmZsYWdzLnRlc3RfYW55KFBDRl9JTl9T
VFJVQ1QgfCBQQ0ZfSU5fQ0xBU1MpCiAgICAgICAgICYmIGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9BU1NJR04pCiAgICAgICAgICYmIGNodW5rX2lzX3Rva2VuKG5uZXh0LCBDVF9TRU1JQ09M
T04pCiAgICAgICAgICYmICggIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0RFRkFVTFQpCiAg
ICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0RFTEVURSkKICAgICAgICAg
ICAgfHwgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX05VTUJFUikgJiYgY2h1bmtfaXNfc3Ry
KG5leHQsICIwIiwgMSkpKSkKICAgICAgewogICAgICAgICBjb25zdCBzaXplX3QgbGV2ZWwg
ICAgICAgID0gcGMtPmxldmVsOwogICAgICAgICBib29sICAgICAgICAgZm91bmRfc3RhdHVz
ID0gZmFsc2U7CiAgICAgICAgIGNodW5rX3QgICAgICAqcHByZXYgICAgICAgPSBjaHVua19n
ZXRfcHJldihwYyk7CgogICAgICAgICBmb3IgKCA7ICggIHBwcmV2ICE9IG51bGxwdHIKICAg
ICAgICAgICAgICAgICAmJiBwcHJldi0+bGV2ZWwgPj0gbGV2ZWwKICAgICAgICAgICAgICAg
ICAmJiBwcHJldi0+dHlwZSAhPSBDVF9TRU1JQ09MT04KICAgICAgICAgICAgICAgICAmJiBw
cHJldi0+dHlwZSAhPSBDVF9BQ0NFU1NfQ09MT04pCiAgICAgICAgICAgICAgIDsgcHByZXYg
PSBjaHVua19nZXRfcHJldihwcHJldikpCiAgICAgICAgIHsKICAgICAgICAgICAgaWYgKHBw
cmV2LT5sZXZlbCAhPSBsZXZlbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBjb250
aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG5l
eHQsIENUX05VTUJFUikpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgaWYgKCAgcHBy
ZXYtPnR5cGUgPT0gQ1RfUVVBTElGSUVSCiAgICAgICAgICAgICAgICAgICYmIGNodW5rX2lz
X3N0cihwcHJldiwgInZpcnR1YWwiLCA3KSkKICAgICAgICAgICAgICAgewogICAgICAgICAg
ICAgICAgICBmb3VuZF9zdGF0dXMgPSB0cnVlOwogICAgICAgICAgICAgICAgICBicmVhazsK
ICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAg
ICAgICAgewogICAgICAgICAgICAgICBpZiAoICBwcHJldi0+dHlwZSA9PSBDVF9GVU5DX0NM
QVNTX1BST1RPICAvLyBjdG9yL2R0b3IKICAgICAgICAgICAgICAgICAgfHwgcHByZXYtPnR5
cGUgPT0gQ1RfRlVOQ19QUk9UTykgICAgICAgLy8gbm9ybWFsIGZ1bmN0aW9uCiAgICAgICAg
ICAgICAgIHsKICAgICAgICAgICAgICAgICAgZm91bmRfc3RhdHVzID0gdHJ1ZTsKICAgICAg
ICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg
ICAgICB9CgogICAgICAgICBpZiAoZm91bmRfc3RhdHVzKQogICAgICAgICB7CiAgICAgICAg
ICAgIHNldF9jaHVua19wYXJlbnQocGMsIHBwcmV2LT50eXBlKTsKICAgICAgICAgfQogICAg
ICB9CiAgICAgIC8vIElzc3VlICMyMzMyCiAgICAgIGJvb2wgd2VfaGF2ZV9hX2Nhc2VfYmVm
b3JlID0gZmFsc2U7CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0NPTE9OKSkK
ICAgICAgewogICAgICAgICAvLyBjaGVjayBpZiB3ZSBoYXZlIGEgY2FzZSBiZWZvcmUKICAg
ICAgICAgY2h1bmtfdCAqc3dpdGNoX2JlZm9yZSA9IGNodW5rX2dldF9wcmV2X3R5cGUocGMs
IENUX0NBU0UsIHBjLT5sZXZlbCk7CgogICAgICAgICBpZiAoc3dpdGNoX2JlZm9yZSAhPSBu
dWxscHRyKQogICAgICAgICB7CiAgICAgICAgICAgIExPR19GTVQoTEZDTlIsICIlcyglZCk6
IHN3aXRjaF9iZWZvcmUtPm9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4
dCgpIGlzICclcycsIHR5cGUgaXMgJXNcbiIsCiAgICAgICAgICAgICAgICAgICAgX19mdW5j
X18sIF9fTElORV9fLCBzd2l0Y2hfYmVmb3JlLT5vcmlnX2xpbmUsIHN3aXRjaF9iZWZvcmUt
Pm9yaWdfY29sLAogICAgICAgICAgICAgICAgICAgIHN3aXRjaF9iZWZvcmUtPnRleHQoKSwg
Z2V0X3Rva2VuX25hbWUoc3dpdGNoX2JlZm9yZS0+dHlwZSkpOwogICAgICAgICAgICB3ZV9o
YXZlX2FfY2FzZV9iZWZvcmUgPSB0cnVlOwogICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8v
IERldGVjdCBhIGJyYWNlZC1pbml0LWxpc3QKICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4o
cGMsIENUX1dPUkQpCiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9UWVBFKQog
ICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQVNTSUdOKQogICAgICAgICB8fCBj
aHVua19pc190b2tlbihwYywgQ1RfUkVUVVJOKQogICAgICAgICB8fCBjaHVua19pc190b2tl
bihwYywgQ1RfQ09NTUEpCiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BTkdM
RV9DTE9TRSkKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NRVUFSRV9DTE9T
RSkKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RTUVVBUkUpCiAgICAgICAg
IHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9GUEFSRU5fT1BFTikKICAgICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX1FVRVNUSU9OKQogICAgICAgICB8fCAoICBjaHVua19pc190
b2tlbihwYywgQ1RfQ09MT04pCiAgICAgICAgICAgICYmICF3ZV9oYXZlX2FfY2FzZV9iZWZv
cmUpCiAgICAgICAgIHx8ICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9CUkFDRV9PUEVOKQog
ICAgICAgICAgICAmJiAoICBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09IENUX05PTkUK
ICAgICAgICAgICAgICAgfHwgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9CUkFD
RURfSU5JVF9MSVNUKSkpCiAgICAgIHsKICAgICAgICAgbG9nX3BjZl9mbGFncyhMRkNOUiwg
cGMtPmZsYWdzKTsKICAgICAgICAgYXV0byBicmFjZV9vcGVuID0gY2h1bmtfZ2V0X25leHRf
bmNubChwYyk7CgogICAgICAgICBpZiAoICBjaHVua19pc190b2tlbihicmFjZV9vcGVuLCBD
VF9CUkFDRV9PUEVOKQogICAgICAgICAgICAmJiAoICBnZXRfY2h1bmtfcGFyZW50X3R5cGUo
YnJhY2Vfb3BlbikgPT0gQ1RfTk9ORQogICAgICAgICAgICAgICB8fCBnZXRfY2h1bmtfcGFy
ZW50X3R5cGUoYnJhY2Vfb3BlbikgPT0gQ1RfQVNTSUdOCiAgICAgICAgICAgICAgIHx8IGdl
dF9jaHVua19wYXJlbnRfdHlwZShicmFjZV9vcGVuKSA9PSBDVF9SRVRVUk4KICAgICAgICAg
ICAgICAgfHwgZ2V0X2NodW5rX3BhcmVudF90eXBlKGJyYWNlX29wZW4pID09IENUX0JSQUNF
RF9JTklUX0xJU1QpKQogICAgICAgICB7CiAgICAgICAgICAgIGxvZ19wY2ZfZmxhZ3MoTEZD
TlIsIGJyYWNlX29wZW4tPmZsYWdzKTsKICAgICAgICAgICAgYXV0byBicmFjZV9jbG9zZSA9
IGNodW5rX3NraXBfdG9fbWF0Y2gobmV4dCk7CgogICAgICAgICAgICBpZiAoY2h1bmtfaXNf
dG9rZW4oYnJhY2VfY2xvc2UsIENUX0JSQUNFX0NMT1NFKSkKICAgICAgICAgICAgewogICAg
ICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KGJyYWNlX29wZW4sIENUX0JSQUNFRF9JTklU
X0xJU1QpOwogICAgICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KGJyYWNlX2Nsb3NlLCBD
VF9CUkFDRURfSU5JVF9MSVNUKTsKCiAgICAgICAgICAgICAgIHRtcCA9IGNodW5rX2dldF9u
ZXh0X25jbmwoYnJhY2VfY2xvc2UpOwoKICAgICAgICAgICAgICAgaWYgKHRtcCkKICAgICAg
ICAgICAgICAgewogICAgICAgICAgICAgICAgICBjaHVua19mbGFnc19jbHIodG1wLCBQQ0Zf
RVhQUl9TVEFSVCB8IFBDRl9TVE1UX1NUQVJUKTsKICAgICAgICAgICAgICAgfQogICAgICAg
ICAgICAgICAvLyBUT0RPOiBDaGFuZ2UgcGMtPnR5cGUgQ1RfV09SRCAtPiBDVF9UWVBFCiAg
ICAgICAgICAgICAgIC8vIGZvciB0aGUgY2FzZSBDVF9BU1NJR04gKGFuZCBvdGhlcnMpLgoK
ICAgICAgICAgICAgICAgLy8gVE9ETzogTW92ZSB0aGlzIGJsb2NrIHRvIHRoZSBmaXhfZmNu
X2NhbGxfYXJncyBmdW5jdGlvbi4KICAgICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9XT1JEKSAmJiBwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fRkNOX0NBTEwpKQogICAg
ICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9U
WVBFKTsKICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAg
fQogICB9CgogICAvLyBDaGVjayBmb3Igc3R1ZmYgdGhhdCBjYW4gb25seSBvY2N1ciBhdCB0
aGUgc3RhcnQgb2YgYW4gZXhwcmVzc2lvbgogICBpZiAoICBwYy0+ZmxhZ3MudGVzdChQQ0Zf
RVhQUl9TVEFSVCkKICAgICAgfHwgKHByZXYtPmZsYWdzLnRlc3QoUENGX0VYUFJfU1RBUlQp
ICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgPT0gQ1RfT0NfQVQpKQogICB7CiAgICAg
IC8vIENoYW5nZSBTVEFSLCBNSU5VUywgYW5kIFBMVVMgaW4gdGhlIGVhc3kgY2FzZXMKICAg
ICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TVEFSKSkKICAgICAgewogICAgICAgICAv
LyBpc3N1ZSAjNTk2CiAgICAgICAgIC8vIFsweDEwMDA2MjAyMDpJTl9TUEFSRU4sSU5fRk9S
LFNUTVRfU1RBUlQsRVhQUl9TVEFSVCxQVU5DVFVBVE9SXQogICAgICAgICAvLyBwcmV2LT50
eXBlIGlzIENUX0NPTE9OID09PiBDVF9ERVJFRgogICAgICAgICBpZiAoY2h1bmtfaXNfdG9r
ZW4ocHJldiwgQ1RfQU5HTEVfQ0xPU0UpKQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9j
aHVua190eXBlKHBjLCBDVF9QVFJfVFlQRSk7CiAgICAgICAgIH0KICAgICAgICAgZWxzZSBp
ZiAoY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfQ09MT04pKQogICAgICAgICB7CiAgICAgICAg
ICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9ERVJFRik7CiAgICAgICAgIH0KICAgICAgICAg
ZWxzZQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9ERVJF
Rik7CiAgICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCAgbGFuZ3VhZ2VfaXNfc2V0KExB
TkdfQ1BQKQogICAgICAgICAmJiBjaHVua19pc190b2tlbihwYywgQ1RfQ0FSRVQpCiAgICAg
ICAgICYmIGNodW5rX2lzX3Rva2VuKHByZXYsIENUX0FOR0xFX0NMT1NFKSkKICAgICAgewog
ICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfUFRSX1RZUEUpOwogICAgICB9CgogICAg
ICBpZiAoICBsYW5ndWFnZV9pc19zZXQoTEFOR19DUykKICAgICAgICAgJiYgKGNodW5rX2lz
X3Rva2VuKHBjLCBDVF9RVUVTVElPTikpCiAgICAgICAgICYmIChjaHVua19pc190b2tlbihw
cmV2LCBDVF9BTkdMRV9DTE9TRSkpKQogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBl
KHBjLCBDVF9QVFJfVFlQRSk7CiAgICAgIH0KCiAgICAgIGlmIChjaHVua19pc190b2tlbihw
YywgQ1RfTUlOVVMpKQogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9O
RUcpOwogICAgICB9CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1BMVVMpKQog
ICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9QT1MpOwogICAgICB9Cgog
ICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0lOQ0RFQ19BRlRFUikpCiAgICAgIHsK
ICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0lOQ0RFQ19CRUZPUkUpOwogICAgICB9
CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FNUCkpCiAgICAgIHsKICAgICAg
ICAgaWYgKGNodW5rX2lzX3Rva2VuKHByZXYsIENUX0FOR0xFX0NMT1NFKSkgICAgICAgICAg
ICAgLy8gSXNzdWUgIzIzMjQKICAgICAgICAgewogICAgICAgICAgICBzZXRfY2h1bmtfdHlw
ZShwYywgQ1RfQllSRUYpOwogICAgICAgICB9CiAgICAgICAgIGVsc2UKICAgICAgICAgewog
ICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfQUREUik7CiAgICAgICAgIH0KICAg
ICAgfQoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DQVJFVCkpCiAgICAgIHsK
ICAgICAgICAgaWYgKGxhbmd1YWdlX2lzX3NldChMQU5HX0MgfCBMQU5HX0NQUCB8IExBTkdf
T0MpKQogICAgICAgICB7CiAgICAgICAgICAgIC8vIFRoaXMgaXMgbGlrZWx5IHRoZSBzdGFy
dCBvZiBhIGJsb2NrIGxpdGVyYWwKICAgICAgICAgICAgaGFuZGxlX29jX2Jsb2NrX2xpdGVy
YWwocGMpOwogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgLy8gRGV0ZWN0IGEgdmFyaWFi
bGUgZGVmaW5pdGlvbiB0aGF0IHN0YXJ0cyB3aXRoIHN0cnVjdC9lbnVtL3VuaW9uL2NsYXNz
CiAgIGlmICggICFwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fVFlQRURFRikKICAgICAgJiYgZ2V0
X2NodW5rX3BhcmVudF90eXBlKHByZXYpICE9IENUX0NQUF9DQVNUCiAgICAgICYmICFwcmV2
LT5mbGFncy50ZXN0KFBDRl9JTl9GQ05fREVGKQogICAgICAmJiAoICBjaHVua19pc190b2tl
bihwYywgQ1RfU1RSVUNUKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfVU5J
T04pCiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DTEFTUykKICAgICAgICAg
fHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0VOVU0pKSkKICAgewogICAgICB0bXAgPSBjaHVu
a19za2lwX2RjX21lbWJlcihuZXh0KTsKCiAgICAgIGlmICgoY2h1bmtfaXNfdG9rZW4odG1w
LCBDVF9UWVBFKSB8fCBjaHVua19pc190b2tlbih0bXAsIENUX1dPUkQpKSkKICAgICAgewog
ICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgcGMtPnR5cGUpOwogICAgICAgICBzZXRf
Y2h1bmtfdHlwZSh0bXAsIENUX1RZUEUpOwoKICAgICAgICAgdG1wID0gY2h1bmtfZ2V0X25l
eHRfbmNubCh0bXApOwogICAgICB9CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBD
VF9CUkFDRV9PUEVOKSkKICAgICAgewogICAgICAgICB0bXAgPSBjaHVua19za2lwX3RvX21h
dGNoKHRtcCk7CgogICAgICAgICBpZiAodG1wICE9IG51bGxwdHIpCiAgICAgICAgIHsKICAg
ICAgICAgICAgdG1wID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXApOwogICAgICAgICB9CiAg
ICAgIH0KCiAgICAgIGlmICggIHRtcCAhPSBudWxscHRyCiAgICAgICAgICYmIChjaHVua19p
c19wdHJfb3BlcmF0b3IodG1wKSB8fCBjaHVua19pc190b2tlbih0bXAsIENUX1dPUkQpKSkK
ICAgICAgewogICAgICAgICBtYXJrX3ZhcmlhYmxlX2RlZmluaXRpb24odG1wKTsKICAgICAg
fQogICB9CgogICAvKgogICAgKiBDaGFuZ2UgdGhlIHBhcmVudGhlc2lzIHBhaXIgYWZ0ZXIg
YSBmdW5jdGlvbi9tYWNyby1mdW5jdGlvbgogICAgKiBDVF9QQVJFTl9PUEVOID0+IENUX0ZQ
QVJFTl9PUEVOCiAgICAqLwogICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX01BQ1JPX0ZV
TkMpKQogICB7CiAgICAgIGZsYWdfcGFyZW5zKG5leHQsIFBDRl9JTl9GQ05fQ0FMTCwgQ1Rf
RlBBUkVOX09QRU4sIENUX01BQ1JPX0ZVTkMsIGZhbHNlKTsKICAgfQoKICAgaWYgKCAgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX01BQ1JPX09QRU4pCiAgICAgIHx8IGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9NQUNST19FTFNFKQogICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfTUFD
Uk9fQ0xPU0UpKQogICB7CiAgICAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9QQVJF
Tl9PUEVOKSkKICAgICAgewogICAgICAgICBmbGFnX3BhcmVucyhuZXh0LCBQQ0ZfTk9ORSwg
Q1RfRlBBUkVOX09QRU4sIHBjLT50eXBlLCBmYWxzZSk7CiAgICAgIH0KICAgfQoKICAgaWYg
KGNodW5rX2lzX3Rva2VuKHBjLCBDVF9ERUxFVEUpICYmIGNodW5rX2lzX3Rva2VuKG5leHQs
IENUX1RTUVVBUkUpKQogICB7CiAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgQ1RfREVM
RVRFKTsKICAgfQoKICAgLy8gQ2hhbmdlIENUX1NUQVIgdG8gQ1RfUFRSX1RZUEUgb3IgQ1Rf
QVJJVEggb3IgQ1RfREVSRUYKICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NUQVIp
CiAgICAgIHx8IChsYW5ndWFnZV9pc19zZXQoTEFOR19DUFApICYmIGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9DQVJFVCkpKQogICB7CiAgICAgIGlmIChjaHVua19pc19wYXJlbl9jbG9zZShu
ZXh0KSB8fCBjaHVua19pc190b2tlbihuZXh0LCBDVF9DT01NQSkpCiAgICAgIHsKICAgICAg
ICAgc2V0X2NodW5rX3R5cGUocGMsIENUX1BUUl9UWVBFKTsKICAgICAgfQogICAgICBlbHNl
IGlmIChsYW5ndWFnZV9pc19zZXQoTEFOR19PQykgJiYgY2h1bmtfaXNfdG9rZW4obmV4dCwg
Q1RfU1RBUikpCiAgICAgIHsKICAgICAgICAgLyoKICAgICAgICAgICogQ2hhbmdlIHBvaW50
ZXItdG8tcG9pbnRlciB0eXBlcyBpbiBPQ19NU0dfREVDTHMKICAgICAgICAgICogZnJvbSBB
UklUSCA8PT09PiBERVJFRiB0byBQVFJfVFlQRSA8PT09PiBQVFJfVFlQRQogICAgICAgICAg
Ki8KICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX1BUUl9UWVBFKTsKICAgICAgICAg
c2V0X2NodW5rX3BhcmVudChwYywgZ2V0X2NodW5rX3BhcmVudF90eXBlKHByZXYpKTsKCiAg
ICAgICAgIHNldF9jaHVua190eXBlKG5leHQsIENUX1BUUl9UWVBFKTsKICAgICAgICAgc2V0
X2NodW5rX3BhcmVudChuZXh0LCBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpKTsKICAgICAg
fQogICAgICBlbHNlIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TVEFSKQogICAgICAg
ICAgICAgICYmICggIGNodW5rX2lzX3Rva2VuKHByZXYsIENUX0RFQ0xUWVBFKQogICAgICAg
ICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHByZXYsIENUX1NJWkVPRikKICAgICAgICAg
ICAgICAgICB8fCBjaHVua19pc190b2tlbihwcmV2LCBDVF9ERUxFVEUpCiAgICAgICAgICAg
ICAgICAgfHwgKHBjICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgPT0gQ1RfU0laRU9G
KSkpCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0RFUkVGKTsKICAg
ICAgfQogICAgICBlbHNlIGlmICggICggIGNodW5rX2lzX3Rva2VuKHByZXYsIENUX1dPUkQp
CiAgICAgICAgICAgICAgICAgJiYgY2h1bmtfZW5kc190eXBlKHByZXYpCiAgICAgICAgICAg
ICAgICAgJiYgIXByZXYtPmZsYWdzLnRlc3QoUENGX0lOX0ZDTl9DVE9SKSkKICAgICAgICAg
ICAgICB8fCBjaHVua19pc190b2tlbihwcmV2LCBDVF9EQ19NRU1CRVIpCiAgICAgICAgICAg
ICAgfHwgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfUFRSX1RZUEUpKQogICAgICB7CiAgICAg
ICAgIExPR19GTVQoTEZDTlIsICIlcyglZCk6IHBjLT5vcmlnX2xpbmUgaXMgJXp1LCBvcmln
X2NvbCBpcyAlenUsIHRleHQoKSBpcyAnJXMnLCB0eXBlIGlzICVzXG4gICAiLAogICAgICAg
ICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdf
Y29sLCBwYy0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSkpOwogICAgICAgICBs
b2dfcGNmX2ZsYWdzKExGQ05SLCBwYy0+ZmxhZ3MpOwogICAgICAgICBzZXRfY2h1bmtfdHlw
ZShwYywgQ1RfUFRSX1RZUEUpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rv
a2VuKG5leHQsIENUX1NRVUFSRV9PUEVOKSAmJiAhbGFuZ3VhZ2VfaXNfc2V0KExBTkdfT0Mp
KSAgLy8gaXNzdWUgIyA0MDgKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywg
Q1RfUFRSX1RZUEUpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBj
LCBDVF9TVEFSKSkKICAgICAgewogICAgICAgICAvLyBBZGQgY2hlY2sgZm9yIENUX0RDX01F
TUJFUiBDVF9XT1JEIENUX1NUQVIgc2VxdWVuY2UKICAgICAgICAgLy8gdG8gY29udmVydCBD
VF9XT1JEIGludG8gQ1RfVFlQRQogICAgICAgICAvLyBhbmQgQ1RfU1RBUiBpbnRvIENUX1BU
Ul9UWVBFCiAgICAgICAgIC8vIGxvb2sgZm9yIGFuIGFzc2lnbiBiYWNrd2FyZCB0byBkaXN0
aW5ndWlzaCBiZXR3ZWVuCiAgICAgICAgIC8vICAgIGRvdWJsZSByZXN1bHQgPSBDb25zdGFu
dHM6OlBJICogZmFjdG9yOwogICAgICAgICAvLyBhbmQKICAgICAgICAgLy8gICAgOjpzb21l
OjpuYW1lICogZm9vOwogICAgICAgICBpZiAoICBjaHVua19pc190b2tlbihwcmV2LCBDVF9X
T1JEKQogICAgICAgICAgICAmJiBjaHVua19pc190b2tlbihwcmV2LT5wcmV2LCBDVF9EQ19N
RU1CRVIpCiAgICAgICAgICAgICYmIGxhbmd1YWdlX2lzX3NldChMQU5HX0NQUCkpCiAgICAg
ICAgIHsKICAgICAgICAgICAgLy8gSXNzdWUgMTQwMgogICAgICAgICAgICBib29sIGFzc2ln
bl9mb3VuZCA9IGZhbHNlOwogICAgICAgICAgICB0bXAgPSBwYzsKCiAgICAgICAgICAgIHdo
aWxlICh0bXAgIT0gbnVsbHB0cikKICAgICAgICAgICAgewogICAgICAgICAgICAgICBpZiAo
Y2h1bmtfaXNfdG9rZW4odG1wLCBDVF9TRU1JQ09MT04pKQogICAgICAgICAgICAgICB7CiAg
ICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg
IGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfQVNTSUdOKSkKICAgICAgICAgICAg
ICAgewogICAgICAgICAgICAgICAgICBhc3NpZ25fZm91bmQgPSB0cnVlOwogICAgICAgICAg
ICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICB0bXAgPSBj
aHVua19nZXRfcHJldl9uY25sbmkodG1wKTsgLy8gSXNzdWUgIzIyNzkKICAgICAgICAgICAg
fQoKICAgICAgICAgICAgaWYgKGFzc2lnbl9mb3VuZCkKICAgICAgICAgICAgewogICAgICAg
ICAgICAgICAvLyBkb3VibGUgcmVzdWx0ID0gQ29uc3RhbnRzOjpQSSAqIGZhY3RvcjsKICAg
ICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0FSSVRIKTsKICAgICAgICAgICAg
fQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgLy8gICAg
Ojpzb21lOjpuYW1lICogZm9vOwogICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwcmV2
LCBDVF9UWVBFKTsKICAgICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX1BUUl9U
WVBFKTsKICAgICAgICAgICAgfQogICAgICAgICB9CgogICAgICAgICAvKgogICAgICAgICAg
KiBBIHN0YXIgY2FuIGhhdmUgdGhyZWUgbWVhbmluZ3MKICAgICAgICAgICogMS4gQ1RfREVS
RUYgICAgPSBwb2ludGVyIGRlcmVmZXJlbmNpbmcKICAgICAgICAgICogMi4gQ1RfUFRSX1RZ
UEUgPSBwb2ludGVyIGRlZmluaXRpb24KICAgICAgICAgICogMy4gQ1RfQVJJVEggICAgPSBh
cml0aG1ldGljIG11bHRpcGxpY2F0aW9uCiAgICAgICAgICAqCiAgICAgICAgICAqIG1vc3Qg
UENGX1BVTkNUVUFUT1IgY2h1bmtzIGV4Y2VwdCBhIHBhcmVuIGNsb3NlIHdvdWxkIG1ha2Ug
dGhpcwogICAgICAgICAgKiBhIGRlcmVmLiBBIHBhcmVuIGNsb3NlIG1heSBlbmQgYSBjYXN0
IG9yIG1heSBiZSBwYXJ0IG9mIGEgbWFjcm8gZmNuLgogICAgICAgICAgKi8KICAgICAgICAg
aWYgKGNodW5rX2lzX3Rva2VuKHByZXYsIENUX1RZUEUpKQogICAgICAgICB7CiAgICAgICAg
ICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9QVFJfVFlQRSk7CiAgICAgICAgIH0KICAgICAg
ICAgZWxzZSBpZiAoICBjaHVua19pc190b2tlbihwYy0+bmV4dCwgQ1RfU0VNSUNPTE9OKSAg
ICAgIC8vIElzc3VlICMyMzE5CiAgICAgICAgICAgICAgICAgfHwgKCAgY2h1bmtfaXNfdG9r
ZW4ocGMtPm5leHQsIENUX1NUQVIpCiAgICAgICAgICAgICAgICAgICAgJiYgY2h1bmtfaXNf
dG9rZW4ocGMtPm5leHQtPm5leHQsIENUX1NFTUlDT0xPTikpKQogICAgICAgICB7CiAgICAg
ICAgICAgIC8vIGV4YW1wbGU6CiAgICAgICAgICAgIC8vICAgIHVzaW5nIEFic3RyYWN0TGlu
a1B0ciA9IEFic3RyYWN0TGluayo7CiAgICAgICAgICAgIC8vICAgIHVzaW5nIEFic3RyYWN0
TGlua1B0clB0ciA9IEFic3RyYWN0TGluayoqOwogICAgICAgICAgICBzZXRfY2h1bmtfdHlw
ZShwYywgQ1RfUFRSX1RZUEUpOwogICAgICAgICB9CiAgICAgICAgIGVsc2UgaWYgKCAgKCAg
Z2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9GVU5DX0RFRgogICAgICAgICAgICAg
ICAgICAgICYmIChjaHVua19pc19vcGVuaW5nX2JyYWNlKG5leHQpIHx8IGNodW5rX2lzX3N0
YXIocGMtPm5leHQpKSkKICAgICAgICAgICAgICAgICB8fCAobmV4dC0+dHlwZSA9PSBDVF9R
VUFMSUZJRVIpKSAgICAgICAgICAgICAgIC8vIElzc3VlICMyNjQ4CiAgICAgICAgIHsKICAg
ICAgICAgICAgLy8gZXhhbXBsZToKICAgICAgICAgICAgLy8gYXV0byBnZXRDb21wb25lbnQo
Q29sb3IgKmNvbG9yKSAtPiBDb21wb25lbnQgKiB7CiAgICAgICAgICAgIC8vIGF1dG8gZ2V0
Q29tcG9uZW50KENvbG9yICpjb2xvcikgLT4gQ29tcG9uZW50ICoqIHsKICAgICAgICAgICAg
Ly8gYXV0byBnZXRDb21wb25lbnQoQ29sb3IgKmNvbG9yKSAtPiBDb21wb25lbnQgKiBfTm9u
bnVsbAogICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfUFRSX1RZUEUpOwogICAg
ICAgICB9CiAgICAgICAgIGVsc2UgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMtPm5leHQsIENU
X1NFTUlDT0xPTikgICAgICAvLyBJc3N1ZSAjMjMxOQogICAgICAgICAgICAgICAgIHx8ICgg
IGNodW5rX2lzX3Rva2VuKHBjLT5uZXh0LCBDVF9TVEFSKQogICAgICAgICAgICAgICAgICAg
ICYmIGNodW5rX2lzX3Rva2VuKHBjLT5uZXh0LT5uZXh0LCBDVF9TVEFSKSkpCiAgICAgICAg
IHsKICAgICAgICAgICAgLy8gbW9yZSBwb2ludGVycyBhcmUgTk9UIHlldCBwb3NzaWJsZQog
ICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIlRvbyBtYW55IHBvaW50ZXJzXG4iKTsKICAg
ICAgICAgICAgZnByaW50ZihzdGRlcnIsICJhdCBsaW5lICV6dSwgY29sdW1uICV6dS5cbiIs
IHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCk7CiAgICAgICAgICAgIGZwcmludGYoc3Rk
ZXJyLCAiUGxlYXNlIG1ha2UgYSByZXBvcnQuXG4iKTsKICAgICAgICAgICAgbG9nX2ZsdXNo
KHRydWUpOwogICAgICAgICAgICBleGl0KEVYX1NPRlRXQVJFKTsKICAgICAgICAgfQogICAg
ICAgICBlbHNlCiAgICAgICAgIHsKICAgICAgICAgICAgLy8gSXNzdWUgMTQwMgogICAgICAg
ICAgICBzZXRfY2h1bmtfdHlwZShwYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgKCAg
cHJldi0+ZmxhZ3MudGVzdChQQ0ZfUFVOQ1RVQVRPUikKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgJiYgKCAgIWNodW5rX2lzX3BhcmVuX2Nsb3NlKHByZXYpCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHByZXYsIENUX1NQQVJFTl9DTE9T
RSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgZ2V0X2NodW5rX3BhcmVudF90
eXBlKHByZXYpID09IENUX01BQ1JPX0ZVTkMpCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICYmIHByZXYtPnR5cGUgIT0gQ1RfU1FVQVJFX0NMT1NFCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICYmIHByZXYtPnR5cGUgIT0gQ1RfRENfTUVNQkVSKSA/IENUX0RFUkVGIDogQ1Rf
QVJJVEgpOwogICAgICAgICB9CgogICAgICAgICBpZiAocGMtPmZsYWdzLnRlc3QoUENGX0lO
X1RZUEVERUYpKSAgLy8gSXNzdWUgIzEyNTUvIzYzMwogICAgICAgICB7CiAgICAgICAgICAg
IHRtcCA9IHBjOwoKICAgICAgICAgICAgd2hpbGUgKHRtcCAhPSBudWxscHRyKQogICAgICAg
ICAgICB7CiAgICAgICAgICAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfU0VN
SUNPTE9OKQogICAgICAgICAgICAgICAgICB8fCBjaHVua19pc190b2tlbih0bXAsIENUX0JS
QUNFX09QRU4pKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwog
ICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2Vu
KHRtcCwgQ1RfVFlQRURFRikpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg
c2V0X2NodW5rX3R5cGUocGMsIENUX1BUUl9UWVBFKTsKICAgICAgICAgICAgICAgfQogICAg
ICAgICAgICAgICB0bXAgPSBjaHVua19nZXRfcHJldl9uY25sbmkodG1wKTsgLy8gSXNzdWUg
IzIyNzkKICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgaWYgKGNo
dW5rX2lzX3Rva2VuKHBjLCBDVF9BTVApKQogICB7CiAgICAgIGlmIChjaHVua19pc190b2tl
bihwcmV2LCBDVF9ERUxFVEUpKQogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHBj
LCBDVF9BRERSKTsKICAgICAgfQogICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihwcmV2
LCBDVF9UWVBFKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfQllS
RUYpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0ZQ
QVJFTl9DTE9TRSkgfHwgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfQ09NTUEpKQogICAgICB7
CiAgICAgICAgIC8vIGZpeCB0aGUgYnVnICM2NTQKICAgICAgICAgLy8gY29ubmVjdCgmbWFw
cGVyLCBTSUdOQUwobWFwcGVkKFFTdHJpbmcgJikpLCB0aGlzLCBTTE9UKG9uU29tZUV2ZW50
KFFTdHJpbmcgJikpKTsKICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0JZUkVGKTsK
ICAgICAgfQogICAgICBlbHNlIGlmIChnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09IENU
X1VTSU5HX0FMSUFTKQogICAgICB7CiAgICAgICAgIC8vIGZpeCB0aGUgSXNzdWUgIyAxNjg5
CiAgICAgICAgIC8vIHVzaW5nIHJlZmVyZW5jZSA9IHZhbHVlX3R5cGUgJjsKICAgICAgICAg
c2V0X2NodW5rX3R5cGUocGMtPnByZXYsIENUX1RZUEUpOwogICAgICAgICBzZXRfY2h1bmtf
dHlwZShwYywgQ1RfQllSRUYpOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAg
ICAvLyBJc3N1ZSAjIDEzOTgKICAgICAgICAgaWYgKCAgcGMtPmZsYWdzLnRlc3QoUENGX0lO
X0ZDTl9ERUYpCiAgICAgICAgICAgICYmIGNodW5rX2lzX3Rva2VuKHByZXYsIENUX1dPUkQp
CiAgICAgICAgICAgICYmIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BTVApCiAgICAgICAgICAg
ICYmIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1dPUkQpKQogICAgICAgICB7CiAgICAgICAg
ICAgIC8qCiAgICAgICAgICAgICAqIENoYW5nZSBDVF9XT1JEIGJlZm9yZSBDVF9BTVAgYmVm
b3JlIENUX1dPUkQgdG8gQ1RfVFlQRQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgc2V0
X2NodW5rX3R5cGUocHJldiwgQ1RfVFlQRSk7CiAgICAgICAgIH0KICAgICAgICAgZWxzZQog
ICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9BUklUSCk7Cgog
ICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfV09SRCkpCiAgICAgICAg
ICAgIHsKICAgICAgICAgICAgICAgdG1wID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHByZXYp
OyAvLyBJc3N1ZSAjMjI3OQoKICAgICAgICAgICAgICAgaWYgKHRtcCAhPSBudWxscHRyKQog
ICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGlmICggIGNodW5rX2lzX3NlbWlj
b2xvbih0bXApCiAgICAgICAgICAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwg
Q1RfQlJBQ0VfT1BFTikKICAgICAgICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4o
dG1wLCBDVF9RVUFMSUZJRVIpKQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAg
ICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9CWVJFRik7CiAgICAgICAgICAgICAgICAg
ICAgIHNldF9jaHVua190eXBlKHByZXYsIENUX1RZUEUpOwoKICAgICAgICAgICAgICAgICAg
ICAgaWYgKCEoICBjaHVua19pc190b2tlbihuZXh0LCBDVF9PUEVSQVRPUikKICAgICAgICAg
ICAgICAgICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihuZXh0LCBDVF9UWVBFKQogICAg
ICAgICAgICAgICAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0RDX01F
TUJFUikpKQogICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAg
IExPR19GTVQoTEZDTlIsICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlz
ICV6dSwgdGV4dCgpICclcycsIHNldCBQQ0ZfVkFSXzFTVFxuIiwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBj
LT5vcmlnX2NvbCwgcGMtPnRleHQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5r
X2ZsYWdzX3NldChuZXh0LCBQQ0ZfVkFSXzFTVCk7CiAgICAgICAgICAgICAgICAgICAgIH0K
ICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIGlmIChjaHVua19p
c190b2tlbih0bXAsIENUX0RDX01FTUJFUikpCiAgICAgICAgICAgICAgICAgIHsKICAgICAg
ICAgICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUocHJldiwgQ1RfVFlQRSk7CgogICAgICAg
ICAgICAgICAgICAgICBpZiAoIWNodW5rX2lzX3Rva2VuKG5leHQsIENUX1RZUEUpKSAgICAg
ICAgICAgIC8vIElzc3VlICMyMTAzCiAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAg
ICAgICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0JZUkVGKTsKICAgICAgICAg
ICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIH0KICAg
ICAgICAgICAgfQogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgaWYgKGNodW5rX2lzX3Rv
a2VuKHBjLCBDVF9NSU5VUykgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1BMVVMpKQogICB7
CiAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKHByZXYsIENUX1BPUykKICAgICAgICAgfHwg
Y2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfTkVHKQogICAgICAgICB8fCBjaHVua19pc190b2tl
bihwcmV2LCBDVF9BUklUSCkpCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMs
IChwYy0+dHlwZSA9PSBDVF9NSU5VUykgPyBDVF9ORUcgOiBDVF9QT1MpOwogICAgICB9CiAg
ICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHByZXYsIENUX09DX0NMQVNTKSkKICAgICAg
ewogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9N
SU5VUykpID8gQ1RfTkVHIDogQ1RfUE9TKTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsK
ICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0FSSVRIKTsKICAgICAgfQogICB9Cgog
ICAvKgogICAgKiBCdWcgIyA2MzQKICAgICogQ2hlY2sgZm9yIGV4dGVybiAiQyIgTlNTdHJp
bmcqIGk7CiAgICAqIE5TU3RyaW5nIGlzIGEgdHlwZQogICAgKiBjaGFuZ2UgQ1RfV09SRCA9
PiBDVF9UWVBFICAgICBmb3IgcGMKICAgICogY2hhbmdlIENUX1NUQVIgPT4gQ1RfUFRSX1RZ
UEUgZm9yIHBjLW5leHQKICAgICovCiAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfV09S
RCkpICAgICAvLyBoZXJlIE5TU3RyaW5nCiAgIHsKICAgICAgaWYgKHBjLT5uZXh0ICE9IG51
bGxwdHIpICAgICAgICAgIC8vIGhlcmUgKgogICAgICB7CiAgICAgICAgIGlmIChwYy0+bmV4
dC0+dHlwZSA9PSBDVF9TVEFSKSAvLyBoZXJlICoKICAgICAgICAgewogICAgICAgICAgICAv
LyBjb21wYXJlIHRleHQgd2l0aCAiQyIgdG8gZmluZCBleHRlcm4gIkMiIGluc3RydWN0aW9u
cwogICAgICAgICAgICBpZiAocGMtPnByZXYgIT0gbnVsbHB0cikKICAgICAgICAgICAgewog
ICAgICAgICAgICAgICBpZiAocGMtPnByZXYtPnR5cGUgPT0gQ1RfU1RSSU5HKQogICAgICAg
ICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGlmICh1bmNfdGV4dDo6Y29tcGFyZShwYy0+
cHJldi0+dGV4dCgpLCAiXCJDXCIiKSA9PSAwKQogICAgICAgICAgICAgICAgICB7CiAgICAg
ICAgICAgICAgICAgICAgIGlmIChwYy0+cHJldi0+cHJldi0+dHlwZSA9PSBDVF9FWFRFUk4p
CiAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0X2No
dW5rX3R5cGUocGMsIENUX1RZUEUpOyAgICAgICAgICAgIC8vIGNoYW5nZSBDVF9XT1JEID0+
IENUX1RZUEUKICAgICAgICAgICAgICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMtPm5l
eHQsIENUX1BUUl9UWVBFKTsgIC8vIGNoYW5nZSBDVF9TVEFSID0+IENUX1BUUl9UWVBFCiAg
ICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg
ICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElzc3VlICMzMjIgU1RETUVUSE9E
KEdldFZhbHVlcykoQlNUUiBic05hbWUsIFJFRkRBVEEqKiBwRGF0YSk7CiAgICAgICAgICAg
IGlmICggIChwYy0+bmV4dC0+bmV4dCAhPSBudWxscHRyKQogICAgICAgICAgICAgICAmJiBw
Yy0+bmV4dC0+bmV4dC0+dHlwZSA9PSBDVF9TVEFSCiAgICAgICAgICAgICAgICYmIHBjLT5m
bGFncy50ZXN0KFBDRl9JTl9DT05TVF9BUkdTKSkKICAgICAgICAgICAgewogICAgICAgICAg
ICAgICAvLyBjaGFuZ2UgQ1RfU1RBUiA9PiBDVF9QVFJfVFlQRQogICAgICAgICAgICAgICBz
ZXRfY2h1bmtfdHlwZShwYy0+bmV4dCwgQ1RfUFRSX1RZUEUpOwogICAgICAgICAgICAgICBz
ZXRfY2h1bmtfdHlwZShwYy0+bmV4dC0+bmV4dCwgQ1RfUFRSX1RZUEUpOwogICAgICAgICAg
ICB9CgogICAgICAgICAgICAvLyBJc3N1ZSAjMjIyIHdoYXRldmVyMyAqKGZ1bmNfcHRyKSgg
d2hhdGV2ZXI0ICpmb28yLCAuLi4KICAgICAgICAgICAgaWYgKCAgKHBjLT5uZXh0LT5uZXh0
ICE9IG51bGxwdHIpCiAgICAgICAgICAgICAgICYmIHBjLT5uZXh0LT5uZXh0LT50eXBlID09
IENUX1dPUkQKICAgICAgICAgICAgICAgJiYgcGMtPmZsYWdzLnRlc3QoUENGX0lOX0ZDTl9E
RUYpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIC8vIGxvb2sgZm9yIHRoZSBvcGVu
aW5nIHBhcmVudGhlc2lzCiAgICAgICAgICAgICAgIC8vIElzc3VlIDE0MDMKICAgICAgICAg
ICAgICAgdG1wID0gY2h1bmtfZ2V0X3ByZXZfdHlwZShwYywgQ1RfRlBBUkVOX09QRU4sIHBj
LT5sZXZlbCAtIDEpOwoKICAgICAgICAgICAgICAgaWYgKCAgdG1wICE9IG51bGxwdHIKICAg
ICAgICAgICAgICAgICAgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHRtcCkgIT0gQ1RfRlVO
Q19DVE9SX1ZBUikKICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBzZXRfY2h1
bmtfdHlwZShwYy0+bmV4dCwgQ1RfUFRSX1RZUEUpOwogICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgIH0KICAgICAgICAgfQogICAgICB9CiAgIH0KCiAgIC8qCiAgICAqIEJ1ZyAjIDYz
NAogICAgKiBDaGVjayBmb3IgX19hdHRyaWJ1dGVfXygodmlzaWJpbGl0eSAoImRlZmF1bHQi
KSkpIE5TU3RyaW5nKiBpOwogICAgKiBOU1N0cmluZyBpcyBhIHR5cGUKICAgICogY2hhbmdl
IENUX1dPUkQgPT4gQ1RfVFlQRSAgICAgZm9yIHBjCiAgICAqIGNoYW5nZSBDVF9TVEFSID0+
IENUX1BUUl9UWVBFIGZvciBwYy1uZXh0CiAgICAqLwogICBpZiAoY2h1bmtfaXNfdG9rZW4o
cGMsIENUX1dPUkQpKSAgICAgLy8gaGVyZSBOU1N0cmluZwogICB7CiAgICAgIGlmIChwYy0+
bmV4dCAhPSBudWxscHRyKSAgICAgICAgICAvLyBoZXJlICoKICAgICAgewogICAgICAgICBp
ZiAocGMtPm5leHQtPnR5cGUgPT0gQ1RfU1RBUikgLy8gaGVyZSAqCiAgICAgICAgIHsKICAg
ICAgICAgICAgdG1wID0gcGM7CgogICAgICAgICAgICB3aGlsZSAoKHRtcCAhPSBudWxscHRy
KSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1w
LCBDVF9BVFRSSUJVVEUpKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIExP
R19GTVQoTEZDTlIsICIlcyglZCk6IEFUVFJJQlVURSBmb3VuZCwgdHlwZSBpcyAlcywgdGV4
dCgpICclcydcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElO
RV9fLCBnZXRfdG9rZW5fbmFtZSh0bXAtPnR5cGUpLCB0bXAtPnRleHQoKSk7CiAgICAgICAg
ICAgICAgICAgIExPR19GTVQoTEZDTlIsICJmb3IgdG9rZW4sIHR5cGUgaXMgJXMsIHRleHQo
KSAnJXMnXG4iLCBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSksIHBjLT50ZXh0KCkpOwogICAg
ICAgICAgICAgICAgICAvLyBjaGFuZ2UgQ1RfV09SRCA9PiBDVF9UWVBFCiAgICAgICAgICAg
ICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9UWVBFKTsKICAgICAgICAgICAgICAgICAg
Ly8gY2hhbmdlIENUX1NUQVIgPT4gQ1RfUFRSX1RZUEUKICAgICAgICAgICAgICAgICAgc2V0
X2NodW5rX3R5cGUocGMtPm5leHQsIENUX1BUUl9UWVBFKTsKICAgICAgICAgICAgICAgfQoK
ICAgICAgICAgICAgICAgaWYgKHRtcC0+ZmxhZ3MudGVzdChQQ0ZfU1RNVF9TVEFSVCkpCiAg
ICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgLy8gd2UgYXJlIGF0IGJlZ2lubmlu
ZyBvZiB0aGUgbGluZQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg
fQogICAgICAgICAgICAgICB0bXAgPSBjaHVua19nZXRfcHJldih0bXApOwogICAgICAgICAg
ICB9CiAgICAgICAgIH0KICAgICAgfQogICB9CgogICAvKgogICAgKiBJc3N1ZSAjIDE2ODkK
ICAgICogQ2hlY2sgZm9yIHVzaW5nIHJlZmVyZW5jZSA9IHZhbHVlX3R5cGUmOwogICAgKiBp
cyBpdCBhIFR5cGUgYWxpYXMsIGFsaWFzIHRlbXBsYXRlPwogICAgKi8KICAgaWYgKGNodW5r
X2lzX3Rva2VuKHBjLCBDVF9VU0lORykpCiAgIHsKICAgICAgLy8gbG9vayBmb3IgQ1RfQVNT
SUdOIGJlZm9yZSBDVF9TRU1JQ09MT04gYXQgdGhlIGVuZCBvZiB0aGUgc3RhdGVtZW50CiAg
ICAgIGJvb2wgICAgYXNzaWduX2ZvdW5kID0gZmFsc2U7CiAgICAgIGJvb2wgICAgaXNfcHJl
cHJvYyAgID0gcGMtPmZsYWdzLnRlc3QoUENGX0lOX1BSRVBST0MpOwogICAgICBjaHVua190
ICp0ZW1wOwoKICAgICAgZm9yICh0ZW1wID0gcGM7IHRlbXAgIT0gbnVsbHB0cjsgdGVtcCA9
IGNodW5rX2dldF9uZXh0X25jbmwodGVtcCkpCiAgICAgIHsKICAgICAgICAgTE9HX0ZNVChM
RkNOUiwgIiVzKCVkKTogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0
KCkgJyVzJywgdHlwZSBpcyAlc1xuIiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19M
SU5FX18sIHRlbXAtPm9yaWdfbGluZSwgdGVtcC0+b3JpZ19jb2wsIHRlbXAtPnRleHQoKSwg
Z2V0X3Rva2VuX25hbWUodGVtcC0+dHlwZSkpOwoKICAgICAgICAgaWYgKGNodW5rX2lzX3Rv
a2VuKHRlbXAsIENUX0FTU0lHTikpCiAgICAgICAgIHsKICAgICAgICAgICAgYXNzaWduX2Zv
dW5kID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgIH0KCiAgICAgICAgIGlm
ICggIGNodW5rX2lzX3Rva2VuKHRlbXAsIENUX1NFTUlDT0xPTikKICAgICAgICAgICAgfHwg
KCAgaXNfcHJlcHJvYwogICAgICAgICAgICAgICAmJiAoICAhdGVtcC0+ZmxhZ3MudGVzdChQ
Q0ZfSU5fUFJFUFJPQykKICAgICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4odGVt
cCwgQ1RfUFJFUFJPQykpKSkKICAgICAgICAgewogICAgICAgICAgICBicmVhazsKICAgICAg
ICAgfQogICAgICB9CgogICAgICBpZiAoYXNzaWduX2ZvdW5kKQogICAgICB7CiAgICAgICAg
IC8vIGl0IGlzIGEgVHlwZSBhbGlhcywgYWxpYXMgdGVtcGxhdGUKICAgICAgICAgZm9yICh0
ZW1wID0gcGM7IHRlbXAgIT0gbnVsbHB0cjsgdGVtcCA9IGNodW5rX2dldF9uZXh0X25jbmwo
dGVtcCkpCiAgICAgICAgIHsKICAgICAgICAgICAgaWYgKGdldF9jaHVua19wYXJlbnRfdHlw
ZSh0ZW1wKSA9PSBDVF9OT05FKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIHNldF9j
aHVua19wYXJlbnQodGVtcCwgQ1RfVVNJTkdfQUxJQVMpOwogICAgICAgICAgICB9CgogICAg
ICAgICAgICBpZiAoICBjaHVua19pc190b2tlbih0ZW1wLCBDVF9TRU1JQ09MT04pCiAgICAg
ICAgICAgICAgIHx8ICggIGlzX3ByZXByb2MKICAgICAgICAgICAgICAgICAgJiYgKCAgIXRl
bXAtPmZsYWdzLnRlc3QoUENGX0lOX1BSRVBST0MpCiAgICAgICAgICAgICAgICAgICAgIHx8
IGNodW5rX2lzX3Rva2VuKHRlbXAsIENUX1BSRVBST0MpKSkpCiAgICAgICAgICAgIHsKICAg
ICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgICB9CiAg
IH0KCiAgIC8vIElzc3VlICM1NDg6IGlubGluZSBUICYmIHNvbWVGdW5jKGZvbyAqICpwLCBi
YXIgJiYgcSkgeyB9CiAgIGlmICggIHBjLT50eXBlID09IENUX0JPT0wKICAgICAgJiYgIXBj
LT5mbGFncy50ZXN0KFBDRl9JTl9QUkVQUk9DKQogICAgICAmJiBjaHVua19pc19zdHIocGMs
ICImJiIsIDIpCiAgICAgICYmIGNodW5rX2VuZHNfdHlwZShwYy0+cHJldikpCiAgIHsKICAg
ICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0JZUkVGKTsKICAgfQoKICAgLy8gSXNzdWUgIzE3
MDQKICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0lOQ0RFQ19BRlRFUikKICAgICAg
JiYgcGMtPmZsYWdzLnRlc3QoUENGX0lOX1BSRVBST0MpKQogICB7CiAgICAgIGNodW5rX3Qg
KnRtcF8yID0gY2h1bmtfZ2V0X25leHQocGMpOwogICAgICBsb2dfcGNmX2ZsYWdzKExGVFlQ
RSwgcGMtPmZsYWdzKTsKCiAgICAgIGlmIChjaHVua19pc190b2tlbih0bXBfMiwgQ1RfV09S
RCkpCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0lOQ0RFQ19CRUZP
UkUpOwogICAgICB9CiAgIH0KfSAvLyBkb19zeW1ib2xfY2hlY2sKCgpzdGF0aWMgdm9pZCBj
aGVja19kb3VibGVfYnJhY2VfaW5pdChjaHVua190ICpibzEpCnsKICAgTE9HX0ZVTkNfRU5U
UlkoKTsKICAgTE9HX0ZNVChMSkRCSSwgIiVzKCVkKTogb3JpZ19saW5lIGlzICV6dSwgb3Jp
Z19jb2wgaXMgJXp1IiwgX19mdW5jX18sIF9fTElORV9fLCBibzEtPm9yaWdfbGluZSwgYm8x
LT5vcmlnX2NvbCk7CiAgIGNodW5rX3QgKnBjID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKGJv
MSk7ICAgLy8gSXNzdWUgIzIyNzkKCiAgIGlmIChwYyA9PSBudWxscHRyKQogICB7CiAgICAg
IHJldHVybjsKICAgfQoKICAgaWYgKGNodW5rX2lzX3BhcmVuX2Nsb3NlKHBjKSkKICAgewog
ICAgICBjaHVua190ICpibzIgPSBjaHVua19nZXRfbmV4dChibzEpOwoKICAgICAgaWYgKGJv
MiA9PSBudWxscHRyKQogICAgICB7CiAgICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAg
aWYgKGNodW5rX2lzX3Rva2VuKGJvMiwgQ1RfQlJBQ0VfT1BFTikpCiAgICAgIHsKICAgICAg
ICAgLy8gZm91bmQgYSBwb3RlbnRpYWwgZG91YmxlIGJyYWNlCiAgICAgICAgIGNodW5rX3Qg
KmJjMiA9IGNodW5rX3NraXBfdG9fbWF0Y2goYm8yKTsKCiAgICAgICAgIGlmIChiYzIgPT0g
bnVsbHB0cikKICAgICAgICAgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAg
ICAgICAgY2h1bmtfdCAqYmMxID0gY2h1bmtfZ2V0X25leHQoYmMyKTsKCiAgICAgICAgIGlm
IChiYzEgPT0gbnVsbHB0cikKICAgICAgICAgewogICAgICAgICAgICByZXR1cm47CiAgICAg
ICAgIH0KCiAgICAgICAgIGlmIChjaHVua19pc190b2tlbihiYzEsIENUX0JSQUNFX0NMT1NF
KSkKICAgICAgICAgewogICAgICAgICAgICBMT0dfRk1UKExKREJJLCAiIC0gZW5kLCBvcmln
X2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenVcbiIsIGJjMi0+b3JpZ19saW5lLCBiYzIt
Pm9yaWdfY29sKTsKICAgICAgICAgICAgLy8gZGVsZXRlIGJvMiBhbmQgYmMxCiAgICAgICAg
ICAgIGJvMS0+c3RyICAgICAgICAgKz0gYm8yLT5zdHI7CiAgICAgICAgICAgIGJvMS0+b3Jp
Z19jb2xfZW5kID0gYm8yLT5vcmlnX2NvbF9lbmQ7CiAgICAgICAgICAgIGNodW5rX2RlbChi
bzIpOwogICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KGJvMSwgQ1RfRE9VQkxFX0JSQUNF
KTsKCiAgICAgICAgICAgIGJjMi0+c3RyICAgICAgICAgKz0gYmMxLT5zdHI7CiAgICAgICAg
ICAgIGJjMi0+b3JpZ19jb2xfZW5kID0gYmMxLT5vcmlnX2NvbF9lbmQ7CiAgICAgICAgICAg
IGNodW5rX2RlbChiYzEpOwogICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KGJjMiwgQ1Rf
RE9VQkxFX0JSQUNFKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgIH0K
ICAgfQogICBMT0dfRk1UKExKREJJLCAiIC0gbm9cbiIpOwp9IC8vIGNoZWNrX2RvdWJsZV9i
cmFjZV9pbml0CgoKdm9pZCBmaXhfc3ltYm9scyh2b2lkKQp7CiAgIExPR19GVU5DX0VOVFJZ
KCk7CiAgIGNodW5rX3QgKnBjOwogICBjaHVua190IGR1bW15OwoKICAgY3BkLnVuY19zdGFn
ZSA9IHVuY19zdGFnZV9lOjpGSVhfU1lNQk9MUzsKCiAgIG1hcmtfZGVmaW5lX2V4cHJlc3Np
b25zKCk7CgogICBib29sIGlzX2NwcCAgPSBsYW5ndWFnZV9pc19zZXQoTEFOR19DUFApOwog
ICBib29sIGlzX2phdmEgPSBsYW5ndWFnZV9pc19zZXQoTEFOR19KQVZBKTsKCiAgIGZvciAo
cGMgPSBjaHVua19nZXRfaGVhZCgpOyBwYyAhPSBudWxscHRyOyBwYyA9IGNodW5rX2dldF9u
ZXh0X25jbmwocGMpKQogICB7CiAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9G
VU5DX1dSQVApCiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9UWVBFX1dSQVAp
KQogICAgICB7CiAgICAgICAgIGhhbmRsZV93cmFwKHBjKTsKICAgICAgfQoKICAgICAgaWYg
KGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BU1NJR04pKQogICAgICB7CiAgICAgICAgIG1hcmtf
bHZhbHVlKHBjKTsKICAgICAgfQogICAgICAvLyBhIGJyYWNlIGltbWVkaWF0ZWx5IHByZWNl
ZWRlZCBieSB3b3JkIGluIEMrKzExIGlzIGFuIGluaXRpYWxpemVyIGxpc3QgdGhvdWdoIGl0
IG1heSBhbHNvCiAgICAgIC8vIGJ5IGEgdHlwZSBjYXN0aW5nIGluaXRpYWxpemVyIGxpc3Qg
aWYgdGhlIHdvcmQgaXMgcmVhbGx5IGEgdHlwZTsgc2FkbHkgdW51Y3VzdGlmeSBrbm93cwog
ICAgICAvLyBvbmx5IGJ1aWx0aW4gdHlwZXMgYW5kIGtub3dzIG5vdGhpbmcgb2YgdXNlci1k
ZWZpbmVkIHR5cGVzCiAgICAgIGNodW5rX3QgKnByZXYgPSBjaHVua19nZXRfcHJldl9uY25s
bmkocGMpOyAgIC8vIElzc3VlICMyMjc5CgogICAgICBpZiAoICBpc19jcHAKICAgICAgICAg
JiYgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0JSQUNFX09QRU4pCiAgICAgICAgICYmICggIGNo
dW5rX2lzX3Rva2VuKHByZXYsIENUX1dPUkQpCiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rv
a2VuKHByZXYsIENUX1RZUEUpKSkKICAgICAgewogICAgICAgICBtYXJrX2x2YWx1ZShwYyk7
CiAgICAgIH0KCiAgICAgIGlmICggIGlzX2phdmEKICAgICAgICAgJiYgY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX0JSQUNFX09QRU4pKQogICAgICB7CiAgICAgICAgIGNoZWNrX2RvdWJsZV9i
cmFjZV9pbml0KHBjKTsKICAgICAgfQoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9BVFRSSUJVVEUpKQogICAgICB7CiAgICAgICAgIGNodW5rX3QgKm5leHQgPSBjaHVua19n
ZXRfbmV4dF9uY25sKHBjLCBzY29wZV9lOjpQUkVQUk9DKTsKCiAgICAgICAgIGlmICggIG5l
eHQgIT0gbnVsbHB0cgogICAgICAgICAgICAmJiBjaHVua19pc190b2tlbihuZXh0LCBDVF9Q
QVJFTl9PUEVOKSkKICAgICAgICAgewogICAgICAgICAgICBmbGFnX3BhcmVucyhuZXh0LCBQ
Q0ZfTk9ORSwgQ1RfRlBBUkVOX09QRU4sIENUX0FUVFJJQlVURSwgZmFsc2UpOwogICAgICAg
ICB9CiAgICAgIH0KICAgfQoKICAgcGMgPSBjaHVua19nZXRfaGVhZCgpOwoKICAgaWYgKHBj
ID09IG51bGxwdHIpCiAgIHsKICAgICAgcmV0dXJuOwogICB9CgogICBpZiAoICBjaHVua19p
c19uZXdsaW5lKHBjKQogICAgICB8fCBjaHVua19pc19jb21tZW50KHBjKSkKICAgewogICAg
ICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGMpOwogICB9CgogICB3aGlsZSAocGMgIT0g
bnVsbHB0cikKICAgewogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0lHTk9SRUQp
KQogICAgICB7CiAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7CiAgICAg
ICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIExPR19GTVQoTEZDTlIsICIlcyglZCk6IHBj
LT5vcmlnX2xpbmUgICAgICAgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSBpcyAn
JXMnLCB0eXBlIGlzICVzXG4iLAogICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywg
cGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpLCBnZXRfdG9rZW5fbmFt
ZShwYy0+dHlwZSkpOwogICAgICBjaHVua190ICpwcmV2ID0gY2h1bmtfZ2V0X3ByZXZfbmNu
bG5pKHBjLCBzY29wZV9lOjpQUkVQUk9DKTsgICAvLyBJc3N1ZSAjMjI3OQoKICAgICAgaWYg
KHByZXYgPT0gbnVsbHB0cikKICAgICAgewogICAgICAgICBwcmV2ID0gJmR1bW15OwogICAg
ICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICAvLyBJc3N1ZSAjMjI3OQogICAgICAg
ICBMT0dfRk1UKExGQ05SLCAiJXMoJWQpOiBwcmV2KG5pKS0+b3JpZ19saW5lIGlzICV6dSwg
b3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgaXMgJyVzJywgdHlwZSBpcyAlc1xuIiwKICAgICAg
ICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHByZXYtPm9yaWdfbGluZSwgcHJldi0+
b3JpZ19jb2wsIHByZXYtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUocHJldi0+dHlwZSkpOwog
ICAgICB9CiAgICAgIGNodW5rX3QgKm5leHQgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjLCBz
Y29wZV9lOjpQUkVQUk9DKTsKCiAgICAgIGlmIChuZXh0ID09IG51bGxwdHIpCiAgICAgIHsK
ICAgICAgICAgbmV4dCA9ICZkdW1teTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAg
ICAgICAgLy8gSXNzdWUgIzIyNzkKICAgICAgICAgTE9HX0ZNVChMRkNOUiwgIiVzKCVkKTog
bmV4dC0+b3JpZ19saW5lICAgICBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpIGlz
ICclcycsIHR5cGUgaXMgJXNcbiIsCiAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElO
RV9fLCBuZXh0LT5vcmlnX2xpbmUsIG5leHQtPm9yaWdfY29sLCBuZXh0LT50ZXh0KCksIGdl
dF90b2tlbl9uYW1lKG5leHQtPnR5cGUpKTsKICAgICAgfQogICAgICBMT0dfRk1UKExGQ05S
LCAiJXMoJWQpOiBkb19zeW1ib2xfY2hlY2soJXMsICVzLCAlcylcbiIsCiAgICAgICAgICAg
ICAgX19mdW5jX18sIF9fTElORV9fLCBwcmV2LT50ZXh0KCksIHBjLT50ZXh0KCksIG5leHQt
PnRleHQoKSk7CiAgICAgIGRvX3N5bWJvbF9jaGVjayhwcmV2LCBwYywgbmV4dCk7CiAgICAg
IHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7CiAgIH0KICAgcGF3bl9hZGRfdmlydHVh
bF9zZW1pY29sb25zKCk7CiAgIHByb2Nlc3NfcmV0dXJucygpOwoKICAgLyoKICAgICogMm5k
IHBhc3MgLSBoYW5kbGUgdmFyaWFibGUgZGVmaW5pdGlvbnMKICAgICogUkVWSVNJVDogV2Ug
bmVlZCBmdW5jdGlvbiBwYXJhbXMgbWFya2VkIHRvIGRvIHRoaXMgKD8pCiAgICAqLwogICBw
YyA9IGNodW5rX2dldF9oZWFkKCk7CiAgIGludCBzcXVhcmVfbGV2ZWwgPSAtMTsKCiAgIHdo
aWxlIChwYyAhPSBudWxscHRyKQogICB7CiAgICAgIExPR19GTVQoTEZDTlIsICIlcyglZCk6
IHBjLT5vcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSBpcyAnJXMn
LCB0eXBlIGlzICVzLCBwYXJlbnRfdHlwZSBpcyAlc1xuIiwKICAgICAgICAgICAgICBfX2Z1
bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQo
KSwgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUpLCBnZXRfdG9rZW5fbmFtZShwYy0+cGFyZW50
X3R5cGUpKTsKCiAgICAgIC8vIENhbid0IGhhdmUgYSB2YXJpYWJsZSBkZWZpbml0aW9uIGlu
c2lkZSBbIF0KICAgICAgaWYgKHNxdWFyZV9sZXZlbCA8IDApCiAgICAgIHsKICAgICAgICAg
aWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TUVVBUkVfT1BFTikpCiAgICAgICAgIHsKICAg
ICAgICAgICAgc3F1YXJlX2xldmVsID0gcGMtPmxldmVsOwogICAgICAgICB9CiAgICAgIH0K
ICAgICAgZWxzZQogICAgICB7CiAgICAgICAgIGlmIChwYy0+bGV2ZWwgPD0gc3RhdGljX2Nh
c3Q8c2l6ZV90PihzcXVhcmVfbGV2ZWwpKQogICAgICAgICB7CiAgICAgICAgICAgIHNxdWFy
ZV9sZXZlbCA9IC0xOwogICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICggIGNodW5rX2lz
X3Rva2VuKHBjLCBDVF9FWFRFUk4pCiAgICAgICAgICYmIGxhbmd1YWdlX2lzX3NldChMQU5H
X0FMTEMpKQogICAgICB7CiAgICAgICAgIGNodW5rX3QgKm5leHQgPSBjaHVua19nZXRfbmV4
dF9uY25sKHBjKTsKCiAgICAgICAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9TVFJJ
TkcpKQogICAgICAgICB7CiAgICAgICAgICAgIGNodW5rX3QgKnRtcCA9IGNodW5rX2dldF9u
ZXh0X25jbmwobmV4dCk7CgogICAgICAgICAgICB3aGlsZSAodG1wICE9IG51bGxwdHIpCiAg
ICAgICAgICAgIHsKICAgICAgICAgICAgICAgaWYgKCAgKGNodW5rX2lzX3Rva2VuKHRtcCwg
Q1RfVFlQRSkpCiAgICAgICAgICAgICAgICAgIHx8IChjaHVua19pc190b2tlbih0bXAsIENU
X0JSQUNFX09QRU4pKQogICAgICAgICAgICAgICAgICB8fCAoY2h1bmtfaXNfdG9rZW4odG1w
LCBDVF9BVFRSSUJVVEUpKSkKICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBi
cmVhazsKICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rv
a2VuKHRtcCwgQ1RfV09SRCkpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg
Y2h1bmtfZmxhZ3Nfc2V0KHRtcCwgUENGX1NUTVRfU1RBUlQgfCBQQ0ZfRVhQUl9TVEFSVCk7
CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAg
ICAgIHRtcCA9IGNodW5rX2dldF9uZXh0X25jbmwodG1wKTsKICAgICAgICAgICAgfQogICAg
ICAgICB9CiAgICAgIH0KCiAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BVFRS
SUJVVEUpCiAgICAgICAgICYmIGxhbmd1YWdlX2lzX3NldChMQU5HX0FMTEMpKQogICAgICB7
CiAgICAgICAgIGNodW5rX3QgKnRtcCA9IHNraXBfYXR0cmlidXRlX25leHQocGMpOwoKICAg
ICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfV09SRCkpCiAgICAgICAgIHsKICAg
ICAgICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHRtcCwgUENGX1NUTVRfU1RBUlQgfCBQQ0ZfRVhQ
Ul9TVEFSVCk7CiAgICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCAgY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX0JSQUNFX09QRU4pICAgICAgICAgICAgICAgICAgICAgICAvLyBJc3N1ZSAj
MjMzMgogICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09IENUX0JSQUNF
RF9JTklUX0xJU1QpCiAgICAgIHsKICAgICAgICAgTE9HX0ZNVChMRkNOUiwgIiVzKCVkKTog
cGMtPm9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpIGlzICclcycs
IGxvb2sgZm9yIENUX0JSQUNFX09QRU5cbiIsCiAgICAgICAgICAgICAgICAgX19mdW5jX18s
IF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIHBjLT50ZXh0KCkpOwog
ICAgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X3R5cGUocGMsIENUX0JSQUNFX0NMT1NFLCBw
Yy0+bGV2ZWwpOwogICAgICB9CiAgICAgIC8qCiAgICAgICAqIEEgdmFyaWFibGUgZGVmaW5p
dGlvbiBpcyBwb3NzaWJsZSBhZnRlciBhdCB0aGUgc3RhcnQgb2YgYSBzdGF0ZW1lbnQKICAg
ICAgICogdGhhdCBzdGFydHMgd2l0aDogRENfTUVNQkVSLCBRVUFMSUZJRVIsIFRZUEUsIG9y
IFdPUkQKICAgICAgICovCiAgICAgIC8vIElzc3VlICMyMjc5CiAgICAgIC8vIElzc3VlICMy
NDc4CiAgICAgIExPR19GTVQoTEZDTlIsICIlcyglZCk6IHBjLT5vcmlnX2xpbmUgaXMgJXp1
LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSBpcyAnJXMnLCB0eXBlIGlzICVzLCBwYXJlbnRf
dHlwZSBpcyAlc1xuICAgIiwKICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBj
LT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUo
cGMtPnR5cGUpLCBnZXRfdG9rZW5fbmFtZShwYy0+cGFyZW50X3R5cGUpKTsKICAgICAgbG9n
X3BjZl9mbGFncyhMRkNOUiwgcGMtPmZsYWdzKTsKCiAgICAgIGlmICggIChzcXVhcmVfbGV2
ZWwgPCAwKQogICAgICAgICAmJiBwYy0+ZmxhZ3MudGVzdChQQ0ZfU1RNVF9TVEFSVCkKICAg
ICAgICAgJiYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1FVQUxJRklFUikKICAgICAgICAg
ICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RZUEUpCiAgICAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHBjLCBDVF9UWVBFTkFNRSkKICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX0RDX01FTUJFUikgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSXNzdWUg
IzI0NzgKICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1dPUkQpKQogICAg
ICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpICE9IENUX0VOVU0KICAgICAgICAg
JiYgIXBjLT5mbGFncy50ZXN0KFBDRl9JTl9FTlVNKSkKICAgICAgewogICAgICAgICBwYyA9
IGZpeF92YXJpYWJsZV9kZWZpbml0aW9uKHBjKTsKICAgICAgfQogICAgICBlbHNlCiAgICAg
IHsKICAgICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKICAgICAgfQogICB9
Cn0gLy8gZml4X3N5bWJvbHMKCgpzdGF0aWMgdm9pZCBtYXJrX2x2YWx1ZShjaHVua190ICpw
YykKewogICBMT0dfRlVOQ19FTlRSWSgpOwogICBjaHVua190ICpwcmV2OwoKICAgaWYgKHBj
LT5mbGFncy50ZXN0KFBDRl9JTl9QUkVQUk9DKSkKICAgewogICAgICByZXR1cm47CiAgIH0K
CiAgIGZvciAocHJldiA9IGNodW5rX2dldF9wcmV2X25jbmxuaShwYyk7ICAgICAvLyBJc3N1
ZSAjMjI3OQogICAgICAgIHByZXYgIT0gbnVsbHB0cjsKICAgICAgICBwcmV2ID0gY2h1bmtf
Z2V0X3ByZXZfbmNubG5pKHByZXYpKSAgIC8vIElzc3VlICMyMjc5CiAgIHsKICAgICAgaWYg
KCAgcHJldi0+bGV2ZWwgPCBwYy0+bGV2ZWwKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4o
cHJldiwgQ1RfQVNTSUdOKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihwcmV2LCBDVF9D
T01NQSkKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfQk9PTCkKICAgICAg
ICAgfHwgY2h1bmtfaXNfc2VtaWNvbG9uKHByZXYpCiAgICAgICAgIHx8IGNodW5rX2lzX3N0
cihwcmV2LCAiKCIsIDEpCiAgICAgICAgIHx8IGNodW5rX2lzX3N0cihwcmV2LCAieyIsIDEp
CiAgICAgICAgIHx8IGNodW5rX2lzX3N0cihwcmV2LCAiWyIsIDEpCiAgICAgICAgIHx8IHBy
ZXYtPmZsYWdzLnRlc3QoUENGX0lOX1BSRVBST0MpKQogICAgICB7CiAgICAgICAgIGJyZWFr
OwogICAgICB9CiAgICAgIGNodW5rX2ZsYWdzX3NldChwcmV2LCBQQ0ZfTFZBTFVFKTsKCiAg
ICAgIGlmIChwcmV2LT5sZXZlbCA9PSBwYy0+bGV2ZWwgJiYgY2h1bmtfaXNfc3RyKHByZXYs
ICImIiwgMSkpCiAgICAgIHsKICAgICAgICAgbWFrZV90eXBlKHByZXYpOwogICAgICB9CiAg
IH0KfQoKCnN0YXRpYyB2b2lkIG1hcmtfZnVuY3Rpb25fcmV0dXJuX3R5cGUoY2h1bmtfdCAq
Zm5hbWUsIGNodW5rX3QgKnN0YXJ0LCBjX3Rva2VuX3QgcGFyZW50X3R5cGUpCnsKICAgTE9H
X0ZVTkNfRU5UUlkoKTsKICAgY2h1bmtfdCAqcGMgPSBzdGFydDsKCiAgIGlmIChwYyAhPSBu
dWxscHRyKQogICB7CiAgICAgIC8vIFN0ZXAgYmFja3dhcmRzIGZyb20gcGMgYW5kIG1hcmsg
dGhlIHBhcmVudCBvZiB0aGUgcmV0dXJuIHR5cGUKICAgICAgTE9HX0ZNVChMRkNOUiwgIiVz
KCVkKTogKGJhY2t3YXJkcykgcmV0dXJuIHR5cGUgZm9yICclcycgQCBvcmlnX2xpbmUgaXMg
JXp1LCBvcmlnX2NvbCBpcyAlenVcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElO
RV9fLCBmbmFtZS0+dGV4dCgpLCBmbmFtZS0+b3JpZ19saW5lLCBmbmFtZS0+b3JpZ19jb2wp
OwoKICAgICAgY2h1bmtfdCAqZmlyc3QgPSBwYzsKCiAgICAgIHdoaWxlIChwYyAhPSBudWxs
cHRyKQogICAgICB7CiAgICAgICAgIExPR19GTVQoTEZDTlIsICIlcyglZCk6IG9yaWdfbGlu
ZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcycsIHR5cGUgaXMgJXMsICIs
CiAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBw
Yy0+b3JpZ19jb2wsIHBjLT50ZXh0KCksIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CiAg
ICAgICAgIGxvZ19wY2ZfZmxhZ3MoTEZDTlIsIHBjLT5mbGFncyk7CgogICAgICAgICBpZiAo
Y2h1bmtfaXNfdG9rZW4ocGMsIENUX0FOR0xFX0NMT1NFKSkKICAgICAgICAgewogICAgICAg
ICAgICBwYyA9IHNraXBfdGVtcGxhdGVfcHJldihwYyk7CgogICAgICAgICAgICBpZiAocGMg
PT0gbnVsbHB0ciB8fCBjaHVua19pc190b2tlbihwYywgQ1RfVEVNUExBVEUpKQogICAgICAg
ICAgICB7CiAgICAgICAgICAgICAgIC8vZWl0aGVyIGV4cHJlc3Npb24gaXMgbm90IGNvbXBs
ZXRlIG9yIHRoaXMgaXMgc210aCBsaWtlICd0ZW1wbGF0ZTxUPiB2b2lkIGZ1bmMoKScKICAg
ICAgICAgICAgICAgLy8gIC0gd2UgYXJlIG5vdCBpbnRlcmVzdGVkIGluICd0ZW1wbGF0ZTxU
PicgcGFydAogICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAg
ICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgLy90aGlzIGlzIHNtdGggbGlr
ZSAndmVjdG9yPGludD4gZnVuYygpJyBhbmQgJ3BjJyBpcyBjdXJyZW50bHkgb24gJ3ZlY3Rv
cicgLSBqdXN0IHByb2NlZWQKICAgICAgICAgICAgfQogICAgICAgICB9CgogICAgICAgICBp
ZiAoICAoICAhY2h1bmtfaXNfdHlwZShwYykKICAgICAgICAgICAgICAgJiYgcGMtPnR5cGUg
IT0gQ1RfT1BFUkFUT1IKICAgICAgICAgICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfV09SRAog
ICAgICAgICAgICAgICAmJiBwYy0+dHlwZSAhPSBDVF9BRERSKQogICAgICAgICAgICB8fCBw
Yy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykpCiAgICAgICAgIHsKICAgICAgICAgICAg
YnJlYWs7CiAgICAgICAgIH0KCiAgICAgICAgIGlmICghY2h1bmtfaXNfcHRyX29wZXJhdG9y
KHBjKSkKICAgICAgICAgewogICAgICAgICAgICBmaXJzdCA9IHBjOwogICAgICAgICB9CiAg
ICAgICAgIHBjID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHBjKTsgICAvLyBJc3N1ZSAjMjI3
OQogICAgICB9CiAgICAgIExPR19GTVQoTEZDTlIsICIlcyglZCk6IG1hcmtpbmcgcmV0dXJu
cy4uLiIsIF9fZnVuY19fLCBfX0xJTkVfXyk7CgogICAgICAvLyBDaGFuZ2luZyB3b3JkcyB0
byB0eXBlcyBpbnRvIHR1cGxlIHJldHVybiB0eXBlcyBpbiBDUy4KICAgICAgYm9vbCBpc19y
ZXR1cm5fdHVwbGUgPSBmYWxzZTsKCiAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1Rf
UEFSRU5fQ0xPU0UpICYmICFwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykpCiAgICAg
IHsKICAgICAgICAgZmlyc3QgICAgICAgICAgID0gY2h1bmtfc2tpcF90b19tYXRjaF9yZXYo
cGMpOwogICAgICAgICBpc19yZXR1cm5fdHVwbGUgPSB0cnVlOwogICAgICB9CiAgICAgIHBj
ID0gZmlyc3Q7CgogICAgICB3aGlsZSAocGMgIT0gbnVsbHB0cikKICAgICAgewogICAgICAg
ICBMT0dfRk1UKExGQ05SLCAiIHRleHQoKSAnJXMnLCB0eXBlIGlzICVzIiwgcGMtPnRleHQo
KSwgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUpKTsKCiAgICAgICAgIGlmIChwYXJlbnRfdHlw
ZSAhPSBDVF9OT05FKQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQo
cGMsIHBhcmVudF90eXBlKTsKICAgICAgICAgfQogICAgICAgICBjaHVua190ICpwcmV2ID0g
Y2h1bmtfZ2V0X3ByZXZfbmNubG5pKHBjKTsgICAvLyBJc3N1ZSAjMjI3OQoKICAgICAgICAg
aWYgKCAgIWlzX3JldHVybl90dXBsZQogICAgICAgICAgICB8fCBwYy0+dHlwZSAhPSBDVF9X
T1JECiAgICAgICAgICAgIHx8IChwcmV2ICE9IG51bGxwdHIgJiYgcHJldi0+dHlwZSAhPSBD
VF9UWVBFKSkKICAgICAgICAgewogICAgICAgICAgICBtYWtlX3R5cGUocGMpOwogICAgICAg
ICB9CgogICAgICAgICBpZiAocGMgPT0gc3RhcnQpCiAgICAgICAgIHsKICAgICAgICAgICAg
YnJlYWs7CiAgICAgICAgIH0KICAgICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBj
KTsKCiAgICAgICAgIC8vdGVtcGxhdGUgYW5nbGVzIHNob3VsZCBrZWVwIHBhcmVudCB0eXBl
IENUX1RFTVBMQVRFCiAgICAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfQU5HTEVf
T1BFTikpCiAgICAgICAgIHsKICAgICAgICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF90eXBl
KHBjLCBDVF9BTkdMRV9DTE9TRSwgcGMtPmxldmVsKTsKCiAgICAgICAgICAgIGlmIChwYyA9
PSBzdGFydCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg
ICAgfQogICAgICAgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGMpOwogICAgICAg
ICB9CiAgICAgIH0KICAgICAgTE9HX0ZNVChMRkNOUiwgIlxuIik7CgogICAgICAvLyBCYWNr
IHVwIGFuZCBtYXJrIHBhcmVudCB0eXBlIG9uIGZyaWVuZCBkZWNsYXJhdGlvbnMKICAgICAg
aWYgKHBhcmVudF90eXBlICE9IENUX05PTkUgJiYgZmlyc3QgJiYgZmlyc3QtPmZsYWdzLnRl
c3QoUENGX0lOX0NMQVNTKSkKICAgICAgewogICAgICAgICBwYyA9IGNodW5rX2dldF9wcmV2
X25jbmxuaShmaXJzdCk7ICAgLy8gSXNzdWUgIzIyNzkKCiAgICAgICAgIGlmIChjaHVua19p
c190b2tlbihwYywgQ1RfRlJJRU5EKSkKICAgICAgICAgewogICAgICAgICAgICBMT0dfRk1U
KExGQ05SLCAiJXMoJWQpOiBtYXJraW5nIGZyaWVuZFxuIiwgX19mdW5jX18sIF9fTElORV9f
KTsKICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVudChwYywgcGFyZW50X3R5cGUpOwogICAg
ICAgICAgICAvLyBBIGZyaWVuZCBtaWdodCBiZSBwcmVjZWRlZCBieSBhIHRlbXBsYXRlIHNw
ZWNpZmljYXRpb24sIGFzIGluOgogICAgICAgICAgICAvLyAgIHRlbXBsYXRlIDwuLi4+IGZy
aWVuZCB0eXBlIGZ1bmMoLi4uKTsKICAgICAgICAgICAgLy8gSWYgc28sIHdlIG5lZWQgdG8g
bWFyayB0aGF0IGFsc28KICAgICAgICAgICAgcGMgPSBjaHVua19nZXRfcHJldl9uY25sbmko
cGMpOyAgIC8vIElzc3VlICMyMjc5CgogICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4o
cGMsIENUX0FOR0xFX0NMT1NFKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBwYyA9
IHNraXBfdGVtcGxhdGVfcHJldihwYyk7CgogICAgICAgICAgICAgICBpZiAoY2h1bmtfaXNf
dG9rZW4ocGMsIENUX1RFTVBMQVRFKSkKICAgICAgICAgICAgICAgewogICAgICAgICAgICAg
ICAgICBMT0dfRk1UKExGQ05SLCAiJXMoJWQpOiBtYXJraW5nIGZyaWVuZCB0ZW1wbGF0ZVxu
IiwKICAgICAgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18pOwogICAg
ICAgICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBwYXJlbnRfdHlwZSk7CiAgICAg
ICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgIH0KICAgfQp9IC8v
IG1hcmtfZnVuY3Rpb25fcmV0dXJuX3R5cGUKCgpzdGF0aWMgYm9vbCBtYXJrX2Z1bmN0aW9u
X3R5cGUoY2h1bmtfdCAqcGMpCnsKICAgTE9HX0ZVTkNfRU5UUlkoKTsKICAgTE9HX0ZNVChM
RlRZUEUsICIlcyglZCk6IHR5cGUgaXMgJXMsIHRleHQoKSAnJXMnIEAgb3JpZ19saW5lIGlz
ICV6dSwgb3JpZ19jb2wgaXMgJXp1XG4iLAogICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVf
XywgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUpLCBwYy0+dGV4dCgpLAogICAgICAgICAgIHBj
LT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCk7CgogICBzaXplX3QgICAgc3Rhcl9jb3VudCA9
IDA7CiAgIHNpemVfdCAgICB3b3JkX2NvdW50ID0gMDsKICAgY2h1bmtfdCAgICpwdHJjbmsg
ICAgPSBudWxscHRyOwogICBjaHVua190ICAgKnRtcDsKICAgY2h1bmtfdCAgICphcG87CiAg
IGNodW5rX3QgICAqYXBjOwogICBjaHVua190ICAgKmFmdDsKICAgYm9vbCAgICAgIGFub24g
PSBmYWxzZTsKICAgY190b2tlbl90IHB0LCBwdHA7CgogICAvLyBTY2FuIGJhY2t3YXJkcyBh
Y3Jvc3MgdGhlIG5hbWUsIHdoaWNoIGNhbiBvbmx5IGJlIGEgd29yZCBhbmQgc2luZ2xlIHN0
YXIKICAgY2h1bmtfdCAqdmFyY25rID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHBjKTsgICAv
LyBJc3N1ZSAjMjI3OQoKICAgdmFyY25rID0gY2h1bmtfZ2V0X3ByZXZfc3NxKHZhcmNuayk7
CgogICBpZiAodmFyY25rICE9IG51bGxwdHIgJiYgIWNodW5rX2lzX3dvcmQodmFyY25rKSkK
ICAgewogICAgICBpZiAoICBsYW5ndWFnZV9pc19zZXQoTEFOR19PQykKICAgICAgICAgJiYg
Y2h1bmtfaXNfc3RyKHZhcmNuaywgIl4iLCAxKQogICAgICAgICAmJiBjaHVua19pc19wYXJl
bl9vcGVuKGNodW5rX2dldF9wcmV2X25jbmxuaSh2YXJjbmspKSkgICAvLyBJc3N1ZSAjMjI3
OQogICAgICB7CiAgICAgICAgIC8vIGFub255bW91cyBPYmpDIGJsb2NrIHR5cGUgLS0gUlRZ
UEUgKF4pKEFSR1MpCiAgICAgICAgIGFub24gPSB0cnVlOwogICAgICB9CiAgICAgIGVsc2UK
ICAgICAgewogICAgICAgICBMT0dfRk1UKExGVFlQRSwgIiVzKCVkKTogbm90IGEgd29yZDog
dGV4dCgpICclcycsIHR5cGUgaXMgJXMsIEAgb3JpZ19saW5lIGlzICV6dTosIG9yaWdfY29s
IGlzICV6dVxuIiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHZhcmNu
ay0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZSh2YXJjbmstPnR5cGUpLAogICAgICAgICAgICAg
ICAgIHZhcmNuay0+b3JpZ19saW5lLCB2YXJjbmstPm9yaWdfY29sKTsKICAgICAgICAgZ290
byBub2dvX2V4aXQ7CiAgICAgIH0KICAgfQogICBhcG8gPSBjaHVua19nZXRfbmV4dF9uY25s
KHBjKTsKCiAgIGlmIChhcG8gPT0gbnVsbHB0cikKICAgewogICAgICByZXR1cm4oZmFsc2Up
OwogICB9CiAgIGFwYyA9IGNodW5rX3NraXBfdG9fbWF0Y2goYXBvKTsKCiAgIGlmICggIGFw
YyAhPSBudWxscHRyCiAgICAgICYmICggICFjaHVua19pc19wYXJlbl9vcGVuKGFwbykKICAg
ICAgICAgfHwgKChhcGMgPSBjaHVua19za2lwX3RvX21hdGNoKGFwbykpID09IG51bGxwdHIp
KSkKICAgewogICAgICBMT0dfRk1UKExGVFlQRSwgIiVzKCVkKTogbm90IGZvbGxvd2VkIGJ5
IHBhcmVuc1xuIiwgX19mdW5jX18sIF9fTElORV9fKTsKICAgICAgZ290byBub2dvX2V4aXQ7
CiAgIH0KICAgYWZ0ID0gY2h1bmtfZ2V0X25leHRfbmNubChhcGMpOwoKICAgaWYgKGNodW5r
X2lzX3Rva2VuKGFmdCwgQ1RfQlJBQ0VfT1BFTikpCiAgIHsKICAgICAgcHQgPSBDVF9GVU5D
X0RFRjsKICAgfQogICBlbHNlIGlmIChjaHVua19pc190b2tlbihhZnQsIENUX1NFTUlDT0xP
TikgfHwgY2h1bmtfaXNfdG9rZW4oYWZ0LCBDVF9BU1NJR04pKQogICB7CiAgICAgIHB0ID0g
Q1RfRlVOQ19QUk9UTzsKICAgfQogICBlbHNlCiAgIHsKICAgICAgTE9HX0ZNVChMRlRZUEUs
ICIlcyglZCk6IG5vdCBmb2xsb3dlZCBieSAneycgb3IgJzsnXG4iLCBfX2Z1bmNfXywgX19M
SU5FX18pOwogICAgICBnb3RvIG5vZ29fZXhpdDsKICAgfQogICBwdHAgPSBwYy0+ZmxhZ3Mu
dGVzdChQQ0ZfSU5fVFlQRURFRikgPyBDVF9GVU5DX1RZUEUgOiBDVF9GVU5DX1ZBUjsKCiAg
IHRtcCA9IHBjOwoKICAgd2hpbGUgKCh0bXAgPSBjaHVua19nZXRfcHJldl9uY25sbmkodG1w
KSkgIT0gbnVsbHB0cikgICAvLyBJc3N1ZSAjMjI3OQogICB7CiAgICAgIHRtcCA9IGNodW5r
X2dldF9wcmV2X3NzcSh0bXApOwoKICAgICAgTE9HX0ZNVChMRlRZUEUsICIgLS0gdHlwZSBp
cyAlcywgJXMgb24gb3JpZ19saW5lICV6dSwgb3JpZ19jb2wgaXMgJXp1IiwKICAgICAgICAg
ICAgICBnZXRfdG9rZW5fbmFtZSh0bXAtPnR5cGUpLCB0bXAtPnRleHQoKSwKICAgICAgICAg
ICAgICB0bXAtPm9yaWdfbGluZSwgdG1wLT5vcmlnX2NvbCk7CgogICAgICBpZiAoICBjaHVu
a19pc19zdGFyKHRtcCkKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9QVFJf
VFlQRSkKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9DQVJFVCkpCiAgICAg
IHsKICAgICAgICAgc3Rhcl9jb3VudCsrOwogICAgICAgICBwdHJjbmsgPSB0bXA7CiAgICAg
ICAgIExPR19GTVQoTEZUWVBFLCAiIC0tIFBUUl9UWVBFXG4iKTsKICAgICAgfQogICAgICBl
bHNlIGlmICggIGNodW5rX2lzX3dvcmQodG1wKQogICAgICAgICAgICAgIHx8IGNodW5rX2lz
X3Rva2VuKHRtcCwgQ1RfV09SRCkKICAgICAgICAgICAgICB8fCBjaHVua19pc190b2tlbih0
bXAsIENUX1RZUEUpKQogICAgICB7CiAgICAgICAgIHdvcmRfY291bnQrKzsKICAgICAgICAg
TE9HX0ZNVChMRlRZUEUsICIgLS0gVFlQRSglcylcbiIsIHRtcC0+dGV4dCgpKTsKICAgICAg
fQogICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX0RDX01FTUJFUikpCiAg
ICAgIHsKICAgICAgICAgd29yZF9jb3VudCA9IDA7CiAgICAgICAgIExPR19GTVQoTEZUWVBF
LCAiIC0tIDo6IHJlc2V0IHdvcmRfY291bnRcbiIpOwogICAgICB9CiAgICAgIGVsc2UgaWYg
KGNodW5rX2lzX3N0cih0bXAsICIoIiwgMSkpCiAgICAgIHsKICAgICAgICAgTE9HX0ZNVChM
RlRZUEUsICIgLS0gb3BlbiBwYXJlbiAoYnJlYWspXG4iKTsKICAgICAgICAgYnJlYWs7CiAg
ICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgIExPR19GTVQoTEZUWVBFLCAiIC0t
ICB1bmV4cGVjdGVkIHRva2VuOiB0eXBlIGlzICVzLCB0ZXh0KCkgJyVzJywgb24gb3JpZ19s
aW5lICV6dSwgb3JpZ19jb2wgJXp1XG4iLAogICAgICAgICAgICAgICAgIGdldF90b2tlbl9u
YW1lKHRtcC0+dHlwZSksIHRtcC0+dGV4dCgpLAogICAgICAgICAgICAgICAgIHRtcC0+b3Jp
Z19saW5lLCB0bXAtPm9yaWdfY29sKTsKICAgICAgICAgZ290byBub2dvX2V4aXQ7CiAgICAg
IH0KICAgfQoKICAgLy8gRml4ZXMgI2lzc3VlIDE1NzcKICAgLy8gQWxsb3cgd29yZCBjb3Vu
dCAyIGluY2FzZSBvZiBmdW5jdGlvbiBwb2ludGVyIGRlY2xhcmF0aW9uLgogICAvLyBFeDog
Ym9vbCAoX19zdGRjYWxsKiBmdW5jcHRyKShpbnQsIGludCk7CiAgIGlmICggIHN0YXJfY291
bnQgPiAxCiAgICAgIHx8ICh3b3JkX2NvdW50ID4gMSAmJiAhKHdvcmRfY291bnQgPT0gMiAm
JiBwdHAgPT0gQ1RfRlVOQ19WQVIpKQogICAgICB8fCAoKHN0YXJfY291bnQgKyB3b3JkX2Nv
dW50KSA9PSAwKSkKICAgewogICAgICBMT0dfRk1UKExGVFlQRSwgIiVzKCVkKTogYmFkIGNv
dW50cyB3b3JkOiAlenUsIHN0YXI6ICV6dVxuIiwKICAgICAgICAgICAgICBfX2Z1bmNfXywg
X19MSU5FX18sIHdvcmRfY291bnQsIHN0YXJfY291bnQpOwogICAgICBnb3RvIG5vZ29fZXhp
dDsKICAgfQoKICAgLy8gbWFrZSBzdXJlIHdoYXQgYXBwZWFycyBiZWZvcmUgdGhlIGZpcnN0
IG9wZW4gcGFyZW4gY2FuIGJlIGEgcmV0dXJuIHR5cGUKICAgaWYgKCFjaHVua19lbmRzX3R5
cGUoY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHRtcCkpKSAgIC8vIElzc3VlICMyMjc5CiAgIHsK
ICAgICAgZ290byBub2dvX2V4aXQ7CiAgIH0KCiAgIGlmIChwdHJjbmspCiAgIHsKICAgICAg
c2V0X2NodW5rX3R5cGUocHRyY25rLCBDVF9QVFJfVFlQRSk7CiAgIH0KCiAgIGlmICghYW5v
bikKICAgewogICAgICBpZiAocGMtPmZsYWdzLnRlc3QoUENGX0lOX1RZUEVERUYpKQogICAg
ICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHZhcmNuaywgQ1RfVFlQRSk7CiAgICAgIH0K
ICAgICAgZWxzZQogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHZhcmNuaywgQ1Rf
RlVOQ19WQVIpOwogICAgICAgICBjaHVua19mbGFnc19zZXQodmFyY25rLCBQQ0ZfVkFSXzFT
VF9ERUYpOwogICAgICB9CiAgIH0KICAgc2V0X2NodW5rX3R5cGUocGMsIENUX1RQQVJFTl9D
TE9TRSk7CiAgIHNldF9jaHVua19wYXJlbnQocGMsIHB0cCk7CgogICBzZXRfY2h1bmtfdHlw
ZShhcG8sIENUX0ZQQVJFTl9PUEVOKTsKICAgc2V0X2NodW5rX3BhcmVudChhcG8sIHB0KTsK
ICAgc2V0X2NodW5rX3R5cGUoYXBjLCBDVF9GUEFSRU5fQ0xPU0UpOwogICBzZXRfY2h1bmtf
cGFyZW50KGFwYywgcHQpOwogICBmaXhfZmNuX2RlZl9wYXJhbXMoYXBvKTsKCiAgIGlmIChj
aHVua19pc19zZW1pY29sb24oYWZ0KSkKICAgewogICAgICBzZXRfY2h1bmtfcGFyZW50KGFm
dCwgYWZ0LT5mbGFncy50ZXN0KFBDRl9JTl9UWVBFREVGKSA/IENUX1RZUEVERUYgOiBDVF9G
VU5DX1ZBUik7CiAgIH0KICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4oYWZ0LCBDVF9CUkFD
RV9PUEVOKSkKICAgewogICAgICBmbGFnX3BhcmVucyhhZnQsIFBDRl9OT05FLCBDVF9OT05F
LCBwdCwgZmFsc2UpOwogICB9CiAgIC8vIFN0ZXAgYmFja3dhcmRzIHRvIHRoZSBwcmV2aW91
cyBvcGVuIHBhcmVuIGFuZCBtYXJrIGV2ZXJ5dGhpbmcgYQogICB0bXAgPSBwYzsKCiAgIHdo
aWxlICgodG1wID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHRtcCkpICE9IG51bGxwdHIpICAg
Ly8gSXNzdWUgIzIyNzkKICAgewogICAgICBMT0dfRk1UKExGVFlQRSwgIiArKyB0eXBlIGlz
ICVzLCB0ZXh0KCkgJyVzJywgb24gb3JpZ19saW5lICV6dSwgb3JpZ19jb2wgJXp1XG4iLAog
ICAgICAgICAgICAgIGdldF90b2tlbl9uYW1lKHRtcC0+dHlwZSksIHRtcC0+dGV4dCgpLAog
ICAgICAgICAgICAgIHRtcC0+b3JpZ19saW5lLCB0bXAtPm9yaWdfY29sKTsKCiAgICAgIGlm
ICgqdG1wLT5zdHIuY19zdHIoKSA9PSAnKCcpCiAgICAgIHsKICAgICAgICAgaWYgKCFwYy0+
ZmxhZ3MudGVzdChQQ0ZfSU5fVFlQRURFRikpCiAgICAgICAgIHsKICAgICAgICAgICAgY2h1
bmtfZmxhZ3Nfc2V0KHRtcCwgUENGX1ZBUl8xU1RfREVGKTsKICAgICAgICAgfQogICAgICAg
ICBzZXRfY2h1bmtfdHlwZSh0bXAsIENUX1RQQVJFTl9PUEVOKTsKICAgICAgICAgc2V0X2No
dW5rX3BhcmVudCh0bXAsIHB0cCk7CgogICAgICAgICB0bXAgPSBjaHVua19nZXRfcHJldl9u
Y25sbmkodG1wKTsgICAvLyBJc3N1ZSAjMjI3OQoKICAgICAgICAgaWYgKCAgY2h1bmtfaXNf
dG9rZW4odG1wLCBDVF9GVU5DVElPTikKICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4o
dG1wLCBDVF9GVU5DX0NBTEwpCiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwg
Q1RfRlVOQ19DQUxMX1VTRVIpCiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwg
Q1RfRlVOQ19ERUYpCiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfRlVO
Q19QUk9UTykpCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBD
VF9UWVBFKTsKICAgICAgICAgICAgY2h1bmtfZmxhZ3NfY2xyKHRtcCwgUENGX1ZBUl8xU1Rf
REVGKTsKICAgICAgICAgfQogICAgICAgICBtYXJrX2Z1bmN0aW9uX3JldHVybl90eXBlKHZh
cmNuaywgdG1wLCBwdHApOwogICAgICAgICBicmVhazsKICAgICAgfQogICB9CiAgIHJldHVy
bih0cnVlKTsKCm5vZ29fZXhpdDoKICAgdG1wID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7
CgogICBpZiAoY2h1bmtfaXNfcGFyZW5fb3Blbih0bXApKQogICB7CiAgICAgIExPR19GTVQo
TEZUWVBFLCAiJXMoJWQpOiBzZXR0aW5nIEZVTkNfQ0FMTCBvbiBvcmlnX2xpbmUgaXMgJXp1
LCBvcmlnX2NvbCBpcyAlenVcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9f
LCB0bXAtPm9yaWdfbGluZSwgdG1wLT5vcmlnX2NvbCk7CiAgICAgIGZsYWdfcGFyZW5zKHRt
cCwgUENGX05PTkUsIENUX0ZQQVJFTl9PUEVOLCBDVF9GVU5DX0NBTEwsIGZhbHNlKTsKICAg
fQogICByZXR1cm4oZmFsc2UpOwp9IC8vIG1hcmtfZnVuY3Rpb25fdHlwZQoKCnN0YXRpYyB2
b2lkIHByb2Nlc3NfcmV0dXJucyh2b2lkKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CiAgIGNo
dW5rX3QgKnBjOwoKICAgcGMgPSBjaHVua19nZXRfaGVhZCgpOwoKICAgd2hpbGUgKHBjICE9
IG51bGxwdHIpCiAgIHsKICAgICAgaWYgKHBjLT50eXBlICE9IENUX1JFVFVSTikKICAgICAg
ewogICAgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X3R5cGUocGMsIENUX1JFVFVSTiwgLTEp
OwogICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBwYyA9IHByb2Nlc3NfcmV0dXJu
KHBjKTsKICAgfQp9CgoKc3RhdGljIGNodW5rX3QgKnByb2Nlc3NfcmV0dXJuKGNodW5rX3Qg
KnBjKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CiAgIGNodW5rX3QgKm5leHQ7CiAgIGNodW5r
X3QgKnRlbXA7CiAgIGNodW5rX3QgKnNlbWk7CiAgIGNodW5rX3QgKmNwYXI7CiAgIGNodW5r
X3QgY2h1bms7CgogICAvLyBncmFiIG5leHQgYW5kIGJhaWwgaWYgaXQgaXMgYSBzZW1pY29s
b24KICAgbmV4dCA9IGNodW5rX3BwYV9nZXRfbmV4dF9uY25sKHBjKTsKCiAgIGlmICggIG5l
eHQgPT0gbnVsbHB0ciB8fCBjaHVua19pc19zZW1pY29sb24obmV4dCkKICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4obmV4dCwgQ1RfTkVXTElORSkpCiAgIHsKICAgICAgcmV0dXJuKG5leHQp
OwogICB9CiAgIGxvZ19ydWxlX0IoIm5sX3JldHVybl9leHByIik7CgogICBpZiAoICBvcHRp
b25zOjpubF9yZXR1cm5fZXhwcigpICE9IElBUkZfSUdOT1JFCiAgICAgICYmICFwYy0+Zmxh
Z3MudGVzdChQQ0ZfSU5fUFJFUFJPQykpCiAgIHsKICAgICAgbmV3bGluZV9pYXJmKHBjLCBv
cHRpb25zOjpubF9yZXR1cm5fZXhwcigpKTsKICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2Vu
KG5leHQsIENUX1BBUkVOX09QRU4pKQogICB7CiAgICAgIC8vIFNlZSBpZiB0aGUgcmV0dXJu
IGlzIGZ1bGx5IHBhcmVuJ2QKICAgICAgY3BhciA9IGNodW5rX2dldF9uZXh0X3R5cGUobmV4
dCwgQ1RfUEFSRU5fQ0xPU0UsIG5leHQtPmxldmVsKTsKCiAgICAgIGlmIChjcGFyID09IG51
bGxwdHIpCiAgICAgIHsKICAgICAgICAgcmV0dXJuKG51bGxwdHIpOwogICAgICB9CiAgICAg
IHNlbWkgPSBjaHVua19wcGFfZ2V0X25leHRfbmNubChjcGFyKTsKCiAgICAgIGlmIChzZW1p
ID09IG51bGxwdHIpCiAgICAgIHsKICAgICAgICAgcmV0dXJuKG51bGxwdHIpOwogICAgICB9
CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4oc2VtaSwgQ1RfTkVXTElORSkgfHwgY2h1bmtf
aXNfc2VtaWNvbG9uKHNlbWkpKQogICAgICB7CiAgICAgICAgIGxvZ19ydWxlX0IoIm1vZF9w
YXJlbl9vbl9yZXR1cm4iKTsKCiAgICAgICAgIGlmIChvcHRpb25zOjptb2RfcGFyZW5fb25f
cmV0dXJuKCkgPT0gSUFSRl9SRU1PVkUpCiAgICAgICAgIHsKICAgICAgICAgICAgTE9HX0ZN
VChMUkVUVVJOLCAiJXMoJWQpOiByZW1vdmluZyBwYXJlbnMgb24gb3JpZ19saW5lICV6dVxu
IiwKICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xp
bmUpOwoKICAgICAgICAgICAgLy8gbG93ZXIgdGhlIGxldmVsIG9mIGV2ZXJ5dGhpbmcKICAg
ICAgICAgICAgZm9yICh0ZW1wID0gbmV4dDsgdGVtcCAhPSBjcGFyOyB0ZW1wID0gY2h1bmtf
Z2V0X25leHQodGVtcCkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgaWYgKHRlbXAt
PmxldmVsID09IDApCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgZnByaW50
ZihzdGRlcnIsICIlcyglZCk6IHRlbXAtPmxldmVsIGlzIFpFUk8sIGNhbm5vdCBiZSBkZWNy
ZW1lbnRlZCwgYXQgbGluZSAlenUsIGNvbHVtbiAlenVcbiIsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0ZW1wLT5vcmlnX2xpbmUsIHRlbXAtPm9y
aWdfY29sKTsKICAgICAgICAgICAgICAgICAgbG9nX2ZsdXNoKHRydWUpOwogICAgICAgICAg
ICAgICAgICBleGl0KEVYX1NPRlRXQVJFKTsKICAgICAgICAgICAgICAgfQogICAgICAgICAg
ICAgICB0ZW1wLT5sZXZlbC0tOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBkZWxl
dGUgdGhlIHBhcmVudGhlc2lzCiAgICAgICAgICAgIGNodW5rX2RlbChuZXh0KTsKICAgICAg
ICAgICAgY2h1bmtfZGVsKGNwYXIpOwoKICAgICAgICAgICAgLy8gYmFjayB1cCBmb2xsb3dp
bmcgY2h1bmtzCiAgICAgICAgICAgIHRlbXAgPSBzZW1pOwoKICAgICAgICAgICAgd2hpbGUg
KHRlbXAgIT0gbnVsbHB0ciAmJiB0ZW1wLT50eXBlICE9IENUX05FV0xJTkUpCiAgICAgICAg
ICAgIHsKICAgICAgICAgICAgICAgdGVtcC0+Y29sdW1uICAgICAgID0gdGVtcC0+Y29sdW1u
IC0gMjsKICAgICAgICAgICAgICAgdGVtcC0+b3JpZ19jb2wgICAgID0gdGVtcC0+b3JpZ19j
b2wgLSAyOwogICAgICAgICAgICAgICB0ZW1wLT5vcmlnX2NvbF9lbmQgPSB0ZW1wLT5vcmln
X2NvbF9lbmQgLSAyOwogICAgICAgICAgICAgICB0ZW1wICAgICAgICAgICAgICAgPSBjaHVu
a19nZXRfbmV4dCh0ZW1wKTsKICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgICAgIGVs
c2UKICAgICAgICAgewogICAgICAgICAgICBMT0dfRk1UKExSRVRVUk4sICIlcyglZCk6IGtl
ZXBpbmcgcGFyZW5zIG9uIG9yaWdfbGluZSAlenVcbiIsCiAgICAgICAgICAgICAgICAgICAg
X19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lKTsKCiAgICAgICAgICAgIC8vIG1h
cmsgJiBrZWVwIHRoZW0KICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBDVF9S
RVRVUk4pOwogICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KGNwYXIsIENUX1JFVFVSTik7
CiAgICAgICAgIH0KICAgICAgICAgcmV0dXJuKHNlbWkpOwogICAgICB9CiAgIH0KICAgLy8g
V2UgZG9uJ3QgaGF2ZSBhIGZ1bGx5IHBhcmVuJ2QgcmV0dXJuLiBTaG91bGQgd2UgYWRkIHNv
bWU/CiAgIGxvZ19ydWxlX0IoIm1vZF9wYXJlbl9vbl9yZXR1cm4iKTsKCiAgIGlmICghKG9w
dGlvbnM6Om1vZF9wYXJlbl9vbl9yZXR1cm4oKSAmIElBUkZfQUREKSkKICAgewogICAgICBy
ZXR1cm4obmV4dCk7CiAgIH0KCiAgIC8vIElzc3VlICMxOTE3CiAgIC8vIE5ldmVyIGFkZCBw
YXJlbnMgdG8gYSBicmFjZWQgaW5pdCBsaXN0OyB0aGF0IGJyZWFrcyB0aGUgY29kZQogICAv
LyAgIHJldHVybiB7YXJncy4uLn07ICAgIC8vIEMrKzExIHR5cGUgZWxpc2lvbjsgb2theQog
ICAvLyAgIHJldHVybiAoe2FyZ3MuLi59KTsgIC8vIGlsbC1mb3JtZWQKICAgaWYgKCAgbGFu
Z3VhZ2VfaXNfc2V0KExBTkdfQ1BQKSAmJiBjaHVua19pc190b2tlbihuZXh0LCBDVF9CUkFD
RV9PUEVOKQogICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUobmV4dCkgPT0gQ1RfQlJB
Q0VEX0lOSVRfTElTVCkKICAgewogICAgICBMT0dfRk1UKExSRVRVUk4sICIlcyglZCk6IG5v
dCBhZGRpbmcgcGFyZW5zIGFyb3VuZCBicmFjZWQgaW5pdGlhbGl6ZXIiCiAgICAgICAgICAg
ICAgIiBvbiBvcmlnX2xpbmUgJXpkXG4iLAogICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJ
TkVfXywgcGMtPm9yaWdfbGluZSk7CiAgICAgIHJldHVybihuZXh0KTsKICAgfQogICAvLyBm
aW5kIHRoZSBuZXh0IHNlbWljb2xvbiBvbiB0aGUgc2FtZSBsZXZlbAogICBzZW1pID0gbmV4
dDsKCiAgIGlmIChwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykpCiAgIHsKICAgICAg
d2hpbGUgKChzZW1pID0gc2VtaS0+bmV4dCkgIT0gbnVsbHB0cikKICAgICAgewogICAgICAg
ICBpZiAoIXNlbWktPmZsYWdzLnRlc3QoUENGX0lOX1BSRVBST0MpKQogICAgICAgICB7CiAg
ICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CgogICAgICAgICBpZiAoc2VtaS0+bGV2ZWwg
PCBwYy0+bGV2ZWwpCiAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuKHNlbWkpOwogICAg
ICAgICB9CgogICAgICAgICBpZiAoY2h1bmtfaXNfc2VtaWNvbG9uKHNlbWkpICYmIHBjLT5s
ZXZlbCA9PSBzZW1pLT5sZXZlbCkKICAgICAgICAgewogICAgICAgICAgICBicmVhazsKICAg
ICAgICAgfQogICAgICB9CiAgIH0KICAgZWxzZQogICB7CiAgICAgIHdoaWxlICgoc2VtaSA9
IGNodW5rX2dldF9uZXh0KHNlbWkpKSAhPSBudWxscHRyKQogICAgICB7CiAgICAgICAgIGlm
IChzZW1pLT5sZXZlbCA8IHBjLT5sZXZlbCkKICAgICAgICAgewogICAgICAgICAgICByZXR1
cm4oc2VtaSk7CiAgICAgICAgIH0KCiAgICAgICAgIGlmIChjaHVua19pc19zZW1pY29sb24o
c2VtaSkgJiYgcGMtPmxldmVsID09IHNlbWktPmxldmVsKQogICAgICAgICB7CiAgICAgICAg
ICAgIGJyZWFrOwogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgaWYgKHNlbWkpCiAgIHsK
ICAgICAgLy8gYWRkIHRoZSBwYXJlbnRoZXNpcwogICAgICBzZXRfY2h1bmtfdHlwZSgmY2h1
bmssIENUX1BBUkVOX09QRU4pOwogICAgICBzZXRfY2h1bmtfcGFyZW50KCZjaHVuaywgQ1Rf
UkVUVVJOKTsKICAgICAgY2h1bmsuc3RyICAgICAgICAgPSAiKCI7CiAgICAgIGNodW5rLmxl
dmVsICAgICAgID0gcGMtPmxldmVsOwogICAgICBjaHVuay5icmFjZV9sZXZlbCA9IHBjLT5i
cmFjZV9sZXZlbDsKICAgICAgY2h1bmsub3JpZ19saW5lICAgPSBwYy0+b3JpZ19saW5lOwog
ICAgICBjaHVuay5vcmlnX2NvbCAgICA9IG5leHQtPm9yaWdfY29sIC0gMTsKICAgICAgY2h1
bmsuZmxhZ3MgICAgICAgPSBwYy0+ZmxhZ3MgJiBQQ0ZfQ09QWV9GTEFHUzsKICAgICAgY2h1
bmtfYWRkX2JlZm9yZSgmY2h1bmssIG5leHQpOwoKICAgICAgc2V0X2NodW5rX3R5cGUoJmNo
dW5rLCBDVF9QQVJFTl9DTE9TRSk7CiAgICAgIGNodW5rLnN0ciAgICAgICA9ICIpIjsKICAg
ICAgY2h1bmsub3JpZ19saW5lID0gc2VtaS0+b3JpZ19saW5lOwogICAgICBjaHVuay5vcmln
X2NvbCAgPSBzZW1pLT5vcmlnX2NvbCAtIDE7CiAgICAgIGNwYXIgICAgICAgICAgICA9IGNo
dW5rX2FkZF9iZWZvcmUoJmNodW5rLCBzZW1pKTsKCiAgICAgIExPR19GTVQoTFJFVFVSTiwg
IiVzKCVkKTogYWRkZWQgcGFyZW5zIG9uIG9yaWdfbGluZSAlenVcbiIsCiAgICAgICAgICAg
ICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lKTsKCiAgICAgIGZvciAodGVt
cCA9IG5leHQ7IHRlbXAgIT0gY3BhcjsgdGVtcCA9IGNodW5rX2dldF9uZXh0KHRlbXApKQog
ICAgICB7CiAgICAgICAgIHRlbXAtPmxldmVsKys7CiAgICAgIH0KICAgfQogICByZXR1cm4o
c2VtaSk7Cn0gLy8gcHJvY2Vzc19yZXR1cm4KCgpzdGF0aWMgYm9vbCBpc191Y2FzZV9zdHIo
Y29uc3QgY2hhciAqc3RyLCBzaXplX3QgbGVuKQp7CiAgIHdoaWxlIChsZW4tLSA+IDApCiAg
IHsKICAgICAgaWYgKHVuY190b3VwcGVyKCpzdHIpICE9ICpzdHIpCiAgICAgIHsKICAgICAg
ICAgcmV0dXJuKGZhbHNlKTsKICAgICAgfQogICAgICBzdHIrKzsKICAgfQogICByZXR1cm4o
dHJ1ZSk7Cn0KCgpzdGF0aWMgYm9vbCBpc19vY19ibG9jayhjaHVua190ICpwYykKewogICBy
ZXR1cm4oICBwYyAhPSBudWxscHRyCiAgICAgICAgICYmICggIGdldF9jaHVua19wYXJlbnRf
dHlwZShwYykgPT0gQ1RfT0NfQkxPQ0tfVFlQRQogICAgICAgICAgICB8fCBnZXRfY2h1bmtf
cGFyZW50X3R5cGUocGMpID09IENUX09DX0JMT0NLX0VYUFIKICAgICAgICAgICAgfHwgZ2V0
X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9PQ19CTE9DS19BUkcKICAgICAgICAgICAg
fHwgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9PQ19CTE9DSwogICAgICAgICAg
ICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfT0NfQkxPQ0tfQ0FSRVQpCiAgICAgICAgICAg
IHx8IChwYy0+bmV4dCAhPSBudWxscHRyICYmIHBjLT5uZXh0LT50eXBlID09IENUX09DX0JM
T0NLX0NBUkVUKQogICAgICAgICAgICB8fCAocGMtPnByZXYgIT0gbnVsbHB0ciAmJiBwYy0+
cHJldi0+dHlwZSA9PSBDVF9PQ19CTE9DS19DQVJFVCkpKTsKfQoKCnN0YXRpYyB2b2lkIGZp
eF9jYXN0cyhjaHVua190ICpzdGFydCkKewogICBMT0dfRlVOQ19FTlRSWSgpOwogICBjaHVu
a190ICAgICpwYzsKICAgY2h1bmtfdCAgICAqcHJldjsKICAgY2h1bmtfdCAgICAqZmlyc3Q7
CiAgIGNodW5rX3QgICAgKmFmdGVyOwogICBjaHVua190ICAgICpsYXN0ID0gbnVsbHB0cjsK
ICAgY2h1bmtfdCAgICAqcGFyZW5fY2xvc2U7CiAgIGNvbnN0IGNoYXIgKnZlcmIgICAgICA9
ICJsaWtlbHkiOwogICBjb25zdCBjaGFyICpkZXRhaWwgICAgPSAiIjsKICAgc2l6ZV90ICAg
ICBjb3VudCAgICAgID0gMDsKICAgaW50ICAgICAgICB3b3JkX2NvdW50ID0gMDsKICAgYm9v
bCAgICAgICBub3BlOwogICBib29sICAgICAgIGRvdWJ0ZnVsX2Nhc3QgPSBmYWxzZTsKCgog
ICBMT0dfRk1UKExDQVNUUywgIiVzKCVkKTogc3RhcnQtPnRleHQoKSBpcyAnJXMnLCBvcmln
X2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenVcbiIsCiAgICAgICAgICAgX19mdW5jX18s
IF9fTElORV9fLCBzdGFydC0+dGV4dCgpLCBzdGFydC0+b3JpZ19saW5lLCBzdGFydC0+b3Jp
Z19jb2wpOwoKICAgcHJldiA9IGNodW5rX2dldF9wcmV2X25jbmxuaShzdGFydCk7ICAgLy8g
SXNzdWUgIzIyNzkKCiAgIGlmIChwcmV2ID09IG51bGxwdHIpCiAgIHsKICAgICAgcmV0dXJu
OwogICB9CgogICBpZiAoY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfUFBfREVGSU5FRCkpCiAg
IHsKICAgICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6ICAtLSBub3QgYSBjYXN0IC0gYWZ0
ZXIgZGVmaW5lZFxuIiwKICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18pOwogICAg
ICByZXR1cm47CiAgIH0KCiAgIGlmIChjaHVua19pc190b2tlbihwcmV2LCBDVF9BTkdMRV9D
TE9TRSkpCiAgIHsKICAgICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6ICAtLSBub3QgYSBj
YXN0IC0gYWZ0ZXIgPiAodGVtcGxhdGUpXG4iLAogICAgICAgICAgICAgIF9fZnVuY19fLCBf
X0xJTkVfXyk7CiAgICAgIHJldHVybjsKICAgfQogICAvLyBNYWtlIHN1cmUgdGhlcmUgaXMg
b25seSBXT1JELCBUWVBFLCBhbmQgJyonIG9yICdeJyBiZWZvcmUgdGhlIGNsb3NlIHBhcmVu
CiAgIHBjICAgID0gY2h1bmtfZ2V0X25leHRfbmNubChzdGFydCk7CiAgIGZpcnN0ID0gcGM7
CgogICB3aGlsZSAoICBwYyAhPSBudWxscHRyCiAgICAgICAgICYmICggIGNodW5rX2lzX3R5
cGUocGMpCiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9XT1JEKQogICAg
ICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfUVVBTElGSUVSKQogICAgICAgICAg
ICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfRENfTUVNQkVSKQogICAgICAgICAgICB8fCBj
aHVua19pc190b2tlbihwYywgQ1RfUFApCiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9TVEFSKQogICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfUVVF
U1RJT04pCiAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DQVJFVCkKICAg
ICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RTUVVBUkUpCiAgICAgICAgICAg
IHx8ICggICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BTkdMRV9PUEVOKQogICAgICAgICAg
ICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQU5HTEVfQ0xPU0UpKQogICAgICAg
ICAgICAgICAmJiBsYW5ndWFnZV9pc19zZXQoTEFOR19PQyB8IExBTkdfSkFWQSkpCiAgICAg
ICAgICAgIHx8ICggICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9RVUVTVElPTikKICAgICAg
ICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0NPTU1BKQogICAgICAgICAg
ICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfTUVNQkVSKSkKICAgICAgICAgICAg
ICAgJiYgbGFuZ3VhZ2VfaXNfc2V0KExBTkdfSkFWQSkpCiAgICAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHBjLCBDVF9BTVApKSkKICAgewogICAgICBMT0dfRk1UKExDQVNUUywgIiVz
KCVkKTogcGMtPnRleHQoKSBpcyAnJXMnLCBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBp
cyAlenUsIHR5cGUgaXMgJXNcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9f
LCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIGdldF90b2tlbl9u
YW1lKHBjLT50eXBlKSk7CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1dPUkQp
IHx8IChjaHVua19pc190b2tlbihsYXN0LCBDVF9BTkdMRV9DTE9TRSkgJiYgY2h1bmtfaXNf
dG9rZW4ocGMsIENUX0RDX01FTUJFUikpKQogICAgICB7CiAgICAgICAgIHdvcmRfY291bnQr
KzsKICAgICAgfQogICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfRENfTUVN
QkVSKSB8fCBjaHVua19pc190b2tlbihwYywgQ1RfTUVNQkVSKSB8fCBjaHVua19pc190b2tl
bihwYywgQ1RfUFApKQogICAgICB7CiAgICAgICAgIC8vIG1pZ2h0IGJlIG5lZ2F0aXYsIHN1
Y2ggYXMgd2l0aDoKICAgICAgICAgLy8gYSA9IHZhbCArIChDRm9vOjpiYXJfdCk3OwogICAg
ICAgICB3b3JkX2NvdW50LS07CiAgICAgIH0KICAgICAgbGFzdCA9IHBjOwogICAgICBwYyAg
ID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7CiAgICAgIGNvdW50Kys7CiAgIH0KCiAgIGlm
ICggIHBjID09IG51bGxwdHIKICAgICAgfHwgcGMtPnR5cGUgIT0gQ1RfUEFSRU5fQ0xPU0UK
ICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfT0NfQ0xBU1MpKQogICB7CiAgICAg
IExPR19GTVQoTENBU1RTLCAiJXMoJWQpOiAgLS0gbm90IGEgY2FzdCwgaGl0IHR5cGUgaXMg
JXNcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYyA9PSBudWxscHRy
ID8gIk5VTEwiIDogZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUpKTsKICAgICAgcmV0dXJuOwog
ICB9CgogICBpZiAod29yZF9jb3VudCA+IDEpCiAgIHsKICAgICAgTE9HX0ZNVChMQ0FTVFMs
ICIlcyglZCk6ICAtLSB0b28gbWFueSB3b3JkczogJWRcbiIsCiAgICAgICAgICAgICAgX19m
dW5jX18sIF9fTElORV9fLCB3b3JkX2NvdW50KTsKICAgICAgcmV0dXJuOwogICB9CiAgIHBh
cmVuX2Nsb3NlID0gcGM7CgogICAvLyBJZiBsYXN0IGlzIGEgdHlwZSBvciBzdGFyL2NhcmV0
LCB3ZSBoYXZlIGEgY2FzdCBmb3Igc3VyZQogICBpZiAoICBjaHVua19pc190b2tlbihsYXN0
LCBDVF9TVEFSKQogICAgICB8fCBjaHVua19pc190b2tlbihsYXN0LCBDVF9DQVJFVCkKICAg
ICAgfHwgY2h1bmtfaXNfdG9rZW4obGFzdCwgQ1RfUFRSX1RZUEUpCiAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKGxhc3QsIENUX1RZUEUpCiAgICAgIHx8IChjaHVua19pc190b2tlbihsYXN0
LCBDVF9BTkdMRV9DTE9TRSkgJiYgbGFuZ3VhZ2VfaXNfc2V0KExBTkdfT0MgfCBMQU5HX0pB
VkEpKSkKICAgewogICAgICB2ZXJiID0gImZvciBzdXJlIjsKICAgfQogICBlbHNlIGlmIChj
b3VudCA9PSAxKQogICB7CiAgICAgIC8qCiAgICAgICAqIFdlIGFyZSBvbiBhIHBvdGVudGlh
bCBjYXN0IG9mIHRoZSBmb3JtICIod29yZCkiLgogICAgICAgKiBXZSBkb24ndCBrbm93IGlm
IHRoZSB3b3JkIGlzIGEgdHlwZS4gU28gbGV0cyBndWVzcyBiYXNlZCBvbiBzb21lCiAgICAg
ICAqIHNpbXBsZSBydWxlczoKICAgICAgICogIC0gaWYgYWxsIGNhcHMsIGxpa2VseSBhIHR5
cGUKICAgICAgICogIC0gaWYgaXQgZW5kcyBpbiBfdCwgbGlrZWx5IGEgdHlwZQogICAgICAg
KiAgLSBpZiBpdCdzIG9iamVjdGl2ZS1jIGFuZCB0aGUgdHlwZSBpcyBpZCwgbGlrZWx5IHZh
bGlkCiAgICAgICAqLwogICAgICB2ZXJiID0gImd1ZXNzZWQiOwoKICAgICAgaWYgKCAgKGxh
c3QtPmxlbigpID4gMykKICAgICAgICAgJiYgKGxhc3QtPnN0cltsYXN0LT5sZW4oKSAtIDJd
ID09ICdfJykKICAgICAgICAgJiYgKGxhc3QtPnN0cltsYXN0LT5sZW4oKSAtIDFdID09ICd0
JykpCiAgICAgIHsKICAgICAgICAgZGV0YWlsID0gIiAtLSAnX3QnIjsKICAgICAgfQogICAg
ICBlbHNlIGlmIChpc191Y2FzZV9zdHIobGFzdC0+dGV4dCgpLCBsYXN0LT5sZW4oKSkpCiAg
ICAgIHsKICAgICAgICAgZGV0YWlsID0gIiAtLSB1cHBlciBjYXNlIjsKICAgICAgfQogICAg
ICBlbHNlIGlmIChsYW5ndWFnZV9pc19zZXQoTEFOR19PQykgJiYgY2h1bmtfaXNfc3RyKGxh
c3QsICJpZCIsIDIpKQogICAgICB7CiAgICAgICAgIGRldGFpbCA9ICIgLS0gT2JqZWN0aXZl
LUMgaWQiOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICAvLyBJZiB3ZSBj
YW4ndCB0ZWxsIGZvciBzdXJlIHdoZXRoZXIgdGhpcyBpcyBhIGNhc3QsIGRlY2lkZSBhZ2Fp
bnN0IGl0CiAgICAgICAgIGRldGFpbCAgICAgICAgPSAiIC0tIG1peGVkIGNhc2UiOwogICAg
ICAgICBkb3VidGZ1bF9jYXN0ID0gdHJ1ZTsKICAgICAgfQogICAgICAvKgogICAgICAgKiBJ
ZiB0aGUgbmV4dCBpdGVtIGlzIGEgKiBvciAmLCB0aGUgbmV4dCBpdGVtIGFmdGVyIHRoYXQg
Y2FuJ3QgYmUgYQogICAgICAgKiBudW1iZXIgb3Igc3RyaW5nLgogICAgICAgKgogICAgICAg
KiBJZiB0aGUgbmV4dCBpdGVtIGlzIGEgKywgdGhlIG5leHQgaXRlbSBoYXMgdG8gYmUgYSBu
dW1iZXIuCiAgICAgICAqCiAgICAgICAqIElmIHRoZSBuZXh0IGl0ZW0gaXMgYSAtLCB0aGUg
bmV4dCBpdGVtIGNhbid0IGJlIGEgc3RyaW5nLgogICAgICAgKgogICAgICAgKiBGb3IgdGhp
cyB0byBiZSBhIGNhc3QsIHRoZSBjbG9zZSBwYXJlbiBtdXN0IGJlIGZvbGxvd2VkIGJ5Ogog
ICAgICAgKiAgLSBjb25zdGFudCAobnVtYmVyIG9yIHN0cmluZykKICAgICAgICogIC0gcGFy
ZW4gb3BlbgogICAgICAgKiAgLSB3b3JkCiAgICAgICAqCiAgICAgICAqIEZpbmQgdGhlIG5l
eHQgbm9uLW9wZW4gcGFyZW4gaXRlbS4KICAgICAgICovCiAgICAgIHBjICAgID0gY2h1bmtf
Z2V0X25leHRfbmNubChwYXJlbl9jbG9zZSk7CiAgICAgIGFmdGVyID0gcGM7CgogICAgICBk
bwogICAgICB7CiAgICAgICAgIGFmdGVyID0gY2h1bmtfZ2V0X25leHRfbmNubChhZnRlcik7
CiAgICAgIH0gd2hpbGUgKGNodW5rX2lzX3Rva2VuKGFmdGVyLCBDVF9QQVJFTl9PUEVOKSk7
CgogICAgICBpZiAoYWZ0ZXIgPT0gbnVsbHB0cikKICAgICAgewogICAgICAgICBMT0dfRk1U
KExDQVNUUywgIiVzKCVkKTogIC0tIG5vdCBhIGNhc3QgLSBoaXQgTlVMTFxuIiwKICAgICAg
ICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18pOwogICAgICAgICByZXR1cm47CiAgICAg
IH0KICAgICAgbm9wZSA9IGZhbHNlOwoKICAgICAgaWYgKGNodW5rX2lzX3B0cl9vcGVyYXRv
cihwYykpCiAgICAgIHsKICAgICAgICAgLy8gc3RhciAoKikgYW5kIGFkZHJlc3MgKCYpIGFy
ZSBhbWJpZ3VvdXMKICAgICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4oYWZ0ZXIsIENUX05V
TUJFUl9GUCkKICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4oYWZ0ZXIsIENUX05VTUJF
UikKICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4oYWZ0ZXIsIENUX1NUUklORykKICAg
ICAgICAgICAgfHwgZG91YnRmdWxfY2FzdCkKICAgICAgICAgewogICAgICAgICAgICBub3Bl
ID0gdHJ1ZTsKICAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rv
a2VuKHBjLCBDVF9NSU5VUykpCiAgICAgIHsKICAgICAgICAgLy8gKFVJTlQ4KS0xIG9yIChm
b28pLTEgb3IgKEZPTyktJ2EnCiAgICAgICAgIGlmIChjaHVua19pc190b2tlbihhZnRlciwg
Q1RfU1RSSU5HKSB8fCBkb3VidGZ1bF9jYXN0KQogICAgICAgICB7CiAgICAgICAgICAgIG5v
cGUgPSB0cnVlOwogICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSBpZiAoY2h1bmtfaXNf
dG9rZW4ocGMsIENUX1BMVVMpKQogICAgICB7CiAgICAgICAgIC8vIChVSU5UOCkrMSBvciAo
Zm9vKSsxCiAgICAgICAgIGlmICggIChhZnRlci0+dHlwZSAhPSBDVF9OVU1CRVIgJiYgYWZ0
ZXItPnR5cGUgIT0gQ1RfTlVNQkVSX0ZQKQogICAgICAgICAgICB8fCBkb3VidGZ1bF9jYXN0
KQogICAgICAgICB7CiAgICAgICAgICAgIG5vcGUgPSB0cnVlOwogICAgICAgICB9CiAgICAg
IH0KICAgICAgZWxzZSBpZiAoICBwYy0+dHlwZSAhPSBDVF9OVU1CRVJfRlAKICAgICAgICAg
ICAgICAmJiBwYy0+dHlwZSAhPSBDVF9OVU1CRVIKICAgICAgICAgICAgICAmJiBwYy0+dHlw
ZSAhPSBDVF9XT1JECiAgICAgICAgICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfVEhJUwogICAg
ICAgICAgICAgICYmIHBjLT50eXBlICE9IENUX1RZUEUKICAgICAgICAgICAgICAmJiBwYy0+
dHlwZSAhPSBDVF9QQVJFTl9PUEVOCiAgICAgICAgICAgICAgJiYgcGMtPnR5cGUgIT0gQ1Rf
U1RSSU5HCiAgICAgICAgICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfREVDTFRZUEUKICAgICAg
ICAgICAgICAmJiBwYy0+dHlwZSAhPSBDVF9TSVpFT0YKICAgICAgICAgICAgICAmJiBnZXRf
Y2h1bmtfcGFyZW50X3R5cGUocGMpICE9IENUX1NJWkVPRgogICAgICAgICAgICAgICYmIHBj
LT50eXBlICE9IENUX0ZVTkNfQ0FMTAogICAgICAgICAgICAgICYmIHBjLT50eXBlICE9IENU
X0ZVTkNfQ0FMTF9VU0VSCiAgICAgICAgICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfRlVOQ1RJ
T04KICAgICAgICAgICAgICAmJiBwYy0+dHlwZSAhPSBDVF9CUkFDRV9PUEVOCiAgICAgICAg
ICAgICAgJiYgKCEoICBjaHVua19pc190b2tlbihwYywgQ1RfU1FVQVJFX09QRU4pCiAgICAg
ICAgICAgICAgICAgICAmJiBsYW5ndWFnZV9pc19zZXQoTEFOR19PQykpKSkKICAgICAgewog
ICAgICAgICBMT0dfRk1UKExDQVNUUywgIiVzKCVkKTogIC0tIG5vdCBhIGNhc3QgLSBmb2xs
b3dlZCBieSB0ZXh0KCkgJyVzJywgdHlwZSBpcyAlc1xuIiwKICAgICAgICAgICAgICAgICBf
X2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIGdldF90b2tlbl9uYW1lKHBjLT50eXBl
KSk7CiAgICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKG5vcGUpCiAgICAgIHsK
ICAgICAgICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6ICAtLSBub3QgYSBjYXN0IC0gdGV4
dCgpICclcycgZm9sbG93ZWQgYnkgdHlwZSAlc1xuIiwKICAgICAgICAgICAgICAgICBfX2Z1
bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIGdldF90b2tlbl9uYW1lKGFmdGVyLT50eXBl
KSk7CiAgICAgICAgIHJldHVybjsKICAgICAgfQogICB9CiAgIC8vIGlmIHRoZSAnY2FzdCcg
aXMgZm9sbG93ZWQgYnkgYSBzZW1pY29sb24sIGNvbW1hLCBib29sIG9yIGNsb3NlIHBhcmVu
dGhlc2lzLCBpdCBpc24ndAogICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGFyZW5fY2xv
c2UpOwoKICAgaWYgKHBjID09IG51bGxwdHIpCiAgIHsKICAgICAgcmV0dXJuOwogICB9Cgog
ICBpZiAoICBjaHVua19pc19zZW1pY29sb24ocGMpCiAgICAgIHx8IGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9DT01NQSkKICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0JPT0wpICAg
ICAgICAgICAgICAgLy8gSXNzdWUgIzIxNTEKICAgICAgfHwgY2h1bmtfaXNfcGFyZW5fY2xv
c2UocGMpKQogICB7CiAgICAgIExPR19GTVQoTENBU1RTLCAiJXMoJWQpOiAgLS0gbm90IGEg
Y2FzdCAtIGZvbGxvd2VkIGJ5IHR5cGUgJXNcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18s
IF9fTElORV9fLCBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSkpOwogICAgICByZXR1cm47CiAg
IH0KICAgc2V0X2NodW5rX3BhcmVudChzdGFydCwgQ1RfQ19DQVNUKTsKICAgc2V0X2NodW5r
X3BhcmVudChwYXJlbl9jbG9zZSwgQ1RfQ19DQVNUKTsKCiAgIExPR19GTVQoTENBU1RTLCAi
JXMoJWQpOiAgLS0gJXMgYy1jYXN0OiAoIiwKICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5F
X18sIHZlcmIpOwoKICAgZm9yIChwYyA9IGZpcnN0OwogICAgICAgIHBjICE9IG51bGxwdHIg
JiYgcGMgIT0gcGFyZW5fY2xvc2U7CiAgICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25s
KHBjKSkKICAgewogICAgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBDVF9DX0NBU1QpOwogICAg
ICBtYWtlX3R5cGUocGMpOwogICAgICBMT0dfRk1UKExDQVNUUywgIiAlcyIsIHBjLT50ZXh0
KCkpOwogICB9CgogICBMT0dfRk1UKExDQVNUUywgIiApJXNcbiIsIGRldGFpbCk7CgogICAv
LyBNYXJrIHRoZSBuZXh0IGl0ZW0gYXMgYW4gZXhwcmVzc2lvbiBzdGFydAogICBwYyA9IGNo
dW5rX2dldF9uZXh0X25jbmwocGFyZW5fY2xvc2UpOwoKICAgaWYgKHBjICE9IG51bGxwdHIp
CiAgIHsKICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHBjLCBQQ0ZfRVhQUl9TVEFSVCk7CgogICAg
ICBpZiAoY2h1bmtfaXNfb3BlbmluZ19icmFjZShwYykpCiAgICAgIHsKICAgICAgICAgc2V0
X3BhcmVuX3BhcmVudChwYywgZ2V0X2NodW5rX3BhcmVudF90eXBlKHN0YXJ0KSk7CiAgICAg
IH0KICAgfQp9IC8vIGZpeF9jYXN0cwoKCnN0YXRpYyB2b2lkIGZpeF90eXBlX2Nhc3QoY2h1
bmtfdCAqc3RhcnQpCnsKICAgTE9HX0ZVTkNfRU5UUlkoKTsKICAgY2h1bmtfdCAqcGM7Cgog
ICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwoc3RhcnQpOwoKICAgaWYgKHBjID09IG51bGxw
dHIgfHwgcGMtPnR5cGUgIT0gQ1RfQU5HTEVfT1BFTikKICAgewogICAgICByZXR1cm47CiAg
IH0KCiAgIHdoaWxlICggICgocGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKSkgIT0gbnVs
bHB0cikKICAgICAgICAgJiYgcGMtPmxldmVsID49IHN0YXJ0LT5sZXZlbCkKICAgewogICAg
ICBpZiAocGMtPmxldmVsID09IHN0YXJ0LT5sZXZlbCAmJiBjaHVua19pc190b2tlbihwYywg
Q1RfQU5HTEVfQ0xPU0UpKQogICAgICB7CiAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRf
bmNubChwYyk7CgogICAgICAgICBpZiAocGMgPT0gbnVsbHB0cikKICAgICAgICAgewogICAg
ICAgICAgICByZXR1cm47CiAgICAgICAgIH0KCiAgICAgICAgIGlmIChjaHVua19pc19zdHIo
cGMsICIoIiwgMSkpCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X3BhcmVuX3BhcmVudChw
YywgQ1RfVFlQRV9DQVNUKTsKICAgICAgICAgfQogICAgICAgICByZXR1cm47CiAgICAgIH0K
ICAgICAgbWFrZV90eXBlKHBjKTsKICAgfQp9CgoKc3RhdGljIHZvaWQgZml4X2VudW1fc3Ry
dWN0X3VuaW9uKGNodW5rX3QgKnBjKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CiAgIGNodW5r
X3QgICAgICpuZXh0OwogICBjaHVua190ICAgICAqcHJldiAgICAgICAgPSBudWxscHRyOwog
ICBwY2ZfZmxhZ3NfdCBmbGFncyAgICAgICAgPSBQQ0ZfVkFSXzFTVF9ERUY7CiAgIGF1dG8g
Y29uc3QgIGluX2Zjbl9wYXJlbiA9IHBjLT5mbGFncyAmIFBDRl9JTl9GQ05fREVGOwoKICAg
Ly8gTWFrZSBzdXJlIHRoaXMgd2Fzbid0IGEgY2FzdAogICBpZiAoZ2V0X2NodW5rX3BhcmVu
dF90eXBlKHBjKSA9PSBDVF9DX0NBU1QpCiAgIHsKICAgICAgcmV0dXJuOwogICB9CiAgIC8v
IHRoZSBuZXh0IGl0ZW0gaXMgZWl0aGVyIGEgdHlwZSBvciBvcGVuIGJyYWNlCiAgIG5leHQg
PSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKCiAgIC8vIHRoZSBlbnVtLWtleSBtaWdodCBi
ZSBlbnVtLCBlbnVtIGNsYXNzIG9yIGVudW0gc3RydWN0IChUT0RPKQogICBpZiAoY2h1bmtf
aXNfdG9rZW4obmV4dCwgQ1RfRU5VTV9DTEFTUykpCiAgIHsKICAgICAgbmV4dCA9IGNodW5r
X2dldF9uZXh0X25jbmwobmV4dCk7IC8vIGdldCB0aGUgbmV4dCBvbmUKICAgfQoKICAgaWYg
KGxhbmd1YWdlX2lzX3NldChMQU5HX0NQUCkpCiAgIHsKICAgICAgbmV4dCA9IHNraXBfYXR0
cmlidXRlX25leHQobmV4dCk7IC8vIGdldCB0aGUgbmV4dCBvbmUKICAgfQoKICAgLy8gdGhl
IG5leHQgaXRlbSBpcyBlaXRoZXIgYSB0eXBlLCBhbiBhdHRyaWJ1dGUgKFRPRE8pLCBhbiBp
ZGVudGlmaWVyLCBhIGNvbG9uIG9yIG9wZW4gYnJhY2UKICAgaWYgKGNodW5rX2lzX3Rva2Vu
KG5leHQsIENUX1RZUEUpIHx8IGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1dPUkQpIHx8IGNo
dW5rX2lzX3Rva2VuKG5leHQsIENUX0NPTE9OKSkKICAgewogICAgICAvLyBpLmUuICJlbnVt
IHh5eiA6IHVuc2lnbmVkIGludCB7IC4uLiB9OyIKICAgICAgLy8gaS5lLiAiZW51bSBjbGFz
cyB4eXogOiB1bnNpZ25lZCBpbnQgeyAuLi4gfTsiCiAgICAgIC8vIGkuZS4gImVudW0gOiB1
bnNpZ25lZCBpbnQgeyAuLi4gfTsiCiAgICAgIC8vIHh5eiBpcyBhIHR5cGUKCiAgICAgIC8v
IHNhdmUgdGhlIHR5cGUgaWYgaXQgZXhpc3RzCiAgICAgIGlmICghY2h1bmtfaXNfdG9rZW4o
bmV4dCwgQ1RfQ09MT04pKQogICAgICB7CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQobmV4
dCwgcGMtPnR5cGUpOwogICAgICAgICBwcmV2ID0gbmV4dDsKICAgICAgICAgbmV4dCA9IGNo
dW5rX2dldF9uZXh0X25jbmwobmV4dCk7CiAgICAgIH0KCiAgICAgIGlmIChuZXh0ID09IG51
bGxwdHIpCiAgICAgIHsKICAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHNldF9jaHVu
a19wYXJlbnQobmV4dCwgcGMtPnR5cGUpOwogICAgICBhdXRvIGNvbnN0IGlzX3N0cnVjdF9v
cl9jbGFzcyA9CiAgICAgICAgIChjaHVua19pc190b2tlbihwYywgQ1RfU1RSVUNUKSB8fCBj
aHVua19pc190b2tlbihwYywgQ1RfQ0xBU1MpKTsKCiAgICAgIC8vIG5leHQgdXAgaXMgZWl0
aGVyIGEgY29sb24sIG9wZW4gYnJhY2UsIG9yIG9wZW4gcGFyZW50aGVzaXMgKHBhd24pCiAg
ICAgIGlmIChsYW5ndWFnZV9pc19zZXQoTEFOR19QQVdOKSAmJiBjaHVua19pc190b2tlbihu
ZXh0LCBDVF9QQVJFTl9PUEVOKSkKICAgICAgewogICAgICAgICBuZXh0ID0gc2V0X3BhcmVu
X3BhcmVudChuZXh0LCBDVF9FTlVNKTsKICAgICAgfQogICAgICBlbHNlIGlmIChjaHVua19p
c190b2tlbihuZXh0LCBDVF9DT0xPTikpCiAgICAgIHsKICAgICAgICAgaWYgKGNodW5rX2lz
X3Rva2VuKHBjLCBDVF9FTlVNKSkKICAgICAgICAgewogICAgICAgICAgICAvLyBlbnVtIFRZ
UEUgOiBJTlRfVFlQRSB7IC4uLiB9OwogICAgICAgICAgICBuZXh0ID0gY2h1bmtfZ2V0X25l
eHRfbmNubChuZXh0KTsKCiAgICAgICAgICAgIGlmIChuZXh0ICE9IG51bGxwdHIpCiAgICAg
ICAgICAgIHsKICAgICAgICAgICAgICAgbWFrZV90eXBlKG5leHQpOwogICAgICAgICAgICAg
ICBuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0KTsKCiAgICAgICAgICAgICAgIC8v
IGVudW0gVFlQRSA6IHVuc2lnbmVkIGludCB7IC4uLiB9OwogICAgICAgICAgICAgICBpZiAo
Y2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfVFlQRSkpCiAgICAgICAgICAgICAgIHsKICAgICAg
ICAgICAgICAgICAgLy8gZ2V0IHRoZSBuZXh0IHBhcnQgb2YgdGhlIHR5cGUKICAgICAgICAg
ICAgICAgICAgbmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwobmV4dCk7CiAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgICAgIGVsc2UgaWYgKGlzX3N0
cnVjdF9vcl9jbGFzcykKICAgICAgICAgewogICAgICAgICAgICBuZXh0ID0gc2tpcF9wYXJl
bnRfdHlwZXMobmV4dCk7CiAgICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIGlmIChpc19z
dHJ1Y3Rfb3JfY2xhc3MgJiYgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfUEFSRU5fT1BFTikp
CiAgICAgIHsKICAgICAgICAgLy8gRml4ICMxMjY3IHN0cnVjdHVyZSBhdHRyaWJ1dGVzCiAg
ICAgICAgIC8vIHN0cnVjdCBfX2F0dHJpYnV0ZV9fKGFsaWduKHgpKSBzdHJ1Y3RfbmFtZTsK
ICAgICAgICAgLy8gc2tpcCB0byBtYXRjaGluZyBwYXJlbmNsb3NlIGFuZCBtYWtlIG5leHQg
dG9rZW4gYXMgdHlwZS4KICAgICAgICAgbmV4dCA9IGNodW5rX3NraXBfdG9fbWF0Y2gobmV4
dCk7CiAgICAgICAgIG5leHQgPSBjaHVua19nZXRfbmV4dF9uY25sKG5leHQpOwogICAgICAg
ICBzZXRfY2h1bmtfdHlwZShuZXh0LCBDVF9UWVBFKTsKICAgICAgICAgc2V0X2NodW5rX3Bh
cmVudChuZXh0LCBwYy0+dHlwZSk7CiAgICAgIH0KCiAgICAgIGlmIChjaHVua19pc190b2tl
bihuZXh0LCBDVF9TRU1JQ09MT04pKSAvLyBjKysgZm9yd2FyZCBkZWNsYXJhdGlvbgogICAg
ICB7CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgcGMtPnR5cGUpOwogICAgICAg
ICBmbGFnX3NlcmllcyhwYywgcHJldiwgUENGX0lOQ09NUExFVEUpOwogICAgICAgICByZXR1
cm47CiAgICAgIH0KICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0JSQUNF
X09QRU4pKQogICB7CiAgICAgIGF1dG8gY29uc3QgZmxhZyA9IFtwY10gewogICAgICAgICBz
d2l0Y2ggKHBjLT50eXBlKQogICAgICAgICB7CiAgICAgICAgIGNhc2UgQ1RfRU5VTToKICAg
ICAgICAgICAgcmV0dXJuKFBDRl9JTl9FTlVNKTsKCiAgICAgICAgIGNhc2UgQ1RfU1RSVUNU
OgogICAgICAgICAgICByZXR1cm4oUENGX0lOX1NUUlVDVCk7CgogICAgICAgICBjYXNlIENU
X0NMQVNTOgogICAgICAgICAgICByZXR1cm4oUENGX0lOX0NMQVNTKTsKCiAgICAgICAgIGRl
ZmF1bHQ6CiAgICAgICAgICAgIHJldHVybihQQ0ZfTk9ORSk7CiAgICAgICAgIH0KICAgICAg
fSgpOwoKICAgICAgZmxhZ19wYXJlbnMobmV4dCwgZmxhZywgQ1RfTk9ORSwgQ1RfTk9ORSwg
ZmFsc2UpOwoKICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1VOSU9OKQogICAg
ICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfU1RSVUNUKQogICAgICAgICB8fCBjaHVu
a19pc190b2tlbihwYywgQ1RfQ0xBU1MpKQogICAgICB7CiAgICAgICAgIG1hcmtfc3RydWN0
X3VuaW9uX2JvZHkobmV4dCk7CiAgICAgIH0KICAgICAgLy8gU2tpcCB0byB0aGUgY2xvc2lu
ZyBicmFjZQogICAgICBzZXRfY2h1bmtfcGFyZW50KG5leHQsIHBjLT50eXBlKTsKICAgICAg
bmV4dCAgID0gY2h1bmtfZ2V0X25leHRfdHlwZShuZXh0LCBDVF9CUkFDRV9DTE9TRSwgcGMt
PmxldmVsKTsKICAgICAgZmxhZ3MgfD0gUENGX1ZBUl9JTkxJTkU7CgogICAgICBpZiAobmV4
dCAhPSBudWxscHRyKQogICAgICB7CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwg
cGMtPnR5cGUpOwogICAgICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0KTsK
ICAgICAgfQogICAgICBwcmV2ID0gbnVsbHB0cjsKICAgfQogICAvLyByZXNldCB2YXIgbmFt
ZSBwYXJlbnQgdHlwZQogICBlbHNlIGlmIChuZXh0ICYmIHByZXYpCiAgIHsKICAgICAgc2V0
X2NodW5rX3BhcmVudChwcmV2LCBDVF9OT05FKTsKICAgfQoKICAgaWYgKG5leHQgPT0gbnVs
bHB0ciB8fCBjaHVua19pc190b2tlbihuZXh0LCBDVF9QQVJFTl9DTE9TRSkpCiAgIHsKICAg
ICAgcmV0dXJuOwogICB9CgogICBpZiAoIWNodW5rX2lzX3NlbWljb2xvbihuZXh0KSkKICAg
ewogICAgICAvLyBQYXduIGRvZXMgbm90IHJlcXVpcmUgYSBzZW1pY29sb24gYWZ0ZXIgYW4g
ZW51bQogICAgICBpZiAobGFuZ3VhZ2VfaXNfc2V0KExBTkdfUEFXTikpCiAgICAgIHsKICAg
ICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvKgogICAgICAgKiBEIGRvZXMgbm90IHJl
cXVpcmUgYSBzZW1pY29sb24gYWZ0ZXIgYW4gZW51bSwgYnV0IHdlIGFkZCBvbmUgdG8gbWFr
ZQogICAgICAgKiBvdGhlciBjb2RlIGhhcHB5LgogICAgICAgKi8KICAgICAgaWYgKGxhbmd1
YWdlX2lzX3NldChMQU5HX0QpKQogICAgICB7CiAgICAgICAgIG5leHQgPSBwYXduX2FkZF92
c2VtaV9hZnRlcihjaHVua19nZXRfcHJldl9uY25sbmkobmV4dCkpOyAgIC8vIElzc3VlICMy
Mjc5CiAgICAgIH0KICAgfQoKICAgLy8gV2UgYXJlIGVpdGhlciBwb2ludGluZyB0byBhICc7
JyBvciBhIHZhcmlhYmxlCiAgIHdoaWxlICggIG5leHQgIT0gbnVsbHB0cgogICAgICAgICAm
JiAhY2h1bmtfaXNfc2VtaWNvbG9uKG5leHQpCiAgICAgICAgICYmIG5leHQtPnR5cGUgIT0g
Q1RfQVNTSUdOCiAgICAgICAgICYmICEoaW5fZmNuX3BhcmVuIF4gKG5leHQtPmZsYWdzICYg
UENGX0lOX0ZDTl9ERUYpKS50ZXN0X2FueSgpKQogICB7CiAgICAgIGlmIChuZXh0LT5sZXZl
bCA9PSBwYy0+bGV2ZWwpCiAgICAgIHsKICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG5l
eHQsIENUX1dPUkQpKQogICAgICAgICB7CiAgICAgICAgICAgIGNodW5rX2ZsYWdzX3NldChu
ZXh0LCBmbGFncyk7CiAgICAgICAgICAgIGZsYWdzICY9IH5QQ0ZfVkFSXzFTVDsgICAvLyBj
bGVhciB0aGUgZmlyc3QgZmxhZyBmb3IgdGhlIG5leHQgaXRlbXMKICAgICAgICAgICAgTE9H
X0ZNVChMQ0FTVFMsICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6
dSwgdGV4dCgpICclcycsIHNldCBQQ0ZfVkFSXzFTVFxuIiwKICAgICAgICAgICAgICAgICAg
ICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMt
PnRleHQoKSk7CiAgICAgICAgIH0KCiAgICAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKG5l
eHQsIENUX1NUQVIpCiAgICAgICAgICAgIHx8IChsYW5ndWFnZV9pc19zZXQoTEFOR19DUFAp
ICYmIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0NBUkVUKSkpCiAgICAgICAgIHsKICAgICAg
ICAgICAgc2V0X2NodW5rX3R5cGUobmV4dCwgQ1RfUFRSX1RZUEUpOwogICAgICAgICB9Cgog
ICAgICAgICAvLyBJZiB3ZSBoaXQgYSBjb21tYSBpbiBhIGZ1bmN0aW9uIHBhcmFtLCB3ZSBh
cmUgZG9uZQogICAgICAgICBpZiAoICAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfQ09NTUEp
IHx8IGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0ZQQVJFTl9DTE9TRSkpCiAgICAgICAgICAg
ICYmIChuZXh0LT5mbGFncy50ZXN0X2FueShQQ0ZfSU5fRkNOX0RFRiB8IFBDRl9JTl9GQ05f
Q0FMTCkpKQogICAgICAgICB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAg
ICB9CiAgICAgIG5leHQgPSBjaHVua19nZXRfbmV4dF9uY25sKG5leHQpOwogICB9CgogICBp
ZiAoICBuZXh0ICE9IG51bGxwdHIKICAgICAgJiYgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1Rf
U0VNSUNPTE9OKSkKICAgewogICAgICBzZXRfY2h1bmtfcGFyZW50KG5leHQsIHBjLT50eXBl
KTsKICAgfQp9IC8vIGZpeF9lbnVtX3N0cnVjdF91bmlvbgoKCnN0YXRpYyB2b2lkIGZpeF90
eXBlZGVmKGNodW5rX3QgKnN0YXJ0KQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CgogICBpZiAo
c3RhcnQgPT0gbnVsbHB0cikKICAgewogICAgICByZXR1cm47CiAgIH0KICAgTE9HX0ZNVChM
VFlQRURFRiwgIiVzKCVkKTogdHlwZWRlZiBAIG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6
dVxuIiwKICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHN0YXJ0LT5vcmlnX2xpbmUs
IHN0YXJ0LT5vcmlnX2NvbCk7CgogICBjaHVua190ICp0aGVfdHlwZSA9IG51bGxwdHI7CiAg
IGNodW5rX3QgKmxhc3Rfb3AgID0gbnVsbHB0cjsKCiAgIC8qCiAgICAqIE1hcmsgZXZlcnl0
aGluZyBpbiB0aGUgdHlwZWRlZiBhbmQgc2NhbiBmb3IgIikoIiwgd2hpY2ggbWFrZXMgaXQg
YQogICAgKiBmdW5jdGlvbiB0eXBlCiAgICAqLwogICBmb3IgKGNodW5rX3QgKm5leHQgPSBj
aHVua19nZXRfbmV4dF9uY25sKHN0YXJ0LCBzY29wZV9lOjpQUkVQUk9DKQogICAgICAgIDsg
bmV4dCAhPSBudWxscHRyICYmIG5leHQtPmxldmVsID49IHN0YXJ0LT5sZXZlbAogICAgICAg
IDsgbmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwobmV4dCwgc2NvcGVfZTo6UFJFUFJPQykp
CiAgIHsKICAgICAgY2h1bmtfZmxhZ3Nfc2V0KG5leHQsIFBDRl9JTl9UWVBFREVGKTsKCiAg
ICAgIGlmIChzdGFydC0+bGV2ZWwgPT0gbmV4dC0+bGV2ZWwpCiAgICAgIHsKICAgICAgICAg
aWYgKGNodW5rX2lzX3NlbWljb2xvbihuZXh0KSkKICAgICAgICAgewogICAgICAgICAgICBz
ZXRfY2h1bmtfcGFyZW50KG5leHQsIENUX1RZUEVERUYpOwogICAgICAgICAgICBicmVhazsK
ICAgICAgICAgfQoKICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0FUVFJJ
QlVURSkpCiAgICAgICAgIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgIH0KCiAgICAg
ICAgIGlmIChsYW5ndWFnZV9pc19zZXQoTEFOR19EKSAmJiBjaHVua19pc190b2tlbihuZXh0
LCBDVF9BU1NJR04pKQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQo
bmV4dCwgQ1RfVFlQRURFRik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAgICAg
ICAgIG1ha2VfdHlwZShuZXh0KTsKCiAgICAgICAgIGlmIChjaHVua19pc190b2tlbihuZXh0
LCBDVF9UWVBFKSkKICAgICAgICAgewogICAgICAgICAgICB0aGVfdHlwZSA9IG5leHQ7CiAg
ICAgICAgIH0KICAgICAgICAgY2h1bmtfZmxhZ3NfY2xyKG5leHQsIFBDRl9WQVJfMVNUX0RF
Rik7CgogICAgICAgICBpZiAoKm5leHQtPnN0ci5jX3N0cigpID09ICcoJykKICAgICAgICAg
ewogICAgICAgICAgICBsYXN0X29wID0gbmV4dDsKICAgICAgICAgfQogICAgICB9CiAgIH0K
CiAgIC8vIGF2b2lkIGludGVycHJldGluZyB0eXBlZGVmIE5TX0VOVU0gKE5TSW50ZWdlciwg
TXlFbnVtKSBhcyBhIGZ1bmN0aW9uIGRlZgogICBpZiAoICBsYXN0X29wICE9IG51bGxwdHIK
ICAgICAgJiYgIShsYW5ndWFnZV9pc19zZXQoTEFOR19PQykgJiYgZ2V0X2NodW5rX3BhcmVu
dF90eXBlKGxhc3Rfb3ApID09IENUX0VOVU0pKQogICB7CiAgICAgIGZsYWdfcGFyZW5zKGxh
c3Rfb3AsIFBDRl9OT05FLCBDVF9GUEFSRU5fT1BFTiwgQ1RfVFlQRURFRiwgZmFsc2UpOwog
ICAgICBmaXhfZmNuX2RlZl9wYXJhbXMobGFzdF9vcCk7CgogICAgICB0aGVfdHlwZSA9IGNo
dW5rX2dldF9wcmV2X25jbmxuaShsYXN0X29wLCBzY29wZV9lOjpQUkVQUk9DKTsgICAvLyBJ
c3N1ZSAjMjI3OQoKICAgICAgaWYgKHRoZV90eXBlID09IG51bGxwdHIpCiAgICAgIHsKICAg
ICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNodW5rX3QgKm9wZW5fcGFyZW4gPSBudWxs
cHRyOwoKICAgICAgaWYgKGNodW5rX2lzX3BhcmVuX2Nsb3NlKHRoZV90eXBlKSkKICAgICAg
ewogICAgICAgICBvcGVuX3BhcmVuID0gY2h1bmtfc2tpcF90b19tYXRjaF9yZXYodGhlX3R5
cGUpOwogICAgICAgICBtYXJrX2Z1bmN0aW9uX3R5cGUodGhlX3R5cGUpOwogICAgICAgICB0
aGVfdHlwZSA9IGNodW5rX2dldF9wcmV2X25jbmxuaSh0aGVfdHlwZSwgc2NvcGVfZTo6UFJF
UFJPQyk7ICAgLy8gSXNzdWUgIzIyNzkKCiAgICAgICAgIGlmICh0aGVfdHlwZSA9PSBudWxs
cHRyKQogICAgICAgICB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgICB9
CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICAvLyBtdXN0IGJlOiAidHlwZWRlZiA8cmV0
dXJuIHR5cGU+ZnVuYyhwYXJhbXMpOyIKICAgICAgICAgc2V0X2NodW5rX3R5cGUodGhlX3R5
cGUsIENUX0ZVTkNfVFlQRSk7CiAgICAgIH0KICAgICAgc2V0X2NodW5rX3BhcmVudCh0aGVf
dHlwZSwgQ1RfVFlQRURFRik7CgogICAgICBMT0dfRk1UKExUWVBFREVGLCAiJXMoJWQpOiBm
Y24gdHlwZWRlZiB0ZXh0KCkgJyVzJywgb24gb3JpZ19saW5lICV6dVxuIiwKICAgICAgICAg
ICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHRoZV90eXBlLT50ZXh0KCksIHRoZV90eXBlLT5v
cmlnX2xpbmUpOwoKICAgICAgLy8gSWYgd2UgYXJlIGFsaWduaW5nIG9uIHRoZSBvcGVuIHBh
cmVudGhlc2lzLCBncmFiIHRoYXQgaW5zdGVhZAogICAgICBsb2dfcnVsZV9CKCJhbGlnbl90
eXBlZGVmX2Z1bmMiKTsKCiAgICAgIGlmIChvcGVuX3BhcmVuICE9IG51bGxwdHIgJiYgb3B0
aW9uczo6YWxpZ25fdHlwZWRlZl9mdW5jKCkgPT0gMSkKICAgICAgewogICAgICAgICB0aGVf
dHlwZSA9IG9wZW5fcGFyZW47CiAgICAgIH0KICAgICAgbG9nX3J1bGVfQigiYWxpZ25fdHlw
ZWRlZl9mdW5jIik7CgogICAgICBpZiAob3B0aW9uczo6YWxpZ25fdHlwZWRlZl9mdW5jKCkg
IT0gMCkKICAgICAgewogICAgICAgICBMT0dfRk1UKExUWVBFREVGLCAiJXMoJWQpOiAgLS0g
YWxpZ24gYW5jaG9yIG9uIHRleHQoKSAlcywgQCBvcmlnX2xpbmUgJXp1LCBvcmlnX2NvbCAl
enVcbiIsCiAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0aGVfdHlwZS0+
dGV4dCgpLCB0aGVfdHlwZS0+b3JpZ19saW5lLCB0aGVfdHlwZS0+b3JpZ19jb2wpOwogICAg
ICAgICBjaHVua19mbGFnc19zZXQodGhlX3R5cGUsIFBDRl9BTkNIT1IpOwogICAgICB9CiAg
ICAgIC8vIGFscmVhZHkgZGlkIGV2ZXJ5dGhpbmcgd2UgbmVlZCB0byBkbwogICAgICByZXR1
cm47CiAgIH0KICAgLyoKICAgICogU2tpcCBvdmVyIGVudW0vc3RydWN0L3VuaW9uIHN0dWZm
LCBhcyB3ZSBrbm93IGl0IGlzbid0IGEgcmV0dXJuIHR5cGUKICAgICogZm9yIGEgZnVuY3Rp
b24gdHlwZQogICAgKi8KICAgY2h1bmtfdCAqYWZ0ZXIgPSBjaHVua19nZXRfbmV4dF9uY25s
KHN0YXJ0LCBzY29wZV9lOjpQUkVQUk9DKTsKCiAgIGlmIChhZnRlciA9PSBudWxscHRyKQog
ICB7CiAgICAgIHJldHVybjsKICAgfQoKICAgaWYgKCAgYWZ0ZXItPnR5cGUgIT0gQ1RfRU5V
TQogICAgICAmJiBhZnRlci0+dHlwZSAhPSBDVF9TVFJVQ1QKICAgICAgJiYgYWZ0ZXItPnR5
cGUgIT0gQ1RfVU5JT04pCiAgIHsKICAgICAgaWYgKHRoZV90eXBlICE9IG51bGxwdHIpCiAg
ICAgIHsKICAgICAgICAgLy8gV2UgaGF2ZSBqdXN0IGEgcmVndWxhciB0eXBlZGVmCiAgICAg
ICAgIExPR19GTVQoTFRZUEVERUYsICIlcyglZCk6IHJlZ3VsYXIgdHlwZWRlZiB0ZXh0KCkg
JXMsIG9uIG9yaWdfbGluZSAlenVcbiIsCiAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9f
TElORV9fLCB0aGVfdHlwZS0+dGV4dCgpLCB0aGVfdHlwZS0+b3JpZ19saW5lKTsKICAgICAg
ICAgY2h1bmtfZmxhZ3Nfc2V0KHRoZV90eXBlLCBQQ0ZfQU5DSE9SKTsKICAgICAgfQogICAg
ICByZXR1cm47CiAgIH0KICAgLy8gV2UgaGF2ZSBhIHN0cnVjdC91bmlvbi9lbnVtLCBuZXh0
IHNob3VsZCBiZSBlaXRoZXIgYSB0eXBlIG9yIHsKICAgY2h1bmtfdCAqbmV4dCA9IGNodW5r
X2dldF9uZXh0X25jbmwoYWZ0ZXIsIHNjb3BlX2U6OlBSRVBST0MpOwoKICAgaWYgKG5leHQg
PT0gbnVsbHB0cikKICAgewogICAgICByZXR1cm47CiAgIH0KCiAgIGlmIChjaHVua19pc190
b2tlbihuZXh0LCBDVF9UWVBFKSkKICAgewogICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHRf
bmNubChuZXh0LCBzY29wZV9lOjpQUkVQUk9DKTsKCiAgICAgIGlmIChuZXh0ID09IG51bGxw
dHIpCiAgICAgIHsKICAgICAgICAgcmV0dXJuOwogICAgICB9CiAgIH0KCiAgIGlmIChjaHVu
a19pc190b2tlbihuZXh0LCBDVF9CUkFDRV9PUEVOKSkKICAgewogICAgICAvLyBTa2lwIHRv
IHRoZSBjbG9zaW5nIGJyYWNlCiAgICAgIGNodW5rX3QgKmJyX2MgPSBjaHVua19nZXRfbmV4
dF90eXBlKG5leHQsIENUX0JSQUNFX0NMT1NFLCBuZXh0LT5sZXZlbCwgc2NvcGVfZTo6UFJF
UFJPQyk7CgogICAgICBpZiAoYnJfYyAhPSBudWxscHRyKQogICAgICB7CiAgICAgICAgIGNv
bnN0IGNfdG9rZW5fdCB0YWcgPSBhZnRlci0+dHlwZTsKICAgICAgICAgc2V0X2NodW5rX3Bh
cmVudChuZXh0LCB0YWcpOwogICAgICAgICBzZXRfY2h1bmtfcGFyZW50KGJyX2MsIHRhZyk7
CgogICAgICAgICBpZiAodGFnID09IENUX0VOVU0pCiAgICAgICAgIHsKICAgICAgICAgICAg
ZmxhZ19zZXJpZXMoYWZ0ZXIsIGJyX2MsIFBDRl9JTl9FTlVNKTsKICAgICAgICAgfQogICAg
ICAgICBlbHNlIGlmICh0YWcgPT0gQ1RfU1RSVUNUKQogICAgICAgICB7CiAgICAgICAgICAg
IGZsYWdfc2VyaWVzKGFmdGVyLCBicl9jLCBQQ0ZfSU5fU1RSVUNUKTsKICAgICAgICAgfQog
ICAgICB9CiAgIH0KCiAgIGlmICh0aGVfdHlwZSAhPSBudWxscHRyKQogICB7CiAgICAgIExP
R19GTVQoTFRZUEVERUYsICIlcyglZCk6ICVzIHR5cGVkZWYgdGV4dCgpICVzLCBvbiBvcmln
X2xpbmUgJXp1XG4iLAogICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgZ2V0X3Rv
a2VuX25hbWUoYWZ0ZXItPnR5cGUpLCB0aGVfdHlwZS0+dGV4dCgpLAogICAgICAgICAgICAg
IHRoZV90eXBlLT5vcmlnX2xpbmUpOwogICAgICBjaHVua19mbGFnc19zZXQodGhlX3R5cGUs
IFBDRl9BTkNIT1IpOwogICB9Cn0gLy8gZml4X3R5cGVkZWYKCgpzdGF0aWMgdm9pZCBtYXJr
X3ZhcmlhYmxlX3N0YWNrKENodW5rU3RhY2sgJmNzLCBsb2dfc2V2X3Qgc2V2KQp7CiAgIFVO
VVNFRChzZXYpOwogICBMT0dfRlVOQ19FTlRSWSgpOwoKICAgLy8gdGhyb3cgb3V0IHRoZSBs
YXN0IHdvcmQgYW5kIG1hcmsgdGhlIHJlc3QKICAgY2h1bmtfdCAqdmFyX25hbWUgPSBjcy5Q
b3BfQmFjaygpOwoKICAgaWYgKHZhcl9uYW1lICYmIHZhcl9uYW1lLT5wcmV2LT50eXBlID09
IENUX0RDX01FTUJFUikKICAgewogICAgICBjcy5QdXNoX0JhY2sodmFyX25hbWUpOwogICB9
CgogICBpZiAodmFyX25hbWUgIT0gbnVsbHB0cikKICAgewogICAgICBMT0dfRk1UKExGQ05Q
LCAiJXMoJWQpOiBwYXJhbWV0ZXIgb24gb3JpZ19saW5lICV6dSwgb3JpZ19jb2wgJXp1Olxu
IiwKICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHZhcl9uYW1lLT5vcmlnX2xp
bmUsIHZhcl9uYW1lLT5vcmlnX2NvbCk7CgogICAgICBzaXplX3QgIHdvcmRfY250ID0gMDsK
ICAgICAgY2h1bmtfdCAqd29yZF90eXBlOwoKICAgICAgd2hpbGUgKCh3b3JkX3R5cGUgPSBj
cy5Qb3BfQmFjaygpKSAhPSBudWxscHRyKQogICAgICB7CiAgICAgICAgIGlmIChjaHVua19p
c190b2tlbih3b3JkX3R5cGUsIENUX1dPUkQpIHx8IGNodW5rX2lzX3Rva2VuKHdvcmRfdHlw
ZSwgQ1RfVFlQRSkpCiAgICAgICAgIHsKICAgICAgICAgICAgTE9HX0ZNVChMRkNOUCwgIiVz
KCVkKTogcGFyYW1ldGVyIG9uIG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dTogPCVzPiBh
cyBUWVBFXG4iLAogICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgdmFy
X25hbWUtPm9yaWdfbGluZSwgdmFyX25hbWUtPm9yaWdfY29sLCB3b3JkX3R5cGUtPnRleHQo
KSk7CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKHdvcmRfdHlwZSwgQ1RfVFlQRSk7CiAg
ICAgICAgICAgIGNodW5rX2ZsYWdzX3NldCh3b3JkX3R5cGUsIFBDRl9WQVJfVFlQRSk7CiAg
ICAgICAgIH0KICAgICAgICAgd29yZF9jbnQrKzsKICAgICAgfQoKICAgICAgaWYgKGNodW5r
X2lzX3Rva2VuKHZhcl9uYW1lLCBDVF9XT1JEKSkKICAgICAgewogICAgICAgICBpZiAod29y
ZF9jbnQgPiAwKQogICAgICAgICB7CiAgICAgICAgICAgIExPR19GTVQoTEZDTlAsICIlcygl
ZCk6IHBhcmFtZXRlciBvbiBvcmlnX2xpbmUgJXp1LCBvcmlnX2NvbCAlenU6IDwlcz4gYXMg
VkFSXG4iLAogICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgdmFyX25h
bWUtPm9yaWdfbGluZSwgdmFyX25hbWUtPm9yaWdfY29sLCB2YXJfbmFtZS0+dGV4dCgpKTsK
ICAgICAgICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHZhcl9uYW1lLCBQQ0ZfVkFSX0RFRik7CiAg
ICAgICAgIH0KICAgICAgICAgZWxzZQogICAgICAgICB7CiAgICAgICAgICAgIExPR19GTVQo
TEZDTlAsICIlcyglZCk6IHBhcmFtZXRlciBvbiBvcmlnX2xpbmUgJXp1LCBvcmlnX2NvbCAl
enU6IDwlcz4gYXMgVFlQRVxuIiwKICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19M
SU5FX18sIHZhcl9uYW1lLT5vcmlnX2xpbmUsIHZhcl9uYW1lLT5vcmlnX2NvbCwgdmFyX25h
bWUtPnRleHQoKSk7CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKHZhcl9uYW1lLCBDVF9U
WVBFKTsKICAgICAgICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHZhcl9uYW1lLCBQQ0ZfVkFSX1RZ
UEUpOwogICAgICAgICB9CiAgICAgIH0KICAgfQp9IC8vIG1hcmtfdmFyaWFibGVfc3RhY2sK
CgpzdGF0aWMgdm9pZCBmaXhfZmNuX2RlZl9wYXJhbXMoY2h1bmtfdCAqc3RhcnQpCnsKICAg
TE9HX0ZVTkNfRU5UUlkoKTsKCiAgIGlmIChzdGFydCA9PSBudWxscHRyKQogICB7CiAgICAg
IHJldHVybjsKICAgfQogICBMT0dfRk1UKExGQ05QLCAiJXMoJWQpOiB0ZXh0KCkgJyVzJywg
dHlwZSBpcyAlcywgb24gb3JpZ19saW5lICV6dSwgbGV2ZWwgaXMgJXp1XG4iLAogICAgICAg
ICAgIF9fZnVuY19fLCBfX0xJTkVfXywgc3RhcnQtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUo
c3RhcnQtPnR5cGUpLCBzdGFydC0+b3JpZ19saW5lLCBzdGFydC0+bGV2ZWwpOwoKICAgd2hp
bGUgKHN0YXJ0ICE9IG51bGxwdHIgJiYgIWNodW5rX2lzX3BhcmVuX29wZW4oc3RhcnQpKQog
ICB7CiAgICAgIHN0YXJ0ID0gY2h1bmtfZ2V0X25leHRfbmNubChzdGFydCk7CiAgIH0KCiAg
IGlmIChzdGFydCA9PSBudWxscHRyKS8vIENvdmVyaXR5IENJRCA3NjAwMywgMTEwMDc4Mgog
ICB7CiAgICAgIHJldHVybjsKICAgfQogICAvLyBlbnN1cmUgc3RhcnQgY2h1bmsgaG9sZHMg
YSBzaW5nbGUgJygnIGNoYXJhY3RlcgogICBhc3NlcnQoKHN0YXJ0LT5sZW4oKSA9PSAxKSAm
JiAoc3RhcnQtPnN0clswXSA9PSAnKCcpKTsKCiAgIENodW5rU3RhY2sgY3M7CiAgIHNpemVf
dCAgICAgbGV2ZWwgPSBzdGFydC0+bGV2ZWwgKyAxOwogICBjaHVua190ICAgICpwYyAgID0g
c3RhcnQ7CgogICB3aGlsZSAoKHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChwYykpICE9IG51
bGxwdHIpCiAgIHsKICAgICAgaWYgKCAgKChzdGFydC0+bGVuKCkgPT0gMSkgJiYgKHN0YXJ0
LT5zdHJbMF0gPT0gJyknKSkKICAgICAgICAgfHwgcGMtPmxldmVsIDwgbGV2ZWwpCiAgICAg
IHsKICAgICAgICAgTE9HX0ZNVChMRkNOUCwgIiVzKCVkKTogYmFpbGVkIG9uIHRleHQoKSAn
JXMnLCBvbiBvcmlnX2xpbmUgJXp1XG4iLAogICAgICAgICAgICAgICAgIF9fZnVuY19fLCBf
X0xJTkVfXywgcGMtPnRleHQoKSwgcGMtPm9yaWdfbGluZSk7CiAgICAgICAgIGJyZWFrOwog
ICAgICB9CiAgICAgIExPR19GTVQoTEZDTlAsICIlcyglZCk6ICVzLCB0ZXh0KCkgJyVzJyBv
biBvcmlnX2xpbmUgJXp1LCBsZXZlbCAlenVcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18s
IF9fTElORV9fLCAocGMtPmxldmVsID4gbGV2ZWwpID8gInNraXBwaW5nIiA6ICJsb29raW5n
IGF0IiwKICAgICAgICAgICAgICBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5lLCBwYy0+bGV2
ZWwpOwoKICAgICAgaWYgKHBjLT5sZXZlbCA+IGxldmVsKQogICAgICB7CiAgICAgICAgIGNv
bnRpbnVlOwogICAgICB9CgogICAgICBpZiAoY2h1bmtfaXNfc3RhcihwYykgfHwgY2h1bmtf
aXNfbXNyZWYocGMpIHx8IGNodW5rX2lzX251bGxhYmxlKHBjKSkKICAgICAgewogICAgICAg
ICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfUFRSX1RZUEUpOwogICAgICAgICBjcy5QdXNoX0Jh
Y2socGMpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENU
X0FNUCkKICAgICAgICAgICAgICB8fCAobGFuZ3VhZ2VfaXNfc2V0KExBTkdfQ1BQKSAmJiBj
aHVua19pc19zdHIocGMsICImJiIsIDIpKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtf
dHlwZShwYywgQ1RfQllSRUYpOwogICAgICAgICBjcy5QdXNoX0JhY2socGMpOwogICAgICB9
CiAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9UWVBFX1dSQVApKQogICAg
ICB7CiAgICAgICAgIGNzLlB1c2hfQmFjayhwYyk7CiAgICAgIH0KICAgICAgZWxzZSBpZiAo
Y2h1bmtfaXNfdG9rZW4ocGMsIENUX1dPUkQpIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9U
WVBFKSkKICAgICAgewogICAgICAgICBjcy5QdXNoX0JhY2socGMpOwogICAgICB9CiAgICAg
IGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DT01NQSkgfHwgY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX0FTU0lHTikpCiAgICAgIHsKICAgICAgICAgbWFya192YXJpYWJsZV9zdGFj
ayhjcywgTEZDTlApOwoKICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BU1NJ
R04pKQogICAgICAgICB7CiAgICAgICAgICAgIC8vIE1hcmsgYXNzaWdubWVudCBmb3IgZGVm
YXVsdCBwYXJhbSBzcGFjaW5nCiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQocGMsIENU
X0ZVTkNfUFJPVE8pOwogICAgICAgICB9CiAgICAgIH0KICAgfQogICBtYXJrX3ZhcmlhYmxl
X3N0YWNrKGNzLCBMRkNOUCk7Cn0gLy8gZml4X2Zjbl9kZWZfcGFyYW1zCgoKc3RhdGljIGNo
dW5rX3QgKnNraXBfdG9fbmV4dF9zdGF0ZW1lbnQoY2h1bmtfdCAqcGMpCnsKICAgd2hpbGUg
KCAgcGMgIT0gbnVsbHB0cgogICAgICAgICAmJiAhY2h1bmtfaXNfc2VtaWNvbG9uKHBjKQog
ICAgICAgICAmJiBwYy0+dHlwZSAhPSBDVF9CUkFDRV9PUEVOCiAgICAgICAgICYmIHBjLT50
eXBlICE9IENUX0JSQUNFX0NMT1NFKQogICB7CiAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRf
bmNubChwYyk7CiAgIH0KICAgcmV0dXJuKHBjKTsKfQoKCnN0YXRpYyBjaHVua190ICpmaXhf
dmFyaWFibGVfZGVmaW5pdGlvbihjaHVua190ICpzdGFydCkKewogICBMT0dfRlVOQ19FTlRS
WSgpOwogICBjaHVua190ICAgICpwYyA9IHN0YXJ0OwogICBjaHVua190ICAgICplbmQ7CiAg
IGNodW5rX3QgICAgKnRtcF9wYzsKICAgQ2h1bmtTdGFjayBjczsKICAgaW50ICAgICAgICBp
ZHg7CiAgIGludCAgICAgICAgcmVmX2lkeDsKCiAgIExPR19GTVQoTEZWRCwgIiVzKCVkKTog
c3RhcnQgYXQgcGMtPm9yaWdfbGluZSBpcyAlenUsIHBjLT5vcmlnX2NvbCBpcyAlenVcbiIs
CiAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3Jp
Z19jb2wpOwoKICAgLy8gU2NhbiBmb3Igd29yZHMgYW5kIHR5cGVzIGFuZCBzdGFycyBvaCBt
eSEKICAgd2hpbGUgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RZUEUpCiAgICAgICAgIHx8
IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9XT1JEKQogICAgICAgICB8fCBjaHVua19pc190b2tl
bihwYywgQ1RfUVVBTElGSUVSKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1Rf
VFlQRU5BTUUpCiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9EQ19NRU1CRVIp
CiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9NRU1CRVIpCiAgICAgICAgIHx8
IGNodW5rX2lzX3B0cl9vcGVyYXRvcihwYykpCiAgIHsKICAgICAgTE9HX0ZNVChMRlZELCAi
JXMoJWQpOiAgIDE6cGMtPnRleHQoKSAnJXMnLCB0eXBlIGlzICVzXG4iLAogICAgICAgICAg
ICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUocGMt
PnR5cGUpKTsKICAgICAgY3MuUHVzaF9CYWNrKHBjKTsKICAgICAgcGMgPSBjaHVua19nZXRf
bmV4dF9uY25sKHBjKTsKCiAgICAgIGlmIChwYyA9PSBudWxscHRyKQogICAgICB7CiAgICAg
ICAgIExPR19GTVQoTEZWRCwgIiVzKCVkKTogcGMgaXMgbnVsbHB0clxuIiwgX19mdW5jX18s
IF9fTElORV9fKTsKICAgICAgICAgcmV0dXJuKG51bGxwdHIpOwogICAgICB9CiAgICAgIExP
R19GTVQoTEZWRCwgIiVzKCVkKTogICAyOnBjLT50ZXh0KCkgJyVzJywgdHlwZSBpcyAlc1xu
IiwKICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIGdldF90
b2tlbl9uYW1lKHBjLT50eXBlKSk7CgogICAgICAvLyBTa2lwIHRlbXBsYXRlcyBhbmQgYXR0
cmlidXRlcwogICAgICBwYyA9IHNraXBfdGVtcGxhdGVfbmV4dChwYyk7CgogICAgICBpZiAo
cGMgPT0gbnVsbHB0cikKICAgICAgewogICAgICAgICBMT0dfRk1UKExGVkQsICIlcyglZCk6
IHBjIGlzIG51bGxwdHJcbiIsIF9fZnVuY19fLCBfX0xJTkVfXyk7CiAgICAgICAgIHJldHVy
bihudWxscHRyKTsKICAgICAgfQogICAgICBMT0dfRk1UKExGVkQsICIlcyglZCk6ICAgMzpw
Yy0+dGV4dCgpICclcycsIHR5cGUgaXMgJXNcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18s
IF9fTElORV9fLCBwYy0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSkpOwoKICAg
ICAgcGMgPSBza2lwX2F0dHJpYnV0ZV9uZXh0KHBjKTsKCiAgICAgIGlmIChwYyA9PSBudWxs
cHRyKQogICAgICB7CiAgICAgICAgIExPR19GTVQoTEZWRCwgIiVzKCVkKTogcGMgaXMgbnVs
bHB0clxuIiwgX19mdW5jX18sIF9fTElORV9fKTsKICAgICAgICAgcmV0dXJuKG51bGxwdHIp
OwogICAgICB9CiAgICAgIExPR19GTVQoTEZWRCwgIiVzKCVkKTogICA0OnBjLT50ZXh0KCkg
JyVzJywgdHlwZSBpcyAlc1xuIiwKICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18s
IHBjLT50ZXh0KCksIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CgogICAgICBpZiAobGFu
Z3VhZ2VfaXNfc2V0KExBTkdfSkFWQSkpCiAgICAgIHsKICAgICAgICAgcGMgPSBza2lwX3Rz
cXVhcmVfbmV4dChwYyk7CiAgICAgICAgIExPR19GTVQoTEZWRCwgIiVzKCVkKTogICA1OnBj
LT50ZXh0KCkgJyVzJywgdHlwZSBpcyAlc1xuIiwgX19mdW5jX18sIF9fTElORV9fLCBwYy0+
dGV4dCgpLCBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSkpOwogICAgICB9CiAgIH0KICAgZW5k
ID0gcGM7CgogICBpZiAoZW5kID09IG51bGxwdHIpCiAgIHsKICAgICAgTE9HX0ZNVChMRlZE
LCAiJXMoJWQpOiBlbmQgaXMgbnVsbHB0clxuIiwgX19mdW5jX18sIF9fTElORV9fKTsKICAg
ICAgcmV0dXJuKG51bGxwdHIpOwogICB9CiAgIExPR19GTVQoTEZWRCwgIiVzKCVkKTogZW5k
LT50eXBlIGlzICVzXG4iLCBfX2Z1bmNfXywgX19MSU5FX18sIGdldF90b2tlbl9uYW1lKGVu
ZC0+dHlwZSkpOwoKICAgaWYgKCAgY3MuTGVuKCkgPT0gMQogICAgICAmJiBjaHVua19pc190
b2tlbihlbmQsIENUX0JSQUNFX09QRU4pCiAgICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlw
ZShlbmQpID09IENUX0JSQUNFRF9JTklUX0xJU1QpCiAgIHsKICAgICAgc2V0X2NodW5rX3R5
cGUoY3MuR2V0KDApLT5tX3BjLCBDVF9UWVBFKTsKICAgfQoKICAgLy8gRnVuY3Rpb24gZGVm
cyBhcmUgaGFuZGxlZCBlbHNld2hlcmUKICAgaWYgKCAgKGNzLkxlbigpIDw9IDEpCiAgICAg
IHx8IGNodW5rX2lzX3Rva2VuKGVuZCwgQ1RfRlVOQ19ERUYpCiAgICAgIHx8IGNodW5rX2lz
X3Rva2VuKGVuZCwgQ1RfRlVOQ19QUk9UTykKICAgICAgfHwgY2h1bmtfaXNfdG9rZW4oZW5k
LCBDVF9GVU5DX0NMQVNTX0RFRikKICAgICAgfHwgY2h1bmtfaXNfdG9rZW4oZW5kLCBDVF9G
VU5DX0NMQVNTX1BST1RPKQogICAgICB8fCBjaHVua19pc190b2tlbihlbmQsIENUX09QRVJB
VE9SKSkKICAgewogICAgICByZXR1cm4oc2tpcF90b19uZXh0X3N0YXRlbWVudChlbmQpKTsK
ICAgfQogICAvLyByZWZfaWR4IHBvaW50cyB0byB0aGUgYWxpZ25hYmxlIHBhcnQgb2YgdGhl
IHZhcmlhYmxlIGRlZmluaXRpb24KICAgcmVmX2lkeCA9IGNzLkxlbigpIC0gMTsKCiAgIC8v
IENoZWNrIGZvciB0aGUgJzo6JyBzdHVmZjogImNoYXIgKkVuZ2luZTo6bmFtZSIKICAgaWYg
KCAgKGNzLkxlbigpID49IDMpCiAgICAgICYmICggIChjcy5HZXQoY3MuTGVuKCkgLSAyKS0+
bV9wYy0+dHlwZSA9PSBDVF9NRU1CRVIpCiAgICAgICAgIHx8IChjcy5HZXQoY3MuTGVuKCkg
LSAyKS0+bV9wYy0+dHlwZSA9PSBDVF9EQ19NRU1CRVIpKSkKICAgewogICAgICBpZHggPSBj
cy5MZW4oKSAtIDI7CgogICAgICB3aGlsZSAoaWR4ID4gMCkKICAgICAgewogICAgICAgICB0
bXBfcGMgPSBjcy5HZXQoaWR4KS0+bV9wYzsKCiAgICAgICAgIGlmICggIHRtcF9wYy0+dHlw
ZSAhPSBDVF9EQ19NRU1CRVIKICAgICAgICAgICAgJiYgdG1wX3BjLT50eXBlICE9IENUX01F
TUJFUikKICAgICAgICAgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgfQoKICAgICAg
ICAgaWYgKGlkeCA9PSAwKQogICAgICAgICB7CiAgICAgICAgICAgIGZwcmludGYoc3RkZXJy
LCAiJXMoJWQpOiBpZHggaXMgWkVSTywgY2Fubm90IGJlIGRlY3JlbWVudGVkLCBhdCBsaW5l
ICV6dSwgY29sdW1uICV6dVxuIiwKICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19M
SU5FX18sIHRtcF9wYy0+b3JpZ19saW5lLCB0bXBfcGMtPm9yaWdfY29sKTsKICAgICAgICAg
ICAgbG9nX2ZsdXNoKHRydWUpOwogICAgICAgICAgICBleGl0KEVYX1NPRlRXQVJFKTsKICAg
ICAgICAgfQogICAgICAgICBpZHgtLTsKICAgICAgICAgdG1wX3BjID0gY3MuR2V0KGlkeCkt
Pm1fcGM7CgogICAgICAgICBpZiAoICB0bXBfcGMtPnR5cGUgIT0gQ1RfV09SRAogICAgICAg
ICAgICAmJiB0bXBfcGMtPnR5cGUgIT0gQ1RfVFlQRSkKICAgICAgICAgewogICAgICAgICAg
ICBicmVhazsKICAgICAgICAgfQogICAgICAgICBtYWtlX3R5cGUodG1wX3BjKTsKICAgICAg
ICAgaWR4LS07CiAgICAgIH0KICAgICAgcmVmX2lkeCA9IGlkeCArIDE7CiAgIH0KICAgdG1w
X3BjID0gY3MuR2V0KHJlZl9pZHgpLT5tX3BjOwogICBMT0dfRk1UKExGVkQsICIlcyglZCk6
IHJlZl9pZHgoJWQpIGlzICclcydcbiIsIF9fZnVuY19fLCBfX0xJTkVfXywgcmVmX2lkeCwg
dG1wX3BjLT50ZXh0KCkpOwoKICAgLy8gTm8gdHlwZSBwYXJ0IGZvdW5kIQogICBpZiAocmVm
X2lkeCA8PSAwKQogICB7CiAgICAgIHJldHVybihza2lwX3RvX25leHRfc3RhdGVtZW50KGVu
ZCkpOwogICB9CiAgIExPR19GTVQoTEZWRDIsICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUs
IFRZUEUgOiAiLCBfX2Z1bmNfXywgX19MSU5FX18sIHN0YXJ0LT5vcmlnX2xpbmUpOwoKICAg
Zm9yIChzaXplX3QgaWR4Rm9yQ3MgPSAwOyBpZHhGb3JDcyA8IGNzLkxlbigpIC0gMTsgaWR4
Rm9yQ3MrKykKICAgewogICAgICB0bXBfcGMgPSBjcy5HZXQoaWR4Rm9yQ3MpLT5tX3BjOwog
ICAgICBtYWtlX3R5cGUodG1wX3BjKTsKICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHRtcF9wYywg
UENGX1ZBUl9UWVBFKTsKICAgICAgTE9HX0ZNVChMRlZEMiwgIiB0ZXh0KCkgaXMgJyVzJywg
dHlwZSBpcyAlcyIsIHRtcF9wYy0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZSh0bXBfcGMtPnR5
cGUpKTsKICAgfQoKICAgTE9HX0ZNVChMRlZEMiwgIlxuIik7CgogICAvLyBPSyB3ZSBoYXZl
IHR3byBvciBtb3JlIGl0ZW1zLCBtYXJrIHR5cGVzIHVwIHRvIHRoZSBlbmQuCiAgIExPR19G
TVQoTEZWRCwgIiVzKCVkKTogcGMtPm9yaWdfbGluZSBpcyAlenUsIHBjLT5vcmlnX2NvbCBp
cyAlenVcbiIsCiAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5l
LCBwYy0+b3JpZ19jb2wpOwogICBtYXJrX3ZhcmlhYmxlX2RlZmluaXRpb24oY3MuR2V0KGNz
LkxlbigpIC0gMSktPm1fcGMpOwoKICAgaWYgKGNodW5rX2lzX3Rva2VuKGVuZCwgQ1RfQ09N
TUEpKQogICB7CiAgICAgIHJldHVybihjaHVua19nZXRfbmV4dF9uY25sKGVuZCkpOwogICB9
CiAgIHJldHVybihza2lwX3RvX25leHRfc3RhdGVtZW50KGVuZCkpOwp9IC8vIGZpeF92YXJp
YWJsZV9kZWZpbml0aW9uCgoKc3RhdGljIGNodW5rX3QgKnNraXBfZXhwcmVzc2lvbihjaHVu
a190ICpzdGFydCkKewogICBjaHVua190ICpwYyA9IHN0YXJ0OwoKICAgd2hpbGUgKHBjICE9
IG51bGxwdHIgJiYgcGMtPmxldmVsID49IHN0YXJ0LT5sZXZlbCkKICAgewogICAgICBpZiAo
ICBwYy0+bGV2ZWwgPT0gc3RhcnQtPmxldmVsCiAgICAgICAgICYmIChjaHVua19pc19zZW1p
Y29sb24ocGMpIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DT01NQSkpKQogICAgICB7CiAg
ICAgICAgIHJldHVybihwYyk7CiAgICAgIH0KICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9u
Y25sKHBjKTsKICAgfQogICByZXR1cm4ocGMpOwp9CgoKYm9vbCBnb19vbihjaHVua190ICpw
YywgY2h1bmtfdCAqc3RhcnQpCnsKICAgaWYgKHBjID09IG51bGxwdHIgfHwgcGMtPmxldmVs
ICE9IHN0YXJ0LT5sZXZlbCkKICAgewogICAgICByZXR1cm4oZmFsc2UpOwogICB9CgogICBp
ZiAocGMtPmZsYWdzLnRlc3QoUENGX0lOX0ZPUikpCiAgIHsKICAgICAgcmV0dXJuKCghY2h1
bmtfaXNfc2VtaWNvbG9uKHBjKSkgJiYgKCEoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0NPTE9O
KSkpKTsKICAgfQogICByZXR1cm4oIWNodW5rX2lzX3NlbWljb2xvbihwYykpOwp9IC8vIGdv
X29uCgoKc3RhdGljIGNodW5rX3QgKm1hcmtfdmFyaWFibGVfZGVmaW5pdGlvbihjaHVua190
ICpzdGFydCkKewogICBMT0dfRlVOQ19FTlRSWSgpOwoKICAgaWYgKHN0YXJ0ID09IG51bGxw
dHIpCiAgIHsKICAgICAgcmV0dXJuKG51bGxwdHIpOwogICB9CiAgIGNodW5rX3QgICAgICpw
YyAgID0gc3RhcnQ7CiAgIHBjZl9mbGFnc190IGZsYWdzID0gUENGX1ZBUl8xU1RfREVGOwoK
ICAgTE9HX0ZNVChMVkFSREVGLCAiJXMoJWQpOiBvcmlnX2xpbmUgJXp1LCBvcmlnX2NvbCAl
enUsIHRleHQoKSAnJXMnLCB0eXBlIGlzICVzXG4iLAogICAgICAgICAgIF9fZnVuY19fLCBf
X0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpLAogICAg
ICAgICAgIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CgogICAvLyBJc3N1ZSAjNTk2CiAg
IGJvb2wgYml0X2ZpZWxkX2NvbG9uX2lzX3ByZXNlbnQgPSBmYWxzZTsKCiAgIHdoaWxlIChn
b19vbihwYywgc3RhcnQpKQogICB7CiAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9XT1JEKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfRlVOQ19DVE9SX1ZB
UikpCiAgICAgIHsKICAgICAgICAgYXV0byBjb25zdCBvcmlnX2ZsYWdzID0gcGMtPmZsYWdz
OwoKICAgICAgICAgaWYgKCFwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fRU5VTSkpCiAgICAgICAg
IHsKICAgICAgICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHBjLCBmbGFncyk7CiAgICAgICAgIH0K
ICAgICAgICAgZmxhZ3MgJj0gflBDRl9WQVJfMVNUOwogICAgICAgICBMT0dfRk1UKExWQVJE
RUYsICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgp
ICclcycsIHNldCBQQ0ZfVkFSXzFTVFxuIiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywg
X19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQoKSk7Cgog
ICAgICAgICBMT0dfRk1UKExWQVJERUYsCiAgICAgICAgICAgICAgICAgIiVzKCVkKTogb3Jp
Z19saW5lIGlzICV6dSwgbWFya2VkIHRleHQoKSAnJXMnWyVzXSAiCiAgICAgICAgICAgICAg
ICAgImluIG9yaWdfY29sICV6dSwgZmxhZ3M6ICVzIC0+ICVzXG4iLAogICAgICAgICAgICAg
ICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPnRleHQoKSwKICAg
ICAgICAgICAgICAgICBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSksIHBjLT5vcmlnX2NvbCwK
ICAgICAgICAgICAgICAgICBwY2ZfZmxhZ3Nfc3RyKG9yaWdfZmxhZ3MpLmNfc3RyKCksCiAg
ICAgICAgICAgICAgICAgcGNmX2ZsYWdzX3N0cihwYy0+ZmxhZ3MpLmNfc3RyKCkpOwogICAg
ICB9CiAgICAgIGVsc2UgaWYgKCAgIWJpdF9maWVsZF9jb2xvbl9pc19wcmVzZW50ICAgICAg
ICAgICAgICAgICAgICAgIC8vIElzc3VlICMyNjg5CiAgICAgICAgICAgICAgJiYgKCAgY2h1
bmtfaXNfc3RhcihwYykKICAgICAgICAgICAgICAgICB8fCBjaHVua19pc19tc3JlZihwYykp
KQogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9QVFJfVFlQRSk7CiAg
ICAgIH0KICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfYWRkcihwYykpCiAgICAgIHsKICAgICAg
ICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0JZUkVGKTsKICAgICAgfQogICAgICBlbHNlIGlm
ICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TUVVBUkVfT1BFTikKICAgICAgICAgICAgICB8
fCBjaHVua19pc190b2tlbihwYywgQ1RfQVNTSUdOKSkKICAgICAgewogICAgICAgICBwYyA9
IHNraXBfZXhwcmVzc2lvbihwYyk7CiAgICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAg
IGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DT0xPTikpCiAgICAgIHsKICAgICAg
ICAgYml0X2ZpZWxkX2NvbG9uX2lzX3ByZXNlbnQgPSB0cnVlOyAgICAgICAgICAgICAgICAg
ICAgLy8gSXNzdWUgIzI2ODkKICAgICAgfQogICAgICBwYyA9IGNodW5rX2dldF9uZXh0X25j
bmwocGMpOwogICB9CiAgIHJldHVybihwYyk7Cn0gLy8gbWFya192YXJpYWJsZV9kZWZpbml0
aW9uCgoKc3RhdGljIGJvb2wgY2FuX2JlX2Z1bGxfcGFyYW0oY2h1bmtfdCAqc3RhcnQsIGNo
dW5rX3QgKmVuZCkKewogICBMT0dfRlVOQ19FTlRSWSgpOwoKICAgTE9HX0ZNVChMRlBBUkFN
LCAiJXM6IiwgX19mdW5jX18pOwoKICAgaW50ICAgICB3b3JkX2NvdW50ID0gMDsKICAgaW50
ICAgICB0eXBlX2NvdW50ID0gMDsKICAgY2h1bmtfdCAqcGM7CgogICBmb3IgKHBjID0gc3Rh
cnQ7CiAgICAgICAgcGMgIT0gbnVsbHB0ciAmJiBwYyAhPSBlbmQ7CiAgICAgICAgcGMgPSBj
aHVua19nZXRfbmV4dF9uY25sKHBjLCBzY29wZV9lOjpQUkVQUk9DKSkKICAgewogICAgICBM
T0dfRk1UKExGUEFSQU0sICIgWyVzXSIsIHBjLT50ZXh0KCkpOwoKICAgICAgaWYgKCAgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX1FVQUxJRklFUikKICAgICAgICAgfHwgY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX1NUUlVDVCkKICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0VO
VU0pCiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9VTklPTikKICAgICAgICAg
fHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RZUEVOQU1FKSkKICAgICAgewogICAgICAgICBM
T0dfRk1UKExGUEFSQU0sICIgPD09ICVzISAoeWVzKVxuIiwgZ2V0X3Rva2VuX25hbWUocGMt
PnR5cGUpKTsKICAgICAgICAgcmV0dXJuKHRydWUpOwogICAgICB9CgogICAgICBpZiAoY2h1
bmtfaXNfdG9rZW4ocGMsIENUX1dPUkQpIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9UWVBF
KSkKICAgICAgewogICAgICAgICArK3dvcmRfY291bnQ7CgogICAgICAgICBpZiAoY2h1bmtf
aXNfdG9rZW4ocGMsIENUX1RZUEUpKQogICAgICAgICB7CiAgICAgICAgICAgICsrdHlwZV9j
b3VudDsKICAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9NRU1CRVIpIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9EQ19NRU1CRVIpKQog
ICAgICB7CiAgICAgICAgIGlmICh3b3JkX2NvdW50ID4gMCkKICAgICAgICAgewogICAgICAg
ICAgICAtLXdvcmRfY291bnQ7CiAgICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIGlmIChw
YyAhPSBzdGFydCAmJiBjaHVua19pc19wdHJfb3BlcmF0b3IocGMpKQogICAgICB7CiAgICAg
ICAgIC8vIGNodW5rIGlzIE9LCiAgICAgIH0KICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX0FTU0lHTikpCiAgICAgIHsKICAgICAgICAgLy8gY2h1bmsgaXMgT0sgKGRl
ZmF1bHQgdmFsdWVzKQogICAgICAgICBicmVhazsKICAgICAgfQogICAgICBlbHNlIGlmIChj
aHVua19pc190b2tlbihwYywgQ1RfQU5HTEVfT1BFTikpCiAgICAgIHsKICAgICAgICAgTE9H
X0ZNVChMRlBBUkFNLCAiIDw9PSB0ZW1wbGF0ZVxuIik7CiAgICAgICAgIHJldHVybih0cnVl
KTsKICAgICAgfQogICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfRUxMSVBT
SVMpKQogICAgICB7CiAgICAgICAgIExPR19GTVQoTEZQQVJBTSwgIiA8PT0gZWxpcHNlc1xu
Iik7CiAgICAgICAgIHJldHVybih0cnVlKTsKICAgICAgfQogICAgICBlbHNlIGlmICh3b3Jk
X2NvdW50ID09IDAgJiYgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1BBUkVOX09QRU4pKQogICAg
ICB7CiAgICAgICAgIC8vIENoZWNrIGZvciBvbGQtc2Nob29sIGZ1bmMgcHJvdG8gcGFyYW0g
Jyh0eXBlKScKICAgICAgICAgY2h1bmtfdCAqdG1wMSA9IGNodW5rX3NraXBfdG9fbWF0Y2go
cGMsIHNjb3BlX2U6OlBSRVBST0MpOwoKICAgICAgICAgaWYgKHRtcDEgPT0gbnVsbHB0cikK
ICAgICAgICAgewogICAgICAgICAgICByZXR1cm4oZmFsc2UpOwogICAgICAgICB9CiAgICAg
ICAgIGNodW5rX3QgKnRtcDIgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcDEsIHNjb3BlX2U6
OlBSRVBST0MpOwoKICAgICAgICAgaWYgKHRtcDIgPT0gbnVsbHB0cikKICAgICAgICAgewog
ICAgICAgICAgICByZXR1cm4oZmFsc2UpOwogICAgICAgICB9CgogICAgICAgICBpZiAoY2h1
bmtfaXNfdG9rZW4odG1wMiwgQ1RfQ09NTUEpIHx8IGNodW5rX2lzX3BhcmVuX2Nsb3NlKHRt
cDIpKQogICAgICAgICB7CiAgICAgICAgICAgIGRvCiAgICAgICAgICAgIHsKICAgICAgICAg
ICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjLCBzY29wZV9lOjpQUkVQUk9DKTsK
CiAgICAgICAgICAgICAgIGlmIChwYyA9PSBudWxscHRyKQogICAgICAgICAgICAgICB7CiAg
ICAgICAgICAgICAgICAgIHJldHVybihmYWxzZSk7CiAgICAgICAgICAgICAgIH0KICAgICAg
ICAgICAgICAgTE9HX0ZNVChMRlBBUkFNLCAiIFslc10iLCBwYy0+dGV4dCgpKTsKICAgICAg
ICAgICAgfSB3aGlsZSAocGMgIT0gdG1wMSk7CgogICAgICAgICAgICAvLyByZXNldCBzb21l
IHZhcnMgdG8gYWxsb3cgW10gYWZ0ZXIgcGFyZW5zCiAgICAgICAgICAgIHdvcmRfY291bnQg
PSAxOwogICAgICAgICAgICB0eXBlX2NvdW50ID0gMTsKICAgICAgICAgfQogICAgICAgICBl
bHNlCiAgICAgICAgIHsKICAgICAgICAgICAgTE9HX0ZNVChMRlBBUkFNLCAiIDw9PSBbJXNd
IG5vdCBmY24gdHlwZSFcbiIsIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CiAgICAgICAg
ICAgIHJldHVybihmYWxzZSk7CiAgICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIGlmICgg
ICh3b3JkX2NvdW50ID09IDEgfHwgKHdvcmRfY291bnQgPT0gdHlwZV9jb3VudCkpCiAgICAg
ICAgICAgICAgJiYgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1BBUkVOX09QRU4pKQogICAgICB7
CiAgICAgICAgIC8vIENoZWNrIGZvciBmdW5jIHByb3RvIHBhcmFtICd2b2lkICgqbmFtZSkn
IG9yICd2b2lkICgqbmFtZSkocGFyYW1zKScgb3IgJ3ZvaWQgKF5uYW1lKShwYXJhbXMpJwog
ICAgICAgICAvLyA8bmFtZT4gY2FuIGJlIG9wdGlvbmFsCiAgICAgICAgIGNodW5rX3QgKnRt
cDEgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjLCBzY29wZV9lOjpQUkVQUk9DKTsKCiAgICAg
ICAgIGlmICh0bXAxID09IG51bGxwdHIpCiAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJu
KGZhbHNlKTsKICAgICAgICAgfQogICAgICAgICBjaHVua190ICp0bXAyID0gY2h1bmtfZ2V0
X25leHRfbmNubCh0bXAxLCBzY29wZV9lOjpQUkVQUk9DKTsKCiAgICAgICAgIGlmICh0bXAy
ID09IG51bGxwdHIpCiAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuKGZhbHNlKTsKICAg
ICAgICAgfQogICAgICAgICBjaHVua190ICp0bXAzID0gKGNodW5rX2lzX3N0cih0bXAyLCAi
KSIsIDEpKSA/IHRtcDIgOiBjaHVua19nZXRfbmV4dF9uY25sKHRtcDIsIHNjb3BlX2U6OlBS
RVBST0MpOwoKICAgICAgICAgaWYgKHRtcDMgPT0gbnVsbHB0cikKICAgICAgICAgewogICAg
ICAgICAgICByZXR1cm4oZmFsc2UpOwogICAgICAgICB9CgogICAgICAgICBpZiAoICAhY2h1
bmtfaXNfc3RyKHRtcDMsICIpIiwgMSkKICAgICAgICAgICAgfHwgIShjaHVua19pc19zdHIo
dG1wMSwgIioiLCAxKSB8fCBjaHVua19pc19zdHIodG1wMSwgIl4iLCAxKSkgLy8gSXNzdWUg
IzI2NTYKICAgICAgICAgICAgfHwgISh0bXAyLT50eXBlID09IENUX1dPUkQgfHwgY2h1bmtf
aXNfc3RyKHRtcDIsICIpIiwgMSkpKQogICAgICAgICB7CiAgICAgICAgICAgIExPR19GTVQo
TEZQQVJBTSwgIiA8PT0gWyVzXSBub3QgZmNuIHR5cGUhXG4iLCBnZXRfdG9rZW5fbmFtZShw
Yy0+dHlwZSkpOwogICAgICAgICAgICByZXR1cm4oZmFsc2UpOwogICAgICAgICB9CiAgICAg
ICAgIExPR19GTVQoTEZQQVJBTSwgIiA8c2tpcCBmY24gdHlwZT4iKTsKICAgICAgICAgdG1w
MSA9IGNodW5rX2dldF9uZXh0X25jbmwodG1wMywgc2NvcGVfZTo6UFJFUFJPQyk7CgogICAg
ICAgICBpZiAodG1wMSA9PSBudWxscHRyKQogICAgICAgICB7CiAgICAgICAgICAgIHJldHVy
bihmYWxzZSk7CiAgICAgICAgIH0KCiAgICAgICAgIGlmIChjaHVua19pc19zdHIodG1wMSwg
IigiLCAxKSkKICAgICAgICAgewogICAgICAgICAgICB0bXAzID0gY2h1bmtfc2tpcF90b19t
YXRjaCh0bXAxLCBzY29wZV9lOjpQUkVQUk9DKTsKICAgICAgICAgfQogICAgICAgICBwYyA9
IHRtcDM7CgogICAgICAgICAvLyByZXNldCBzb21lIHZhcnMgdG8gYWxsb3cgW10gYWZ0ZXIg
cGFyZW5zCiAgICAgICAgIHdvcmRfY291bnQgPSAxOwogICAgICAgICB0eXBlX2NvdW50ID0g
MTsKICAgICAgfQogICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfVFNRVUFS
RSkpCiAgICAgIHsKICAgICAgICAgLy8gaWdub3JlIGl0CiAgICAgIH0KICAgICAgZWxzZSBp
ZiAod29yZF9jb3VudCA9PSAxICYmIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TUVVBUkVfT1BF
TikpCiAgICAgIHsKICAgICAgICAgLy8gc2tpcCBvdmVyIGFueSBhcnJheSBzdHVmZgogICAg
ICAgICBwYyA9IGNodW5rX3NraXBfdG9fbWF0Y2gocGMsIHNjb3BlX2U6OlBSRVBST0MpOwog
ICAgICB9CiAgICAgIGVsc2UgaWYgKHdvcmRfY291bnQgPT0gMiAmJiBjaHVua19pc190b2tl
bihwYywgQ1RfU1FVQVJFX09QRU4pKQogICAgICB7CiAgICAgICAgIC8vIEJ1ZyAjNjcxOiBp
cyBpdCBzdWNoIGFzOiBib29sIGZvb1tGT09fTUFYXQogICAgICAgICBwYyA9IGNodW5rX3Nr
aXBfdG9fbWF0Y2gocGMsIHNjb3BlX2U6OlBSRVBST0MpOwogICAgICB9CiAgICAgIGVsc2Ug
aWYgKCAgd29yZF9jb3VudCA9PSAxCiAgICAgICAgICAgICAgJiYgbGFuZ3VhZ2VfaXNfc2V0
KExBTkdfQ1BQKQogICAgICAgICAgICAgICYmIGNodW5rX2lzX3N0cihwYywgIiYmIiwgMikp
CiAgICAgIHsKICAgICAgICAgLy8gaWdub3JlIHBvc3NpYmxlICdtb3ZlJyBvcGVyYXRvcgog
ICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICBMT0dfRk1UKExGUEFSQU0sICIg
PD09IFslc10gbm8gd2F5ISB0Yz0lZCB3Yz0lZFxuIiwKICAgICAgICAgICAgICAgICBnZXRf
dG9rZW5fbmFtZShwYy0+dHlwZSksIHR5cGVfY291bnQsIHdvcmRfY291bnQpOwogICAgICAg
ICByZXR1cm4oZmFsc2UpOwogICAgICB9CiAgIH0KCiAgIGNodW5rX3QgKmxhc3QgPSBjaHVu
a19nZXRfcHJldl9uY25sbmkocGMpOyAgIC8vIElzc3VlICMyMjc5CgogICBpZiAoY2h1bmtf
aXNfcHRyX29wZXJhdG9yKGxhc3QpKQogICB7CiAgICAgIExPR19GTVQoTEZQQVJBTSwgIiA8
PT0gWyVzXSBzdXJlIVxuIiwgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUpKTsKICAgICAgcmV0
dXJuKHRydWUpOwogICB9CgogICBpZiAod29yZF9jb3VudCA8IDIgJiYgdHlwZV9jb3VudCA8
IDEgJiYgc3RhcnQtPmJyYWNlX2xldmVsID4gMCkKICAgewogICAgICBMT0dfRk1UKExGUEFS
QU0sICIgIU1WUCEiKTsKICAgICAgLy8gT2gsIGpveSwgd2UgYXJlIGluIE1vc3QgVmV4aW5n
IFBhcnNlIHRlcnJpdG9yeQogICAgICBhdXRvIGNvbnN0IGJyYWNlID0KICAgICAgICAgY2h1
bmtfZ2V0X3ByZXZfdHlwZShzdGFydCwgQ1RfQlJBQ0VfT1BFTiwgc3RhcnQtPmJyYWNlX2xl
dmVsIC0gMSk7CgogICAgICBpZiAoYnJhY2UpCiAgICAgIHsKICAgICAgICAgTE9HX0ZNVChM
RlBBUkFNLCAiIChtYXRjaGluZyAlcyBicmFjZSBhdCAlenU6JXp1KSIsCiAgICAgICAgICAg
ICAgICAgZ2V0X3Rva2VuX25hbWUoZ2V0X2NodW5rX3BhcmVudF90eXBlKGJyYWNlKSksCiAg
ICAgICAgICAgICAgICAgYnJhY2UtPm9yaWdfbGluZSwgYnJhY2UtPm9yaWdfY29sKTsKICAg
ICAgfQoKICAgICAgaWYgKCAgYnJhY2UKICAgICAgICAgJiYgKCAgZ2V0X2NodW5rX3BhcmVu
dF90eXBlKGJyYWNlKSA9PSBDVF9DTEFTUwogICAgICAgICAgICB8fCBnZXRfY2h1bmtfcGFy
ZW50X3R5cGUoYnJhY2UpID09IENUX1NUUlVDVCkpCiAgICAgIHsKICAgICAgICAgLy8gQSBN
b3N0IFZleGluZyBQYXJzZSB2YXJpYWJsZSBkZWNsYXJhdGlvbiBjYW5ub3Qgb2NjdXIgaW4g
dGhlIGJvZHkKICAgICAgICAgLy8gb2YgYSBzdHJ1Y3QvY2xhc3MsIHNvIHdlIHByb2JhYmx5
IGhhdmUgYSBmdW5jdGlvbiBwcm90b3R5cGUKICAgICAgICAgTE9HX0ZNVChMRlBBUkFNLCAi
IDw9PSBbJXNdIExpa2VseSFcbiIsCiAgICAgICAgICAgICAgICAgKHBjID09IG51bGxwdHIg
PyAibnVsbHB0ciIgOiBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSkpKTsKICAgICAgICAgcmV0
dXJuKHRydWUpOwogICAgICB9CiAgIH0KICAgYm9vbCByZXQgPSAoICB3b3JkX2NvdW50ID49
IDIKICAgICAgICAgICAgICB8fCAod29yZF9jb3VudCA9PSAxICYmIHR5cGVfY291bnQgPT0g
MSkpOwoKICAgTE9HX0ZNVChMRlBBUkFNLCAiIDw9PSBbJXNdICVzIVxuIiwKICAgICAgICAg
ICAocGMgPT0gbnVsbHB0ciA/ICJudWxscHRyIiA6IGdldF90b2tlbl9uYW1lKHBjLT50eXBl
KSksCiAgICAgICAgICAgcmV0ID8gIll1cCIgOiAiVW5saWtlbHkiKTsKICAgcmV0dXJuKHJl
dCk7Cn0gLy8gY2FuX2JlX2Z1bGxfcGFyYW0KCgpzdGF0aWMgdm9pZCBtYXJrX2Z1bmN0aW9u
KGNodW5rX3QgKnBjKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CgogICBpZiAocGMgPT0gbnVs
bHB0cikKICAgewogICAgICByZXR1cm47CiAgIH0KICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQp
OiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSAnJXMnXG4iLAog
ICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdf
Y29sLCBwYy0+dGV4dCgpKTsKICAgY2h1bmtfdCAqcHJldiA9IGNodW5rX2dldF9wcmV2X25j
bmxuaShwYyk7ICAgLy8gSXNzdWUgIzIyNzkKICAgY2h1bmtfdCAqbmV4dCA9IGNodW5rX2dl
dF9uZXh0X25jbmxucChwYyk7CgogICBpZiAobmV4dCA9PSBudWxscHRyKQogICB7CiAgICAg
IHJldHVybjsKICAgfQogICBjaHVua190ICp0bXA7CiAgIGNodW5rX3QgKnNlbWkgPSBudWxs
cHRyOwogICBjaHVua190ICpwYXJlbl9vcGVuOwogICBjaHVua190ICpwYXJlbl9jbG9zZTsK
CiAgIC8vIEZpbmQgb3V0IHdoYXQgaXMgYmVmb3JlIHRoZSBvcGVyYXRvcgogICBpZiAoZ2V0
X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9PUEVSQVRPUikKICAgewogICAgICBMT0df
Rk1UKExGQ04sICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwg
dGV4dCgpICclcyIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3Jp
Z19saW5lLCBwYy0+b3JpZ19jb2wsIHBjLT50ZXh0KCkpOwogICAgICBsb2dfcGNmX2ZsYWdz
KExHVVksIHBjLT5mbGFncyk7CiAgICAgIGNodW5rX3QgKnBjX29wID0gY2h1bmtfZ2V0X3By
ZXZfdHlwZShwYywgQ1RfT1BFUkFUT1IsIHBjLT5sZXZlbCk7CgogICAgICBpZiAoICBwY19v
cCAhPSBudWxscHRyCiAgICAgICAgICYmIHBjX29wLT5mbGFncy50ZXN0KFBDRl9FWFBSX1NU
QVJUKSkKICAgICAgewogICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6ICg0KSBTRVQg
VE8gQ1RfRlVOQ19DQUxMOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRl
eHQoKSAnJXMnXG4iLAogICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMt
Pm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpKTsKICAgICAgICAgc2V0X2No
dW5rX3R5cGUocGMsIENUX0ZVTkNfQ0FMTCk7CiAgICAgIH0KCiAgICAgIGlmIChsYW5ndWFn
ZV9pc19zZXQoTEFOR19DUFApKQogICAgICB7CiAgICAgICAgIHRtcCA9IHBjOwoKICAgICAg
ICAgd2hpbGUgKCh0bXAgPSBjaHVua19nZXRfcHJldl9uY25sbmkodG1wKSkgIT0gbnVsbHB0
cikgICAvLyBJc3N1ZSAjMjI3OQogICAgICAgICB7CiAgICAgICAgICAgIGlmICggIGNodW5r
X2lzX3Rva2VuKHRtcCwgQ1RfQlJBQ0VfQ0xPU0UpCiAgICAgICAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHRtcCwgQ1RfQlJBQ0VfT1BFTikgICAgICAgICAgICAgLy8gSXNzdWUgNTc1
CiAgICAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfU0VNSUNPTE9OKSkK
ICAgICAgICAgICAgewogICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAg
ICAgICAgICAgaWYgKCAgY2h1bmtfaXNfcGFyZW5fb3Blbih0bXApCiAgICAgICAgICAgICAg
ICYmICFwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykpICAgICAgICAgICAgICAgLy8g
SXNzdWUgIzI3MDMKICAgICAgICAgICAgewogICAgICAgICAgICAgICBMT0dfRk1UKExGQ04s
ICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICcl
cydcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0bXAt
Pm9yaWdfbGluZSwgdG1wLT5vcmlnX2NvbCwgdG1wLT50ZXh0KCkpOwogICAgICAgICAgICAg
ICBMT0dfRk1UKExGQ04sICIlcyglZCk6ICg1KSBTRVQgVE8gQ1RfRlVOQ19DQUxMOiBvcmln
X2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSAnJXMnXG4iLAogICAgICAg
ICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMt
Pm9yaWdfY29sLCBwYy0+dGV4dCgpKTsKICAgICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUo
cGMsIENUX0ZVTkNfQ0FMTCk7CiAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9
CgogICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9BU1NJR04pKQogICAg
ICAgICAgICB7CiAgICAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogKDYpIFNF
VCBUTyBDVF9GVU5DX0NBTEw6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwg
dGV4dCgpICclcydcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElO
RV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIHBjLT50ZXh0KCkpOwogICAgICAg
ICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfRlVOQ19DQUxMKTsKICAgICAgICAgICAg
ICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjaHVua19pc190b2tl
bih0bXAsIENUX1RFTVBMQVRFKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBMT0df
Rk1UKExGQ04sICIlcyglZCk6ICg3KSBTRVQgVE8gQ1RfRlVOQ19ERUY6IG9yaWdfbGluZSBp
cyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcydcbiIsCiAgICAgICAgICAgICAg
ICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19j
b2wsIHBjLT50ZXh0KCkpOwogICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1Rf
RlVOQ19ERUYpOwogICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAg
ICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfQlJBQ0VfT1BFTikpCiAgICAgICAg
ICAgIHsKICAgICAgICAgICAgICAgaWYgKGdldF9jaHVua19wYXJlbnRfdHlwZSh0bXApID09
IENUX0ZVTkNfREVGKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIExPR19G
TVQoTEZDTiwgIiVzKCVkKTogKDgpIFNFVCBUTyBDVF9GVU5DX0NBTEw6IG9yaWdfbGluZSBp
cyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcydcbiIsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3Jp
Z19jb2wsIHBjLT50ZXh0KCkpOwogICAgICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShw
YywgQ1RfRlVOQ19DQUxMKTsKICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgaWYg
KCAgZ2V0X2NodW5rX3BhcmVudF90eXBlKHRtcCkgPT0gQ1RfQ0xBU1MKICAgICAgICAgICAg
ICAgICAgfHwgZ2V0X2NodW5rX3BhcmVudF90eXBlKHRtcCkgPT0gQ1RfU1RSVUNUKQogICAg
ICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTog
KDkpIFNFVCBUTyBDVF9GVU5DX0RFRjogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMg
JXp1LCB0ZXh0KCkgJyVzJ1xuIiwKICAgICAgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNf
XywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQoKSk7
CiAgICAgICAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DX0RFRik7CiAg
ICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAg
ICAgICAgfQoKICAgICAgICAgaWYgKCAgdG1wICE9IG51bGxwdHIKICAgICAgICAgICAgJiYg
cGMtPnR5cGUgIT0gQ1RfRlVOQ19DQUxMKQogICAgICAgICB7CiAgICAgICAgICAgIC8vIE1h
cmsgdGhlIHJldHVybiB0eXBlCiAgICAgICAgICAgIHdoaWxlICggICh0bXAgPSBjaHVua19n
ZXRfbmV4dF9uY25sKHRtcCkpICE9IHBjCiAgICAgICAgICAgICAgICAgICYmIHRtcCAhPSBu
dWxscHRyKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIG1ha2VfdHlwZSh0bXApOyAv
LyBNYXJrIHRoZSByZXR1cm4gdHlwZQogICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAg
fQogICB9CgogICBpZiAoY2h1bmtfaXNfcHRyX29wZXJhdG9yKG5leHQpKQogICB7CiAgICAg
IG5leHQgPSBjaHVua19nZXRfbmV4dF9uY25sbnAobmV4dCk7CgogICAgICBpZiAobmV4dCA9
PSBudWxscHRyKQogICAgICB7CiAgICAgICAgIHJldHVybjsKICAgICAgfQogICB9CiAgIExP
R19GTVQoTEZDTiwgIiVzKCVkKTogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1
LCB0ZXh0KCkgJyVzLCB0eXBlIGlzICVzLCBwYXJlbnRfdHlwZSBpcyAlc1xuIiwKICAgICAg
ICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwg
cGMtPnRleHQoKSwKICAgICAgICAgICBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSksIGdldF90
b2tlbl9uYW1lKGdldF9jaHVua19wYXJlbnRfdHlwZShwYykpKTsKICAgTE9HX0ZNVChMRkNO
LCAiICAgbGV2ZWwgaXMgJXp1LCBicmFjZV9sZXZlbCBpcyAlenUsIG5leHQtPnRleHQoKSAn
JXMnLCBuZXh0LT50eXBlIGlzICVzLCBuZXh0LT5sZXZlbCBpcyAlenVcbiIsCiAgICAgICAg
ICAgcGMtPmxldmVsLCBwYy0+YnJhY2VfbGV2ZWwsCiAgICAgICAgICAgbmV4dC0+dGV4dCgp
LCBnZXRfdG9rZW5fbmFtZShuZXh0LT50eXBlKSwgbmV4dC0+bGV2ZWwpOwoKICAgaWYgKHBj
LT5mbGFncy50ZXN0KFBDRl9JTl9DT05TVF9BUkdTKSkKICAgewogICAgICBzZXRfY2h1bmtf
dHlwZShwYywgQ1RfRlVOQ19DVE9SX1ZBUik7CiAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVk
KTogICAxKSBNYXJrZWQgWyVzXSBhcyBGVU5DX0NUT1JfVkFSIG9uIGxpbmUgJXp1IGNvbCAl
enVcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+dGV4dCgpLCBw
Yy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wpOwogICAgICBuZXh0ID0gc2tpcF90ZW1wbGF0
ZV9uZXh0KG5leHQpOwoKICAgICAgaWYgKG5leHQgPT0gbnVsbHB0cikKICAgICAgewogICAg
ICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZmxhZ19wYXJlbnMobmV4dCwgUENGX05PTkUs
IENUX0ZQQVJFTl9PUEVOLCBwYy0+dHlwZSwgdHJ1ZSk7CiAgICAgIHJldHVybjsKICAgfQog
ICAvLyBTa2lwIG92ZXIgYW55IHRlbXBsYXRlIGFuZCBhdHRyaWJ1dGUgbWFkbmVzcwogICBu
ZXh0ID0gc2tpcF90ZW1wbGF0ZV9uZXh0KG5leHQpOwoKICAgaWYgKG5leHQgPT0gbnVsbHB0
cikKICAgewogICAgICByZXR1cm47CiAgIH0KICAgbmV4dCA9IHNraXBfYXR0cmlidXRlX25l
eHQobmV4dCk7CgogICBpZiAobmV4dCA9PSBudWxscHRyKQogICB7CiAgICAgIHJldHVybjsK
ICAgfQogICAvLyBGaW5kIHRoZSBvcGVuIGFuZCBjbG9zZSBwYXJlbnRoZXNpcwogICBwYXJl
bl9vcGVuICA9IGNodW5rX2dldF9uZXh0X3N0cihwYywgIigiLCAxLCBwYy0+bGV2ZWwpOwog
ICBwYXJlbl9jbG9zZSA9IGNodW5rX2dldF9uZXh0X3N0cihwYXJlbl9vcGVuLCAiKSIsIDEs
IHBjLT5sZXZlbCk7CgogICBpZiAoICBwYXJlbl9vcGVuID09IG51bGxwdHIKICAgICAgfHwg
cGFyZW5fY2xvc2UgPT0gbnVsbHB0cikKICAgewogICAgICBMT0dfRk1UKExGQ04sICIlcygl
ZCk6IE5vIHBhcmVucyBmb3VuZCBmb3IgWyVzXSBvbiBvcmlnX2xpbmUgJXp1LCBvcmlnX2Nv
bCAlenVcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+dGV4dCgp
LCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wpOwogICAgICByZXR1cm47CiAgIH0KICAg
LyoKICAgICogVGhpcyBwYXJ0IGRldGVjdHMgZWl0aGVyIGNoYWluZWQgZnVuY3Rpb24gY2Fs
bHMgb3IgYSBmdW5jdGlvbiBwdHIgZGVmaW5pdGlvbi4KICAgICogTVlUWVBFICgqZnVuYyko
dm9pZCk7CiAgICAqIG1Xcml0ZXIoICJjbGFzcyBDbHN0XyJjICkoIHNvbWVzdHIuZ2V0VGV4
dCgpICkoICIgOiBDbHVzdGVyIHsiYyApLm5ld2xpbmU7CiAgICAqCiAgICAqIEZvciBpdCB0
byBiZSBhIGZ1bmN0aW9uIHZhcmlhYmxlIGRlZiwgdGhlcmUgbXVzdCBiZSBhICcqJyBmb2xs
b3dlZCBieSBhCiAgICAqIHNpbmdsZSB3b3JkLgogICAgKgogICAgKiBPdGhlcndpc2UsIGl0
IG11c3QgYmUgY2hhaW5lZCBmdW5jdGlvbiBjYWxscy4KICAgICovCiAgIHRtcCA9IGNodW5r
X2dldF9uZXh0X25jbmwocGFyZW5fY2xvc2UpOwoKICAgaWYgKCAgdG1wICE9IG51bGxwdHIK
ICAgICAgJiYgY2h1bmtfaXNfc3RyKHRtcCwgIigiLCAxKSkKICAgewogICAgICBjaHVua190
ICp0bXAxOwogICAgICBjaHVua190ICp0bXAyOwogICAgICBjaHVua190ICp0bXAzOwoKICAg
ICAgLy8gc2tpcCBvdmVyIGFueSBsZWFkaW5nIGNsYXNzL25hbWVzcGFjZSBpbjogIlQoRjo6
KkEpKCk7IgogICAgICB0bXAxID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0KTsKCiAgICAg
IHdoaWxlICh0bXAxICE9IG51bGxwdHIpCiAgICAgIHsKICAgICAgICAgdG1wMiA9IGNodW5r
X2dldF9uZXh0X25jbmwodG1wMSk7CgogICAgICAgICBpZiAoIWNodW5rX2lzX3dvcmQodG1w
MSkgfHwgIWNodW5rX2lzX3Rva2VuKHRtcDIsIENUX0RDX01FTUJFUikpCiAgICAgICAgIHsK
ICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgIH0KICAgICAgICAgdG1wMSA9IGNodW5rX2dl
dF9uZXh0X25jbmwodG1wMik7CiAgICAgIH0KICAgICAgdG1wMiA9IGNodW5rX2dldF9uZXh0
X25jbmwodG1wMSk7CgogICAgICBpZiAoY2h1bmtfaXNfc3RyKHRtcDIsICIpIiwgMSkpCiAg
ICAgIHsKICAgICAgICAgdG1wMyA9IHRtcDI7CiAgICAgICAgIHRtcDIgPSBudWxscHRyOwog
ICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICB0bXAzID0gY2h1bmtfZ2V0X25l
eHRfbmNubCh0bXAyKTsKICAgICAgfQogICAgICB0bXAzID0gY2h1bmtfZ2V0X25leHRfc3Nx
KHRtcDMpOwoKICAgICAgaWYgKCAgY2h1bmtfaXNfc3RyKHRtcDMsICIpIiwgMSkKICAgICAg
ICAgJiYgKCAgY2h1bmtfaXNfc3Rhcih0bXAxKQogICAgICAgICAgICB8fCBjaHVua19pc19t
c3JlZih0bXAxKQogICAgICAgICAgICB8fCAobGFuZ3VhZ2VfaXNfc2V0KExBTkdfT0MpICYm
IGNodW5rX2lzX3Rva2VuKHRtcDEsIENUX0NBUkVUKSkpCiAgICAgICAgICYmICh0bXAyID09
IG51bGxwdHIgfHwgY2h1bmtfaXNfdG9rZW4odG1wMiwgQ1RfV09SRCkpKQogICAgICB7CiAg
ICAgICAgIGlmICh0bXAyKQogICAgICAgICB7CiAgICAgICAgICAgIExPR19GTVQoTEZDTiwg
IiVzKCVkKTogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCBmdW5jdGlvbiB2
YXJpYWJsZSAnJXMnLCBjaGFuZ2luZyAnJXMnIGludG8gYSB0eXBlXG4iLAogICAgICAgICAg
ICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdf
Y29sLCB0bXAyLT50ZXh0KCksIHBjLT50ZXh0KCkpOwogICAgICAgICAgICBzZXRfY2h1bmtf
dHlwZSh0bXAyLCBDVF9GVU5DX1ZBUik7CiAgICAgICAgICAgIGZsYWdfcGFyZW5zKHBhcmVu
X29wZW4sIFBDRl9OT05FLCBDVF9QQVJFTl9PUEVOLCBDVF9GVU5DX1ZBUiwgZmFsc2UpOwoK
ICAgICAgICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiBwYXJlbiBvcGVuIEAgb3JpZ19s
aW5lICV6dSwgb3JpZ19jb2wgJXp1XG4iLAogICAgICAgICAgICAgICAgICAgIF9fZnVuY19f
LCBfX0xJTkVfXywgcGFyZW5fb3Blbi0+b3JpZ19saW5lLCBwYXJlbl9vcGVuLT5vcmlnX2Nv
bCk7CiAgICAgICAgIH0KICAgICAgICAgZWxzZQogICAgICAgICB7CiAgICAgICAgICAgIExP
R19GTVQoTEZDTiwgIiVzKCVkKTogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1
LCBmdW5jdGlvbiB0eXBlLCBjaGFuZ2luZyAnJXMnIGludG8gYSB0eXBlXG4iLAogICAgICAg
ICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPm9y
aWdfY29sLCBwYy0+dGV4dCgpKTsKCiAgICAgICAgICAgIGlmICh0bXAyKQogICAgICAgICAg
ICB7CiAgICAgICAgICAgICAgIHNldF9jaHVua190eXBlKHRtcDIsIENUX0ZVTkNfVFlQRSk7
CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmxhZ19wYXJlbnMocGFyZW5fb3BlbiwgUENG
X05PTkUsIENUX1BBUkVOX09QRU4sIENUX0ZVTkNfVFlQRSwgZmFsc2UpOwogICAgICAgICB9
CiAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9UWVBFKTsKICAgICAgICAgc2V0X2No
dW5rX3R5cGUodG1wMSwgQ1RfUFRSX1RZUEUpOwogICAgICAgICBjaHVua19mbGFnc19jbHIo
cGMsIFBDRl9WQVJfMVNUX0RFRik7CgogICAgICAgICBpZiAodG1wMiAhPSBudWxscHRyKQog
ICAgICAgICB7CiAgICAgICAgICAgIGNodW5rX2ZsYWdzX3NldCh0bXAyLCBQQ0ZfVkFSXzFT
VF9ERUYpOwogICAgICAgICB9CiAgICAgICAgIGZsYWdfcGFyZW5zKHRtcCwgUENGX05PTkUs
IENUX0ZQQVJFTl9PUEVOLCBDVF9GVU5DX1BST1RPLCBmYWxzZSk7CiAgICAgICAgIGZpeF9m
Y25fZGVmX3BhcmFtcyh0bXApOwogICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgTE9H
X0ZNVChMRkNOLCAiJXMoJWQpOiBjaGFpbmVkIGZ1bmN0aW9uIGNhbGxzPyB0ZXh0KCkgaXMg
JyVzJywgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1XG4iLAogICAgICAgICAg
ICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPnRleHQoKSwgcGMtPm9yaWdfbGluZSwgcGMt
Pm9yaWdfY29sKTsKICAgfQoKICAgLy8gQXNzdW1lIGl0IGlzIGEgZnVuY3Rpb24gY2FsbCBp
ZiBub3QgYWxyZWFkeSBsYWJlbGVkCiAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfRlVO
Q1RJT04pKQogICB7CiAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogZXhhbWluZTogdGV4
dCgpIGlzICclcycsIG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdHlwZSBp
cyAlc1xuIiwKICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCks
IHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUp
KTsKICAgICAgLy8gbG9vayBmb3IgYW4gYXNzaWdtZW50LiBJc3N1ZSAjNTc1CiAgICAgIGNo
dW5rX3QgKnRlbXAgPSBjaHVua19nZXRfbmV4dF90eXBlKHBjLCBDVF9BU1NJR04sIHBjLT5s
ZXZlbCk7CgogICAgICBpZiAodGVtcCAhPSBudWxscHRyKQogICAgICB7CiAgICAgICAgIExP
R19GTVQoTEZDTiwgIiVzKCVkKTogYXNzaWdtZW50IGZvdW5kLCBvcmlnX2xpbmUgaXMgJXp1
LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSAnJXMnXG4iLAogICAgICAgICAgICAgICAgIF9f
ZnVuY19fLCBfX0xJTkVfXywgdGVtcC0+b3JpZ19saW5lLCB0ZW1wLT5vcmlnX2NvbCwgdGVt
cC0+dGV4dCgpKTsKICAgICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiAoMTApIFNFVCBU
TyBDVF9GVU5DX0NBTEw6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4
dCgpICclcyciLAogICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9y
aWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpKTsKICAgICAgICAgc2V0X2NodW5r
X3R5cGUocGMsIENUX0ZVTkNfQ0FMTCk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAg
ICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogKDExKSBTRVQgVE8gJXM6IG9yaWdfbGlu
ZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcyciLAogICAgICAgICAgICAg
ICAgIF9fZnVuY19fLCBfX0xJTkVfXywgKGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgPT0g
Q1RfT1BFUkFUT1IpID8gIkNUX0ZVTkNfREVGIiA6ICJDVF9GVU5DX0NBTEwiLAogICAgICAg
ICAgICAgICAgIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQoKSk7CiAg
ICAgICAgIHNldF9jaHVua190eXBlKHBjLCAoZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9
PSBDVF9PUEVSQVRPUikgPyBDVF9GVU5DX0RFRiA6IENUX0ZVTkNfQ0FMTCk7CiAgICAgIH0K
ICAgfQogICBMT0dfRk1UKExGQ04sICIlcyglZCk6IENoZWNrIGZvciBDKysgZnVuY3Rpb24g
ZGVmLCB0ZXh0KCkgaXMgJyVzJywgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1
LCB0eXBlIGlzICVzXG4iLAogICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPnRl
eHQoKSwgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBnZXRfdG9rZW5fbmFtZShwYy0+
dHlwZSkpOwoKICAgaWYgKHByZXYgIT0gbnVsbHB0cikKICAgewogICAgICBMT0dfRk1UKExG
Q04sICIlcyglZCk6IHByZXYtPnRleHQoKSBpcyAnJXMnLCBvcmlnX2xpbmUgaXMgJXp1LCBv
cmlnX2NvbCBpcyAlenUsIHR5cGUgaXMgJXNcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18s
IF9fTElORV9fLCBwcmV2LT50ZXh0KCksIHByZXYtPm9yaWdfbGluZSwgcHJldi0+b3JpZ19j
b2wsIGdldF90b2tlbl9uYW1lKHByZXYtPnR5cGUpKTsKICAgfQoKICAgLy8gQ2hlY2sgZm9y
IEMrKyBmdW5jdGlvbiBkZWYKICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0ZVTkNf
Q0xBU1NfREVGKQogICAgICB8fCAoICBwcmV2ICE9IG51bGxwdHIKICAgICAgICAgJiYgKCAg
Y2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfSU5WKQogICAgICAgICAgICB8fCBjaHVua19pc190
b2tlbihwcmV2LCBDVF9EQ19NRU1CRVIpKSkpCiAgIHsKICAgICAgY2h1bmtfdCAqZGVzdHIg
PSBudWxscHRyOwoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHByZXYsIENUX0lOVikpCiAg
ICAgIHsKICAgICAgICAgLy8gVE9ETzogZG8gd2UgY2FyZSB0aGF0IHRoaXMgaXMgdGhlIGRl
c3RydWN0b3I/CiAgICAgICAgIHNldF9jaHVua190eXBlKHByZXYsIENUX0RFU1RSVUNUT1Ip
OwogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfRlVOQ19DTEFTU19ERUYpOwoKICAg
ICAgICAgc2V0X2NodW5rX3BhcmVudChwYywgQ1RfREVTVFJVQ1RPUik7CgogICAgICAgICBk
ZXN0ciA9IHByZXY7CiAgICAgICAgIC8vIFBvaW50IHRvIHRoZSBpdGVtIHByZXZpb3VzIHRv
IHRoZSBjbGFzcyBuYW1lCiAgICAgICAgIHByZXYgPSBjaHVua19nZXRfcHJldl9uY25sbnAo
cHJldik7CiAgICAgIH0KCiAgICAgIGlmIChjaHVua19pc190b2tlbihwcmV2LCBDVF9EQ19N
RU1CRVIpKQogICAgICB7CiAgICAgICAgIHByZXYgPSBjaHVua19nZXRfcHJldl9uY25sbnAo
cHJldik7CiAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogcHJldi0+dGV4dCgpIGlz
ICclcycsIG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdHlwZSBpcyAlc1xu
IiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHByZXYtPnRleHQoKSwg
cHJldi0+b3JpZ19saW5lLCBwcmV2LT5vcmlnX2NvbCwKICAgICAgICAgICAgICAgICBnZXRf
dG9rZW5fbmFtZShwcmV2LT50eXBlKSk7CiAgICAgICAgIHByZXYgPSBza2lwX3RlbXBsYXRl
X3ByZXYocHJldik7CiAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogcHJldi0+dGV4
dCgpIGlzICclcycsIG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdHlwZSBp
cyAlc1xuIiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHByZXYtPnRl
eHQoKSwgcHJldi0+b3JpZ19saW5lLCBwcmV2LT5vcmlnX2NvbCwKICAgICAgICAgICAgICAg
ICBnZXRfdG9rZW5fbmFtZShwcmV2LT50eXBlKSk7CiAgICAgICAgIHByZXYgPSBza2lwX2F0
dHJpYnV0ZV9wcmV2KHByZXYpOwogICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IHBy
ZXYtPnRleHQoKSBpcyAnJXMnLCBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUs
IHR5cGUgaXMgJXNcbiIsCiAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBw
cmV2LT50ZXh0KCksIHByZXYtPm9yaWdfbGluZSwgcHJldi0+b3JpZ19jb2wsCiAgICAgICAg
ICAgICAgICAgZ2V0X3Rva2VuX25hbWUocHJldi0+dHlwZSkpOwoKICAgICAgICAgaWYgKGNo
dW5rX2lzX3Rva2VuKHByZXYsIENUX1dPUkQpIHx8IGNodW5rX2lzX3Rva2VuKHByZXYsIENU
X1RZUEUpKQogICAgICAgICB7CiAgICAgICAgICAgIGlmIChwYy0+c3RyLmVxdWFscyhwcmV2
LT5zdHIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVz
KCVkKTogcGMtPnRleHQoKSBpcyAnJXMnLCBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBp
cyAlenUsIHR5cGUgaXMgJXNcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18s
IF9fTElORV9fLCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsCiAg
ICAgICAgICAgICAgICAgICAgICAgZ2V0X3Rva2VuX25hbWUocHJldi0+dHlwZSkpOwogICAg
ICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfRlVOQ19DTEFTU19ERUYpOwogICAg
ICAgICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9y
aWdfY29sIGlzICV6dSAtIEZPVU5EICVzU1RSVUNUT1IgZm9yICclcycsIHR5cGUgaXMgJXNc
biIsCiAgICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLAogICAgICAg
ICAgICAgICAgICAgICAgIHByZXYtPm9yaWdfbGluZSwgcHJldi0+b3JpZ19jb2wsCiAgICAg
ICAgICAgICAgICAgICAgICAgKGRlc3RyICE9IG51bGxwdHIpID8gIkRFIiA6ICJDT04iLAog
ICAgICAgICAgICAgICAgICAgICAgIHByZXYtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUocHJl
di0+dHlwZSkpOwoKICAgICAgICAgICAgICAgbWFya19jcHBfY29uc3RydWN0b3IocGMpOwog
ICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gUG9p
bnQgdG8gdGhlIGl0ZW0gcHJldmlvdXMgdG8gdGhlIGNsYXNzIG5hbWUKICAgICAgICAgICAg
cHJldiA9IGNodW5rX2dldF9wcmV2X25jbmxucChwcmV2KTsKICAgICAgICAgfQogICAgICB9
CiAgIH0KCiAgIC8qCiAgICAqIERldGVybWluZSBpZiB0aGlzIGlzIGEgZnVuY3Rpb24gY2Fs
bCBvciBhIGZ1bmN0aW9uIGRlZi9wcm90bwogICAgKiBXZSBjaGVjayBmb3IgbGV2ZWw9PTEg
dG8gYWxsb3cgdGhlIGNhc2UgdGhhdCBhIGZ1bmN0aW9uIHByb3RvdHlwZSBpcwogICAgKiB3
cmFwcGVkIGluIGEgbWFjcm86ICJNQUNSTyh2b2lkIGZvbyh2b2lkKSk7IgogICAgKi8KICAg
aWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0ZVTkNfQ0FMTCkKICAgICAgJiYgKCAgcGMt
PmxldmVsID09IHBjLT5icmFjZV9sZXZlbAogICAgICAgICB8fCBwYy0+bGV2ZWwgPT0gMSkK
ICAgICAgJiYgIXBjLT5mbGFncy50ZXN0KFBDRl9JTl9BUlJBWV9BU1NJR04pKQogICB7CiAg
ICAgIGJvb2wgaXNhX2RlZiAgPSBmYWxzZTsKICAgICAgYm9vbCBoaXRfc3RhciA9IGZhbHNl
OwogICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IHBjLT50ZXh0KCkgaXMgJyVzJywgb3Jp
Z19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0eXBlIGlzICVzXG4iLAogICAgICAg
ICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPnRleHQoKSwgcGMtPm9yaWdfbGluZSwg
cGMtPm9yaWdfY29sLAogICAgICAgICAgICAgIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7
CgogICAgICBpZiAocHJldiA9PSBudWxscHRyKQogICAgICB7CiAgICAgICAgIExPR19GTVQo
TEZDTiwgIiVzKCVkKTogQ2hlY2tpbmcgZnVuYyBjYWxsOiBwcmV2IGlzIE5VTExcbiIsCiAg
ICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fKTsKICAgICAgfQogICAgICBlbHNl
CiAgICAgIHsKICAgICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiBDaGVja2luZyBmdW5j
IGNhbGw6IHByZXYtPnRleHQoKSAnJXMnLCBwcmV2LT50eXBlIGlzICVzXG4iLAogICAgICAg
ICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcHJldi0+dGV4dCgpLCBnZXRfdG9rZW5f
bmFtZShwcmV2LT50eXBlKSk7CiAgICAgIH0KICAgICAgLy8gaWYgKCFjaHVua19lbmRzX3R5
cGUocHJldikpCiAgICAgIC8vIHsKICAgICAgLy8gICAgZ290byBiYWRfcmV0X3R5cGU7CiAg
ICAgIC8vIH0KCiAgICAgIC8qCiAgICAgICAqIFJFVklTSVQ6CiAgICAgICAqIGEgZnVuY3Rp
b24gZGVmIGNhbiBvbmx5IG9jY3VyIGF0IGJyYWNlIGxldmVsLCBidXQgbm90IGluc2lkZSBh
bgogICAgICAgKiBhc3NpZ25tZW50LCBzdHJ1Y3R1cmUsIGVudW0sIG9yIHVuaW9uLgogICAg
ICAgKiBUaGUgY2xvc2UgcGFyZW4gbXVzdCBiZSBmb2xsb3dlZCBieSBhbiBvcGVuIGJyYWNl
LCB3aXRoIGFuIG9wdGlvbmFsCiAgICAgICAqIHF1YWxpZmllciAoY29uc3QpIGluIGJldHdl
ZW4uCiAgICAgICAqIFRoZXJlIGNhbiBiZSBhbGwgc29ydHMgb2YgdGVtcGxhdGUgc3R1ZmYg
YW5kL29yICdbXScgaW4gdGhlIHR5cGUuCiAgICAgICAqIFRoaXMgaGFjayBtb3N0bHkgY2hl
Y2tzIHRoYXQuCiAgICAgICAqCiAgICAgICAqIEV4YW1wbGVzOgogICAgICAgKiBmb28tPmJh
cihtYWlkKTsgICAgICAgICAgICAgICAgICAgLS0gZmNuIGNhbGwKICAgICAgICogRk9PICog
YmFyKCk7ICAgICAgICAgICAgICAgICAgICAgIC0tIGZjbiBwcm90byBvciBjbGFzcyB2YXJp
YWJsZQogICAgICAgKiBGT08gZm9vKCk7ICAgICAgICAgICAgICAgICAgICAgICAgLS0gZmNu
IHByb3RvIG9yIGNsYXNzIHZhcmlhYmxlCiAgICAgICAqIEZPTyBmb28oMSk7ICAgICAgICAg
ICAgICAgICAgICAgICAtLSBjbGFzcyB2YXJpYWJsZQogICAgICAgKiBhID0gRk9PICogYmFy
KCk7ICAgICAgICAgICAgICAgICAgLS0gZmNuIGNhbGwKICAgICAgICogYS55ID0gZm9vKCkg
KiBiYXIoKTsgICAgICAgICAgICAgIC0tIGZjbiBjYWxsCiAgICAgICAqIHN0YXRpYyBjb25z
dCBjaGFyICogY29uc3QgZml6eigpOyAtLSBmY24gZGVmCiAgICAgICAqLwogICAgICB3aGls
ZSAocHJldiAhPSBudWxscHRyKQogICAgICB7CiAgICAgICAgIExPR19GTVQoTEZDTiwgIiVz
KCVkKTogbmV4dCBzdGVwIHdpdGg6IHByZXYtPm9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29s
IGlzICV6dSwgdGV4dCgpICclcydcbiIsCiAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9f
TElORV9fLCBwcmV2LT5vcmlnX2xpbmUsIHByZXYtPm9yaWdfY29sLCBwcmV2LT50ZXh0KCkp
OwoKICAgICAgICAgaWYgKGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgPT0gQ1RfRklYRUQp
CiAgICAgICAgIHsKICAgICAgICAgICAgaXNhX2RlZiA9IHRydWU7CiAgICAgICAgIH0KCiAg
ICAgICAgIGlmIChwcmV2LT5mbGFncy50ZXN0KFBDRl9JTl9QUkVQUk9DKSkKICAgICAgICAg
ewogICAgICAgICAgICBwcmV2ID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5wKHByZXYpOwogICAg
ICAgICAgICBjb250aW51ZTsKICAgICAgICAgfQoKICAgICAgICAgLy8gU29tZSBjb2RlIHNs
aXBzIGFuIGF0dHJpYnV0ZSBiZXR3ZWVuIHRoZSB0eXBlIGFuZCBmdW5jdGlvbgogICAgICAg
ICBpZiAoICBjaHVua19pc190b2tlbihwcmV2LCBDVF9GUEFSRU5fQ0xPU0UpCiAgICAgICAg
ICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShwcmV2KSA9PSBDVF9BVFRSSUJVVEUpCiAg
ICAgICAgIHsKICAgICAgICAgICAgcHJldiA9IHNraXBfYXR0cmlidXRlX3ByZXYocHJldik7
CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICB9CgogICAgICAgICAvLyBza2lwIGNv
bnN0KFRZUEUpCiAgICAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKHByZXYsIENUX1BBUkVO
X0NMT1NFKQogICAgICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocHJldikgPT0g
Q1RfRF9DQVNUKQogICAgICAgICB7CiAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVk
KTogLS0+IEZvciBzdXJlIGEgcHJvdG90eXBlIG9yIGRlZmluaXRpb25cbiIsCiAgICAgICAg
ICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fKTsKICAgICAgICAgICAgaXNhX2RlZiA9
IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CgogICAgICAgICBpZiAoZ2V0
X2NodW5rX3BhcmVudF90eXBlKHByZXYpID09IENUX0RFQ0xTUEVDKSAgLy8gSXNzdWUgMTI4
OQogICAgICAgICB7CiAgICAgICAgICAgIHByZXYgPSBjaHVua19za2lwX3RvX21hdGNoX3Jl
dihwcmV2KTsKICAgICAgICAgICAgcHJldiA9IGNodW5rX2dldF9wcmV2KHByZXYpOwoKICAg
ICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHByZXYsIENUX0RFQ0xTUEVDKSkKICAgICAg
ICAgICAgewogICAgICAgICAgICAgICBwcmV2ID0gY2h1bmtfZ2V0X3ByZXYocHJldik7CiAg
ICAgICAgICAgIH0KICAgICAgICAgfQoKICAgICAgICAgLy8gaWYgaXQgd2FzIGRldGVybWlu
ZWQgdGhhdCB0aGlzIGNvdWxkIGJlIGEgZnVuY3Rpb24gZGVmaW5pdGlvbgogICAgICAgICAv
LyBidXQgb25lIG9mIHRoZSBwcmVjZWRpbmcgdG9rZW5zIGlzIGEgQ1RfTUVNQkVSIHRoYW4g
dGhpcyBpcyBub3QgYQogICAgICAgICAvLyBmY24gZGVmLCBpc3N1ZSAjMTQ2NgogICAgICAg
ICBpZiAoICBpc2FfZGVmCiAgICAgICAgICAgICYmIGNodW5rX2lzX3Rva2VuKHByZXYsIENU
X01FTUJFUikpCiAgICAgICAgIHsKICAgICAgICAgICAgaXNhX2RlZiA9IGZhbHNlOwogICAg
ICAgICB9CgogICAgICAgICAvLyBnZXQgZmlyc3QgY2h1bmsgYmVmb3JlOiBBOjpCOjpwYyB8
IHRoaXMuQi5wYyB8IHRoaXMtPkItPnBjCiAgICAgICAgIGlmICggIGNodW5rX2lzX3Rva2Vu
KHByZXYsIENUX0RDX01FTUJFUikKICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocHJl
diwgQ1RfTUVNQkVSKSkKICAgICAgICAgewogICAgICAgICAgICB3aGlsZSAoICBjaHVua19p
c190b2tlbihwcmV2LCBDVF9EQ19NRU1CRVIpCiAgICAgICAgICAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHByZXYsIENUX01FTUJFUikpCiAgICAgICAgICAgIHsKICAgICAgICAgICAg
ICAgcHJldiA9IGNodW5rX2dldF9wcmV2X25jbmxucChwcmV2KTsKCiAgICAgICAgICAgICAg
IGlmICggIHByZXYgPT0gbnVsbHB0cgogICAgICAgICAgICAgICAgICB8fCAoICBwcmV2LT50
eXBlICE9IENUX1dPUkQKICAgICAgICAgICAgICAgICAgICAgJiYgcHJldi0+dHlwZSAhPSBD
VF9UWVBFCiAgICAgICAgICAgICAgICAgICAgICYmIHByZXYtPnR5cGUgIT0gQ1RfVEhJUykp
CiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgTE9HX0ZNVChMRkNOLCAiJXMo
JWQpOiAtLT8gc2tpcHBlZCBNRU1CRVIgYW5kIGxhbmRlZCBvbiAlc1xuIiwKICAgICAgICAg
ICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIChwcmV2ID09IG51bGxwdHIp
ID8gIjxudWxsPiIgOiBnZXRfdG9rZW5fbmFtZShwcmV2LT50eXBlKSk7CiAgICAgICAgICAg
ICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIExPR19GTVQo
TEZDTiwgIiVzKCVkKTogPHNraXA+ICclcydcbiIsCiAgICAgICAgICAgICAgICAgICAgICAg
X19mdW5jX18sIF9fTElORV9fLCBwcmV2LT50ZXh0KCkpOwoKICAgICAgICAgICAgICAgLy8g
SXNzdWUgIzExMTIKICAgICAgICAgICAgICAgLy8gY2xhcmlmaWNhdGlvbjogdGhpcyB3aWxs
IHNraXAgdGhlIENUX1dPUkQsIENUX1RZUEUgb3IgQ1RfVEhJUyBsYW5kaW5nIG9uIGVpdGhl
cgogICAgICAgICAgICAgICAvLyBhbm90aGVyIENUX0RDX01FTUJFUiBvciBDVF9NRU1CRVIg
b3IgYSB0b2tlbiB0aGF0IGluZGljYXRlcyB0aGUgY29udGV4dCBvZiB0aGUKICAgICAgICAg
ICAgICAgLy8gdG9rZW4gaW4gcXVlc3Rpb247IHRoZXJlZm9yZSwgZXhpdCBsb29wIHdoZW4g
bm90IGEgQ1RfRENfTUVNQkVSIG9yIENUX01FTUJFUgogICAgICAgICAgICAgICBwcmV2ID0g
Y2h1bmtfZ2V0X3ByZXZfbmNubG5wKHByZXYpOwoKICAgICAgICAgICAgICAgaWYgKHByZXYg
PT0gbnVsbHB0cikKICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBMT0dfRk1U
KExGQ04sICIlcyglZCk6IHByZXYgaXMgbnVsbHB0clxuIiwKICAgICAgICAgICAgICAgICAg
ICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18pOwogICAgICAgICAgICAgICB9CiAgICAgICAg
ICAgICAgIGVsc2UKICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBMT0dfRk1U
KExGQ04sICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4
dCgpICclcydcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElO
RV9fLCBwcmV2LT5vcmlnX2xpbmUsIHByZXYtPm9yaWdfY29sLCBwcmV2LT50ZXh0KCkpOwog
ICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwcmV2ID09
IG51bGxwdHIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg
ICAgIH0KICAgICAgICAgfQoKICAgICAgICAgLy8gSWYgd2UgYXJlIG9uIGEgVFlQRSBvciBX
T1JELCB0aGVuIHRoaXMgY291bGQgYmUgYSBwcm90byBvciBkZWYKICAgICAgICAgaWYgKCAg
Y2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfVFlQRSkKICAgICAgICAgICAgfHwgY2h1bmtfaXNf
dG9rZW4ocHJldiwgQ1RfV09SRCkpCiAgICAgICAgIHsKICAgICAgICAgICAgaWYgKCFoaXRf
c3RhcikKICAgICAgICAgICAgewogICAgICAgICAgICAgICBMT0dfRk1UKExGQ04sICIlcygl
ZCk6ICAgLS0+IEZvciBzdXJlIGEgcHJvdG90eXBlIG9yIGRlZmluaXRpb25cbiIsCiAgICAg
ICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fKTsKICAgICAgICAgICAgICAg
aXNhX2RlZiA9IHRydWU7CiAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAg
ICAgICAgICAgIGNodW5rX3QgKnByZXZfcHJldiA9IGNodW5rX2dldF9wcmV2X25jbmxucChw
cmV2KTsKCiAgICAgICAgICAgIGlmICghY2h1bmtfaXNfdG9rZW4ocHJldl9wcmV2LCBDVF9R
VUVTVElPTikpICAgICAgICAgICAgICAgLy8gSXNzdWUgIzE3NTMKICAgICAgICAgICAgewog
ICAgICAgICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6ICAgLS0+IG1heWJlIGEgcHJv
dG8vZGVmXG4iLAogICAgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXyk7
CgogICAgICAgICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IHByZXYgaXMgJyVzJywg
b3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0eXBlIGlzICVzLCBwYXJlbnRf
dHlwZSBpcyAlc1xuIiwKICAgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5F
X18sIHByZXYtPnRleHQoKSwgcHJldi0+b3JpZ19saW5lLCBwcmV2LT5vcmlnX2NvbCwKICAg
ICAgICAgICAgICAgICAgICAgICBnZXRfdG9rZW5fbmFtZShwcmV2LT50eXBlKSwgZ2V0X3Rv
a2VuX25hbWUoZ2V0X2NodW5rX3BhcmVudF90eXBlKHByZXYpKSk7CiAgICAgICAgICAgICAg
IGxvZ19wY2ZfZmxhZ3MoTEZDTiwgcGMtPmZsYWdzKTsKICAgICAgICAgICAgICAgaXNhX2Rl
ZiA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgfQoKICAgICAgICAgaWYgKGNodW5r
X2lzX3B0cl9vcGVyYXRvcihwcmV2KSkKICAgICAgICAgewogICAgICAgICAgICBoaXRfc3Rh
ciA9IHRydWU7CiAgICAgICAgIH0KCiAgICAgICAgIGlmICggIHByZXYtPnR5cGUgIT0gQ1Rf
T1BFUkFUT1IKICAgICAgICAgICAgJiYgcHJldi0+dHlwZSAhPSBDVF9UU1FVQVJFCiAgICAg
ICAgICAgICYmIHByZXYtPnR5cGUgIT0gQ1RfQU5HTEVfQ0xPU0UKICAgICAgICAgICAgJiYg
cHJldi0+dHlwZSAhPSBDVF9RVUFMSUZJRVIKICAgICAgICAgICAgJiYgcHJldi0+dHlwZSAh
PSBDVF9UWVBFCiAgICAgICAgICAgICYmIHByZXYtPnR5cGUgIT0gQ1RfV09SRAogICAgICAg
ICAgICAmJiAhY2h1bmtfaXNfcHRyX29wZXJhdG9yKHByZXYpKQogICAgICAgICB7CiAgICAg
ICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogIC0tPiBTdG9wcGluZyBvbiBwcmV2IGlz
ICclcycsIG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdHlwZSBpcyAlc1xu
IiwKICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHByZXYtPnRleHQo
KSwgcHJldi0+b3JpZ19saW5lLCBwcmV2LT5vcmlnX2NvbCwgZ2V0X3Rva2VuX25hbWUocHJl
di0+dHlwZSkpOwoKICAgICAgICAgICAgLy8gY2VydGFpbiB0b2tlbnMgYXJlIHVubGlrZWx5
IHRvIHByZWNlZGUgYSBwcm90b3R5cGUgb3IgZGVmaW5pdGlvbgogICAgICAgICAgICBpZiAo
ICBjaHVua19pc190b2tlbihwcmV2LCBDVF9BUklUSCkKICAgICAgICAgICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4ocHJldiwgQ1RfQVNTSUdOKQogICAgICAgICAgICAgICB8fCBjaHVua19p
c190b2tlbihwcmV2LCBDVF9DT01NQSkKICAgICAgICAgICAgICAgfHwgKGNodW5rX2lzX3Rv
a2VuKHByZXYsIENUX1NUUklORykgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHByZXYpICE9
IENUX0VYVEVSTikgIC8vIGZpeGVzIGlzc3VlIDEyNTkKICAgICAgICAgICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4ocHJldiwgQ1RfU1RSSU5HX01VTFRJKQogICAgICAgICAgICAgICB8fCBj
aHVua19pc190b2tlbihwcmV2LCBDVF9OVU1CRVIpCiAgICAgICAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHByZXYsIENUX05VTUJFUl9GUCkKICAgICAgICAgICAgICAgfHwgY2h1bmtf
aXNfdG9rZW4ocHJldiwgQ1RfRlBBUkVOX09QRU4pKSAvLyBpc3N1ZSAjMTQ2NAogICAgICAg
ICAgICB7CiAgICAgICAgICAgICAgIGlzYV9kZWYgPSBmYWxzZTsKICAgICAgICAgICAgfQog
ICAgICAgICAgICBicmVhazsKICAgICAgICAgfQoKICAgICAgICAgLy8gU2tpcCBvdmVyIHRl
bXBsYXRlIGFuZCBhdHRyaWJ1dGUgc3R1ZmYKICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2Vu
KHByZXYsIENUX0FOR0xFX0NMT1NFKSkKICAgICAgICAgewogICAgICAgICAgICBwcmV2ID0g
c2tpcF90ZW1wbGF0ZV9wcmV2KHByZXYpOwogICAgICAgICB9CiAgICAgICAgIGVsc2UKICAg
ICAgICAgewogICAgICAgICAgICBwcmV2ID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5wKHByZXYp
OwogICAgICAgICB9CiAgICAgIH0KICAgICAgLy9MT0dfRk1UKExGQ04sICIgLS0gc3RvcHBl
ZCBvbiAlcyBbJXNdXG4iLAogICAgICAvLyAgICAgICAgcHJldi0+dGV4dCgpLCBnZXRfdG9r
ZW5fbmFtZShwcmV2LT50eXBlKSk7CgogICAgICAvLyBGaXhlcyBpc3N1ZSAjMTYzNAogICAg
ICBpZiAoY2h1bmtfaXNfcGFyZW5fY2xvc2UocHJldikpCiAgICAgIHsKICAgICAgICAgY2h1
bmtfdCAqcHJlcHJvYyA9IGNodW5rX2dldF9uZXh0X25jbmwocHJldik7CgogICAgICAgICBp
ZiAoY2h1bmtfaXNfdG9rZW4ocHJlcHJvYywgQ1RfUFJFUFJPQykpCiAgICAgICAgIHsKICAg
ICAgICAgICAgc2l6ZV90IHBwX2xldmVsID0gcHJlcHJvYy0+cHBfbGV2ZWw7CgogICAgICAg
ICAgICBpZiAoY2h1bmtfaXNfdG9rZW4oY2h1bmtfZ2V0X25leHRfbmNubChwcmVwcm9jKSwg
Q1RfUFBfRUxTRSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgZG8KICAgICAgICAg
ICAgICAgewogICAgICAgICAgICAgICAgICBwcmVwcm9jID0gY2h1bmtfZ2V0X3ByZXZfbmNu
bG5pKHByZXByb2MpOyAgICAgIC8vIElzc3VlICMyMjc5CgogICAgICAgICAgICAgICAgICBp
ZiAoY2h1bmtfaXNfdG9rZW4ocHJlcHJvYywgQ1RfUFBfSUYpKQogICAgICAgICAgICAgICAg
ICB7CiAgICAgICAgICAgICAgICAgICAgIHByZXByb2MgPSBjaHVua19nZXRfcHJldl9uY25s
bmkocHJlcHJvYyk7ICAgLy8gSXNzdWUgIzIyNzkKCiAgICAgICAgICAgICAgICAgICAgIGlm
IChwcmVwcm9jLT5wcF9sZXZlbCA9PSBwcF9sZXZlbCkKICAgICAgICAgICAgICAgICAgICAg
ewogICAgICAgICAgICAgICAgICAgICAgICBwcmV2ID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5w
KHByZXByb2MpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg
ICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIH0gd2hpbGUg
KHByZXByb2MgIT0gbnVsbHB0cik7CiAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgICB9
CgogICAgICBpZiAoICBpc2FfZGVmCiAgICAgICAgICYmIHByZXYgIT0gbnVsbHB0cgogICAg
ICAgICAmJiAoICAoICBjaHVua19pc19wYXJlbl9jbG9zZShwcmV2KQogICAgICAgICAgICAg
ICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocHJldikgIT0gQ1RfRF9DQVNUCiAgICAgICAg
ICAgICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShwcmV2KSAhPSBDVF9NQUNST19PUEVO
ICAvLyBJc3N1ZSAjMjcyNgogICAgICAgICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5
cGUocHJldikgIT0gQ1RfTUFDUk9fQ0xPU0UpCiAgICAgICAgICAgIHx8IHByZXYtPnR5cGUg
PT0gQ1RfQVNTSUdOCiAgICAgICAgICAgIHx8IHByZXYtPnR5cGUgPT0gQ1RfUkVUVVJOKSkK
ICAgICAgewogICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IC0tIG92ZXJyaWRpbmcg
REVGIGR1ZSB0byBwcmV2IGlzICclcycsIHR5cGUgaXMgJXNcbiIsCiAgICAgICAgICAgICAg
ICAgX19mdW5jX18sIF9fTElORV9fLCBwcmV2LT50ZXh0KCksIGdldF90b2tlbl9uYW1lKHBy
ZXYtPnR5cGUpKTsKICAgICAgICAgaXNhX2RlZiA9IGZhbHNlOwogICAgICB9CgogICAgICAv
LyBGaXhlcyBpc3N1ZSAjMTI2NiwgaWRlbnRpZmljYXRpb24gb2YgYSB0dXBsZSByZXR1cm4g
dHlwZSBpbiBDUy4KICAgICAgaWYgKCAgIWlzYV9kZWYKICAgICAgICAgJiYgY2h1bmtfaXNf
dG9rZW4ocHJldiwgQ1RfUEFSRU5fQ0xPU0UpCiAgICAgICAgICYmIGNodW5rX2dldF9uZXh0
X25jbmwocHJldikgPT0gcGMpCiAgICAgIHsKICAgICAgICAgdG1wID0gY2h1bmtfc2tpcF90
b19tYXRjaF9yZXYocHJldik7CgogICAgICAgICB3aGlsZSAoICB0bXAgIT0gbnVsbHB0ciAg
ICAgICAgICAgICAgICAgICAgIC8vIElzc3VlICMyMzE1CiAgICAgICAgICAgICAgICYmIHRt
cCAhPSBwcmV2KQogICAgICAgICB7CiAgICAgICAgICAgIGlmIChjaHVua19pc190b2tlbih0
bXAsIENUX0NPTU1BKSAmJiB0bXAtPmxldmVsID09IHByZXYtPmxldmVsICsgMSkKICAgICAg
ICAgICAgewogICAgICAgICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IC0tIG92ZXJy
aWRpbmcgY2FsbCBkdWUgdG8gdHVwbGUgcmV0dXJuIHR5cGUgLS0gcHJldiBpcyAnJXMnLCB0
eXBlIGlzICVzXG4iLAogICAgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVf
XywgcHJldi0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZShwcmV2LT50eXBlKSk7CiAgICAgICAg
ICAgICAgIGlzYV9kZWYgPSB0cnVlOwogICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg
ICAgfQogICAgICAgICAgICB0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcCk7CiAgICAg
ICAgIH0KICAgICAgfQoKICAgICAgaWYgKGlzYV9kZWYpCiAgICAgIHsKICAgICAgICAgTE9H
X0ZNVChMRkNOLCAiJXMoJWQpOiBwYyBpcyAnJXMnLCBvcmlnX2xpbmUgaXMgJXp1LCBvcmln
X2NvbCBpcyAlenUsIHR5cGUgaXMgJXNcbiIsCiAgICAgICAgICAgICAgICAgX19mdW5jX18s
IF9fTElORV9fLCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIGdl
dF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CiAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVk
KTogKDEyKSBTRVQgVE8gQ1RfRlVOQ19ERUY6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29s
IGlzICV6dSwgdGV4dCgpICclcydcbiIsCiAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9f
TElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIHBjLT50ZXh0KCkpOwogICAg
ICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfRlVOQ19ERUYpOwoKICAgICAgICAgaWYgKHBy
ZXYgPT0gbnVsbHB0cikKICAgICAgICAgewogICAgICAgICAgICBwcmV2ID0gY2h1bmtfZ2V0
X2hlYWQoKTsKICAgICAgICAgfQoKICAgICAgICAgZm9yICggIHRtcCA9IHByZXY7ICh0bXAg
IT0gbnVsbHB0cikKICAgICAgICAgICAgICYmIHRtcCAhPSBwYzsgdG1wID0gY2h1bmtfZ2V0
X25leHRfbmNubG5wKHRtcCkpCiAgICAgICAgIHsKICAgICAgICAgICAgTE9HX0ZNVChMRkNO
LCAiJXMoJWQpOiB0ZXh0KCkgaXMgJyVzJywgdHlwZSBpcyAlc1xuIiwKICAgICAgICAgICAg
ICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHRtcC0+dGV4dCgpLCBnZXRfdG9rZW5fbmFt
ZSh0bXAtPnR5cGUpKTsKICAgICAgICAgICAgbWFrZV90eXBlKHRtcCk7CiAgICAgICAgIH0K
ICAgICAgfQogICB9CgogICBpZiAocGMtPnR5cGUgIT0gQ1RfRlVOQ19ERUYpCiAgIHsKICAg
ICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiAgRGV0ZWN0ZWQgdHlwZSAlcywgdGV4dCgpIGlz
ICclcycsIG9uIG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dVxuIiwKICAgICAgICAgICAg
ICBfX2Z1bmNfXywgX19MSU5FX18sIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSwKICAgICAg
ICAgICAgICBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wpOwoKICAg
ICAgdG1wID0gZmxhZ19wYXJlbnMobmV4dCwgUENGX0lOX0ZDTl9DQUxMLCBDVF9GUEFSRU5f
T1BFTiwgQ1RfRlVOQ19DQUxMLCBmYWxzZSk7CgogICAgICBpZiAoICBjaHVua19pc190b2tl
bih0bXAsIENUX0JSQUNFX09QRU4pCiAgICAgICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlw
ZSh0bXApICE9IENUX0RPVUJMRV9CUkFDRSkKICAgICAgewogICAgICAgICBzZXRfcGFyZW5f
cGFyZW50KHRtcCwgcGMtPnR5cGUpOwogICAgICB9CiAgICAgIHJldHVybjsKICAgfQogICAv
KgogICAgKiBXZSBoYXZlIGEgZnVuY3Rpb24gZGVmaW5pdGlvbiBvciBwcm90b3R5cGUKICAg
ICogTG9vayBmb3IgYSBzZW1pY29sb24gb3IgYSBicmFjZSBvcGVuIGFmdGVyIHRoZSBjbG9z
ZSBwYXJlbnRoZXNpcyB0byBmaWd1cmUKICAgICogb3V0IHdoZXRoZXIgdGhpcyBpcyBhIHBy
b3RvdHlwZSBvciBkZWZpbml0aW9uCiAgICAqLwoKICAgLy8gU2VlIGlmIHRoaXMgaXMgYSBw
cm90b3R5cGUgb3IgaW1wbGVtZW50YXRpb24KCiAgIC8vIEZJWE1FOiB0aGlzIGRvZXNuJ3Qg
dGFrZSB0aGUgb2xkIEsmUiBwYXJhbWV0ZXIgZGVmaW5pdGlvbnMgaW50byBhY2NvdW50Cgog
ICAvLyBTY2FuIHRva2VucyB1bnRpbCB3ZSBoaXQgYSBicmFjZSBvcGVuIChkZWYpIG9yIHNl
bWljb2xvbiAocHJvdG8pCiAgIHRtcCA9IHBhcmVuX2Nsb3NlOwoKICAgd2hpbGUgKCh0bXAg
PSBjaHVua19nZXRfbmV4dF9uY25sKHRtcCkpICE9IG51bGxwdHIpCiAgIHsKICAgICAgLy8g
T25seSBjYXJlIGFib3V0IGJyYWNlIG9yIHNlbWljb2xvbiBvbiB0aGUgc2FtZSBsZXZlbAog
ICAgICBpZiAodG1wLT5sZXZlbCA8IHBjLT5sZXZlbCkKICAgICAgewogICAgICAgICAvLyBO
byBzZW1pY29sb24gLSBndWVzcyB0aGF0IGl0IGlzIGEgcHJvdG90eXBlCiAgICAgICAgIGNo
dW5rX2ZsYWdzX2NscihwYywgUENGX1ZBUl8xU1RfREVGKTsKICAgICAgICAgc2V0X2NodW5r
X3R5cGUocGMsIENUX0ZVTkNfUFJPVE8pOwogICAgICAgICBicmVhazsKICAgICAgfQogICAg
ICBlbHNlIGlmICh0bXAtPmxldmVsID09IHBjLT5sZXZlbCkKICAgICAgewogICAgICAgICBp
ZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9CUkFDRV9PUEVOKSkKICAgICAgICAgewogICAg
ICAgICAgICAvLyBpdHMgYSBmdW5jdGlvbiBkZWYgZm9yIHN1cmUKICAgICAgICAgICAgYnJl
YWs7CiAgICAgICAgIH0KICAgICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfc2VtaWNvbG9uKHRt
cCkpCiAgICAgICAgIHsKICAgICAgICAgICAgLy8gU2V0IHRoZSBwYXJlbnQgZm9yIHRoZSBz
ZW1pY29sb24gZm9yIGxhdGVyCiAgICAgICAgICAgIHNlbWkgPSB0bXA7CiAgICAgICAgICAg
IGNodW5rX2ZsYWdzX2NscihwYywgUENGX1ZBUl8xU1RfREVGKTsKICAgICAgICAgICAgc2V0
X2NodW5rX3R5cGUocGMsIENUX0ZVTkNfUFJPVE8pOwogICAgICAgICAgICBMT0dfRk1UKExG
Q04sICIlcyglZCk6ICAgMikgTWFya2VkIHRleHQoKSBpcyAnJXMnLCBhcyBGVU5DX1BST1RP
IG9uIG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dVxuIiwKICAgICAgICAgICAgICAgICAg
ICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIHBjLT5vcmlnX2xpbmUsIHBjLT5v
cmlnX2NvbCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAgICAgICAgIGVsc2Ug
aWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DT01NQSkpCiAgICAgICAgIHsKICAgICAgICAg
ICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0ZVTkNfQ1RPUl9WQVIpOwogICAgICAgICAgICBM
T0dfRk1UKExGQ04sICIlcyglZCk6ICAgMikgTWFya2VkIHRleHQoKSBpcyAnJXMnLCBhcyBG
VU5DX0NUT1JfVkFSIG9uIG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dVxuIiwKICAgICAg
ICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIHBjLT5vcmln
X2xpbmUsIHBjLT5vcmlnX2NvbCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAg
ICAgIH0KICAgfQoKICAgLyoKICAgICogQysrIHN5bnRheCBpcyB3YWNreS4gV2UgbmVlZCB0
byBjaGVjayB0byBzZWUgaWYgYSBwcm90b3R5cGUgaXMgcmVhbGx5IGEKICAgICogdmFyaWFi
bGUgZGVmaW5pdGlvbiB3aXRoIHBhcmFtZXRlcnMgcGFzc2VkIGludG8gdGhlIGNvbnN0cnVj
dG9yLgogICAgKiBVbmZvcnR1bmF0ZWx5LCB3aXRob3V0IGJlaW5nIGFibGUgdG8gYWNjdXJh
dGVseSBkZXRlcm1pbmUgaWYgYW4KICAgICogaWRlbnRpZmllciBpcyBhIHR5cGUgKHdoaWNo
IHdvdWxkIHJlcXVpcmUgdXMgdG8gbW9yZSBvciBsZXNzIGJlIGEgZnVsbAogICAgKiBjb21w
aWxlciksIHRoZSBvbmx5IG1vc3RseSByZWxpYWJsZSB3YXkgdG8gZG8gc28gaXMgdG8gZ3Vl
c3MgdGhhdCBpdCBpcwogICAgKiBhIGNvbnN0cnVjdG9yIHZhcmlhYmxlIGlmIGluc2lkZSBh
IGZ1bmN0aW9uIGJvZHkgYW5kIHNjYW4gdGhlICdwYXJhbWV0ZXIKICAgICogbGlzdCcgZm9y
IGl0ZW1zIHRoYXQgYXJlIG5vdCBhbGxvd2VkIGluIGEgcHJvdG90eXBlLiBXZSBzZWFyY2gg
YmFja3dhcmRzCiAgICAqIGFuZCBjaGVja2luZyB0aGUgcGFyZW50IG9mIHRoZSBjb250YWlu
aW5nIG9wZW4gYnJhY2VzLiBJZiB0aGUgcGFyZW50IGlzIGEKICAgICogY2xhc3Mgb3IgbmFt
ZXNwYWNlLCB0aGVuIGl0IHByb2JhYmx5IGlzIGEgcHJvdG90eXBlLgogICAgKi8KICAgaWYg
KCAgbGFuZ3VhZ2VfaXNfc2V0KExBTkdfQ1BQKQogICAgICAmJiBjaHVua19pc190b2tlbihw
YywgQ1RfRlVOQ19QUk9UTykKICAgICAgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSAh
PSBDVF9PUEVSQVRPUikKICAgewogICAgICBMT0dfRk1UKExGUEFSQU0sICIlcyglZCk6Iiwg
X19mdW5jX18sIF9fTElORV9fKTsKICAgICAgTE9HX0ZNVChMRlBBUkFNLCAiICBjaGVja2lu
ZyAnJXMnIGZvciBjb25zdHJ1Y3RvciB2YXJpYWJsZSAlcyAlc1xuIiwKICAgICAgICAgICAg
ICBwYy0+dGV4dCgpLAogICAgICAgICAgICAgIGdldF90b2tlbl9uYW1lKHBhcmVuX29wZW4t
PnR5cGUpLAogICAgICAgICAgICAgIGdldF90b2tlbl9uYW1lKHBhcmVuX2Nsb3NlLT50eXBl
KSk7CgogICAgICAvKgogICAgICAgKiBDaGVjayB0aGUgdG9rZW4gYXQgdGhlIHN0YXJ0IG9m
IHRoZSBzdGF0ZW1lbnQuIElmIGl0J3MgJ2V4dGVybicsIHdlCiAgICAgICAqIGRlZmluaXRl
bHkgaGF2ZSBhIGZ1bmN0aW9uIHByb3RvdHlwZS4KICAgICAgICovCiAgICAgIHRtcCA9IHBj
OwoKICAgICAgd2hpbGUgKCAgdG1wICE9IG51bGxwdHIKICAgICAgICAgICAgJiYgIXRtcC0+
ZmxhZ3MudGVzdChQQ0ZfU1RNVF9TVEFSVCkpCiAgICAgIHsKICAgICAgICAgdG1wID0gY2h1
bmtfZ2V0X3ByZXZfbmNubG5pKHRtcCk7ICAgLy8gSXNzdWUgIzIyNzkKICAgICAgfQogICAg
ICBjb25zdCBib29sIGlzX2V4dGVybiA9ICh0bXAgJiYgdG1wLT5zdHIuZXF1YWxzKCJleHRl
cm4iKSk7CgogICAgICAvKgogICAgICAgKiBTY2FuIHRoZSBwYXJhbWV0ZXJzIGxvb2tpbmcg
Zm9yOgogICAgICAgKiAgLSBjb25zdGFudCBzdHJpbmdzCiAgICAgICAqICAtIG51bWJlcnMK
ICAgICAgICogIC0gbm9uLXR5cGUgZmllbGRzCiAgICAgICAqICAtIGZ1bmN0aW9uIGNhbGxz
CiAgICAgICAqLwogICAgICBjaHVua190ICpyZWYgPSBjaHVua19nZXRfbmV4dF9uY25sKHBh
cmVuX29wZW4pOwogICAgICBjaHVua190ICp0bXAyOwogICAgICBib29sICAgIGlzX3BhcmFt
ID0gdHJ1ZTsKICAgICAgdG1wID0gcmVmOwoKICAgICAgd2hpbGUgKHRtcCAhPSBwYXJlbl9j
bG9zZSkKICAgICAgewogICAgICAgICB0bXAyID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXAp
OwoKICAgICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9DT01NQSkKICAgICAg
ICAgICAgJiYgKHRtcC0+bGV2ZWwgPT0gKHBhcmVuX29wZW4tPmxldmVsICsgMSkpKQogICAg
ICAgICB7CiAgICAgICAgICAgIGlmICghY2FuX2JlX2Z1bGxfcGFyYW0ocmVmLCB0bXApKQog
ICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGlzX3BhcmFtID0gZmFsc2U7CiAgICAgICAg
ICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlZiA9IHRtcDI7CiAg
ICAgICAgIH0KICAgICAgICAgdG1wID0gdG1wMjsKICAgICAgfQoKICAgICAgaWYgKCAgIWlz
X2V4dGVybgogICAgICAgICAmJiBpc19wYXJhbSAmJiByZWYgIT0gdG1wKQogICAgICB7CiAg
ICAgICAgIGlmICghY2FuX2JlX2Z1bGxfcGFyYW0ocmVmLCB0bXApKQogICAgICAgICB7CiAg
ICAgICAgICAgIGlzX3BhcmFtID0gZmFsc2U7CiAgICAgICAgIH0KICAgICAgfQoKICAgICAg
aWYgKCAgIWlzX2V4dGVybgogICAgICAgICAmJiAhaXNfcGFyYW0pCiAgICAgIHsKICAgICAg
ICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0ZVTkNfQ1RPUl9WQVIpOwogICAgICAgICBMT0df
Rk1UKExGQ04sICIlcyglZCk6ICAgMykgTWFya2VkIHRleHQoKSAnJXMnIGFzIEZVTkNfQ1RP
Ul9WQVIgb24gb3JpZ19saW5lICV6dSwgb3JpZ19jb2wgJXp1XG4iLAogICAgICAgICAgICAg
ICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPnRleHQoKSwgcGMtPm9yaWdfbGluZSwgcGMt
Pm9yaWdfY29sKTsKICAgICAgfQogICAgICBlbHNlIGlmIChwYy0+YnJhY2VfbGV2ZWwgPiAw
KQogICAgICB7CiAgICAgICAgIGNodW5rX3QgKmJyX29wZW4gPSBjaHVua19nZXRfcHJldl90
eXBlKHBjLCBDVF9CUkFDRV9PUEVOLCBwYy0+YnJhY2VfbGV2ZWwgLSAxKTsKCiAgICAgICAg
IGlmICggIGJyX29wZW4gIT0gbnVsbHB0cgogICAgICAgICAgICAmJiBnZXRfY2h1bmtfcGFy
ZW50X3R5cGUoYnJfb3BlbikgIT0gQ1RfRVhURVJOCiAgICAgICAgICAgICYmIGdldF9jaHVu
a19wYXJlbnRfdHlwZShicl9vcGVuKSAhPSBDVF9OQU1FU1BBQ0UpCiAgICAgICAgIHsKICAg
ICAgICAgICAgLy8gRG8gYSBjaGVjayB0byBzZWUgaWYgdGhlIGxldmVsIGlzIHJpZ2h0CiAg
ICAgICAgICAgIHByZXYgPSBjaHVua19nZXRfcHJldl9uY25sbmkocGMpOyAgIC8vIElzc3Vl
ICMyMjc5CgogICAgICAgICAgICBpZiAoICAhY2h1bmtfaXNfc3RyKHByZXYsICIqIiwgMSkK
ICAgICAgICAgICAgICAgJiYgIWNodW5rX2lzX3N0cihwcmV2LCAiJiIsIDEpKQogICAgICAg
ICAgICB7CiAgICAgICAgICAgICAgIGNodW5rX3QgKnBfb3AgPSBjaHVua19nZXRfcHJldl90
eXBlKHBjLCBDVF9CUkFDRV9PUEVOLCBwYy0+YnJhY2VfbGV2ZWwgLSAxKTsKCiAgICAgICAg
ICAgICAgIGlmICggIHBfb3AgIT0gbnVsbHB0cgogICAgICAgICAgICAgICAgICAmJiBnZXRf
Y2h1bmtfcGFyZW50X3R5cGUocF9vcCkgIT0gQ1RfQ0xBU1MKICAgICAgICAgICAgICAgICAg
JiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBfb3ApICE9IENUX1NUUlVDVAogICAgICAgICAg
ICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocF9vcCkgIT0gQ1RfTkFNRVNQQUNF
KQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBj
LCBDVF9GVU5DX0NUT1JfVkFSKTsKICAgICAgICAgICAgICAgICAgTE9HX0ZNVChMRkNOLCAi
JXMoJWQpOiAgIDQpIE1hcmtlZCB0ZXh0KCkgaXMnJXMnLCBhcyBGVU5DX0NUT1JfVkFSIG9u
IG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dVxuIiwKICAgICAgICAgICAgICAgICAgICAg
ICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIHBjLT5vcmlnX2xpbmUsIHBj
LT5vcmlnX2NvbCk7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICB9
CiAgICAgIH0KICAgfQoKICAgaWYgKHNlbWkgIT0gbnVsbHB0cikKICAgewogICAgICBzZXRf
Y2h1bmtfcGFyZW50KHNlbWksIHBjLT50eXBlKTsKICAgfQoKICAgLy8gSXNzdWUgIyAxNDAz
LCAyMTUyCiAgIGlmIChjaHVua19pc190b2tlbihwYXJlbl9vcGVuLT5wcmV2LCBDVF9GVU5D
X0NUT1JfVkFSKSkKICAgewogICAgICBmbGFnX3BhcmVucyhwYXJlbl9vcGVuLCBQQ0ZfSU5f
RkNOX0NUT1IsIENUX0ZQQVJFTl9PUEVOLCBwYy0+dHlwZSwgZmFsc2UpOwogICB9CiAgIGVs
c2UKICAgewogICAgICBmbGFnX3BhcmVucyhwYXJlbl9vcGVuLCBQQ0ZfSU5fRkNOX0RFRiwg
Q1RfRlBBUkVOX09QRU4sIHBjLT50eXBlLCBmYWxzZSk7CiAgIH0KICAgLy9mbGFnX3BhcmVu
cyhwYXJlbl9vcGVuLCBQQ0ZfSU5fRkNOX0RFRiwgQ1RfRlBBUkVOX09QRU4sIHBjLT50eXBl
LCB0cnVlKTsKCiAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfRlVOQ19DVE9SX1ZBUikp
CiAgIHsKICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHBjLCBQQ0ZfVkFSXzFTVF9ERUYpOwogICAg
ICByZXR1cm47CiAgIH0KCiAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9UU1FVQVJF
KSkKICAgewogICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0KTsKCiAgICAg
IGlmIChuZXh0ID09IG51bGxwdHIpCiAgICAgIHsKICAgICAgICAgcmV0dXJuOwogICAgICB9
CiAgIH0KICAgLy8gTWFyayBwYXJhbWV0ZXJzIGFuZCByZXR1cm4gdHlwZQogICBmaXhfZmNu
X2RlZl9wYXJhbXMobmV4dCk7CiAgIG1hcmtfZnVuY3Rpb25fcmV0dXJuX3R5cGUocGMsIGNo
dW5rX2dldF9wcmV2X25jbmxuaShwYyksIHBjLT50eXBlKTsgICAvLyBJc3N1ZSAjMjI3OQoK
ICAgLyogbWFyayBDIyB3aGVyZSBjaHVuayAqLwogICBpZiAoICBsYW5ndWFnZV9pc19zZXQo
TEFOR19DUykKICAgICAgJiYgKCAgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9GVU5DX0RFRikp
CiAgICAgICAgIHx8IChjaHVua19pc190b2tlbihwYywgQ1RfRlVOQ19QUk9UTykpKSkKICAg
ewogICAgICB0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKHBhcmVuX2Nsb3NlKTsKICAgICAg
cGNmX2ZsYWdzX3QgaW5fd2hlcmVfc3BlY19mbGFncyA9IFBDRl9OT05FOwoKICAgICAgd2hp
bGUgKCAgKHRtcCAhPSBudWxscHRyKQogICAgICAgICAgICAmJiAodG1wLT50eXBlICE9IENU
X0JSQUNFX09QRU4pCiAgICAgICAgICAgICYmICh0bXAtPnR5cGUgIT0gQ1RfU0VNSUNPTE9O
KSkKICAgICAgewogICAgICAgICBtYXJrX3doZXJlX2NodW5rKHRtcCwgcGMtPnR5cGUsIHRt
cC0+ZmxhZ3MgfCBpbl93aGVyZV9zcGVjX2ZsYWdzKTsKICAgICAgICAgaW5fd2hlcmVfc3Bl
Y19mbGFncyA9IHRtcC0+ZmxhZ3MgJiBQQ0ZfSU5fV0hFUkVfU1BFQzsKCiAgICAgICAgIHRt
cCA9IGNodW5rX2dldF9uZXh0X25jbmwodG1wKTsKICAgICAgfQogICB9CgogICAvLyBGaW5k
IHRoZSBicmFjZSBwYWlyIGFuZCBzZXQgdGhlIHBhcmVudAogICBpZiAoY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX0ZVTkNfREVGKSkKICAgewogICAgICB0bXAgPSBjaHVua19nZXRfbmV4dF9u
Y25sKHBhcmVuX2Nsb3NlKTsKCiAgICAgIHdoaWxlICggIHRtcCAhPSBudWxscHRyCiAgICAg
ICAgICAgICYmIHRtcC0+dHlwZSAhPSBDVF9CUkFDRV9PUEVOKQogICAgICB7CiAgICAgICAg
IExPR19GTVQoTEZDTiwgIiVzKCVkKTogKDEzKSBTRVQgVE8gQ1RfRlVOQ19ERUY6IG9yaWdf
bGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcydcbiIsCiAgICAgICAg
ICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0bXAtPm9yaWdfbGluZSwgdG1wLT5vcmln
X2NvbCwgdG1wLT50ZXh0KCkpOwogICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1Rf
RlVOQ19ERUYpOwoKICAgICAgICAgaWYgKCFjaHVua19pc19zZW1pY29sb24odG1wKSkKICAg
ICAgICAgewogICAgICAgICAgICBjaHVua19mbGFnc19zZXQodG1wLCBQQ0ZfT0xEX0ZDTl9Q
QVJBTVMpOwogICAgICAgICB9CiAgICAgICAgIHRtcCA9IGNodW5rX2dldF9uZXh0X25jbmwo
dG1wKTsKICAgICAgfQoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfQlJBQ0Vf
T1BFTikpCiAgICAgIHsKICAgICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiAoMTQpIFNF
VCBUTyBDVF9GVU5DX0RFRjogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0
ZXh0KCkgJyVzJ1xuIiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHRt
cC0+b3JpZ19saW5lLCB0bXAtPm9yaWdfY29sLCB0bXAtPnRleHQoKSk7CiAgICAgICAgIHNl
dF9jaHVua19wYXJlbnQodG1wLCBDVF9GVU5DX0RFRik7CiAgICAgICAgIHRtcCA9IGNodW5r
X3NraXBfdG9fbWF0Y2godG1wKTsKCiAgICAgICAgIGlmICh0bXAgIT0gbnVsbHB0cikKICAg
ICAgICAgewogICAgICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6ICgxNSkgU0VUIFRP
IENUX0ZVTkNfREVGOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRleHQo
KSAnJXMnXG4iLAogICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgdG1w
LT5vcmlnX2xpbmUsIHRtcC0+b3JpZ19jb2wsIHRtcC0+dGV4dCgpKTsKICAgICAgICAgICAg
c2V0X2NodW5rX3BhcmVudCh0bXAsIENUX0ZVTkNfREVGKTsKICAgICAgICAgfQogICAgICB9
CiAgIH0KfSAvLyBtYXJrX2Z1bmN0aW9uCgoKc3RhdGljIHZvaWQgbWFya19jcHBfY29uc3Ry
dWN0b3IoY2h1bmtfdCAqcGMpCnsKICAgTE9HX0ZVTkNfRU5UUlkoKTsKICAgY2h1bmtfdCAq
cGFyZW5fb3BlbjsKICAgY2h1bmtfdCAqdG1wOwogICBjaHVua190ICphZnRlcjsKICAgY2h1
bmtfdCAqdmFyOwogICBib29sICAgIGlzX2Rlc3RyID0gZmFsc2U7CgogICB0bXAgPSBjaHVu
a19nZXRfcHJldl9uY25sbmkocGMpOyAgIC8vIElzc3VlICMyMjc5CgogICBpZiAoY2h1bmtf
aXNfdG9rZW4odG1wLCBDVF9JTlYpIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfREVTVFJV
Q1RPUikpCiAgIHsKICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9ERVNUUlVDVE9SKTsK
ICAgICAgc2V0X2NodW5rX3BhcmVudChwYywgQ1RfREVTVFJVQ1RPUik7CiAgICAgIGlzX2Rl
c3RyID0gdHJ1ZTsKICAgfQogICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiBvcmlnX2xpbmUg
aXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIEZPVU5EICVzU1RSVUNUT1IgZm9yICclcydbJXNd
IHByZXYgJyVzJ1slc11cbiIsCiAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+
b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsCiAgICAgICAgICAgaXNfZGVzdHIgPyAiREUiIDog
IkNPTiIsCiAgICAgICAgICAgcGMtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUp
LAogICAgICAgICAgIHRtcC0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZSh0bXAtPnR5cGUpKTsK
CiAgIHBhcmVuX29wZW4gPSBza2lwX3RlbXBsYXRlX25leHQoY2h1bmtfZ2V0X25leHRfbmNu
bChwYykpOwoKICAgaWYgKCFjaHVua19pc19zdHIocGFyZW5fb3BlbiwgIigiLCAxKSkKICAg
ewogICAgICBMT0dfRk1UKExXQVJOLCAiJXM6JXp1IEV4cGVjdGVkICcoJywgZ290OiBbJXNd
XG4iLAogICAgICAgICAgICAgIGNwZC5maWxlbmFtZS5jX3N0cigpLCBwYXJlbl9vcGVuLT5v
cmlnX2xpbmUsCiAgICAgICAgICAgICAgcGFyZW5fb3Blbi0+dGV4dCgpKTsKICAgICAgcmV0
dXJuOwogICB9CiAgIC8vIE1hcmsgcGFyYW1ldGVycwogICBmaXhfZmNuX2RlZl9wYXJhbXMo
cGFyZW5fb3Blbik7CiAgIGFmdGVyID0gZmxhZ19wYXJlbnMocGFyZW5fb3BlbiwgUENGX0lO
X0ZDTl9DQUxMLCBDVF9GUEFSRU5fT1BFTiwgQ1RfRlVOQ19DTEFTU19QUk9UTywgZmFsc2Up
OwoKICAgTE9HX0ZNVChMRlRPUiwgIiVzKCVkKTogdGV4dCgpICclcydcbiIsIF9fZnVuY19f
LCBfX0xJTkVfXywgYWZ0ZXItPnRleHQoKSk7CgogICAvLyBTY2FuIHVudGlsIHRoZSBicmFj
ZSBvcGVuLCBtYXJrIGV2ZXJ5dGhpbmcKICAgdG1wID0gcGFyZW5fb3BlbjsKICAgYm9vbCBo
aXRfY29sb24gPSBmYWxzZTsKCiAgIHdoaWxlICggIHRtcCAhPSBudWxscHRyCiAgICAgICAg
ICYmICh0bXAtPnR5cGUgIT0gQ1RfQlJBQ0VfT1BFTiB8fCB0bXAtPmxldmVsICE9IHBhcmVu
X29wZW4tPmxldmVsKQogICAgICAgICAmJiAhY2h1bmtfaXNfc2VtaWNvbG9uKHRtcCkpCiAg
IHsKICAgICAgTE9HX0ZNVChMRlRPUiwgIiVzKCVkKTogdG1wIGlzICclcycsIG9yaWdfbGlu
ZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dVxuIiwKICAgICAgICAgICAgICBfX2Z1bmNfXywg
X19MSU5FX18sIHRtcC0+dGV4dCgpLCB0bXAtPm9yaWdfbGluZSwgdG1wLT5vcmlnX2NvbCk7
CiAgICAgIGNodW5rX2ZsYWdzX3NldCh0bXAsIFBDRl9JTl9DT05TVF9BUkdTKTsKICAgICAg
dG1wID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXApOwoKICAgICAgaWYgKGNodW5rX2lzX3N0
cih0bXAsICI6IiwgMSkgJiYgdG1wLT5sZXZlbCA9PSBwYXJlbl9vcGVuLT5sZXZlbCkKICAg
ICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZSh0bXAsIENUX0NPTlNUUl9DT0xPTik7CiAg
ICAgICAgIGhpdF9jb2xvbiA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmICggIGhpdF9jb2xv
bgogICAgICAgICAmJiAoY2h1bmtfaXNfcGFyZW5fb3Blbih0bXApIHx8IGNodW5rX2lzX29w
ZW5pbmdfYnJhY2UodG1wKSkKICAgICAgICAgJiYgdG1wLT5sZXZlbCA9PSBwYXJlbl9vcGVu
LT5sZXZlbCkKICAgICAgewogICAgICAgICB2YXIgPSBza2lwX3RlbXBsYXRlX3ByZXYoY2h1
bmtfZ2V0X3ByZXZfbmNubG5pKHRtcCkpOyAgIC8vIElzc3VlICMyMjc5CgogICAgICAgICBp
ZiAoY2h1bmtfaXNfdG9rZW4odmFyLCBDVF9UWVBFKSB8fCBjaHVua19pc190b2tlbih2YXIs
IENUX1dPUkQpKQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKHZhciwg
Q1RfRlVOQ19DVE9SX1ZBUik7CiAgICAgICAgICAgIGZsYWdfcGFyZW5zKHRtcCwgUENGX0lO
X0ZDTl9DQUxMLCBDVF9GUEFSRU5fT1BFTiwgQ1RfRlVOQ19DVE9SX1ZBUiwgZmFsc2UpOwog
ICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1Rf
QlJBQ0VfT1BFTikpCiAgIHsKICAgICAgc2V0X3BhcmVuX3BhcmVudChwYXJlbl9vcGVuLCBD
VF9GVU5DX0NMQVNTX0RFRik7CiAgICAgIHNldF9wYXJlbl9wYXJlbnQodG1wLCBDVF9GVU5D
X0NMQVNTX0RFRik7CiAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogIE1hcmtlZCAnJXMn
IGFzIEZVTkNfQ0xBU1NfREVGIG9uIG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dVxuIiwK
ICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIHBjLT5vcmln
X2xpbmUsIHBjLT5vcmlnX2NvbCk7CiAgIH0KICAgZWxzZQogICB7CiAgICAgIHNldF9jaHVu
a19wYXJlbnQodG1wLCBDVF9GVU5DX0NMQVNTX1BST1RPKTsKICAgICAgc2V0X2NodW5rX3R5
cGUocGMsIENUX0ZVTkNfQ0xBU1NfUFJPVE8pOwogICAgICBMT0dfRk1UKExGQ04sICIlcygl
ZCk6ICBNYXJrZWQgJyVzJyBhcyBGVU5DX0NMQVNTX1BST1RPIG9uIG9yaWdfbGluZSAlenUs
IG9yaWdfY29sICV6dVxuIiwKICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBj
LT50ZXh0KCksIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCk7CiAgIH0KfSAvLyBtYXJr
X2NwcF9jb25zdHJ1Y3RvcgoKCnN0YXRpYyBwY2ZfZmxhZ3NfdCBtYXJrX3doZXJlX2NodW5r
KGNodW5rX3QgKnBjLCBjX3Rva2VuX3QgcGFyZW50X3R5cGUsIHBjZl9mbGFnc190IGZsYWdz
KQp7CiAgIC8qIFRPRE86IHNob3VsZCBoYXZlIG9wdGlvbnMgdG8gY29udHJvbCBzcGFjaW5n
IGFyb3VuZCB0aGUgJzonIGFzIHdlbGwgYXMgbmV3bGluZSBhYmlsaXR5IGZvciB0aGUKICAg
ICogY29uc3RyYWludCBjbGF1c2VzIChzaG91bGQgaXQgYnJlYWsgdXAgYSAnd2hlcmUgQSA6
IEIgd2hlcmUgQyA6IEQnIG9uIHRoZSBzYW1lIGxpbmU/IHdyYXA/IGV0Yy4pICovCgogICBp
ZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1dIRVJFKSkKICAgewogICAgICBzZXRfY2h1bmtf
dHlwZShwYywgQ1RfV0hFUkVfU1BFQyk7CiAgICAgIHNldF9jaHVua19wYXJlbnQocGMsIHBh
cmVudF90eXBlKTsKICAgICAgZmxhZ3MgfD0gUENGX0lOX1dIRVJFX1NQRUM7CiAgICAgIExP
R19GTVQoTEZUT1IsICIlczogd2hlcmUtc3BlYyBvbiBsaW5lICV6dVxuIiwKICAgICAgICAg
ICAgICBfX2Z1bmNfXywgcGMtPm9yaWdfbGluZSk7CiAgIH0KICAgZWxzZSBpZiAoZmxhZ3Mu
dGVzdChQQ0ZfSU5fV0hFUkVfU1BFQykpCiAgIHsKICAgICAgaWYgKGNodW5rX2lzX3N0cihw
YywgIjoiLCAxKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfV0hF
UkVfQ09MT04pOwogICAgICAgICBMT0dfRk1UKExGVE9SLCAiJXM6IHdoZXJlLXNwZWMgY29s
b24gb24gbGluZSAlenVcbiIsCiAgICAgICAgICAgICAgICAgX19mdW5jX18sIHBjLT5vcmln
X2xpbmUpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKChjaHVua19pc190b2tlbihwYywgQ1Rf
U1RSVUNUKSkgfHwgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DTEFTUykpKQogICAgICB7CiAg
ICAgICAgIC8qIGNsYXNzL3N0cnVjdCBpbnNpZGUgb2YgYSB3aGVyZS1jbGF1c2UgY29uZnVz
ZXMgcGFyc2VyIGZvciBpbmRlbnRhdGlvbjsgc2V0IGl0IGFzIGEgd29yZCBzbyBpdCBsb29r
cyBsaWtlIHRoZSByZXN0ICovCiAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9XT1JE
KTsKICAgICAgfQogICB9CgogICBpZiAoZmxhZ3MudGVzdChQQ0ZfSU5fV0hFUkVfU1BFQykp
CiAgIHsKICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHBjLCBQQ0ZfSU5fV0hFUkVfU1BFQyk7CiAg
IH0KICAgcmV0dXJuKGZsYWdzKTsKfQoKCnN0YXRpYyB2b2lkIG1hcmtfY2xhc3NfY3Rvcihj
aHVua190ICpzdGFydCkKewogICBMT0dfRlVOQ19FTlRSWSgpOwoKICAgTE9HX0ZNVChMRlRP
UiwgIiVzKCVkKTogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCBzdGFydCBp
cyAnJXMnLCBwYXJlbnRfdHlwZSBpcyAlc1xuIiwKICAgICAgICAgICBfX2Z1bmNfXywgX19M
SU5FX18sIHN0YXJ0LT5vcmlnX2xpbmUsIHN0YXJ0LT5vcmlnX2NvbCwgc3RhcnQtPnRleHQo
KSwKICAgICAgICAgICBnZXRfdG9rZW5fbmFtZShnZXRfY2h1bmtfcGFyZW50X3R5cGUoc3Rh
cnQpKSk7CiAgIGxvZ19wY2ZfZmxhZ3MoTEZUT1IsIHN0YXJ0LT5mbGFncyk7CgogICBjaHVu
a190ICpwY2xhc3MgPSBjaHVua19nZXRfbmV4dF9uY25sKHN0YXJ0LCBzY29wZV9lOjpQUkVQ
Uk9DKTsKCiAgIExPR19GTVQoTEZUT1IsICIlcyglZCk6IHBjbGFzcyBpcyAnJXMnXG4iLAog
ICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGNsYXNzLT50ZXh0KCkpOwogICBsb2df
cGNmX2ZsYWdzKExGVE9SLCBwY2xhc3MtPmZsYWdzKTsKCiAgIGlmIChsYW5ndWFnZV9pc19z
ZXQoTEFOR19DUFApKQogICB7CiAgICAgIHBjbGFzcyA9IHNraXBfYXR0cmlidXRlX25leHQo
cGNsYXNzKTsKICAgICAgTE9HX0ZNVChMRlRPUiwgIiVzKCVkKTogcGNsYXNzIGlzICclcydc
biIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwY2xhc3MtPnRleHQoKSk7
CiAgIH0KCiAgIGlmIChnZXRfY2h1bmtfcGFyZW50X3R5cGUoc3RhcnQpID09IENUX1RFTVBM
QVRFKQogICB7CiAgICAgIC8vIGxvb2sgYWZ0ZXIgdGhlIGNsYXNzIG5hbWUKICAgICAgY2h1
bmtfdCAqb3BlbmluZ1RlbXBsYXRlID0gY2h1bmtfZ2V0X25leHRfbmNubChwY2xhc3MpOwog
ICAgICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2Nv
bCBpcyAlenUsIG9wZW5pbmdUZW1wbGF0ZSBpcyAnJXMnLCB0eXBlIGlzICVzXG4iLAogICAg
ICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgb3BlbmluZ1RlbXBsYXRlLT5vcmlnX2xp
bmUsIG9wZW5pbmdUZW1wbGF0ZS0+b3JpZ19jb2wsCiAgICAgICAgICAgICAgb3BlbmluZ1Rl
bXBsYXRlLT50ZXh0KCksIGdldF90b2tlbl9uYW1lKG9wZW5pbmdUZW1wbGF0ZS0+dHlwZSkp
OwoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG9wZW5pbmdUZW1wbGF0ZSwgQ1RfQU5HTEVf
T1BFTikpCiAgICAgIHsKICAgICAgICAgY2h1bmtfdCAqY2xvc2luZ1RlbXBsYXRlID0gY2h1
bmtfc2tpcF90b19tYXRjaChvcGVuaW5nVGVtcGxhdGUpOwogICAgICAgICBMT0dfRk1UKExG
VE9SLCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIGNsb3Np
bmdUZW1wbGF0ZSBpcyAnJXMnLCB0eXBlIGlzICVzXG4iLAogICAgICAgICAgICAgICAgIF9f
ZnVuY19fLCBfX0xJTkVfXywgY2xvc2luZ1RlbXBsYXRlLT5vcmlnX2xpbmUsIGNsb3NpbmdU
ZW1wbGF0ZS0+b3JpZ19jb2wsCiAgICAgICAgICAgICAgICAgY2xvc2luZ1RlbXBsYXRlLT50
ZXh0KCksIGdldF90b2tlbl9uYW1lKGNsb3NpbmdUZW1wbGF0ZS0+dHlwZSkpOwogICAgICAg
ICBjaHVua190ICp0aGlyZFRva2VuID0gY2h1bmtfZ2V0X25leHRfbmNubChjbG9zaW5nVGVt
cGxhdGUpOwogICAgICAgICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMg
JXp1LCBvcmlnX2NvbCBpcyAlenUsIHRoaXJkVG9rZW4gaXMgJyVzJywgdHlwZSBpcyAlc1xu
IiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHRoaXJkVG9rZW4tPm9y
aWdfbGluZSwgdGhpcmRUb2tlbi0+b3JpZ19jb2wsCiAgICAgICAgICAgICAgICAgdGhpcmRU
b2tlbi0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZSh0aGlyZFRva2VuLT50eXBlKSk7CgogICAg
ICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odGhpcmRUb2tlbiwgQ1RfRENfTUVNQkVSKSkKICAg
ICAgICAgewogICAgICAgICAgICBwY2xhc3MgPSBjaHVua19nZXRfbmV4dF9uY25sKHRoaXJk
VG9rZW4pOwogICAgICAgICAgICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiBvcmlnX2xpbmUg
aXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHBjbGFzcyBpcyAnJXMnLCB0eXBlIGlzICVzXG4i
LAogICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGNsYXNzLT5vcmln
X2xpbmUsIHBjbGFzcy0+b3JpZ19jb2wsCiAgICAgICAgICAgICAgICAgICAgcGNsYXNzLT50
ZXh0KCksIGdldF90b2tlbl9uYW1lKHBjbGFzcy0+dHlwZSkpOwogICAgICAgICB9CiAgICAg
IH0KICAgfQogICBwY2xhc3MgPSBza2lwX2F0dHJpYnV0ZV9uZXh0KHBjbGFzcyk7CiAgIExP
R19GTVQoTEZUT1IsICIlcyglZCk6IHBjbGFzcyBpcyAnJXMnXG4iLAogICAgICAgICAgIF9f
ZnVuY19fLCBfX0xJTkVfXywgcGNsYXNzLT50ZXh0KCkpOwoKICAgaWYgKGNodW5rX2lzX3Rv
a2VuKHBjbGFzcywgQ1RfREVDTFNQRUMpKSAgLy8gSXNzdWUgMTI4OQogICB7CiAgICAgIHBj
bGFzcyA9IGNodW5rX2dldF9uZXh0X25jbmwocGNsYXNzKTsKICAgICAgTE9HX0ZNVChMRlRP
UiwgIiVzKCVkKTogcGNsYXNzIGlzICclcydcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18s
IF9fTElORV9fLCBwY2xhc3MtPnRleHQoKSk7CgogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4o
cGNsYXNzLCBDVF9QQVJFTl9PUEVOKSkKICAgICAgewogICAgICAgICBwY2xhc3MgPSBjaHVu
a19nZXRfbmV4dF9uY25sKGNodW5rX3NraXBfdG9fbWF0Y2gocGNsYXNzKSk7CiAgICAgICAg
IExPR19GTVQoTEZUT1IsICIlcyglZCk6IHBjbGFzcyBpcyAnJXMnXG4iLAogICAgICAgICAg
ICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGNsYXNzLT50ZXh0KCkpOwogICAgICB9CiAg
IH0KCiAgIGlmICggIHBjbGFzcyA9PSBudWxscHRyCiAgICAgIHx8IChwY2xhc3MtPnR5cGUg
IT0gQ1RfVFlQRSAmJiBwY2xhc3MtPnR5cGUgIT0gQ1RfV09SRCkpCiAgIHsKICAgICAgcmV0
dXJuOwogICB9CiAgIGNodW5rX3QgKm5leHQgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjbGFz
cywgc2NvcGVfZTo6UFJFUFJPQyk7CgogICB3aGlsZSAoICBjaHVua19pc190b2tlbihuZXh0
LCBDVF9UWVBFKQogICAgICAgICB8fCBjaHVua19pc190b2tlbihuZXh0LCBDVF9XT1JEKQog
ICAgICAgICB8fCBjaHVua19pc190b2tlbihuZXh0LCBDVF9EQ19NRU1CRVIpKQogICB7CiAg
ICAgIHBjbGFzcyA9IG5leHQ7CiAgICAgIExPR19GTVQoTEZUT1IsICIlcyglZCk6IHBjbGFz
cyBpcyAnJXMnXG4iLAogICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGNsYXNz
LT50ZXh0KCkpOwogICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0LCBzY29w
ZV9lOjpQUkVQUk9DKTsKICAgfQogICBjaHVua190ICpwYyAgID0gY2h1bmtfZ2V0X25leHRf
bmNubChwY2xhc3MsIHNjb3BlX2U6OlBSRVBST0MpOwogICBzaXplX3QgIGxldmVsID0gcGNs
YXNzLT5icmFjZV9sZXZlbCArIDE7CgogICBpZiAocGMgPT0gbnVsbHB0cikKICAgewogICAg
ICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiBDYWxsZWQgb24gJXMgb24gb3JpZ19saW5lICV6
dS4gQmFpbGVkIG9uIE5VTExcbiIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9f
LCBwY2xhc3MtPnRleHQoKSwgcGNsYXNzLT5vcmlnX2xpbmUpOwogICAgICByZXR1cm47CiAg
IH0KICAgLy8gQWRkIHRoZSBjbGFzcyBuYW1lCiAgIENodW5rU3RhY2sgY3M7CgogICBjcy5Q
dXNoX0JhY2socGNsYXNzKTsKCiAgIExPR19GTVQoTEZUT1IsICIlcyglZCk6IENhbGxlZCBv
biAlcyBvbiBvcmlnX2xpbmUgJXp1IChuZXh0IGlzICclcycpXG4iLAogICAgICAgICAgIF9f
ZnVuY19fLCBfX0xJTkVfXywgcGNsYXNzLT50ZXh0KCksIHBjbGFzcy0+b3JpZ19saW5lLCBw
Yy0+dGV4dCgpKTsKCiAgIC8vIGRldGVjdCBEIHRlbXBsYXRlIGNsYXNzOiAiY2xhc3MgZm9v
KHgpIHsgLi4uIH0iCiAgIGlmIChsYW5ndWFnZV9pc19zZXQoTEFOR19EKSAmJiBjaHVua19p
c190b2tlbihuZXh0LCBDVF9QQVJFTl9PUEVOKSkgICAgICAgICAgICAgIC8vIENvdmVyaXR5
IENJRCA3NjAwNAogICB7CiAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgQ1RfVEVNUExB
VEUpOwoKICAgICAgbmV4dCA9IGdldF9kX3RlbXBsYXRlX3R5cGVzKGNzLCBuZXh0KTsKCiAg
ICAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9QQVJFTl9DTE9TRSkpCiAgICAgIHsK
ICAgICAgICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBDVF9URU1QTEFURSk7CiAgICAgIH0K
ICAgfQogICAvLyBGaW5kIHRoZSBvcGVuIGJyYWNlLCBhYm9ydCBvbiBzZW1pY29sb24KICAg
cGNmX2ZsYWdzX3QgZmxhZ3MgPSBQQ0ZfTk9ORTsKCiAgIHdoaWxlIChwYyAhPSBudWxscHRy
ICYmIHBjLT50eXBlICE9IENUX0JSQUNFX09QRU4pCiAgIHsKICAgICAgTE9HX0ZNVChMRlRP
UiwgIiBbJXNdIiwgcGMtPnRleHQoKSk7CgogICAgICBmbGFncyA9IG1hcmtfd2hlcmVfY2h1
bmsocGMsIHN0YXJ0LT50eXBlLCBmbGFncyk7CgogICAgICBpZiAoIWZsYWdzLnRlc3QoUENG
X0lOX1dIRVJFX1NQRUMpICYmIGNodW5rX2lzX3N0cihwYywgIjoiLCAxKSkKICAgICAgewog
ICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfQ0xBU1NfQ09MT04pOwogICAgICAgICBm
bGFncyB8PSBQQ0ZfSU5fQ0xBU1NfQkFTRTsKICAgICAgICAgTE9HX0ZNVChMRlRPUiwgIiVz
KCVkKTogY2xhc3MgY29sb24gb24gbGluZSAlenVcbiIsCiAgICAgICAgICAgICAgICAgX19m
dW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lKTsKICAgICAgfQoKICAgICAgaWYgKGNo
dW5rX2lzX3NlbWljb2xvbihwYykpCiAgICAgIHsKICAgICAgICAgTE9HX0ZNVChMRlRPUiwg
IiVzKCVkKTogYmFpbGVkIG9uIHNlbWljb2xvbiBvbiBsaW5lICV6dVxuIiwKICAgICAgICAg
ICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUpOwogICAgICAgICBy
ZXR1cm47CiAgICAgIH0KICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHBjLCBmbGFncyk7CiAgICAg
IHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChwYywgc2NvcGVfZTo6UFJFUFJPQyk7CiAgIH0K
CiAgIGlmIChwYyA9PSBudWxscHRyKQogICB7CiAgICAgIExPR19GTVQoTEZUT1IsICIlcygl
ZCk6IGJhaWxlZCBvbiBOVUxMXG4iLCBfX2Z1bmNfXywgX19MSU5FX18pOwogICAgICByZXR1
cm47CiAgIH0KICAgc2V0X3BhcmVuX3BhcmVudChwYywgc3RhcnQtPnR5cGUpOwogICBjaHVu
a19mbGFnc19zZXQocGMsIFBDRl9JTl9DTEFTUyk7CgogICBwYyA9IGNodW5rX2dldF9uZXh0
X25jbmwocGMsIHNjb3BlX2U6OlBSRVBST0MpOwogICBMT0dfRk1UKExGVE9SLCAiJXMoJWQp
OiBwY2xhc3MgaXMgJyVzJ1xuIiwKICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBj
bGFzcy0+dGV4dCgpKTsKCiAgIHdoaWxlIChwYyAhPSBudWxscHRyKQogICB7CiAgICAgIExP
R19GTVQoTEZUT1IsICIlcyglZCk6IHBjIGlzICclcycsIG9yaWdfbGluZSBpcyAlenUsIG9y
aWdfY29sIGlzICV6dVxuIiwKICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBj
LT50ZXh0KCksIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCk7CiAgICAgIGNodW5rX2Zs
YWdzX3NldChwYywgUENGX0lOX0NMQVNTKTsKCiAgICAgIGlmICggIHBjLT5icmFjZV9sZXZl
bCA+IGxldmVsCiAgICAgICAgIHx8IHBjLT5sZXZlbCA+IHBjLT5icmFjZV9sZXZlbAogICAg
ICAgICB8fCBwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykpCiAgICAgIHsKICAgICAg
ICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKICAgICAgICAgY29udGludWU7CiAg
ICAgIH0KCiAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfQlJBQ0VfQ0xPU0UpICYm
IHBjLT5icmFjZV9sZXZlbCA8IGxldmVsKQogICAgICB7CiAgICAgICAgIExPR19GTVQoTEZU
T1IsICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIEhpdCBicmFjZSBjbG9zZVxuIiwKICAg
ICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUpOwogICAg
ICAgICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGMsIHNjb3BlX2U6OlBSRVBST0MpOwoK
ICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TRU1JQ09MT04pKQogICAgICAg
ICB7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQocGMsIHN0YXJ0LT50eXBlKTsKICAg
ICAgICAgfQogICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbmV4dCA9IGNodW5rX2dl
dF9uZXh0X25jbmwocGMsIHNjb3BlX2U6OlBSRVBST0MpOwoKICAgICAgaWYgKGNodW5rc3Rh
Y2tfbWF0Y2goY3MsIHBjKSkKICAgICAgewogICAgICAgICBMT0dfRk1UKExGVE9SLCAiJXMo
JWQpOiBwYyBpcyAnJXMnLCBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenVcbiIs
CiAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+dGV4dCgpLCBwYy0+
b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wpOwogICAgICAgICAvLyBJc3N1ZSAjMTMzMyBGb3Jt
YXR0ZXIgcmVtb3ZlcyBzZW1pY29sb24gYWZ0ZXIgdmFyaWFibGUgaW5pdGlhbGl6ZXIgYXQg
Y2xhc3MgbGV2ZWwoQyMpCiAgICAgICAgIC8vIGlmIHByZXZpb3VzIGNodW5rIGlzICduZXcn
IG9wZXJhdG9yIGl0IGlzIHZhcmlhYmxlIGluaXRpYWxpemVyIG5vdCBhIENMQVNTX0ZVTkNf
REVGLgogICAgICAgICBjaHVua190ICpwcmV2ID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHBj
LCBzY29wZV9lOjpQUkVQUk9DKTsgICAvLyBJc3N1ZSAjMjI3OQogICAgICAgICBMT0dfRk1U
KExGVE9SLCAiJXMoJWQpOiBwcmV2IGlzICclcycsIG9yaWdfbGluZSBpcyAlenUsIG9yaWdf
Y29sIGlzICV6dSwgdHlwZSBpcyAlc1xuIiwKICAgICAgICAgICAgICAgICBfX2Z1bmNfXywg
X19MSU5FX18sIHByZXYtPnRleHQoKSwgcHJldi0+b3JpZ19saW5lLCBwcmV2LT5vcmlnX2Nv
bCwgZ2V0X3Rva2VuX25hbWUocHJldi0+dHlwZSkpOwoKICAgICAgICAgLy8gSXNzdWUgIzEw
MDMsIG5leHQtPnR5cGUgc2hvdWxkIG5vdCBiZSBDVF9GUEFSRU5fT1BFTgogICAgICAgICBp
ZiAoICBwcmV2ICE9IG51bGxwdHIKICAgICAgICAgICAgJiYgKHByZXYtPnR5cGUgIT0gQ1Rf
TkVXKSkKICAgICAgICAgewogICAgICAgICAgICBib29sIGlzX2Z1bmNfY2xhc3NfZGVmID0g
ZmFsc2U7CgogICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfUEFSRU5f
T1BFTikpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgaXNfZnVuY19jbGFzc19kZWYg
PSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rv
a2VuKG5leHQsIENUX0FOR0xFX09QRU4pKSAgICAgICAgICAvLyBJc3N1ZSAjIDE3MzcKICAg
ICAgICAgICAgewogICAgICAgICAgICAgICBjaHVua190ICpjbG9zZUFuZ2xlICAgID0gY2h1
bmtfc2tpcF90b19tYXRjaChuZXh0KTsKICAgICAgICAgICAgICAgY2h1bmtfdCAqYWZ0ZXJU
ZW1wbGF0ZSA9IGNodW5rX2dldF9uZXh0KGNsb3NlQW5nbGUpOwoKICAgICAgICAgICAgICAg
aWYgKGNodW5rX2lzX3Rva2VuKGFmdGVyVGVtcGxhdGUsIENUX1BBUkVOX09QRU4pKQogICAg
ICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGlzX2Z1bmNfY2xhc3NfZGVmID0gdHJ1
ZTsKICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAg
ICAgICAgICAgewogICAgICAgICAgICAgICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiB0ZXh0
KCkgaXMgJyVzJywgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0eXBlIGlz
ICVzXG4iLAogICAgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMt
PnRleHQoKSwgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBnZXRfdG9rZW5fbmFtZShw
Yy0+dHlwZSkpOwogICAgICAgICAgICAgICBtYWtlX3R5cGUocGMpOwogICAgICAgICAgICB9
CgogICAgICAgICAgICBpZiAoaXNfZnVuY19jbGFzc19kZWYpCiAgICAgICAgICAgIHsKICAg
ICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0ZVTkNfQ0xBU1NfREVGKTsKICAg
ICAgICAgICAgICAgTE9HX0ZNVChMRlRPUiwgIiVzKCVkKTogdGV4dCgpIGlzICclcycsIG9y
aWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdHlwZSBpcyAlcywgTWFya2VkIENU
b3IvRFRvclxuIiwKICAgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18s
IHBjLT50ZXh0KCksIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgZ2V0X3Rva2VuX25h
bWUocGMtPnR5cGUpKTsKICAgICAgICAgICAgICAgbWFya19jcHBfY29uc3RydWN0b3IocGMp
OwogICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgfQogICAgICBwYyA9IG5leHQ7CiAg
IH0KfSAvLyBtYXJrX2NsYXNzX2N0b3IKCgpzdGF0aWMgY2h1bmtfdCAqc2tpcF9hbGlnbihj
aHVua190ICpzdGFydCkKewogICBjaHVua190ICpwYyA9IHN0YXJ0OwoKICAgaWYgKGNodW5r
X2lzX3Rva2VuKHBjLCBDVF9BTElHTikpCiAgIHsKICAgICAgcGMgPSBjaHVua19nZXRfbmV4
dF9uY25sKHBjKTsKCiAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfUEFSRU5fT1BF
TikpCiAgICAgIHsKICAgICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF90eXBlKHBjLCBDVF9Q
QVJFTl9DTE9TRSwgcGMtPmxldmVsKTsKICAgICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9u
Y25sKHBjKTsKCiAgICAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfQ09MT04pKQog
ICAgICAgICB7CiAgICAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7CiAg
ICAgICAgIH0KICAgICAgfQogICB9CiAgIHJldHVybihwYyk7Cn0KCgpjaHVua190ICpza2lw
X3BhcmVudF90eXBlcyhjaHVua190ICpjb2xvbikKewogICBhdXRvIHBjID0gY2h1bmtfZ2V0
X25leHRfbmNubG5wKGNvbG9uKTsKCiAgIHdoaWxlIChwYykKICAgewogICAgICAvLyBTa2lw
IGFjY2VzcyBzcGVjaWZpZXIKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BQ0NF
U1MpKQogICAgICB7CiAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRfbmNubG5wKHBjKTsK
ICAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIC8vIENoZWNrIGZvciBhIHR5cGUg
bmFtZQogICAgICBpZiAoIShjaHVua19pc190b2tlbihwYywgQ1RfV09SRCkgfHwgY2h1bmtf
aXNfdG9rZW4ocGMsIENUX1RZUEUpKSkKICAgICAgewogICAgICAgICBMT0dfRk1UKExQQ1Us
CiAgICAgICAgICAgICAgICAgIiVzIGlzIGNvbmZ1c2VkOyBleHBlY3RlZCBhIHdvcmQgYXQg
JXp1OiV6dSAiCiAgICAgICAgICAgICAgICAgImZvbGxvd2luZyB0eXBlIGxpc3QgYXQgJXp1
OiV6dVxuIiwgX19mdW5jX18sCiAgICAgICAgICAgICAgICAgY29sb24tPm9yaWdfbGluZSwg
Y29sb24tPm9yaWdfY29sLAogICAgICAgICAgICAgICAgIHBjLT5vcmlnX2xpbmUsIHBjLT5v
cmlnX2NvbCk7CiAgICAgICAgIHJldHVybihjb2xvbik7CiAgICAgIH0KICAgICAgLy8gR2V0
IG5leHQgdG9rZW4KICAgICAgYXV0byBuZXh0ID0gc2tpcF90ZW1wbGF0ZV9uZXh0KGNodW5r
X2dldF9uZXh0X25jbmxucChwYykpOwoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQs
IENUX0RDX01FTUJFUikgfHwgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfQ09NTUEpKQogICAg
ICB7CiAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRfbmNubG5wKG5leHQpOwogICAgICB9
CiAgICAgIGVsc2UgaWYgKG5leHQpCiAgICAgIHsKICAgICAgICAgTE9HX0ZNVChMUENVLCAi
JXMgLT4gJXp1OiV6dSAoJyVzJylcbiIsIF9fZnVuY19fLAogICAgICAgICAgICAgICAgIG5l
eHQtPm9yaWdfbGluZSwgbmV4dC0+b3JpZ19jb2wsIG5leHQtPnRleHQoKSk7CiAgICAgICAg
IHJldHVybihuZXh0KTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAgYnJl
YWs7CiAgICAgIH0KICAgfQogICBMT0dfRk1UKExQQ1UsICIlczogZGlkIG5vdCBmaW5kIGVu
ZCBvZiB0eXBlIGxpc3QgKHN0YXJ0IHdhcyAlenU6JXp1KVxuIiwKICAgICAgICAgICBfX2Z1
bmNfXywgY29sb24tPm9yaWdfbGluZSwgY29sb24tPm9yaWdfY29sKTsKICAgcmV0dXJuKGNv
bG9uKTsKfSAvLyBza2lwX3BhcmVudF90eXBlcwoKCnN0YXRpYyB2b2lkIG1hcmtfc3RydWN0
X3VuaW9uX2JvZHkoY2h1bmtfdCAqc3RhcnQpCnsKICAgTE9HX0ZVTkNfRU5UUlkoKTsKICAg
Y2h1bmtfdCAqcGMgPSBzdGFydDsKCiAgIHdoaWxlICggIHBjICE9IG51bGxwdHIKICAgICAg
ICAgJiYgcGMtPmxldmVsID49IHN0YXJ0LT5sZXZlbAogICAgICAgICAmJiAhKHBjLT5sZXZl
bCA9PSBzdGFydC0+bGV2ZWwgJiYgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0JSQUNFX0NMT1NF
KSkpCiAgIHsKICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0JSQUNFX09QRU4p
CiAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9CUkFDRV9DTE9TRSkKICAgICAg
ICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NFTUlDT0xPTikpCiAgICAgIHsKICAgICAg
ICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKCiAgICAgICAgIGlmIChwYyA9PSBu
dWxscHRyKQogICAgICAgICB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAgICAg
IH0KCiAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfQUxJR04pKQogICAgICB7CiAg
ICAgICAgIHBjID0gc2tpcF9hbGlnbihwYyk7IC8vICJhbGlnbih4KSIgb3IgImFsaWduKHgp
OiIKCiAgICAgICAgIGlmIChwYyA9PSBudWxscHRyKQogICAgICAgICB7CiAgICAgICAgICAg
IGJyZWFrOwogICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAg
IHBjID0gZml4X3ZhcmlhYmxlX2RlZmluaXRpb24ocGMpOwoKICAgICAgICAgaWYgKHBjID09
IG51bGxwdHIpCiAgICAgICAgIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgIH0KICAg
ICAgfQogICB9Cn0gLy8gbWFya19zdHJ1Y3RfdW5pb25fYm9keQoKCnZvaWQgbWFya19jb21t
ZW50cyh2b2lkKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CgogICBjcGQudW5jX3N0YWdlID0g
dW5jX3N0YWdlX2U6Ok1BUktfQ09NTUVOVFM7CgogICBib29sICAgIHByZXZfbmwgPSB0cnVl
OwogICBjaHVua190ICpjdXIgICAgPSBjaHVua19nZXRfaGVhZCgpOwoKICAgd2hpbGUgKGN1
ciAhPSBudWxscHRyKQogICB7CiAgICAgIGNodW5rX3QgKm5leHQgICA9IGNodW5rX2dldF9u
ZXh0X252YihjdXIpOwogICAgICBib29sICAgIG5leHRfbmwgPSAobmV4dCA9PSBudWxscHRy
KSB8fCBjaHVua19pc19uZXdsaW5lKG5leHQpOwoKICAgICAgaWYgKGNodW5rX2lzX2NvbW1l
bnQoY3VyKSkKICAgICAgewogICAgICAgICBpZiAobmV4dF9ubCAmJiBwcmV2X25sKQogICAg
ICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQoY3VyLCBDVF9DT01NRU5UX1dI
T0xFKTsKICAgICAgICAgfQogICAgICAgICBlbHNlIGlmIChuZXh0X25sKQogICAgICAgICB7
CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQoY3VyLCBDVF9DT01NRU5UX0VORCk7CiAg
ICAgICAgIH0KICAgICAgICAgZWxzZSBpZiAocHJldl9ubCkKICAgICAgICAgewogICAgICAg
ICAgICBzZXRfY2h1bmtfcGFyZW50KGN1ciwgQ1RfQ09NTUVOVF9TVEFSVCk7CiAgICAgICAg
IH0KICAgICAgICAgZWxzZQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJl
bnQoY3VyLCBDVF9DT01NRU5UX0VNQkVEKTsKICAgICAgICAgfQogICAgICB9CiAgICAgIHBy
ZXZfbmwgPSBjaHVua19pc19uZXdsaW5lKGN1cik7CiAgICAgIGN1ciAgICAgPSBuZXh0Owog
ICB9Cn0KCgpzdGF0aWMgdm9pZCBtYXJrX2RlZmluZV9leHByZXNzaW9ucyh2b2lkKQp7CiAg
IExPR19GVU5DX0VOVFJZKCk7CgogICBib29sICAgIGluX2RlZmluZSA9IGZhbHNlOwogICBi
b29sICAgIGZpcnN0ICAgICA9IHRydWU7CiAgIGNodW5rX3QgKnBjICAgICAgID0gY2h1bmtf
Z2V0X2hlYWQoKTsKICAgY2h1bmtfdCAqcHJldiAgICAgPSBwYzsKCiAgIHdoaWxlIChwYyAh
PSBudWxscHRyKQogICB7CiAgICAgIGlmICghaW5fZGVmaW5lKQogICAgICB7CiAgICAgICAg
IGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9QUF9ERUZJTkUpCiAgICAgICAgICAgIHx8
IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9QUF9JRikKICAgICAgICAgICAgfHwgY2h1bmtfaXNf
dG9rZW4ocGMsIENUX1BQX0VMU0UpKQogICAgICAgICB7CiAgICAgICAgICAgIGluX2RlZmlu
ZSA9IHRydWU7CiAgICAgICAgICAgIGZpcnN0ICAgICA9IHRydWU7CiAgICAgICAgIH0KICAg
ICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAgaWYgKCFwYy0+ZmxhZ3MudGVzdChQ
Q0ZfSU5fUFJFUFJPQykgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1BSRVBST0MpKQogICAg
ICAgICB7CiAgICAgICAgICAgIGluX2RlZmluZSA9IGZhbHNlOwogICAgICAgICB9CiAgICAg
ICAgIGVsc2UKICAgICAgICAgewogICAgICAgICAgICBpZiAoICBwYy0+dHlwZSAhPSBDVF9N
QUNSTwogICAgICAgICAgICAgICAmJiAoICBmaXJzdAogICAgICAgICAgICAgICAgICB8fCBj
aHVua19pc190b2tlbihwcmV2LCBDVF9QQVJFTl9PUEVOKQogICAgICAgICAgICAgICAgICB8
fCBjaHVua19pc190b2tlbihwcmV2LCBDVF9BUklUSCkKICAgICAgICAgICAgICAgICAgfHwg
Y2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfQ0FSRVQpCiAgICAgICAgICAgICAgICAgIHx8IGNo
dW5rX2lzX3Rva2VuKHByZXYsIENUX0FTU0lHTikKICAgICAgICAgICAgICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4ocHJldiwgQ1RfQ09NUEFSRSkKICAgICAgICAgICAgICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4ocHJldiwgQ1RfUkVUVVJOKQogICAgICAgICAgICAgICAgICB8fCBjaHVu
a19pc190b2tlbihwcmV2LCBDVF9HT1RPKQogICAgICAgICAgICAgICAgICB8fCBjaHVua19p
c190b2tlbihwcmV2LCBDVF9DT05USU5VRSkKICAgICAgICAgICAgICAgICAgfHwgY2h1bmtf
aXNfdG9rZW4ocHJldiwgQ1RfRlBBUkVOX09QRU4pCiAgICAgICAgICAgICAgICAgIHx8IGNo
dW5rX2lzX3Rva2VuKHByZXYsIENUX1NQQVJFTl9PUEVOKQogICAgICAgICAgICAgICAgICB8
fCBjaHVua19pc190b2tlbihwcmV2LCBDVF9CUkFDRV9PUEVOKQogICAgICAgICAgICAgICAg
ICB8fCBjaHVua19pc19zZW1pY29sb24ocHJldikKICAgICAgICAgICAgICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4ocHJldiwgQ1RfQ09NTUEpCiAgICAgICAgICAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHByZXYsIENUX0NPTE9OKQogICAgICAgICAgICAgICAgICB8fCBjaHVua19p
c190b2tlbihwcmV2LCBDVF9RVUVTVElPTikpKQogICAgICAgICAgICB7CiAgICAgICAgICAg
ICAgIGNodW5rX2ZsYWdzX3NldChwYywgUENGX0VYUFJfU1RBUlQpOwogICAgICAgICAgICAg
ICBmaXJzdCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgfQogICAg
ICBwcmV2ID0gcGM7CiAgICAgIHBjICAgPSBjaHVua19nZXRfbmV4dChwYyk7CiAgIH0KfSAv
LyBtYXJrX2RlZmluZV9leHByZXNzaW9ucwoKCnN0YXRpYyB2b2lkIGhhbmRsZV9jcHBfdGVt
cGxhdGUoY2h1bmtfdCAqcGMpCnsKICAgTE9HX0ZVTkNfRU5UUlkoKTsKCiAgIGNodW5rX3Qg
KnRtcCA9IGNodW5rX2dldF9uZXh0X25jbmwocGMpOwoKICAgaWYgKHRtcC0+dHlwZSAhPSBD
VF9BTkdMRV9PUEVOKQogICB7CiAgICAgIHJldHVybjsKICAgfQogICBzZXRfY2h1bmtfcGFy
ZW50KHRtcCwgQ1RfVEVNUExBVEUpOwoKICAgc2l6ZV90IGxldmVsID0gdG1wLT5sZXZlbDsK
CiAgIHdoaWxlICgodG1wID0gY2h1bmtfZ2V0X25leHQodG1wKSkgIT0gbnVsbHB0cikKICAg
ewogICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9DTEFTUykgfHwgY2h1bmtfaXNf
dG9rZW4odG1wLCBDVF9TVFJVQ1QpKQogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBl
KHRtcCwgQ1RfVFlQRSk7CiAgICAgIH0KICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4o
dG1wLCBDVF9BTkdMRV9DTE9TRSkgJiYgdG1wLT5sZXZlbCA9PSBsZXZlbCkKICAgICAgewog
ICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfVEVNUExBVEUpOwogICAgICAgICBi
cmVhazsKICAgICAgfQogICB9CgogICBpZiAodG1wICE9IG51bGxwdHIpCiAgIHsKICAgICAg
dG1wID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXApOwoKICAgICAgaWYgKGNodW5rX2lzX3Rv
a2VuKHRtcCwgQ1RfQ0xBU1MpIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfU1RSVUNUKSkK
ICAgICAgewogICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfVEVNUExBVEUpOwoK
ICAgICAgICAgLy8gUkVWSVNJVDogVGhpcyBtYXkgYmUgYSBiaXQgcmlza3kgLSBtaWdodCBu
ZWVkIHRvIHRyYWNrIHRoZSB7IH07CiAgICAgICAgIHRtcCA9IGNodW5rX2dldF9uZXh0X3R5
cGUodG1wLCBDVF9TRU1JQ09MT04sIHRtcC0+bGV2ZWwpOwoKICAgICAgICAgaWYgKHRtcCAh
PSBudWxscHRyKQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1w
LCBDVF9URU1QTEFURSk7CiAgICAgICAgIH0KICAgICAgfQogICB9Cn0gLy8gaGFuZGxlX2Nw
cF90ZW1wbGF0ZQoKCnN0YXRpYyB2b2lkIGhhbmRsZV9jcHBfbGFtYmRhKGNodW5rX3QgKnNx
X28pCnsKICAgTE9HX0ZVTkNfRU5UUlkoKTsKCiAgIGNodW5rX3QgKnJldCA9IG51bGxwdHI7
CgogICAvLyBhYm9ydCBpZiB0eXBlIG9mIHRoZSBwcmV2aW91cyB0b2tlbiBpcyBub3QgY29u
dGFpbmVkIGluIHRoaXMgd2hpdGVsaXN0CiAgIGNodW5rX3QgKnByZXYgPSBjaHVua19nZXRf
cHJldl9uY25sbmkoc3Ffbyk7ICAgLy8gSXNzdWUgIzIyNzkKCiAgIGlmICggIHByZXYgPT0g
bnVsbHB0cgogICAgICB8fCAoICBwcmV2LT50eXBlICE9IENUX0FTU0lHTgogICAgICAgICAm
JiBwcmV2LT50eXBlICE9IENUX0NPTU1BCiAgICAgICAgICYmIHByZXYtPnR5cGUgIT0gQ1Rf
UEFSRU5fT1BFTiAgIC8vIGFsbG93IEpzIGxpa2Ugc2VsZiBpbnZva2luZyBsYW1iZGEgc3lu
dGF4OiAoW10oKXt9KSgpOwogICAgICAgICAmJiBwcmV2LT50eXBlICE9IENUX0ZQQVJFTl9P
UEVOCiAgICAgICAgICYmIHByZXYtPnR5cGUgIT0gQ1RfU1FVQVJFX09QRU4KICAgICAgICAg
JiYgcHJldi0+dHlwZSAhPSBDVF9CUkFDRV9PUEVOCiAgICAgICAgICYmIHByZXYtPnR5cGUg
IT0gQ1RfU0VNSUNPTE9OCiAgICAgICAgICYmIHByZXYtPnR5cGUgIT0gQ1RfUkVUVVJOKSkK
ICAgewogICAgICByZXR1cm47CiAgIH0KICAgY2h1bmtfdCAqc3FfYyA9IHNxX287IC8vIGFz
c3VtaW5nICdbXScKCiAgIGlmIChjaHVua19pc190b2tlbihzcV9vLCBDVF9TUVVBUkVfT1BF
TikpCiAgIHsKICAgICAgLy8gbWFrZSBzdXJlIHRoZXJlIGlzIGEgJ10nCiAgICAgIHNxX2Mg
PSBjaHVua19za2lwX3RvX21hdGNoKHNxX28pOwoKICAgICAgaWYgKCFzcV9jKQogICAgICB7
CiAgICAgICAgIHJldHVybjsKICAgICAgfQogICB9CiAgIGNodW5rX3QgKnBhX28gPSBjaHVu
a19nZXRfbmV4dF9uY25sKHNxX2MpOwoKICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZXJlIGlz
IGEgbGFtYmRhLXNwZWNpZmllciBpbiB0aGUgcGFfbyBjaHVuazsKICAgLy8gYXNzdW1pbmcg
Y2h1bmsgaXMgQ1RfRVhFQ1VUSU9OX0NPTlRFWFQsIGlnbm9yZSBsYW1iZGEtc3BlY2lmaWVy
CiAgIHdoaWxlIChwYV9vLT50eXBlID09IENUX0VYRUNVVElPTl9DT05URVhUKQogICB7CiAg
ICAgIC8vIHNldCBwYV9vIHRvIG5leHQgY2h1bmsgYWZ0ZXIgdGhpcyBzcGVjaWZpZXIKICAg
ICAgcGFfbyA9IGNodW5rX2dldF9uZXh0X25jbmwocGFfbyk7CiAgIH0KCiAgIGlmIChwYV9v
ID09IG51bGxwdHIpCiAgIHsKICAgICAgcmV0dXJuOwogICB9CiAgIGNodW5rX3QgKnBhX2Mg
PSBudWxscHRyOwoKICAgLy8gbGFtYmRhLWRlY2xhcmF0b3IgJyggcGFyYW1zICknIGlzIG9w
dGlvbmFsCiAgIGlmIChjaHVua19pc190b2tlbihwYV9vLCBDVF9QQVJFTl9PUEVOKSkKICAg
ewogICAgICAvLyBhbmQgbm93IGZpbmQgdGhlICcpJwogICAgICBwYV9jID0gY2h1bmtfc2tp
cF90b19tYXRjaChwYV9vKTsKCiAgICAgIGlmIChwYV9jID09IG51bGxwdHIpCiAgICAgIHsK
ICAgICAgICAgcmV0dXJuOwogICAgICB9CiAgIH0KICAgLy8gQ2hlY2sgZm9yICdtdXRhYmxl
JyBrZXl3b3JkOiAnW10oKSBtdXRhYmxlIHt9JyBvciBbXSgpIG11dGFibGUgLT4gcmV0IHt9
CiAgIGNodW5rX3QgKmJyX28gPSBwYV9jID8gY2h1bmtfZ2V0X25leHRfbmNubChwYV9jKSA6
IHBhX287CgogICBpZiAoY2h1bmtfaXNfc3RyKGJyX28sICJtdXRhYmxlIiwgNykpCiAgIHsK
ICAgICAgYnJfbyA9IGNodW5rX2dldF9uZXh0X25jbmwoYnJfbyk7CiAgIH0KICAgLy9UT0RP
OiBhbHNvIGNoZWNrIGZvciBleGNlcHRpb24gYW5kIGF0dHJpYnV0ZSBiZXR3ZWVuIFtdIC4u
LiB7fQoKICAgLy8gc2tpcCBwb3NzaWJsZSBhcnJvdyBzeW50YXg6ICctPiByZXQnCiAgIGlm
IChjaHVua19pc19zdHIoYnJfbywgIi0+IiwgMikpCiAgIHsKICAgICAgcmV0ID0gYnJfbzsK
ICAgICAgLy8gUkVWSVNJVDogcmVhbGx5IHNob3VsZCBjaGVjayB0aGUgc3R1ZmYgd2UgYXJl
IHNraXBwaW5nCiAgICAgIGJyX28gPSBjaHVua19nZXRfbmV4dF90eXBlKGJyX28sIENUX0JS
QUNFX09QRU4sIGJyX28tPmxldmVsKTsKICAgfQoKICAgaWYgKCAgYnJfbyA9PSBudWxscHRy
CiAgICAgIHx8IGJyX28tPnR5cGUgIT0gQ1RfQlJBQ0VfT1BFTikKICAgewogICAgICByZXR1
cm47CiAgIH0KICAgLy8gYW5kIG5vdyBmaW5kIHRoZSAnfScKICAgY2h1bmtfdCAqYnJfYyA9
IGNodW5rX3NraXBfdG9fbWF0Y2goYnJfbyk7CgogICBpZiAoYnJfYyA9PSBudWxscHRyKQog
ICB7CiAgICAgIHJldHVybjsKICAgfQoKICAgLy8gVGhpcyBsb29rcyBsaWtlIGEgbGFtYmRh
IGV4cHJlc3Npb24KICAgaWYgKGNodW5rX2lzX3Rva2VuKHNxX28sIENUX1RTUVVBUkUpKQog
ICB7CiAgICAgIC8vIHNwbGl0IGludG8gdHdvIGNodW5rcwogICAgICBjaHVua190IG5jOwoK
ICAgICAgbmMgPSAqc3FfbzsKICAgICAgc2V0X2NodW5rX3R5cGUoc3FfbywgQ1RfU1FVQVJF
X09QRU4pOwogICAgICBzcV9vLT5zdHIucmVzaXplKDEpOwogICAgICAvKgogICAgICAgKiBi
dWcgIyA2NjQKICAgICAgICoKICAgICAgICogVGhlIG9yaWdpbmFsIG9yaWdfY29sIG9mIENU
X1NRVUFSRV9DTE9TRSBpcyBzdG9yZWQgYXQgb3JpZ19jb2xfZW5kCiAgICAgICAqIG9mIENU
X1RTUVVBUkUuIENUX1NRVUFSRV9DTE9TRSBvcmlnX2NvbCBhbmQgb3JpZ19jb2xfZW5kIHZh
bHVlcwogICAgICAgKiBhcmUgY2FsY3VsYXRlIGZyb20gb3JpZ19jb2xfZW5kIG9mIENUX1RT
UVVBUkUuCiAgICAgICAqLwogICAgICBuYy5vcmlnX2NvbCAgICAgICAgPSBzcV9vLT5vcmln
X2NvbF9lbmQgLSAxOwogICAgICBuYy5jb2x1bW4gICAgICAgICAgPSBzdGF0aWNfY2FzdDxp
bnQ+KG5jLm9yaWdfY29sKTsKICAgICAgbmMub3JpZ19jb2xfZW5kICAgID0gc3Ffby0+b3Jp
Z19jb2xfZW5kOwogICAgICBzcV9vLT5vcmlnX2NvbF9lbmQgPSBzcV9vLT5vcmlnX2NvbCAr
IDE7CgogICAgICBzZXRfY2h1bmtfdHlwZSgmbmMsIENUX1NRVUFSRV9DTE9TRSk7CiAgICAg
IG5jLnN0ci5wb3BfZnJvbnQoKTsKICAgICAgc3FfYyA9IGNodW5rX2FkZF9hZnRlcigmbmMs
IHNxX28pOwogICB9CiAgIHNldF9jaHVua19wYXJlbnQoc3FfbywgQ1RfQ1BQX0xBTUJEQSk7
CiAgIHNldF9jaHVua19wYXJlbnQoc3FfYywgQ1RfQ1BQX0xBTUJEQSk7CgogICBpZiAocGFf
YyAhPSBudWxscHRyKQogICB7CiAgICAgIHNldF9jaHVua190eXBlKHBhX28sIENUX0ZQQVJF
Tl9PUEVOKTsKICAgICAgc2V0X2NodW5rX3BhcmVudChwYV9vLCBDVF9DUFBfTEFNQkRBKTsK
ICAgICAgc2V0X2NodW5rX3R5cGUocGFfYywgQ1RfRlBBUkVOX0NMT1NFKTsKICAgICAgc2V0
X2NodW5rX3BhcmVudChwYV9jLCBDVF9DUFBfTEFNQkRBKTsKICAgfQogICBzZXRfY2h1bmtf
cGFyZW50KGJyX28sIENUX0NQUF9MQU1CREEpOwogICBzZXRfY2h1bmtfcGFyZW50KGJyX2Ms
IENUX0NQUF9MQU1CREEpOwoKICAgaWYgKHJldCAhPSBudWxscHRyKQogICB7CiAgICAgIHNl
dF9jaHVua190eXBlKHJldCwgQ1RfQ1BQX0xBTUJEQV9SRVQpOwogICAgICByZXQgPSBjaHVu
a19nZXRfbmV4dF9uY25sKHJldCk7CgogICAgICB3aGlsZSAocmV0ICE9IGJyX28pCiAgICAg
IHsKICAgICAgICAgbWFrZV90eXBlKHJldCk7CiAgICAgICAgIHJldCA9IGNodW5rX2dldF9u
ZXh0X25jbmwocmV0KTsKICAgICAgfQogICB9CgogICBpZiAocGFfYyAhPSBudWxscHRyKQog
ICB7CiAgICAgIGZpeF9mY25fZGVmX3BhcmFtcyhwYV9vKTsKICAgfQogICAvL2hhbmRsZSBz
ZWxmIGNhbGxpbmcgbGFtYmRhIHBhcmVuCiAgIGNodW5rX3QgKmNhbGxfcGFfbyA9IGNodW5r
X2dldF9uZXh0X25jbmwoYnJfYyk7CgogICBpZiAoY2h1bmtfaXNfdG9rZW4oY2FsbF9wYV9v
LCBDVF9QQVJFTl9PUEVOKSkKICAgewogICAgICBjaHVua190ICpjYWxsX3BhX2MgPSBjaHVu
a19za2lwX3RvX21hdGNoKGNhbGxfcGFfbyk7CgogICAgICBpZiAoY2FsbF9wYV9jICE9IG51
bGxwdHIpCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5cGUoY2FsbF9wYV9vLCBDVF9G
UEFSRU5fT1BFTik7CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQoY2FsbF9wYV9vLCBDVF9G
VU5DX0NBTEwpOwogICAgICAgICBzZXRfY2h1bmtfdHlwZShjYWxsX3BhX2MsIENUX0ZQQVJF
Tl9DTE9TRSk7CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQoY2FsbF9wYV9jLCBDVF9GVU5D
X0NBTEwpOwogICAgICB9CiAgIH0KfSAvLyBoYW5kbGVfY3BwX2xhbWJkYQoKCnN0YXRpYyBj
aHVua190ICpnZXRfZF90ZW1wbGF0ZV90eXBlcyhDaHVua1N0YWNrICZjcywgY2h1bmtfdCAq
b3Blbl9wYXJlbikKewogICBMT0dfRlVOQ19FTlRSWSgpOwogICBjaHVua190ICp0bXAgICAg
ICAgPSBvcGVuX3BhcmVuOwogICBib29sICAgIG1heWJlX3R5cGUgPSB0cnVlOwoKICAgd2hp
bGUgKCAgKCh0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcCkpICE9IG51bGxwdHIpCiAg
ICAgICAgICYmIHRtcC0+bGV2ZWwgPiBvcGVuX3BhcmVuLT5sZXZlbCkKICAgewogICAgICBp
ZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9UWVBFKSB8fCBjaHVua19pc190b2tlbih0bXAs
IENUX1dPUkQpKQogICAgICB7CiAgICAgICAgIGlmIChtYXliZV90eXBlKQogICAgICAgICB7
CiAgICAgICAgICAgIG1ha2VfdHlwZSh0bXApOwogICAgICAgICAgICBjcy5QdXNoX0JhY2so
dG1wKTsKICAgICAgICAgfQogICAgICAgICBtYXliZV90eXBlID0gZmFsc2U7CiAgICAgIH0K
ICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9DT01NQSkpCiAgICAgIHsK
ICAgICAgICAgbWF5YmVfdHlwZSA9IHRydWU7CiAgICAgIH0KICAgfQogICByZXR1cm4odG1w
KTsKfQoKCnN0YXRpYyBib29sIGNodW5rc3RhY2tfbWF0Y2goQ2h1bmtTdGFjayAmY3MsIGNo
dW5rX3QgKnBjKQp7CiAgIGZvciAoc2l6ZV90IGlkeCA9IDA7IGlkeCA8IGNzLkxlbigpOyBp
ZHgrKykKICAgewogICAgICBjaHVua190ICp0bXAgPSBjcy5HZXRDaHVuayhpZHgpOwoKICAg
ICAgaWYgKHBjLT5zdHIuZXF1YWxzKHRtcC0+c3RyKSkKICAgICAgewogICAgICAgICByZXR1
cm4odHJ1ZSk7CiAgICAgIH0KICAgfQoKICAgcmV0dXJuKGZhbHNlKTsKfQoKCnN0YXRpYyB2
b2lkIGhhbmRsZV9kX3RlbXBsYXRlKGNodW5rX3QgKnBjKQp7CiAgIExPR19GVU5DX0VOVFJZ
KCk7CgogICBjaHVua190ICpuYW1lID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7CiAgIGNo
dW5rX3QgKnBvICAgPSBjaHVua19nZXRfbmV4dF9uY25sKG5hbWUpOwoKICAgLy9pZiAoIW5h
bWUgfHwgKG5hbWUtPnR5cGUgIT0gQ1RfV09SRCAmJiBuYW1lLT50eXBlICE9IENUX1dPUkQp
KSAgQ292ZXJpdHkgQ0lEIDc2MDAwIFNhbWUgb24gYm90aCBzaWRlcywgMjAxNi0wMy0xNgog
ICBpZiAoIW5hbWUgfHwgbmFtZS0+dHlwZSAhPSBDVF9XT1JEKQogICB7CiAgICAgIC8vIFRP
RE86IGxvZyBhbiBlcnJvciwgZXhwZWN0ZWQgTkFNRQogICAgICByZXR1cm47CiAgIH0KCiAg
IGlmICggIHBvID09IG51bGxwdHIKICAgICAgfHwgcG8tPnR5cGUgIT0gQ1RfUEFSRU5fT1BF
TikKICAgewogICAgICAvLyBUT0RPOiBsb2cgYW4gZXJyb3IsIGV4cGVjdGVkICcoJwogICAg
ICByZXR1cm47CiAgIH0KICAgc2V0X2NodW5rX3R5cGUobmFtZSwgQ1RfVFlQRSk7CiAgIHNl
dF9jaHVua19wYXJlbnQobmFtZSwgQ1RfVEVNUExBVEUpOwogICBzZXRfY2h1bmtfcGFyZW50
KHBvLCBDVF9URU1QTEFURSk7CgogICBDaHVua1N0YWNrIGNzOwogICBjaHVua190ICAgICp0
bXAgPSBnZXRfZF90ZW1wbGF0ZV90eXBlcyhjcywgcG8pOwoKICAgaWYgKCAgdG1wID09IG51
bGxwdHIKICAgICAgfHwgdG1wLT50eXBlICE9IENUX1BBUkVOX0NMT1NFKQogICB7CiAgICAg
IC8vIFRPRE86IGxvZyBhbiBlcnJvciwgZXhwZWN0ZWQgJyknCiAgICAgIHJldHVybjsKICAg
fQogICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfVEVNUExBVEUpOwoKICAgdG1wID0gY2h1
bmtfZ2V0X25leHRfbmNubCh0bXApOwoKICAgaWYgKHRtcC0+dHlwZSAhPSBDVF9CUkFDRV9P
UEVOKQogICB7CiAgICAgIC8vIFRPRE86IGxvZyBhbiBlcnJvciwgZXhwZWN0ZWQgJ3snCiAg
ICAgIHJldHVybjsKICAgfQogICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfVEVNUExBVEUp
OwogICBwbyA9IHRtcDsKCiAgIHRtcCA9IHBvOwoKICAgd2hpbGUgKCAgKCh0bXAgPSBjaHVu
a19nZXRfbmV4dF9uY25sKHRtcCkpICE9IG51bGxwdHIpCiAgICAgICAgICYmIHRtcC0+bGV2
ZWwgPiBwby0+bGV2ZWwpCiAgIHsKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1Rf
V09SRCkgJiYgY2h1bmtzdGFja19tYXRjaChjcywgdG1wKSkKICAgICAgewogICAgICAgICBz
ZXRfY2h1bmtfdHlwZSh0bXAsIENUX1RZUEUpOwogICAgICB9CiAgIH0KLy8gICBpZiAoIWNo
dW5rX2lzX3Rva2VuKHRtcCwgQ1RfQlJBQ0VfQ0xPU0UpKQovLyAgIHsKLy8gICAgICAvLyBU
T0RPOiBsb2cgYW4gZXJyb3IsIGV4cGVjdGVkICd9JwovLyAgIH0KICAgc2V0X2NodW5rX3Bh
cmVudCh0bXAsIENUX1RFTVBMQVRFKTsKfSAvLyBoYW5kbGVfZF90ZW1wbGF0ZQoKCnN0YXRp
YyB2b2lkIG1hcmtfdGVtcGxhdGVfZnVuYyhjaHVua190ICpwYywgY2h1bmtfdCAqcGNfbmV4
dCkKewogICBMT0dfRlVOQ19FTlRSWSgpOwoKICAgLy8gV2Uga25vdyBhbmdsZV9jbG9zZSBt
dXN0IGJlIHRoZXJlLi4uCiAgIGNodW5rX3QgKmFuZ2xlX2Nsb3NlID0gY2h1bmtfZ2V0X25l
eHRfdHlwZShwY19uZXh0LCBDVF9BTkdMRV9DTE9TRSwgcGMtPmxldmVsKTsKICAgY2h1bmtf
dCAqYWZ0ZXIgICAgICAgPSBjaHVua19nZXRfbmV4dF9uY25sKGFuZ2xlX2Nsb3NlKTsKCiAg
IGlmIChhZnRlciAhPSBudWxscHRyKQogICB7CiAgICAgIGlmIChjaHVua19pc19zdHIoYWZ0
ZXIsICIoIiwgMSkpCiAgICAgIHsKICAgICAgICAgaWYgKGFuZ2xlX2Nsb3NlLT5mbGFncy50
ZXN0KFBDRl9JTl9GQ05fQ0FMTCkpCiAgICAgICAgIHsKICAgICAgICAgICAgTE9HX0ZNVChM
VEVNUEZVTkMsICIlcyglZCk6IG1hcmtpbmcgJyVzJyBpbiBsaW5lICV6dSBhcyBhIEZVTkNf
Q0FMTFxuIiwKICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50
ZXh0KCksIHBjLT5vcmlnX2xpbmUpOwogICAgICAgICAgICBMT0dfRk1UKExGQ04sICIlcygl
ZCk6ICgxNikgU0VUIFRPIENUX0ZVTkNfQ0FMTDogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19j
b2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xuIiwKICAgICAgICAgICAgICAgICAgICBfX2Z1bmNf
XywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQoKSk7
CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DX0NBTEwpOwogICAgICAg
ICAgICBmbGFnX3BhcmVucyhhZnRlciwgUENGX0lOX0ZDTl9DQUxMLCBDVF9GUEFSRU5fT1BF
TiwgQ1RfRlVOQ19DQUxMLCBmYWxzZSk7CiAgICAgICAgIH0KICAgICAgICAgZWxzZQogICAg
ICAgICB7CiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAqIE1pZ2h0IGJlIGEgZnVuY3Rp
b24gZGVmLiBNdXN0IGNoZWNrIHdoYXQgaXMgYmVmb3JlIHRoZSB0ZW1wbGF0ZToKICAgICAg
ICAgICAgICogRnVuYyBjYWxsOgogICAgICAgICAgICAgKiAgIEJUcmVlLkluc2VydChzdGQ6
OnBhaXI8aW50LCBkb3VibGU+KCppdCwgZG91YmxlKCppdCkgKyAxLjApKTsKICAgICAgICAg
ICAgICogICBhID0gVGVzdDxpbnQ+KGopOwogICAgICAgICAgICAgKiAgIHN0ZDo6cGFpcjxp
bnQsIGRvdWJsZT4oKml0LCBkb3VibGUoKml0KSArIDEuMCkpOwogICAgICAgICAgICAgKi8K
CiAgICAgICAgICAgIExPR19GTVQoTFRFTVBGVU5DLCAiJXMoJWQpOiBtYXJraW5nICclcycg
aW4gbGluZSAlenUgYXMgYSBGVU5DX0NBTEwgMlxuIiwKICAgICAgICAgICAgICAgICAgICBf
X2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIHBjLT5vcmlnX2xpbmUpOwogICAgICAg
ICAgICAvLyBpdHMgYSBmdW5jdGlvbiEhIQogICAgICAgICAgICBMT0dfRk1UKExGQ04sICIl
cyglZCk6ICgxNykgU0VUIFRPIENUX0ZVTkNfQ0FMTDogb3JpZ19saW5lIGlzICV6dSwgb3Jp
Z19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xuIiwKICAgICAgICAgICAgICAgICAgICBfX2Z1
bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQo
KSk7CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DX0NBTEwpOwogICAg
ICAgICAgICBtYXJrX2Z1bmN0aW9uKHBjKTsKICAgICAgICAgfQogICAgICB9CiAgICAgIGVs
c2UgaWYgKGNodW5rX2lzX3Rva2VuKGFmdGVyLCBDVF9XT1JEKSkKICAgICAgewogICAgICAg
ICAvLyBpdHMgYSB0eXBlIQogICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfVFlQRSk7
CiAgICAgICAgIGNodW5rX2ZsYWdzX3NldChwYywgUENGX1ZBUl9UWVBFKTsKICAgICAgICAg
Y2h1bmtfZmxhZ3Nfc2V0KGFmdGVyLCBQQ0ZfVkFSX0RFRik7CiAgICAgIH0KICAgfQp9IC8v
IG1hcmtfdGVtcGxhdGVfZnVuYwoKCnN0YXRpYyB2b2lkIG1hcmtfZXhlY19zcWwoY2h1bmtf
dCAqcGMpCnsKICAgTE9HX0ZVTkNfRU5UUlkoKTsKICAgY2h1bmtfdCAqdG1wOwoKICAgLy8g
Q2hhbmdlIENUX1dPUkQgdG8gQ1RfU1FMX1dPUkQKICAgZm9yICh0bXAgPSBjaHVua19nZXRf
bmV4dChwYyk7IHRtcCAhPSBudWxscHRyOyB0bXAgPSBjaHVua19nZXRfbmV4dCh0bXApKQog
ICB7CiAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBwYy0+dHlwZSk7CgogICAgICBpZiAo
Y2h1bmtfaXNfdG9rZW4odG1wLCBDVF9XT1JEKSkKICAgICAgewogICAgICAgICBzZXRfY2h1
bmtfdHlwZSh0bXAsIENUX1NRTF9XT1JEKTsKICAgICAgfQoKICAgICAgaWYgKGNodW5rX2lz
X3Rva2VuKHRtcCwgQ1RfU0VNSUNPTE9OKSkKICAgICAgewogICAgICAgICBicmVhazsKICAg
ICAgfQogICB9CgogICBpZiAoICBwYy0+dHlwZSAhPSBDVF9TUUxfQkVHSU4KICAgICAgfHwg
dG1wID09IG51bGxwdHIKICAgICAgfHwgdG1wLT50eXBlICE9IENUX1NFTUlDT0xPTikKICAg
ewogICAgICByZXR1cm47CiAgIH0KCiAgIGZvciAodG1wID0gY2h1bmtfZ2V0X25leHQodG1w
KTsKICAgICAgICB0bXAgIT0gbnVsbHB0ciAmJiB0bXAtPnR5cGUgIT0gQ1RfU1FMX0VORDsK
ICAgICAgICB0bXAgPSBjaHVua19nZXRfbmV4dCh0bXApKQogICB7CiAgICAgIHRtcC0+bGV2
ZWwrKzsKICAgfQp9CgoKY2h1bmtfdCAqc2tpcF90ZW1wbGF0ZV9uZXh0KGNodW5rX3QgKmFu
Z19vcGVuKQp7CiAgIGlmIChjaHVua19pc190b2tlbihhbmdfb3BlbiwgQ1RfQU5HTEVfT1BF
TikpCiAgIHsKICAgICAgY2h1bmtfdCAqcGMgPSBjaHVua19nZXRfbmV4dF90eXBlKGFuZ19v
cGVuLCBDVF9BTkdMRV9DTE9TRSwgYW5nX29wZW4tPmxldmVsKTsKICAgICAgcmV0dXJuKGNo
dW5rX2dldF9uZXh0X25jbmwocGMpKTsKICAgfQogICByZXR1cm4oYW5nX29wZW4pOwp9CgoK
Y2h1bmtfdCAqc2tpcF90ZW1wbGF0ZV9wcmV2KGNodW5rX3QgKmFuZ19jbG9zZSkKewogICBp
ZiAoY2h1bmtfaXNfdG9rZW4oYW5nX2Nsb3NlLCBDVF9BTkdMRV9DTE9TRSkpCiAgIHsKICAg
ICAgY2h1bmtfdCAqcGMgPSBjaHVua19nZXRfcHJldl90eXBlKGFuZ19jbG9zZSwgQ1RfQU5H
TEVfT1BFTiwgYW5nX2Nsb3NlLT5sZXZlbCk7CiAgICAgIHJldHVybihjaHVua19nZXRfcHJl
dl9uY25sbmkocGMpKTsgICAvLyBJc3N1ZSAjMjI3OQogICB9CiAgIHJldHVybihhbmdfY2xv
c2UpOwp9CgoKY2h1bmtfdCAqc2tpcF90c3F1YXJlX25leHQoY2h1bmtfdCAqYXJ5X2RlZikK
ewogICBpZiAoY2h1bmtfaXNfdG9rZW4oYXJ5X2RlZiwgQ1RfU1FVQVJFX09QRU4pIHx8IGNo
dW5rX2lzX3Rva2VuKGFyeV9kZWYsIENUX1RTUVVBUkUpKQogICB7CiAgICAgIHJldHVybihj
aHVua19nZXRfbmV4dF9uaXNxKGFyeV9kZWYpKTsKICAgfQogICByZXR1cm4oYXJ5X2RlZik7
Cn0KCgpjaHVua190ICpza2lwX2F0dHJpYnV0ZV9uZXh0KGNodW5rX3QgKmF0dHIpCnsKICAg
Y2h1bmtfdCAqcGMgPSBhdHRyOwoKICAgd2hpbGUgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9B
VFRSSUJVVEUpKQogICB7CiAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7Cgog
ICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0ZQQVJFTl9PUEVOKSkKICAgICAgewog
ICAgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X3R5cGUocGMsIENUX0ZQQVJFTl9DTE9TRSwg
cGMtPmxldmVsKTsKICAgICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKICAg
ICAgfQogICB9CiAgIHJldHVybihwYyk7Cn0KCgpjaHVua190ICpza2lwX2F0dHJpYnV0ZV9w
cmV2KGNodW5rX3QgKmZwX2Nsb3NlKQp7CiAgIGNodW5rX3QgKnBjID0gZnBfY2xvc2U7Cgog
ICB3aGlsZSAodHJ1ZSkKICAgewogICAgICBpZiAoICBjaHVua19pc190b2tlbihwYywgQ1Rf
RlBBUkVOX0NMT1NFKQogICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09
IENUX0FUVFJJQlVURSkKICAgICAgewogICAgICAgICBwYyA9IGNodW5rX2dldF9wcmV2X3R5
cGUocGMsIENUX0FUVFJJQlVURSwgcGMtPmxldmVsKTsKICAgICAgfQogICAgICBlbHNlIGlm
IChjaHVua19pc19ub3RfdG9rZW4ocGMsIENUX0FUVFJJQlVURSkpCiAgICAgIHsKICAgICAg
ICAgYnJlYWs7CiAgICAgIH0KICAgICAgcGMgPSBjaHVua19nZXRfcHJldl9uY25sbmkocGMp
OyAgIC8vIElzc3VlICMyMjc5CiAgIH0KICAgcmV0dXJuKHBjKTsKfQoKCnN0YXRpYyB2b2lk
IGhhbmRsZV9vY19jbGFzcyhjaHVua190ICpwYykKewogICBlbnVtIGNsYXNzIGFuZ2xlX3N0
YXRlX2UgOiB1bnNpZ25lZCBpbnQKICAgewogICAgICBOT05FICA9IDAsCiAgICAgIE9QRU4g
ID0gMSwgLy8gJzwnIGZvdW5kCiAgICAgIENMT1NFID0gMiwgLy8gJz4nIGZvdW5kCiAgIH07
CgogICBMT0dfRlVOQ19FTlRSWSgpOwogICBjaHVua190ICAgICAgICp0bXA7CiAgIGJvb2wg
ICAgICAgICAgaGl0X3Njb3BlICAgICA9IGZhbHNlOwogICBib29sICAgICAgICAgIHBhc3Nl
ZF9uYW1lICAgPSBmYWxzZTsgLy8gRGlkIHdlIHBhc3MgdGhlIG5hbWUgb2YgdGhlIGNsYXNz
IGFuZCBub3cgdGhlcmUgY2FuIGJlIG9ubHkgcHJvdG9jb2xzLCBub3QgZ2VuZXJpY3MKICAg
aW50ICAgICAgICAgICBnZW5lcmljX2xldmVsID0gMDsgICAgIC8vIGxldmVsIG9mIGRlcHRo
IG9mIGdlbmVyaWMKICAgYW5nbGVfc3RhdGVfZSBhcyAgICAgICAgICAgID0gYW5nbGVfc3Rh
dGVfZTo6Tk9ORTsKCiAgIExPR19GTVQoTE9DQ0xBU1MsICIlcyglZCk6IHN0YXJ0IFslc10g
WyVzXSBsaW5lICV6dVxuIiwKICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50
ZXh0KCksIGdldF90b2tlbl9uYW1lKGdldF9jaHVua19wYXJlbnRfdHlwZShwYykpLCBwYy0+
b3JpZ19saW5lKTsKCiAgIGlmIChnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09IENUX09D
X1BST1RPQ09MKQogICB7CiAgICAgIHRtcCA9IGNodW5rX2dldF9uZXh0X25jbmwocGMpOwoK
ICAgICAgaWYgKGNodW5rX2lzX3NlbWljb2xvbih0bXApKQogICAgICB7CiAgICAgICAgIHNl
dF9jaHVua19wYXJlbnQodG1wLCBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpKTsKICAgICAg
ICAgTE9HX0ZNVChMT0NDTEFTUywgIiVzKCVkKTogICBiYWlsIG9uIHNlbWljb2xvblxuIiwg
X19mdW5jX18sIF9fTElORV9fKTsKICAgICAgICAgcmV0dXJuOwogICAgICB9CiAgIH0KICAg
dG1wID0gcGM7CgogICB3aGlsZSAoKHRtcCA9IGNodW5rX2dldF9uZXh0X25ubCh0bXApKSAh
PSBudWxscHRyKQogICB7CiAgICAgIExPR19GTVQoTE9DQ0xBU1MsICIlcyglZCk6ICAgICAg
IG9yaWdfbGluZSBpcyAlenUsIFslc11cbiIsCiAgICAgICAgICAgICAgX19mdW5jX18sIF9f
TElORV9fLCB0bXAtPm9yaWdfbGluZSwgdG1wLT50ZXh0KCkpOwoKICAgICAgaWYgKGNodW5r
X2lzX3Rva2VuKHRtcCwgQ1RfT0NfRU5EKSkKICAgICAgewogICAgICAgICBicmVhazsKICAg
ICAgfQoKICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfUEFSRU5fT1BFTikpCiAg
ICAgIHsKICAgICAgICAgcGFzc2VkX25hbWUgPSB0cnVlOwogICAgICB9CgogICAgICBpZiAo
Y2h1bmtfaXNfc3RyKHRtcCwgIjwiLCAxKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtf
dHlwZSh0bXAsIENUX0FOR0xFX09QRU4pOwoKICAgICAgICAgaWYgKHBhc3NlZF9uYW1lKQog
ICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBDVF9PQ19QUk9U
T19MSVNUKTsKICAgICAgICAgfQogICAgICAgICBlbHNlCiAgICAgICAgIHsKICAgICAgICAg
ICAgc2V0X2NodW5rX3BhcmVudCh0bXAsIENUX09DX0dFTkVSSUNfU1BFQyk7CiAgICAgICAg
ICAgIGdlbmVyaWNfbGV2ZWwrKzsKICAgICAgICAgfQogICAgICAgICBhcyA9IGFuZ2xlX3N0
YXRlX2U6Ok9QRU47CiAgICAgIH0KCiAgICAgIGlmIChjaHVua19pc19zdHIodG1wLCAiPiIs
IDEpKQogICAgICB7CiAgICAgICAgIHNldF9jaHVua190eXBlKHRtcCwgQ1RfQU5HTEVfQ0xP
U0UpOwoKICAgICAgICAgaWYgKHBhc3NlZF9uYW1lKQogICAgICAgICB7CiAgICAgICAgICAg
IHNldF9jaHVua19wYXJlbnQodG1wLCBDVF9PQ19QUk9UT19MSVNUKTsKICAgICAgICAgICAg
YXMgPSBhbmdsZV9zdGF0ZV9lOjpDTE9TRTsKICAgICAgICAgfQogICAgICAgICBlbHNlCiAg
ICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVudCh0bXAsIENUX09DX0dFTkVS
SUNfU1BFQyk7CgogICAgICAgICAgICBpZiAoZ2VuZXJpY19sZXZlbCA9PSAwKQogICAgICAg
ICAgICB7CiAgICAgICAgICAgICAgIGZwcmludGYoc3RkZXJyLCAiJXMoJWQpOiBnZW5lcmlj
X2xldmVsIGlzIFpFUk8sIGNhbm5vdCBiZSBkZWNyZW1lbnRlZCwgYXQgbGluZSAlenUsIGNv
bHVtbiAlenVcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9f
LCB0bXAtPm9yaWdfbGluZSwgdG1wLT5vcmlnX2NvbCk7CiAgICAgICAgICAgICAgIGxvZ19m
bHVzaCh0cnVlKTsKICAgICAgICAgICAgICAgZXhpdChFWF9TT0ZUV0FSRSk7CiAgICAgICAg
ICAgIH0KICAgICAgICAgICAgZ2VuZXJpY19sZXZlbC0tOwoKICAgICAgICAgICAgaWYgKGdl
bmVyaWNfbGV2ZWwgPT0gMCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBhcyA9IGFu
Z2xlX3N0YXRlX2U6OkNMT1NFOwogICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgfQoK
ICAgICAgaWYgKGNodW5rX2lzX3N0cih0bXAsICI+PiIsIDIpKQogICAgICB7CiAgICAgICAg
IHNldF9jaHVua190eXBlKHRtcCwgQ1RfQU5HTEVfQ0xPU0UpOwogICAgICAgICBzZXRfY2h1
bmtfcGFyZW50KHRtcCwgQ1RfT0NfR0VORVJJQ19TUEVDKTsKICAgICAgICAgc3BsaXRfb2Zm
X2FuZ2xlX2Nsb3NlKHRtcCk7CiAgICAgICAgIGdlbmVyaWNfbGV2ZWwgLT0gMTsKCiAgICAg
ICAgIGlmIChnZW5lcmljX2xldmVsID09IDApCiAgICAgICAgIHsKICAgICAgICAgICAgYXMg
PSBhbmdsZV9zdGF0ZV9lOjpDTE9TRTsKICAgICAgICAgfQogICAgICB9CgogICAgICBpZiAo
ICBjaHVua19pc190b2tlbih0bXAsIENUX0JSQUNFX09QRU4pCiAgICAgICAgICYmIGdldF9j
aHVua19wYXJlbnRfdHlwZSh0bXApICE9IENUX0FTU0lHTikKICAgICAgewogICAgICAgICBh
cyA9IGFuZ2xlX3N0YXRlX2U6OkNMT1NFOwogICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRt
cCwgQ1RfT0NfQ0xBU1MpOwogICAgICAgICB0bXAgPSBjaHVua19nZXRfbmV4dF90eXBlKHRt
cCwgQ1RfQlJBQ0VfQ0xPU0UsIHRtcC0+bGV2ZWwpOwoKICAgICAgICAgaWYgKCAgdG1wICE9
IG51bGxwdHIKICAgICAgICAgICAgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHRtcCkgIT0g
Q1RfQVNTSUdOKQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1w
LCBDVF9PQ19DTEFTUyk7CiAgICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIGlmIChjaHVu
a19pc190b2tlbih0bXAsIENUX0NPTE9OKSkKICAgICAgewogICAgICAgICBpZiAoYXMgIT0g
YW5nbGVfc3RhdGVfZTo6T1BFTikKICAgICAgICAgewogICAgICAgICAgICBwYXNzZWRfbmFt
ZSA9IHRydWU7CiAgICAgICAgIH0KICAgICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBoaXRf
c2NvcGUgPyBDVF9PQ19DT0xPTiA6IENUX0NMQVNTX0NPTE9OKTsKCiAgICAgICAgIGlmIChj
aHVua19pc190b2tlbih0bXAsIENUX0NMQVNTX0NPTE9OKSkKICAgICAgICAgewogICAgICAg
ICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfT0NfQ0xBU1MpOwogICAgICAgICB9CiAg
ICAgIH0KICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfc3RyKHRtcCwgIi0iLCAxKSB8fCBjaHVu
a19pc19zdHIodG1wLCAiKyIsIDEpKQogICAgICB7CiAgICAgICAgIGFzID0gYW5nbGVfc3Rh
dGVfZTo6Q0xPU0U7CgogICAgICAgICBpZiAoY2h1bmtfaXNfbmV3bGluZShjaHVua19nZXRf
cHJldih0bXApKSkKICAgICAgICAgewogICAgICAgICAgICBzZXRfY2h1bmtfdHlwZSh0bXAs
IENUX09DX1NDT1BFKTsKICAgICAgICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHRtcCwgUENGX1NU
TVRfU1RBUlQpOwogICAgICAgICAgICBoaXRfc2NvcGUgPSB0cnVlOwogICAgICAgICB9CiAg
ICAgIH0KCiAgICAgIGlmIChhcyA9PSBhbmdsZV9zdGF0ZV9lOjpPUEVOKQogICAgICB7CiAg
ICAgICAgIGlmIChwYXNzZWRfbmFtZSkKICAgICAgICAgewogICAgICAgICAgICBzZXRfY2h1
bmtfcGFyZW50KHRtcCwgQ1RfT0NfUFJPVE9fTElTVCk7CiAgICAgICAgIH0KICAgICAgICAg
ZWxzZQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBDVF9P
Q19HRU5FUklDX1NQRUMpOwogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgaWYgKGNodW5r
X2lzX3Rva2VuKHRtcCwgQ1RfQlJBQ0VfT1BFTikpCiAgIHsKICAgICAgdG1wID0gY2h1bmtf
Z2V0X25leHRfdHlwZSh0bXAsIENUX0JSQUNFX0NMT1NFLCB0bXAtPmxldmVsKTsKCiAgICAg
IGlmICh0bXAgIT0gbnVsbHB0cikKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfcGFyZW50
KHRtcCwgQ1RfT0NfQ0xBU1MpOwogICAgICB9CiAgIH0KfSAvLyBoYW5kbGVfb2NfY2xhc3MK
CgpzdGF0aWMgdm9pZCBoYW5kbGVfb2NfYmxvY2tfbGl0ZXJhbChjaHVua190ICpwYykKewog
ICBMT0dfRlVOQ19FTlRSWSgpOwogICBjaHVua190ICpwcmV2ID0gY2h1bmtfZ2V0X3ByZXZf
bmNubG5pKHBjKTsgICAvLyBJc3N1ZSAjMjI3OQogICBjaHVua190ICpuZXh0ID0gY2h1bmtf
Z2V0X25leHRfbmNubChwYyk7CgogICBpZiAoICBwYyA9PSBudWxscHRyCiAgICAgIHx8IHBy
ZXYgPT0gbnVsbHB0cgogICAgICB8fCBuZXh0ID09IG51bGxwdHIpCiAgIHsKICAgICAgcmV0
dXJuOyAvLyBsZXQncyBiZSBwYXJhbm9pZAogICB9CiAgIC8qCiAgICAqIGJsb2NrIGxpdGVy
YWw6ICdeIFJUWVBFICggQVJHUyApIHsgfScKICAgICogUlRZUEUgYW5kIEFSR1MgYXJlIG9w
dGlvbmFsCiAgICAqLwogICBMT0dfRk1UKExPQ0JMSywgIiVzKCVkKTogYmxvY2sgbGl0ZXJh
bCBAIG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dVxuIiwKICAgICAgICAgICBf
X2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCk7CgogICBj
aHVua190ICphcG8gPSBudWxscHRyOyAvLyBhcmcgcGFyZW4gb3BlbgogICBjaHVua190ICpi
Ym8gPSBudWxscHRyOyAvLyBibG9jayBicmFjZSBvcGVuCiAgIGNodW5rX3QgKmJiYzsgICAg
ICAgICAgIC8vIGJsb2NrIGJyYWNlIGNsb3NlCgogICBMT0dfRk1UKExPQ0JMSywgIiVzKCVk
KTogICsgc2NhbiIsIF9fZnVuY19fLCBfX0xJTkVfXyk7CiAgIGNodW5rX3QgKnRtcDsKCiAg
IGZvciAodG1wID0gbmV4dDsgdG1wOyB0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcCkp
CiAgIHsKICAgICAgLyogaGFuZGxlICc8IHByb3RvY29sID4nICovCiAgICAgIGlmIChjaHVu
a19pc19zdHIodG1wLCAiPCIsIDEpKQogICAgICB7CiAgICAgICAgIGNodW5rX3QgKmFvID0g
dG1wOwogICAgICAgICBjaHVua190ICphYyA9IGNodW5rX2dldF9uZXh0X3N0cihhbywgIj4i
LCAxLCBhby0+bGV2ZWwpOwoKICAgICAgICAgaWYgKGFjKQogICAgICAgICB7CiAgICAgICAg
ICAgIHNldF9jaHVua190eXBlKGFvLCBDVF9BTkdMRV9PUEVOKTsKICAgICAgICAgICAgc2V0
X2NodW5rX3BhcmVudChhbywgQ1RfT0NfUFJPVE9fTElTVCk7CiAgICAgICAgICAgIHNldF9j
aHVua190eXBlKGFjLCBDVF9BTkdMRV9DTE9TRSk7CiAgICAgICAgICAgIHNldF9jaHVua19w
YXJlbnQoYWMsIENUX09DX1BST1RPX0xJU1QpOwoKICAgICAgICAgICAgZm9yICh0bXAgPSBj
aHVua19nZXRfbmV4dChhbyk7IHRtcCAhPSBhYzsgdG1wID0gY2h1bmtfZ2V0X25leHQodG1w
KSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICB0bXAtPmxldmVsICs9IDE7CiAgICAg
ICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBDVF9PQ19QUk9UT19MSVNUKTsKICAg
ICAgICAgICAgfQogICAgICAgICB9CiAgICAgICAgIHRtcCA9IGNodW5rX2dldF9uZXh0X25j
bmwoYWMpOwogICAgICB9CiAgICAgIExPR19GTVQoTE9DQkxLLCAiICclcyciLCB0bXAtPnRl
eHQoKSk7CgogICAgICBpZiAodG1wLT5sZXZlbCA8IHBjLT5sZXZlbCB8fCBjaHVua19pc190
b2tlbih0bXAsIENUX1NFTUlDT0xPTikpCiAgICAgIHsKICAgICAgICAgTE9HX0ZNVChMT0NC
TEssICJbRE9ORV0iKTsKICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIGlmICh0bXAt
PmxldmVsID09IHBjLT5sZXZlbCkKICAgICAgewogICAgICAgICBpZiAoY2h1bmtfaXNfcGFy
ZW5fb3Blbih0bXApKQogICAgICAgICB7CiAgICAgICAgICAgIGFwbyA9IHRtcDsKICAgICAg
ICAgICAgTE9HX0ZNVChMT0NCTEssICJbUEFSRU5dIik7CiAgICAgICAgIH0KCiAgICAgICAg
IGlmIChjaHVua19pc190b2tlbih0bXAsIENUX0JSQUNFX09QRU4pKQogICAgICAgICB7CiAg
ICAgICAgICAgIExPR19GTVQoTE9DQkxLLCAiW0JSQUNFXSIpOwogICAgICAgICAgICBiYm8g
PSB0bXA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAg
Ly8gbWFrZSBzdXJlIHdlIGhhdmUgYnJhY2VzCiAgIGJiYyA9IGNodW5rX3NraXBfdG9fbWF0
Y2goYmJvKTsKCiAgIGlmICggIGJibyA9PSBudWxscHRyCiAgICAgIHx8IGJiYyA9PSBudWxs
cHRyKQogICB7CiAgICAgIExPR19GTVQoTE9DQkxLLCAiIC0tIG5vIGJyYWNlcyBmb3VuZFxu
Iik7CiAgICAgIHJldHVybjsKICAgfQogICBMT0dfRk1UKExPQ0JMSywgIlxuIik7CgogICAv
LyB3ZSBhcmUgb24gYSBibG9jayBsaXRlcmFsIGZvciBzdXJlCiAgIHNldF9jaHVua190eXBl
KHBjLCBDVF9PQ19CTE9DS19DQVJFVCk7CiAgIHNldF9jaHVua19wYXJlbnQocGMsIENUX09D
X0JMT0NLX0VYUFIpOwoKICAgLy8gaGFuZGxlIHRoZSBvcHRpb25hbCBhcmdzCiAgIGNodW5r
X3QgKmxicDsgLy8gbGFzdCBiZWZvcmUgcGFyZW4gLSBlbmQgb2YgcmV0dXJuIHR5cGUsIGlm
IGFueQoKICAgaWYgKGFwbykKICAgewogICAgICBjaHVua190ICphcGMgPSBjaHVua19za2lw
X3RvX21hdGNoKGFwbyk7ICAvLyBhcmcgcGFyZW50aGVzaXMgY2xvc2UKCiAgICAgIGlmIChj
aHVua19pc19wYXJlbl9jbG9zZShhcGMpKQogICAgICB7CiAgICAgICAgIExPR19GTVQoTE9D
QkxLLCAiIC0tIG1hcmtpbmcgcGFyZW5zIEAgYXBvLT5vcmlnX2xpbmUgaXMgJXp1LCBhcG8t
Pm9yaWdfY29sIGlzICV6dSBhbmQgYXBjLT5vcmlnX2xpbmUgaXMgJXp1LCBhcGMtPm9yaWdf
Y29sIGlzICV6dVxuIiwKICAgICAgICAgICAgICAgICBhcG8tPm9yaWdfbGluZSwgYXBvLT5v
cmlnX2NvbCwgYXBjLT5vcmlnX2xpbmUsIGFwYy0+b3JpZ19jb2wpOwogICAgICAgICBmbGFn
X3BhcmVucyhhcG8sIFBDRl9PQ19BVFlQRSwgQ1RfRlBBUkVOX09QRU4sIENUX09DX0JMT0NL
X0VYUFIsIHRydWUpOwogICAgICAgICBmaXhfZmNuX2RlZl9wYXJhbXMoYXBvKTsKICAgICAg
fQogICAgICBsYnAgPSBjaHVua19nZXRfcHJldl9uY25sbmkoYXBvKTsgICAvLyBJc3N1ZSAj
MjI3OQogICB9CiAgIGVsc2UKICAgewogICAgICBsYnAgPSBjaHVua19nZXRfcHJldl9uY25s
bmkoYmJvKTsgICAvLyBJc3N1ZSAjMjI3OQogICB9CgogICAvLyBtYXJrIHRoZSByZXR1cm4g
dHlwZSwgaWYgYW55CiAgIHdoaWxlIChsYnAgIT0gcGMpCiAgIHsKICAgICAgTE9HX0ZNVChM
T0NCTEssICIgLS0gbGJwICVzWyVzXVxuIiwgbGJwLT50ZXh0KCksIGdldF90b2tlbl9uYW1l
KGxicC0+dHlwZSkpOwogICAgICBtYWtlX3R5cGUobGJwKTsKICAgICAgY2h1bmtfZmxhZ3Nf
c2V0KGxicCwgUENGX09DX1JUWVBFKTsKICAgICAgc2V0X2NodW5rX3BhcmVudChsYnAsIENU
X09DX0JMT0NLX0VYUFIpOwogICAgICBsYnAgPSBjaHVua19nZXRfcHJldl9uY25sbmkobGJw
KTsgICAvLyBJc3N1ZSAjMjI3OQogICB9CiAgIC8vIG1hcmsgdGhlIGJyYWNlcwogICBzZXRf
Y2h1bmtfcGFyZW50KGJibywgQ1RfT0NfQkxPQ0tfRVhQUik7CiAgIHNldF9jaHVua19wYXJl
bnQoYmJjLCBDVF9PQ19CTE9DS19FWFBSKTsKfSAvLyBoYW5kbGVfb2NfYmxvY2tfbGl0ZXJh
bAoKCnN0YXRpYyB2b2lkIGhhbmRsZV9vY19ibG9ja190eXBlKGNodW5rX3QgKnBjKQp7CiAg
IExPR19GVU5DX0VOVFJZKCk7CgogICBpZiAocGMgPT0gbnVsbHB0cikKICAgewogICAgICBy
ZXR1cm47CiAgIH0KCiAgIGlmIChwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fVFlQRURFRikpCiAg
IHsKICAgICAgTE9HX0ZNVChMT0NCTEssICIlcyglZCk6IHNraXAgYmxvY2sgdHlwZSBAIG9y
aWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgLS0gaW4gdHlwZWRlZlxuIiwKICAg
ICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmln
X2NvbCk7CiAgICAgIHJldHVybjsKICAgfQogICAvLyBtYWtlIHN1cmUgd2UgaGF2ZSAnKCBe
JwogICBjaHVua190ICp0cG8gPSBjaHVua19nZXRfcHJldl9uY25sbmkocGMpOyAvLyB0eXBl
IHBhcmVuIG9wZW4gICBJc3N1ZSAjMjI3OQoKICAgaWYgKGNodW5rX2lzX3BhcmVuX29wZW4o
dHBvKSkKICAgewogICAgICAvKgogICAgICAgKiBibG9jayB0eXBlOiAnUlRZUEUgKF5MQUJF
TCkoQVJHUyknCiAgICAgICAqIExBQkVMIGlzIG9wdGlvbmFsLgogICAgICAgKi8KICAgICAg
Y2h1bmtfdCAqdHBjID0gY2h1bmtfc2tpcF90b19tYXRjaCh0cG8pOyAgIC8vIHR5cGUgY2xv
c2UgcGFyZW4gKGFmdGVyICdeJykKICAgICAgY2h1bmtfdCAqbmFtID0gY2h1bmtfZ2V0X3By
ZXZfbmNubG5pKHRwYyk7IC8vIG5hbWUgKGlmIGFueSkgb3IgJ14nICAgSXNzdWUgIzIyNzkK
ICAgICAgY2h1bmtfdCAqYXBvID0gY2h1bmtfZ2V0X25leHRfbmNubCh0cGMpOyAgIC8vIGFy
ZyBvcGVuIHBhcmVuCiAgICAgIGNodW5rX3QgKmFwYyA9IGNodW5rX3NraXBfdG9fbWF0Y2go
YXBvKTsgICAvLyBhcmcgY2xvc2UgcGFyZW4KCiAgICAgIC8qCiAgICAgICAqIElmIHRoaXMg
aXMgYSBibG9jayBsaXRlcmFsIGluc3RlYWQgb2YgYSBibG9jayB0eXBlLCAnbmFtJwogICAg
ICAgKiB3aWxsIGFjdHVhbGx5IGJlIHRoZSBjbG9zaW5nIGJyYWNrZXQgb2YgdGhlIGJsb2Nr
LiBXZSBydW4gaW50bwogICAgICAgKiB0aGlzIHNpdHVhdGlvbiBpZiBhIGJsb2NrIGxpdGVy
YWwgaXMgZW5jbG9zZWQgaW4gcGFyZW50aGVzZXMuCiAgICAgICAqLwogICAgICBpZiAoY2h1
bmtfaXNfY2xvc2luZ19icmFjZShuYW0pKQogICAgICB7CiAgICAgICAgIHJldHVybihoYW5k
bGVfb2NfYmxvY2tfbGl0ZXJhbChwYykpOwogICAgICB9CgogICAgICAvLyBDaGVjayBhcG8g
aXMgJygnIG9yIGVsc2UgdGhpcyBtaWdodCBiZSBhIGJsb2NrIGxpdGVyYWwuIElzc3VlIDI2
NDMuCiAgICAgIGlmICghY2h1bmtfaXNfcGFyZW5fb3BlbihhcG8pKQogICAgICB7CiAgICAg
ICAgIHJldHVybihoYW5kbGVfb2NfYmxvY2tfbGl0ZXJhbChwYykpOwogICAgICB9CgogICAg
ICBpZiAoY2h1bmtfaXNfcGFyZW5fY2xvc2UoYXBjKSkKICAgICAgewogICAgICAgICBjaHVu
a190ICAgKmFmdCA9IGNodW5rX2dldF9uZXh0X25jbmwoYXBjKTsKICAgICAgICAgY190b2tl
bl90IHB0OwoKICAgICAgICAgaWYgKGNodW5rX2lzX3N0cihuYW0sICJeIiwgMSkpCiAgICAg
ICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUobmFtLCBDVF9QVFJfVFlQRSk7CiAg
ICAgICAgICAgIHB0ID0gQ1RfRlVOQ19UWVBFOwogICAgICAgICB9CiAgICAgICAgIGVsc2Ug
aWYgKCAgY2h1bmtfaXNfdG9rZW4oYWZ0LCBDVF9BU1NJR04pCiAgICAgICAgICAgICAgICAg
fHwgY2h1bmtfaXNfdG9rZW4oYWZ0LCBDVF9TRU1JQ09MT04pKQogICAgICAgICB7CiAgICAg
ICAgICAgIHNldF9jaHVua190eXBlKG5hbSwgQ1RfRlVOQ19WQVIpOwogICAgICAgICAgICBw
dCA9IENUX0ZVTkNfVkFSOwogICAgICAgICB9CiAgICAgICAgIGVsc2UKICAgICAgICAgewog
ICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShuYW0sIENUX0ZVTkNfVFlQRSk7CiAgICAgICAg
ICAgIHB0ID0gQ1RfRlVOQ19UWVBFOwogICAgICAgICB9CiAgICAgICAgIExPR19GTVQoTE9D
QkxLLCAiJXMoJWQpOiBibG9jayB0eXBlIEAgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wg
aXMgJXp1LCB0ZXh0KCkgJyVzJ1slc11cbiIsCiAgICAgICAgICAgICAgICAgX19mdW5jX18s
IF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIG5hbS0+dGV4dCgpLCBn
ZXRfdG9rZW5fbmFtZShuYW0tPnR5cGUpKTsKICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMs
IENUX1BUUl9UWVBFKTsKICAgICAgICAgc2V0X2NodW5rX3BhcmVudChwYywgcHQpOyAgLy9D
VF9PQ19CTE9DS19UWVBFOwogICAgICAgICBzZXRfY2h1bmtfdHlwZSh0cG8sIENUX1RQQVJF
Tl9PUEVOKTsKICAgICAgICAgc2V0X2NodW5rX3BhcmVudCh0cG8sIHB0KTsgLy9DVF9PQ19C
TE9DS19UWVBFOwogICAgICAgICBzZXRfY2h1bmtfdHlwZSh0cGMsIENUX1RQQVJFTl9DTE9T
RSk7CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQodHBjLCBwdCk7IC8vQ1RfT0NfQkxPQ0tf
VFlQRTsKICAgICAgICAgc2V0X2NodW5rX3R5cGUoYXBvLCBDVF9GUEFSRU5fT1BFTik7CiAg
ICAgICAgIHNldF9jaHVua19wYXJlbnQoYXBvLCBDVF9GVU5DX1BST1RPKTsKICAgICAgICAg
c2V0X2NodW5rX3R5cGUoYXBjLCBDVF9GUEFSRU5fQ0xPU0UpOwogICAgICAgICBzZXRfY2h1
bmtfcGFyZW50KGFwYywgQ1RfRlVOQ19QUk9UTyk7CiAgICAgICAgIGZpeF9mY25fZGVmX3Bh
cmFtcyhhcG8pOwogICAgICAgICBtYXJrX2Z1bmN0aW9uX3JldHVybl90eXBlKG5hbSwgY2h1
bmtfZ2V0X3ByZXZfbmNubG5pKHRwbyksIHB0KTsgICAvLyBJc3N1ZSAjMjI3OQogICAgICB9
CiAgIH0KfSAvLyBoYW5kbGVfb2NfYmxvY2tfdHlwZQoKCnN0YXRpYyBjaHVua190ICpoYW5k
bGVfb2NfbWRfdHlwZShjaHVua190ICpwYXJlbl9vcGVuLCBjX3Rva2VuX3QgcHR5cGUsIHBj
Zl9mbGFnc190IGZsYWdzLCBib29sICZkaWRfaXQpCnsKICAgY2h1bmtfdCAqcGFyZW5fY2xv
c2U7CgogICBpZiAoICAhY2h1bmtfaXNfcGFyZW5fb3BlbihwYXJlbl9vcGVuKQogICAgICB8
fCAoKHBhcmVuX2Nsb3NlID0gY2h1bmtfc2tpcF90b19tYXRjaChwYXJlbl9vcGVuKSkgPT0g
bnVsbHB0cikpCiAgIHsKICAgICAgZGlkX2l0ID0gZmFsc2U7CiAgICAgIHJldHVybihwYXJl
bl9vcGVuKTsKICAgfQogICBkaWRfaXQgPSB0cnVlOwoKICAgc2V0X2NodW5rX3BhcmVudChw
YXJlbl9vcGVuLCBwdHlwZSk7CiAgIGNodW5rX2ZsYWdzX3NldChwYXJlbl9vcGVuLCBmbGFn
cyk7CiAgIHNldF9jaHVua19wYXJlbnQocGFyZW5fY2xvc2UsIHB0eXBlKTsKICAgY2h1bmtf
ZmxhZ3Nfc2V0KHBhcmVuX2Nsb3NlLCBmbGFncyk7CgogICBmb3IgKGNodW5rX3QgKmN1ciA9
IGNodW5rX2dldF9uZXh0X25jbmwocGFyZW5fb3Blbik7CiAgICAgICAgY3VyICE9IHBhcmVu
X2Nsb3NlOwogICAgICAgIGN1ciA9IGNodW5rX2dldF9uZXh0X25jbmwoY3VyKSkKICAgewog
ICAgICBMT0dfRk1UKExPQ01TR0QsICIgPCVzfCVzPiIsIGN1ci0+dGV4dCgpLCBnZXRfdG9r
ZW5fbmFtZShjdXItPnR5cGUpKTsKICAgICAgY2h1bmtfZmxhZ3Nfc2V0KGN1ciwgZmxhZ3Mp
OwogICAgICBtYWtlX3R5cGUoY3VyKTsKICAgfQoKICAgLy8gcmV0dXJuaW5nIHRoZSBjaHVu
ayBhZnRlciB0aGUgcGFyZW4gY2xvc2UKICAgcmV0dXJuKGNodW5rX2dldF9uZXh0X25jbmwo
cGFyZW5fY2xvc2UpKTsKfQoKCnN0YXRpYyB2b2lkIGhhbmRsZV9vY19tZXNzYWdlX2RlY2wo
Y2h1bmtfdCAqcGMpCnsKICAgTE9HX0ZVTkNfRU5UUlkoKTsKCiAgIGJvb2wgZGlkX2l0Owog
ICAvL2Jvb2wgICAgICBpbl9wYXJlbiAgPSBmYWxzZTsKICAgLy9pbnQgICAgICAgcGFyZW5f
Y250ID0gMDsKICAgLy9pbnQgICAgICAgYXJnX2NudCAgID0gMDsKCiAgIC8vIEZpZ3VyZSBv
dXQgaWYgdGhpcyBpcyBhIHNwZWMgb3IgZGVjbAogICBjaHVua190ICp0bXAgPSBwYzsKCiAg
IHdoaWxlICgodG1wID0gY2h1bmtfZ2V0X25leHQodG1wKSkgIT0gbnVsbHB0cikKICAgewog
ICAgICBpZiAodG1wLT5sZXZlbCA8IHBjLT5sZXZlbCkKICAgICAgewogICAgICAgICAvLyBz
aG91bGQgbm90IGhhcHBlbgogICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChj
aHVua19pc190b2tlbih0bXAsIENUX1NFTUlDT0xPTikgfHwgY2h1bmtfaXNfdG9rZW4odG1w
LCBDVF9CUkFDRV9PUEVOKSkKICAgICAgewogICAgICAgICBicmVhazsKICAgICAgfQogICB9
CgogICBpZiAodG1wID09IG51bGxwdHIpCiAgIHsKICAgICAgcmV0dXJuOwogICB9CiAgIGNf
dG9rZW5fdCBwdCA9ICh0bXAtPnR5cGUgPT0gQ1RfU0VNSUNPTE9OKSA/IENUX09DX01TR19T
UEVDIDogQ1RfT0NfTVNHX0RFQ0w7CgogICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfT0NfU0NP
UEUpOwogICBzZXRfY2h1bmtfcGFyZW50KHBjLCBwdCk7CgogICBMT0dfRk1UKExPQ01TR0Qs
ICIlcyglZCk6ICVzIEAgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1IC0iLAog
ICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgZ2V0X3Rva2VuX25hbWUocHQpLCBwYy0+
b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wpOwoKICAgLy8gZm9ybWF0OiAtKFRZUEUpIE5BTUUg
WzogKFRZUEUpTkFNRQoKICAgLy8gaGFuZGxlIHRoZSByZXR1cm4gdHlwZQogICB0bXAgPSBo
YW5kbGVfb2NfbWRfdHlwZShjaHVua19nZXRfbmV4dF9uY25sKHBjKSwgcHQsIFBDRl9PQ19S
VFlQRSwgZGlkX2l0KTsKCiAgIGlmICghZGlkX2l0KQogICB7CiAgICAgIExPR19GTVQoTE9D
TVNHRCwgIiAtLSBtaXNzaW5nIHR5cGUgcGFyZW5zXG4iKTsKICAgICAgcmV0dXJuOwogICB9
CgogICAvLyBleHBlY3QgdGhlIG1ldGhvZCBuYW1lL2xhYmVsCiAgIGlmICghY2h1bmtfaXNf
dG9rZW4odG1wLCBDVF9XT1JEKSkKICAgewogICAgICBMT0dfRk1UKExPQ01TR0QsICIgLS0g
bWlzc2luZyBtZXRob2QgbmFtZVxuIik7CiAgICAgIHJldHVybjsKICAgfSAgLy8gZXhwZWN0
IHRoZSBtZXRob2QgbmFtZS9sYWJlbAoKICAgY2h1bmtfdCAqbGFiZWwgPSB0bXA7CgogICBz
ZXRfY2h1bmtfdHlwZSh0bXAsIHB0KTsKICAgc2V0X2NodW5rX3BhcmVudCh0bXAsIHB0KTsK
ICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcCk7CgogICBMT0dfRk1UKExPQ01TR0Qs
ICIgWyVzXSVzIiwgcGMtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUpKTsKCiAg
IC8vIGlmIHdlIGhhdmUgYSBjb2xvbiBuZXh0LCB3ZSBoYXZlIGFyZ3MKICAgaWYgKGNodW5r
X2lzX3Rva2VuKHBjLCBDVF9DT0xPTikgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX09DX0NP
TE9OKSkKICAgewogICAgICBwYyA9IGxhYmVsOwoKICAgICAgd2hpbGUgKHRydWUpCiAgICAg
IHsKICAgICAgICAgLy8gc2tpcCBvcHRpb25hbCBsYWJlbAogICAgICAgICBpZiAoY2h1bmtf
aXNfdG9rZW4ocGMsIENUX1dPUkQpIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBwdCkpCiAgICAg
ICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVudChwYywgcHQpOwogICAgICAgICAg
ICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGMpOwogICAgICAgICB9CgogICAgICAgICAv
LyBhIGNvbG9uIG11c3QgYmUgbmV4dAogICAgICAgICBpZiAoIWNodW5rX2lzX3N0cihwYywg
IjoiLCAxKSkKICAgICAgICAgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogICAg
ICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfT0NfQ09MT04pOwogICAgICAgICBzZXRfY2h1
bmtfcGFyZW50KHBjLCBwdCk7CiAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChw
Yyk7CgogICAgICAgICAvLyBuZXh0IGlzIHRoZSB0eXBlIGluIHBhcmVucwogICAgICAgICBM
T0dfRk1UKExPQ01TR0QsICIgICglcykiLCBwYy0+dGV4dCgpKTsKICAgICAgICAgdG1wID0g
aGFuZGxlX29jX21kX3R5cGUocGMsIHB0LCBQQ0ZfT0NfQVRZUEUsIGRpZF9pdCk7CgogICAg
ICAgICBpZiAoIWRpZF9pdCkKICAgICAgICAgewogICAgICAgICAgICBMT0dfRk1UKExXQVJO
LCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUgZXhwZWN0ZWQg
dHlwZVxuIiwKICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5v
cmlnX2xpbmUsIHBjLT5vcmlnX2NvbCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9
CiAgICAgICAgIC8vIGF0dHJpYnV0ZXMgZm9yIGEgbWV0aG9kIHBhcmFtZXRlciBzaXQgYmV0
d2VlbiB0aGUgcGFyYW1ldGVyIHR5cGUgYW5kIHRoZSBwYXJhbWV0ZXIgbmFtZQogICAgICAg
ICBwYyA9IHNraXBfYXR0cmlidXRlX25leHQodG1wKTsKICAgICAgICAgLy8gd2Ugc2hvdWxk
IG5vdyBiZSBvbiB0aGUgYXJnIG5hbWUKICAgICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHBjLCBQ
Q0ZfVkFSX0RFRik7CiAgICAgICAgIExPR19GTVQoTE9DTVNHRCwgIiBhcmdbJXNdIiwgcGMt
PnRleHQoKSk7CiAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7CiAgICAg
IH0KICAgfQogICBMT0dfRk1UKExPQ01TR0QsICIgZW5kWyVzXSIsIHBjLT50ZXh0KCkpOwoK
ICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9CUkFDRV9PUEVOKSkKICAgewogICAgICBz
ZXRfY2h1bmtfcGFyZW50KHBjLCBwdCk7CiAgICAgIHBjID0gY2h1bmtfc2tpcF90b19tYXRj
aChwYyk7CgogICAgICBpZiAocGMgIT0gbnVsbHB0cikKICAgICAgewogICAgICAgICBzZXRf
Y2h1bmtfcGFyZW50KHBjLCBwdCk7CiAgICAgIH0KICAgfQogICBlbHNlIGlmIChjaHVua19p
c190b2tlbihwYywgQ1RfU0VNSUNPTE9OKSkKICAgewogICAgICBzZXRfY2h1bmtfcGFyZW50
KHBjLCBwdCk7CiAgIH0KICAgTE9HX0ZNVChMT0NNU0dELCAiXG4iKTsKfSAvLyBoYW5kbGVf
b2NfbWVzc2FnZV9kZWNsCgoKc3RhdGljIHZvaWQgaGFuZGxlX29jX21lc3NhZ2Vfc2VuZChj
aHVua190ICpvcykKewogICBMT0dfRlVOQ19FTlRSWSgpOwoKICAgY2h1bmtfdCAqY3MgPSBj
aHVua19nZXRfbmV4dChvcyk7CgogICB3aGlsZSAoY3MgIT0gbnVsbHB0ciAmJiBjcy0+bGV2
ZWwgPiBvcy0+bGV2ZWwpCiAgIHsKICAgICAgY3MgPSBjaHVua19nZXRfbmV4dChjcyk7CiAg
IH0KCiAgIGlmIChjcyA9PSBudWxscHRyIHx8IGNzLT50eXBlICE9IENUX1NRVUFSRV9DTE9T
RSkKICAgewogICAgICByZXR1cm47CiAgIH0KICAgTE9HX0ZNVChMT0NNU0csICIlcyglZCk6
IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dVxuIiwKICAgICAgICAgICBfX2Z1
bmNfXywgX19MSU5FX18sIG9zLT5vcmlnX2xpbmUsIG9zLT5vcmlnX2NvbCk7CgogICBjaHVu
a190ICp0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKGNzKTsKCiAgIGlmIChjaHVua19pc19z
ZW1pY29sb24odG1wKSkKICAgewogICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfT0Nf
TVNHKTsKICAgfQogICAvLyBleHBlY3QgYSB3b3JkIGZpcnN0IHRoaW5nIG9yIFsuLi5dCiAg
IHRtcCA9IGNodW5rX2dldF9uZXh0X25jbmwob3MpOwoKICAgaWYgKCAgY2h1bmtfaXNfdG9r
ZW4odG1wLCBDVF9TUVVBUkVfT1BFTikgfHwgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9QQVJF
Tl9PUEVOKQogICAgICB8fCAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9PQ19BVCkpKQogICB7
CiAgICAgIGNodW5rX3QgKnR0ID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXApOwoKICAgICAg
aWYgKChjaHVua19pc190b2tlbih0bXAsIENUX09DX0FUKSkgJiYgdHQpCiAgICAgIHsKICAg
ICAgICAgaWYgKCAgKGNodW5rX2lzX3Rva2VuKHR0LCBDVF9QQVJFTl9PUEVOKSkKICAgICAg
ICAgICAgfHwgKGNodW5rX2lzX3Rva2VuKHR0LCBDVF9CUkFDRV9PUEVOKSkKICAgICAgICAg
ICAgfHwgKGNodW5rX2lzX3Rva2VuKHR0LCBDVF9TUVVBUkVfT1BFTikpKQogICAgICAgICB7
CiAgICAgICAgICAgIHRtcCA9IHR0OwogICAgICAgICB9CiAgICAgICAgIGVsc2UKICAgICAg
ICAgewogICAgICAgICAgICBMT0dfRk1UKExPQ01TRywgIiVzKCVkKTogdG1wLT5vcmlnX2xp
bmUgaXMgJXp1LCB0bXAtPm9yaWdfY29sIGlzICV6dSwgZXhwZWN0ZWQgaWRlbnRpZmllciwg
bm90ICclcycgWyVzXVxuIiwKICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5F
X18sIHRtcC0+b3JpZ19saW5lLCB0bXAtPm9yaWdfY29sLAogICAgICAgICAgICAgICAgICAg
IHRtcC0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZSh0bXAtPnR5cGUpKTsKICAgICAgICAgICAg
cmV0dXJuOwogICAgICAgICB9CiAgICAgIH0KICAgICAgdG1wID0gY2h1bmtfc2tpcF90b19t
YXRjaCh0bXApOwogICB9CiAgIGVsc2UgaWYgKCAgdG1wLT50eXBlICE9IENUX1dPUkQKICAg
ICAgICAgICAmJiB0bXAtPnR5cGUgIT0gQ1RfVFlQRQogICAgICAgICAgICYmIHRtcC0+dHlw
ZSAhPSBDVF9USElTCiAgICAgICAgICAgJiYgdG1wLT50eXBlICE9IENUX1NUQVIKICAgICAg
ICAgICAmJiB0bXAtPnR5cGUgIT0gQ1RfU1RSSU5HKQogICB7CiAgICAgIExPR19GTVQoTE9D
TVNHLCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIGV4cGVj
dGVkIGlkZW50aWZpZXIsIG5vdCAnJXMnIFslc11cbiIsCiAgICAgICAgICAgICAgX19mdW5j
X18sIF9fTElORV9fLCB0bXAtPm9yaWdfbGluZSwgdG1wLT5vcmlnX2NvbCwKICAgICAgICAg
ICAgICB0bXAtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUodG1wLT50eXBlKSk7CiAgICAgIHJl
dHVybjsKICAgfQogICBlbHNlCiAgIHsKICAgICAgaWYgKGNodW5rX2lzX3N0YXIodG1wKSkg
Ly8gSXNzdWUgIzI3MjIKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZSh0bXAsIENU
X1BUUl9UWVBFKTsKICAgICAgICAgdG1wID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXApOwog
ICAgICB9CiAgICAgIGNodW5rX3QgKnR0ID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXApOwoK
ICAgICAgaWYgKGNodW5rX2lzX3BhcmVuX29wZW4odHQpKQogICAgICB7CiAgICAgICAgIExP
R19GTVQoTEZDTiwgIiVzKCVkKTogKDE4KSBTRVQgVE8gQ1RfRlVOQ19DQUxMOiBvcmlnX2xp
bmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSAnJXMnXG4iLAogICAgICAgICAg
ICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgdG1wLT5vcmlnX2xpbmUsIHRtcC0+b3JpZ19j
b2wsIHRtcC0+dGV4dCgpKTsKICAgICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9GVU5D
X0NBTEwpOwogICAgICAgICB0bXAgPSBjaHVua19nZXRfcHJldl9uY25sbmkoc2V0X3BhcmVu
X3BhcmVudCh0dCwgQ1RfRlVOQ19DQUxMKSk7ICAgLy8gSXNzdWUgIzIyNzkKICAgICAgfQog
ICAgICBlbHNlCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9PQ19N
U0dfQ0xBU1MpOwogICAgICB9CiAgIH0KICAgc2V0X2NodW5rX3BhcmVudChvcywgQ1RfT0Nf
TVNHKTsKICAgY2h1bmtfZmxhZ3Nfc2V0KG9zLCBQQ0ZfSU5fT0NfTVNHKTsKICAgc2V0X2No
dW5rX3BhcmVudChjcywgQ1RfT0NfTVNHKTsKICAgY2h1bmtfZmxhZ3Nfc2V0KGNzLCBQQ0Zf
SU5fT0NfTVNHKTsKCiAgIC8vIGhhbmRsZSAnPCBwcm90b2NvbCA+JwogICB0bXAgPSBjaHVu
a19nZXRfbmV4dF9uY25sKHRtcCk7CgogICBpZiAoY2h1bmtfaXNfc3RyKHRtcCwgIjwiLCAx
KSkKICAgewogICAgICBjaHVua190ICphbyA9IHRtcDsKICAgICAgY2h1bmtfdCAqYWMgPSBj
aHVua19nZXRfbmV4dF9zdHIoYW8sICI+IiwgMSwgYW8tPmxldmVsKTsKCiAgICAgIGlmIChh
YykKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZShhbywgQ1RfQU5HTEVfT1BFTik7
CiAgICAgICAgIHNldF9jaHVua19wYXJlbnQoYW8sIENUX09DX1BST1RPX0xJU1QpOwogICAg
ICAgICBzZXRfY2h1bmtfdHlwZShhYywgQ1RfQU5HTEVfQ0xPU0UpOwogICAgICAgICBzZXRf
Y2h1bmtfcGFyZW50KGFjLCBDVF9PQ19QUk9UT19MSVNUKTsKCiAgICAgICAgIGZvciAodG1w
ID0gY2h1bmtfZ2V0X25leHQoYW8pOyB0bXAgIT0gYWM7IHRtcCA9IGNodW5rX2dldF9uZXh0
KHRtcCkpCiAgICAgICAgIHsKICAgICAgICAgICAgdG1wLT5sZXZlbCArPSAxOwogICAgICAg
ICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfT0NfUFJPVE9fTElTVCk7CiAgICAgICAg
IH0KICAgICAgfQogICAgICB0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKGFjKTsKICAgfQog
ICAvLyBoYW5kbGUgJ29iamVjdC5wcm9wZXJ0eScgYW5kICdjb2xsZWN0aW9uW2luZGV4XScK
ICAgZWxzZQogICB7CiAgICAgIHdoaWxlICh0bXApCiAgICAgIHsKICAgICAgICAgaWYgKGNo
dW5rX2lzX3Rva2VuKHRtcCwgQ1RfTUVNQkVSKSkgIC8vIG1vdmUgcGFzdCBbb2JqZWN0LnBy
b3AxLnByb3AyCiAgICAgICAgIHsKICAgICAgICAgICAgY2h1bmtfdCAqdHlwID0gY2h1bmtf
Z2V0X25leHRfbmNubCh0bXApOwoKICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHR5
cCwgQ1RfV09SRCkgfHwgY2h1bmtfaXNfdG9rZW4odHlwLCBDVF9UWVBFKSkKICAgICAgICAg
ICAgewogICAgICAgICAgICAgICB0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKHR5cCk7CiAg
ICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAg
ICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgICAgZWxzZSBpZiAo
Y2h1bmtfaXNfdG9rZW4odG1wLCBDVF9TUVVBUkVfT1BFTikpICAvLyBtb3ZlIHBhc3QgW2Nv
bGxlY3Rpb25baW5kZXhdCiAgICAgICAgIHsKICAgICAgICAgICAgY2h1bmtfdCAqdGNzID0g
Y2h1bmtfZ2V0X25leHRfbmNubCh0bXApOwoKICAgICAgICAgICAgd2hpbGUgKHRjcyAhPSBu
dWxscHRyICYmIHRjcy0+bGV2ZWwgPiB0bXAtPmxldmVsKQogICAgICAgICAgICB7CiAgICAg
ICAgICAgICAgIHRjcyA9IGNodW5rX2dldF9uZXh0X25jbmwodGNzKTsKICAgICAgICAgICAg
fQoKICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHRjcywgQ1RfU1FVQVJFX0NMT1NF
KSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICB0bXAgPSBjaHVua19nZXRfbmV4dF9u
Y25sKHRjcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7
CiAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAg
ICAgZWxzZQogICAgICAgICB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAgICAg
IH0KICAgfQoKICAgLy8gWyhzZWxmLmZvby5iYXIpIG1ldGhvZF0KICAgaWYgKGNodW5rX2lz
X3BhcmVuX29wZW4odG1wKSkKICAgewogICAgICB0bXAgPSBjaHVua19nZXRfbmV4dF9uY25s
KGNodW5rX3NraXBfdG9fbWF0Y2godG1wKSk7CiAgIH0KCiAgIGlmIChjaHVua19pc190b2tl
bih0bXAsIENUX1dPUkQpIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfVFlQRSkpCiAgIHsK
ICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9PQ19NU0dfRlVOQyk7CiAgIH0KICAgY2h1
bmtfdCAqcHJldiA9IG51bGxwdHI7CgogICBmb3IgKHRtcCA9IGNodW5rX2dldF9uZXh0KG9z
KTsgdG1wICE9IGNzOyB0bXAgPSBjaHVua19nZXRfbmV4dCh0bXApKQogICB7CiAgICAgIGNo
dW5rX2ZsYWdzX3NldCh0bXAsIFBDRl9JTl9PQ19NU0cpOwoKICAgICAgaWYgKHRtcC0+bGV2
ZWwgPT0gY3MtPmxldmVsICsgMSkKICAgICAgewogICAgICAgICBpZiAoY2h1bmtfaXNfdG9r
ZW4odG1wLCBDVF9DT0xPTikpCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3R5
cGUodG1wLCBDVF9PQ19DT0xPTik7CgogICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4o
cHJldiwgQ1RfV09SRCkgfHwgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfVFlQRSkpCiAgICAg
ICAgICAgIHsKICAgICAgICAgICAgICAgLy8gTWlnaHQgYmUgYSBuYW1lZCBwYXJhbSwgY2hl
Y2sgcHJldmlvdXMgYmxvY2sKICAgICAgICAgICAgICAgY2h1bmtfdCAqcHAgPSBjaHVua19n
ZXRfcHJldihwcmV2KTsKCiAgICAgICAgICAgICAgIGlmICggIHBwICE9IG51bGxwdHIKICAg
ICAgICAgICAgICAgICAgJiYgcHAtPnR5cGUgIT0gQ1RfT0NfQ09MT04KICAgICAgICAgICAg
ICAgICAgJiYgcHAtPnR5cGUgIT0gQ1RfQVJJVEgKICAgICAgICAgICAgICAgICAgJiYgcHAt
PnR5cGUgIT0gQ1RfQ0FSRVQpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg
c2V0X2NodW5rX3R5cGUocHJldiwgQ1RfT0NfTVNHX05BTUUpOwogICAgICAgICAgICAgICAg
ICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgQ1RfT0NfTVNHX05BTUUpOwogICAgICAgICAgICAg
ICB9CiAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgICB9CiAgICAgIHByZXYgPSB0bXA7
CiAgIH0KfSAvLyBoYW5kbGVfb2NfbWVzc2FnZV9zZW5kCgoKc3RhdGljIHZvaWQgaGFuZGxl
X29jX2F2YWlsYWJsZShjaHVua190ICpvcykKewogICBvcyA9IGNodW5rX2dldF9uZXh0KG9z
KTsKCiAgIHdoaWxlIChvcyAhPSBudWxscHRyKQogICB7CiAgICAgIGNfdG9rZW5fdCBvcmln
VHlwZSA9IG9zLT50eXBlOwogICAgICBzZXRfY2h1bmtfdHlwZShvcywgQ1RfT0NfQVZBSUxB
QkxFX1ZBTFVFKTsKCiAgICAgIGlmIChvcmlnVHlwZSA9PSBDVF9QQVJFTl9DTE9TRSkKICAg
ICAgewogICAgICAgICBicmVhazsKICAgICAgfQogICAgICBvcyA9IGNodW5rX2dldF9uZXh0
KG9zKTsKICAgfQp9CgoKc3RhdGljIHZvaWQgaGFuZGxlX29jX3Byb3BlcnR5X2RlY2woY2h1
bmtfdCAqb3MpCnsKICAgbG9nX3J1bGVfQigibW9kX3NvcnRfb2NfcHJvcGVydGllcyIpOwoK
ICAgaWYgKG9wdGlvbnM6Om1vZF9zb3J0X29jX3Byb3BlcnRpZXMoKSkKICAgewogICAgICB0
eXBlZGVmIHN0ZDo6dmVjdG9yPGNodW5rX3QgKj4gQ2h1bmtHcm91cDsKCiAgICAgIGNodW5r
X3QgICAgICAgICAgICAgICAgICpuZXh0ICAgICAgID0gY2h1bmtfZ2V0X25leHQob3MpOwog
ICAgICBjaHVua190ICAgICAgICAgICAgICAgICAqb3Blbl9wYXJlbiA9IG51bGxwdHI7Cgog
ICAgICBzdGQ6OnZlY3RvcjxDaHVua0dyb3VwPiBjbGFzc19jaHVua3M7ICAgICAgIC8vIGNs
YXNzCiAgICAgIHN0ZDo6dmVjdG9yPENodW5rR3JvdXA+IHRocmVhZF9jaHVua3M7ICAgICAg
Ly8gYXRvbWljLCBub25hdG9taWMKICAgICAgc3RkOjp2ZWN0b3I8Q2h1bmtHcm91cD4gcmVh
ZHdyaXRlX2NodW5rczsgICAvLyByZWFkd3JpdGUsIHJlYWRvbmx5CiAgICAgIHN0ZDo6dmVj
dG9yPENodW5rR3JvdXA+IHJlZl9jaHVua3M7ICAgICAgICAgLy8gcmV0YWluLCBjb3B5LCBh
c3NpZ24sIHdlYWssIHN0cm9uZywgdW5zYWZlX3VucmV0YWluZWQKICAgICAgc3RkOjp2ZWN0
b3I8Q2h1bmtHcm91cD4gZ2V0dGVyX2NodW5rczsgICAgICAvLyBnZXR0ZXIKICAgICAgc3Rk
Ojp2ZWN0b3I8Q2h1bmtHcm91cD4gc2V0dGVyX2NodW5rczsgICAgICAvLyBzZXR0ZXIKICAg
ICAgc3RkOjp2ZWN0b3I8Q2h1bmtHcm91cD4gbnVsbGFiaWxpdHlfY2h1bmtzOyAvLyBub25u
dWxsLCBudWxsYWJsZSwgbnVsbF91bnNwZWNpZmllZCwgbnVsbF9yZXNldHRhYmxlCiAgICAg
IHN0ZDo6dmVjdG9yPENodW5rR3JvdXA+IG90aGVyX2NodW5rczsgICAgICAgLy8gYW55IHdv
cmRzIG90aGVyIHRoYW4gYWJvdmUKCiAgICAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBD
VF9QQVJFTl9PUEVOKSkKICAgICAgewogICAgICAgICBvcGVuX3BhcmVuID0gbmV4dDsKICAg
ICAgICAgbmV4dCAgICAgICA9IGNodW5rX2dldF9uZXh0KG5leHQpOwoKICAgICAgICAgLyoK
ICAgICAgICAgICogRGV0ZXJtaW5lIGxvY2F0aW9uIG9mIHRoZSBwcm9wZXJ0eSBhdHRyaWJ1
dGVzCiAgICAgICAgICAqIE5PVEU6IERpZCBub3QgZG8gdGhpcyBpbiB0aGUgY29tYmluZS5j
cHAgZG9fc3ltYm9sX2NoZWNrIGFzCiAgICAgICAgICAqIEkgd2FzIG5vdCBzdXJlIHdoYXQg
dGhlIHJhbWlmaWNhdGlvbnMgb2YgYWRkaW5nIGEgbmV3IHR5cGUKICAgICAgICAgICogZm9y
IGVhY2ggb2YgdGhlIGJlbG93IHR5cGVzIHdvdWxkIGJlLiBJdCBkaWQgYnJlYWsgc29tZSBp
dGVtcwogICAgICAgICAgKiB3aGVuIEkgYXR0ZW1wdGVkIHRvIGFkZCB0aGVtIHNvIHRoaXMg
aXMgbXkgaGFjayBmb3Igbm93LgogICAgICAgICAgKi8KICAgICAgICAgd2hpbGUgKG5leHQg
IT0gbnVsbHB0ciAmJiBuZXh0LT50eXBlICE9IENUX1BBUkVOX0NMT1NFKQogICAgICAgICB7
CiAgICAgICAgICAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9PQ19QUk9QRVJUWV9B
VFRSKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICBpZiAoICBjaHVua19pc19zdHIo
bmV4dCwgImF0b21pYyIsIDYpCiAgICAgICAgICAgICAgICAgIHx8IGNodW5rX2lzX3N0cihu
ZXh0LCAibm9uYXRvbWljIiwgOSkpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg
ICAgQ2h1bmtHcm91cCBjaHVua0dyb3VwOwogICAgICAgICAgICAgICAgICBjaHVua0dyb3Vw
LnB1c2hfYmFjayhuZXh0KTsKICAgICAgICAgICAgICAgICAgdGhyZWFkX2NodW5rcy5wdXNo
X2JhY2soY2h1bmtHcm91cCk7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgZWxz
ZSBpZiAoICBjaHVua19pc19zdHIobmV4dCwgInJlYWRvbmx5IiwgOCkKICAgICAgICAgICAg
ICAgICAgICAgICB8fCBjaHVua19pc19zdHIobmV4dCwgInJlYWR3cml0ZSIsIDkpKQogICAg
ICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIENodW5rR3JvdXAgY2h1bmtHcm91cDsK
ICAgICAgICAgICAgICAgICAgY2h1bmtHcm91cC5wdXNoX2JhY2sobmV4dCk7CiAgICAgICAg
ICAgICAgICAgIHJlYWR3cml0ZV9jaHVua3MucHVzaF9iYWNrKGNodW5rR3JvdXApOwogICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGVsc2UgaWYgKCAgY2h1bmtfaXNfc3RyKG5l
eHQsICJhc3NpZ24iLCA2KQogICAgICAgICAgICAgICAgICAgICAgIHx8IGNodW5rX2lzX3N0
cihuZXh0LCAicmV0YWluIiwgNikKICAgICAgICAgICAgICAgICAgICAgICB8fCBjaHVua19p
c19zdHIobmV4dCwgImNvcHkiLCA0KQogICAgICAgICAgICAgICAgICAgICAgIHx8IGNodW5r
X2lzX3N0cihuZXh0LCAic3Ryb25nIiwgNikKICAgICAgICAgICAgICAgICAgICAgICB8fCBj
aHVua19pc19zdHIobmV4dCwgIndlYWsiLCA0KQogICAgICAgICAgICAgICAgICAgICAgIHx8
IGNodW5rX2lzX3N0cihuZXh0LCAidW5zYWZlX3VucmV0YWluZWQiLCAxNykpCiAgICAgICAg
ICAgICAgIHsKICAgICAgICAgICAgICAgICAgQ2h1bmtHcm91cCBjaHVua0dyb3VwOwogICAg
ICAgICAgICAgICAgICBjaHVua0dyb3VwLnB1c2hfYmFjayhuZXh0KTsKICAgICAgICAgICAg
ICAgICAgcmVmX2NodW5rcy5wdXNoX2JhY2soY2h1bmtHcm91cCk7CiAgICAgICAgICAgICAg
IH0KICAgICAgICAgICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfc3RyKG5leHQsICJnZXR0ZXIi
LCA2KSkKICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBDaHVua0dyb3VwIGNo
dW5rR3JvdXA7CgogICAgICAgICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgICB7CiAg
ICAgICAgICAgICAgICAgICAgIGNodW5rR3JvdXAucHVzaF9iYWNrKG5leHQpOwogICAgICAg
ICAgICAgICAgICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHQobmV4dCk7CiAgICAgICAgICAg
ICAgICAgIH0gd2hpbGUgKCAgbmV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICYmIG5l
eHQtPnR5cGUgIT0gQ1RfQ09NTUEKICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBuZXh0
LT50eXBlICE9IENUX1BBUkVOX0NMT1NFKTsKCiAgICAgICAgICAgICAgICAgIG5leHQgPSBu
ZXh0LT5wcmV2OwoKICAgICAgICAgICAgICAgICAgLy8gY292ZXJpdHkgQ0lEIDE2MDk0Ngog
ICAgICAgICAgICAgICAgICBpZiAobmV4dCA9PSBudWxscHRyKQogICAgICAgICAgICAgICAg
ICB7CiAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAg
ICAgICAgICAgICAgICAgIGdldHRlcl9jaHVua3MucHVzaF9iYWNrKGNodW5rR3JvdXApOwog
ICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3N0cihu
ZXh0LCAic2V0dGVyIiwgNikpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg
Q2h1bmtHcm91cCBjaHVua0dyb3VwOwoKICAgICAgICAgICAgICAgICAgZG8KICAgICAgICAg
ICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICBjaHVua0dyb3VwLnB1c2hfYmFjayhu
ZXh0KTsKICAgICAgICAgICAgICAgICAgICAgbmV4dCA9IGNodW5rX2dldF9uZXh0KG5leHQp
OwogICAgICAgICAgICAgICAgICB9IHdoaWxlICggIG5leHQKICAgICAgICAgICAgICAgICAg
ICAgICAgICAmJiBuZXh0LT50eXBlICE9IENUX0NPTU1BCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgJiYgbmV4dC0+dHlwZSAhPSBDVF9QQVJFTl9DTE9TRSk7CgogICAgICAgICAgICAg
ICAgICBuZXh0ID0gY2h1bmtfZ2V0X3ByZXYobmV4dCk7CgogICAgICAgICAgICAgICAgICBp
ZiAobmV4dCA9PSBudWxscHRyKQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAg
ICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHNl
dHRlcl9jaHVua3MucHVzaF9iYWNrKGNodW5rR3JvdXApOwogICAgICAgICAgICAgICB9CiAg
ICAgICAgICAgICAgIGVsc2UgaWYgKCAgY2h1bmtfaXNfc3RyKG5leHQsICJudWxsYWJsZSIs
IDgpCiAgICAgICAgICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfc3RyKG5leHQsICJub25u
dWxsIiwgNykKICAgICAgICAgICAgICAgICAgICAgICB8fCBjaHVua19pc19zdHIobmV4dCwg
Im51bGxfcmVzZXR0YWJsZSIsIDE1KQogICAgICAgICAgICAgICAgICAgICAgIHx8IGNodW5r
X2lzX3N0cihuZXh0LCAibnVsbF91bnNwZWNpZmllZCIsIDE2KSkKICAgICAgICAgICAgICAg
ewogICAgICAgICAgICAgICAgICBDaHVua0dyb3VwIGNodW5rR3JvdXA7CiAgICAgICAgICAg
ICAgICAgIGNodW5rR3JvdXAucHVzaF9iYWNrKG5leHQpOwogICAgICAgICAgICAgICAgICBu
dWxsYWJpbGl0eV9jaHVua3MucHVzaF9iYWNrKGNodW5rR3JvdXApOwogICAgICAgICAgICAg
ICB9CiAgICAgICAgICAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3N0cihuZXh0LCAiY2xhc3Mi
LCA1KSkKICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBDaHVua0dyb3VwIGNo
dW5rR3JvdXA7CiAgICAgICAgICAgICAgICAgIGNodW5rR3JvdXAucHVzaF9iYWNrKG5leHQp
OwogICAgICAgICAgICAgICAgICBjbGFzc19jaHVua3MucHVzaF9iYWNrKGNodW5rR3JvdXAp
OwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg
ewogICAgICAgICAgICAgICAgICBDaHVua0dyb3VwIGNodW5rR3JvdXA7CiAgICAgICAgICAg
ICAgICAgIGNodW5rR3JvdXAucHVzaF9iYWNrKG5leHQpOwogICAgICAgICAgICAgICAgICBv
dGhlcl9jaHVua3MucHVzaF9iYWNrKGNodW5rR3JvdXApOwogICAgICAgICAgICAgICB9CiAg
ICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfd29yZChuZXh0KSkK
ICAgICAgICAgICAgewogICAgICAgICAgICAgICBpZiAoY2h1bmtfaXNfc3RyKG5leHQsICJj
bGFzcyIsIDUpKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIENodW5rR3Jv
dXAgY2h1bmtHcm91cDsKICAgICAgICAgICAgICAgICAgY2h1bmtHcm91cC5wdXNoX2JhY2so
bmV4dCk7CiAgICAgICAgICAgICAgICAgIGNsYXNzX2NodW5rcy5wdXNoX2JhY2soY2h1bmtH
cm91cCk7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg
ICAgICB7CiAgICAgICAgICAgICAgICAgIENodW5rR3JvdXAgY2h1bmtHcm91cDsKICAgICAg
ICAgICAgICAgICAgY2h1bmtHcm91cC5wdXNoX2JhY2sobmV4dCk7CiAgICAgICAgICAgICAg
ICAgIG90aGVyX2NodW5rcy5wdXNoX2JhY2soY2h1bmtHcm91cCk7CiAgICAgICAgICAgICAg
IH0KICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHQobmV4
dCk7CiAgICAgICAgIH0KICAgICAgICAgbG9nX3J1bGVfQigibW9kX3NvcnRfb2NfcHJvcGVy
dHlfY2xhc3Nfd2VpZ2h0Iik7CiAgICAgICAgIGludCBjbGFzc193ID0gb3B0aW9uczo6bW9k
X3NvcnRfb2NfcHJvcGVydHlfY2xhc3Nfd2VpZ2h0KCk7CiAgICAgICAgIGxvZ19ydWxlX0Io
Im1vZF9zb3J0X29jX3Byb3BlcnR5X3RocmVhZF9zYWZlX3dlaWdodCIpOwogICAgICAgICBp
bnQgdGhyZWFkX3cgPSBvcHRpb25zOjptb2Rfc29ydF9vY19wcm9wZXJ0eV90aHJlYWRfc2Fm
ZV93ZWlnaHQoKTsKICAgICAgICAgbG9nX3J1bGVfQigibW9kX3NvcnRfb2NfcHJvcGVydHlf
cmVhZHdyaXRlX3dlaWdodCIpOwogICAgICAgICBpbnQgcmVhZHdyaXRlX3cgPSBvcHRpb25z
Ojptb2Rfc29ydF9vY19wcm9wZXJ0eV9yZWFkd3JpdGVfd2VpZ2h0KCk7CiAgICAgICAgIGxv
Z19ydWxlX0IoIm1vZF9zb3J0X29jX3Byb3BlcnR5X3JlZmVyZW5jZV93ZWlnaHQiKTsKICAg
ICAgICAgaW50IHJlZl93ID0gb3B0aW9uczo6bW9kX3NvcnRfb2NfcHJvcGVydHlfcmVmZXJl
bmNlX3dlaWdodCgpOwogICAgICAgICBsb2dfcnVsZV9CKCJtb2Rfc29ydF9vY19wcm9wZXJ0
eV9nZXR0ZXJfd2VpZ2h0Iik7CiAgICAgICAgIGludCBnZXR0ZXJfdyA9IG9wdGlvbnM6Om1v
ZF9zb3J0X29jX3Byb3BlcnR5X2dldHRlcl93ZWlnaHQoKTsKICAgICAgICAgbG9nX3J1bGVf
QigibW9kX3NvcnRfb2NfcHJvcGVydHlfc2V0dGVyX3dlaWdodCIpOwogICAgICAgICBpbnQg
c2V0dGVyX3cgPSBvcHRpb25zOjptb2Rfc29ydF9vY19wcm9wZXJ0eV9zZXR0ZXJfd2VpZ2h0
KCk7CiAgICAgICAgIGxvZ19ydWxlX0IoIm1vZF9zb3J0X29jX3Byb3BlcnR5X251bGxhYmls
aXR5X3dlaWdodCIpOwogICAgICAgICBpbnQgbnVsbGFiaWxpdHlfdyA9IG9wdGlvbnM6Om1v
ZF9zb3J0X29jX3Byb3BlcnR5X251bGxhYmlsaXR5X3dlaWdodCgpOwoKICAgICAgICAgLy8K
ICAgICAgICAgc3RkOjptdWx0aW1hcDxpbnQsIHN0ZDo6dmVjdG9yPENodW5rR3JvdXA+ID4g
c29ydGVkX2NodW5rX21hcDsKICAgICAgICAgc29ydGVkX2NodW5rX21hcC5pbnNlcnQocGFp
cjxpbnQsIHN0ZDo6dmVjdG9yPENodW5rR3JvdXA+ID4oY2xhc3NfdywgY2xhc3NfY2h1bmtz
KSk7CiAgICAgICAgIHNvcnRlZF9jaHVua19tYXAuaW5zZXJ0KHBhaXI8aW50LCBzdGQ6OnZl
Y3RvcjxDaHVua0dyb3VwPiA+KHRocmVhZF93LCB0aHJlYWRfY2h1bmtzKSk7CiAgICAgICAg
IHNvcnRlZF9jaHVua19tYXAuaW5zZXJ0KHBhaXI8aW50LCBzdGQ6OnZlY3RvcjxDaHVua0dy
b3VwPiA+KHJlYWR3cml0ZV93LCByZWFkd3JpdGVfY2h1bmtzKSk7CiAgICAgICAgIHNvcnRl
ZF9jaHVua19tYXAuaW5zZXJ0KHBhaXI8aW50LCBzdGQ6OnZlY3RvcjxDaHVua0dyb3VwPiA+
KHJlZl93LCByZWZfY2h1bmtzKSk7CiAgICAgICAgIHNvcnRlZF9jaHVua19tYXAuaW5zZXJ0
KHBhaXI8aW50LCBzdGQ6OnZlY3RvcjxDaHVua0dyb3VwPiA+KGdldHRlcl93LCBnZXR0ZXJf
Y2h1bmtzKSk7CiAgICAgICAgIHNvcnRlZF9jaHVua19tYXAuaW5zZXJ0KHBhaXI8aW50LCBz
dGQ6OnZlY3RvcjxDaHVua0dyb3VwPiA+KHNldHRlcl93LCBzZXR0ZXJfY2h1bmtzKSk7CiAg
ICAgICAgIHNvcnRlZF9jaHVua19tYXAuaW5zZXJ0KHBhaXI8aW50LCBzdGQ6OnZlY3RvcjxD
aHVua0dyb3VwPiA+KG51bGxhYmlsaXR5X3csIG51bGxhYmlsaXR5X2NodW5rcykpOwogICAg
ICAgICBzb3J0ZWRfY2h1bmtfbWFwLmluc2VydChwYWlyPGludCwgc3RkOjp2ZWN0b3I8Q2h1
bmtHcm91cD4gPihzdGQ6Om51bWVyaWNfbGltaXRzPGludD46Om1pbigpLCBvdGhlcl9jaHVu
a3MpKTsKCiAgICAgICAgIGNodW5rX3QgKmN1cnJfY2h1bmsgPSBvcGVuX3BhcmVuOwoKICAg
ICAgICAgZm9yIChtdWx0aW1hcDxpbnQsIHN0ZDo6dmVjdG9yPENodW5rR3JvdXA+ID46OnJl
dmVyc2VfaXRlcmF0b3IgaXQgPSBzb3J0ZWRfY2h1bmtfbWFwLnJiZWdpbigpOyBpdCAhPSBz
b3J0ZWRfY2h1bmtfbWFwLnJlbmQoKTsgKytpdCkKICAgICAgICAgewogICAgICAgICAgICBz
dGQ6OnZlY3RvcjxDaHVua0dyb3VwPiBjaHVua19ncm91cHMgPSAoKml0KS5zZWNvbmQ7Cgog
ICAgICAgICAgICBmb3IgKGF1dG8gY2h1bmtfZ3JvdXAgOiBjaHVua19ncm91cHMpCiAgICAg
ICAgICAgIHsKICAgICAgICAgICAgICAgZm9yIChhdXRvIGNodW5rIDogY2h1bmtfZ3JvdXAp
CiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgY2h1bmstPm9yaWdfcHJldl9z
cCA9IDA7CgogICAgICAgICAgICAgICAgICBpZiAoY2h1bmsgIT0gY3Vycl9jaHVuaykKICAg
ICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICBjaHVua19tb3ZlX2FmdGVy
KGNodW5rLCBjdXJyX2NodW5rKTsKICAgICAgICAgICAgICAgICAgICAgY3Vycl9jaHVuayA9
IGNodW5rOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UKICAg
ICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICBjdXJyX2NodW5rID0gY2h1
bmtfZ2V0X25leHQoY3Vycl9jaHVuayk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg
ICAgICAgfQoKICAgICAgICAgICAgICAgLy8gYWRkIHRoZSBwYXJlbnRoZXNpcwogICAgICAg
ICAgICAgICBjaHVua190IGVuZGNodW5rOwogICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlw
ZSgmZW5kY2h1bmssIENUX0NPTU1BKTsKICAgICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVu
dCgmZW5kY2h1bmssIGdldF9jaHVua19wYXJlbnRfdHlwZShjdXJyX2NodW5rKSk7CiAgICAg
ICAgICAgICAgIGVuZGNodW5rLnN0ciAgICAgICAgID0gIiwiOwogICAgICAgICAgICAgICBl
bmRjaHVuay5sZXZlbCAgICAgICA9IGN1cnJfY2h1bmstPmxldmVsOwogICAgICAgICAgICAg
ICBlbmRjaHVuay5icmFjZV9sZXZlbCA9IGN1cnJfY2h1bmstPmJyYWNlX2xldmVsOwogICAg
ICAgICAgICAgICBlbmRjaHVuay5vcmlnX2xpbmUgICA9IGN1cnJfY2h1bmstPm9yaWdfbGlu
ZTsKICAgICAgICAgICAgICAgZW5kY2h1bmsub3JpZ19jb2wgICAgPSBjdXJyX2NodW5rLT5v
cmlnX2NvbDsKICAgICAgICAgICAgICAgZW5kY2h1bmsuY29sdW1uICAgICAgPSBjdXJyX2No
dW5rLT5vcmlnX2NvbF9lbmQgKyAxOwogICAgICAgICAgICAgICBlbmRjaHVuay5mbGFncyAg
ICAgICA9IGN1cnJfY2h1bmstPmZsYWdzICYgUENGX0NPUFlfRkxBR1M7CiAgICAgICAgICAg
ICAgIGNodW5rX2FkZF9hZnRlcigmZW5kY2h1bmssIGN1cnJfY2h1bmspOwogICAgICAgICAg
ICAgICBjdXJyX2NodW5rID0gY3Vycl9jaHVuay0+bmV4dDsKICAgICAgICAgICAgfQogICAg
ICAgICB9CgogICAgICAgICAvLyBSZW1vdmUgdGhlIGV4dHJhIGNvbW1hJ3MgdGhhdCB3ZSBk
aWQgbm90IG1vdmUKICAgICAgICAgd2hpbGUgKGN1cnJfY2h1bmsgJiYgY3Vycl9jaHVuay0+
dHlwZSAhPSBDVF9QQVJFTl9DTE9TRSkKICAgICAgICAgewogICAgICAgICAgICBjaHVua190
ICpybV9jaHVuayA9IGN1cnJfY2h1bms7CiAgICAgICAgICAgIGN1cnJfY2h1bmsgPSBjaHVu
a19nZXRfbmV4dChjdXJyX2NodW5rKTsKICAgICAgICAgICAgY2h1bmtfZGVsKHJtX2NodW5r
KTsKICAgICAgICAgfQogICAgICB9CiAgIH0KICAgY2h1bmtfdCAqdG1wID0gY2h1bmtfZ2V0
X25leHRfbmNubChvcyk7CgogICBpZiAoY2h1bmtfaXNfcGFyZW5fb3Blbih0bXApKQogICB7
CiAgICAgIHRtcCA9IGNodW5rX2dldF9uZXh0X25jbmwoY2h1bmtfc2tpcF90b19tYXRjaCh0
bXApKTsKICAgfQogICBmaXhfdmFyaWFibGVfZGVmaW5pdGlvbih0bXApOwp9IC8vIGhhbmRs
ZV9vY19wcm9wZXJ0eV9kZWNsCgoKc3RhdGljIHZvaWQgaGFuZGxlX2NzX3NxdWFyZV9zdG10
KGNodW5rX3QgKm9zKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CgogICBjaHVua190ICpjcyA9
IGNodW5rX2dldF9uZXh0KG9zKTsKCiAgIHdoaWxlIChjcyAhPSBudWxscHRyICYmIGNzLT5s
ZXZlbCA+IG9zLT5sZXZlbCkKICAgewogICAgICBjcyA9IGNodW5rX2dldF9uZXh0KGNzKTsK
ICAgfQoKICAgaWYgKGNzID09IG51bGxwdHIgfHwgY3MtPnR5cGUgIT0gQ1RfU1FVQVJFX0NM
T1NFKQogICB7CiAgICAgIHJldHVybjsKICAgfQogICBzZXRfY2h1bmtfcGFyZW50KG9zLCBD
VF9DU19TUV9TVE1UKTsKICAgc2V0X2NodW5rX3BhcmVudChjcywgQ1RfQ1NfU1FfU1RNVCk7
CgogICBjaHVua190ICp0bXA7CgogICBmb3IgKHRtcCA9IGNodW5rX2dldF9uZXh0KG9zKTsg
dG1wICE9IGNzOyB0bXAgPSBjaHVua19nZXRfbmV4dCh0bXApKQogICB7CiAgICAgIHNldF9j
aHVua19wYXJlbnQodG1wLCBDVF9DU19TUV9TVE1UKTsKCiAgICAgIGlmIChjaHVua19pc190
b2tlbih0bXAsIENUX0NPTE9OKSkKICAgICAgewogICAgICAgICBzZXRfY2h1bmtfdHlwZSh0
bXAsIENUX0NTX1NRX0NPTE9OKTsKICAgICAgfQogICB9CgogICB0bXAgPSBjaHVua19nZXRf
bmV4dF9uY25sKGNzKTsKCiAgIGlmICh0bXAgIT0gbnVsbHB0cikKICAgewogICAgICBjaHVu
a19mbGFnc19zZXQodG1wLCBQQ0ZfU1RNVF9TVEFSVCB8IFBDRl9FWFBSX1NUQVJUKTsKICAg
fQp9CgoKc3RhdGljIHZvaWQgaGFuZGxlX2NzX3Byb3BlcnR5KGNodW5rX3QgKmJybykKewog
ICBMT0dfRlVOQ19FTlRSWSgpOwoKICAgc2V0X3BhcmVuX3BhcmVudChicm8sIENUX0NTX1BS
T1BFUlRZKTsKCiAgIGJvb2wgICAgZGlkX3Byb3AgPSBmYWxzZTsKICAgY2h1bmtfdCAqcGMg
ICAgICA9IGJybzsKCiAgIHdoaWxlICgocGMgPSBjaHVua19nZXRfcHJldl9uY25sbmkocGMp
KSAhPSBudWxscHRyKSAgIC8vIElzc3VlICMyMjc5CiAgIHsKICAgICAgaWYgKHBjLT5sZXZl
bCA9PSBicm8tPmxldmVsKQogICAgICB7CiAgICAgICAgIC8vcHJldmVudCBzY2FubmluZyBi
YWNrIHBhc3QgJ25ldycgaW4gZXhwcmVzc2lvbnMgbGlrZSBuZXcgTGlzdDxpbnQ+IHsxLDIs
M30KICAgICAgICAgLy8gSXNzdWUgIyAxNjIwLCBVTkktMjQwOTAuY3MKICAgICAgICAgaWYg
KGNodW5rX2lzX3Rva2VuKHBjLCBDVF9ORVcpKQogICAgICAgICB7CiAgICAgICAgICAgIGJy
ZWFrOwogICAgICAgICB9CgogICAgICAgICBpZiAoICAhZGlkX3Byb3AKICAgICAgICAgICAg
JiYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9XT1JEKSB8fCBjaHVua19pc190b2tlbihwYywg
Q1RfVEhJUykpKQogICAgICAgICB7CiAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBD
VF9DU19QUk9QRVJUWSk7CiAgICAgICAgICAgIGRpZF9wcm9wID0gdHJ1ZTsKICAgICAgICAg
fQogICAgICAgICBlbHNlCiAgICAgICAgIHsKICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVu
dChwYywgQ1RfQ1NfUFJPUEVSVFkpOwogICAgICAgICAgICBtYWtlX3R5cGUocGMpOwogICAg
ICAgICB9CgogICAgICAgICBpZiAocGMtPmZsYWdzLnRlc3QoUENGX1NUTVRfU1RBUlQpKQog
ICAgICAgICB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAgICAgIH0KICAgfQp9
CgoKc3RhdGljIHZvaWQgaGFuZGxlX2NzX2FycmF5X3R5cGUoY2h1bmtfdCAqcGMpCnsKICAg
Y2h1bmtfdCAqcHJldjsKCiAgIGZvciAocHJldiA9IGNodW5rX2dldF9wcmV2KHBjKTsKICAg
ICAgICBjaHVua19pc190b2tlbihwcmV2LCBDVF9DT01NQSk7CiAgICAgICAgcHJldiA9IGNo
dW5rX2dldF9wcmV2KHByZXYpKQogICB7CiAgICAgIC8vIGVtcHR5CiAgIH0KCiAgIGlmIChj
aHVua19pc190b2tlbihwcmV2LCBDVF9TUVVBUkVfT1BFTikpCiAgIHsKICAgICAgd2hpbGUg
KHBjICE9IHByZXYpCiAgICAgIHsKICAgICAgICAgc2V0X2NodW5rX3BhcmVudChwYywgQ1Rf
VFlQRSk7CiAgICAgICAgIHBjID0gY2h1bmtfZ2V0X3ByZXYocGMpOwogICAgICB9CiAgICAg
IHNldF9jaHVua19wYXJlbnQocHJldiwgQ1RfVFlQRSk7CiAgIH0KfQoKCnN0YXRpYyB2b2lk
IGhhbmRsZV93cmFwKGNodW5rX3QgKnBjKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CiAgIGNo
dW5rX3QgKm9wcCAgPSBjaHVua19nZXRfbmV4dChwYyk7CiAgIGNodW5rX3QgKm5hbWUgPSBj
aHVua19nZXRfbmV4dChvcHApOwogICBjaHVua190ICpjbHAgID0gY2h1bmtfZ2V0X25leHQo
bmFtZSk7CgogICBsb2dfcnVsZV9CKCJzcF9mdW5jX2NhbGxfcGFyZW4iKTsKICAgbG9nX3J1
bGVfQigic3BfY3BwX2Nhc3RfcGFyZW4iKTsKICAgaWFyZl9lIHBhdiA9IChwYy0+dHlwZSA9
PSBDVF9GVU5DX1dSQVApID8KICAgICAgICAgICAgICAgIG9wdGlvbnM6OnNwX2Z1bmNfY2Fs
bF9wYXJlbigpIDoKICAgICAgICAgICAgICAgIG9wdGlvbnM6OnNwX2NwcF9jYXN0X3BhcmVu
KCk7CgogICBsb2dfcnVsZV9CKCJzcF9pbnNpZGVfZnBhcmVuIik7CiAgIGxvZ19ydWxlX0Io
InNwX2luc2lkZV9wYXJlbl9jYXN0Iik7CiAgIGlhcmZfZSBhdiA9IChwYy0+dHlwZSA9PSBD
VF9GVU5DX1dSQVApID8KICAgICAgICAgICAgICAgb3B0aW9uczo6c3BfaW5zaWRlX2ZwYXJl
bigpIDoKICAgICAgICAgICAgICAgb3B0aW9uczo6c3BfaW5zaWRlX3BhcmVuX2Nhc3QoKTsK
CiAgIGlmICggIGNodW5rX2lzX3Rva2VuKGNscCwgQ1RfUEFSRU5fQ0xPU0UpCiAgICAgICYm
IGNodW5rX2lzX3Rva2VuKG9wcCwgQ1RfUEFSRU5fT1BFTikKICAgICAgJiYgKGNodW5rX2lz
X3Rva2VuKG5hbWUsIENUX1dPUkQpIHx8IGNodW5rX2lzX3Rva2VuKG5hbWUsIENUX1RZUEUp
KSkKICAgewogICAgICBjb25zdCBjaGFyICpwc3AgPSAocGF2ICYgSUFSRl9BREQpID8gIiAi
IDogIiI7CiAgICAgIGNvbnN0IGNoYXIgKmZzcCA9IChhdiAmIElBUkZfQUREKSA/ICIgIiA6
ICIiOwoKICAgICAgcGMtPnN0ci5hcHBlbmQocHNwKTsKICAgICAgcGMtPnN0ci5hcHBlbmQo
IigiKTsKICAgICAgcGMtPnN0ci5hcHBlbmQoZnNwKTsKICAgICAgcGMtPnN0ci5hcHBlbmQo
bmFtZS0+c3RyKTsKICAgICAgcGMtPnN0ci5hcHBlbmQoZnNwKTsKICAgICAgcGMtPnN0ci5h
cHBlbmQoIikiKTsKCiAgICAgIHNldF9jaHVua190eXBlKHBjLCAocGMtPnR5cGUgPT0gQ1Rf
RlVOQ19XUkFQKSA/IENUX0ZVTkNUSU9OIDogQ1RfVFlQRSk7CgogICAgICBwYy0+b3JpZ19j
b2xfZW5kID0gcGMtPm9yaWdfY29sICsgcGMtPmxlbigpOwoKICAgICAgY2h1bmtfZGVsKG9w
cCk7CiAgICAgIGNodW5rX2RlbChuYW1lKTsKICAgICAgY2h1bmtfZGVsKGNscCk7CiAgIH0K
fSAvLyBoYW5kbGVfd3JhcAoKCnN0YXRpYyB2b2lkIGhhbmRsZV9wcm90b193cmFwKGNodW5r
X3QgKnBjKQp7CiAgIExPR19GVU5DX0VOVFJZKCk7CiAgIGNodW5rX3QgKm9wcCAgPSBjaHVu
a19nZXRfbmV4dF9uY25sKHBjKTsKICAgY2h1bmtfdCAqbmFtZSA9IGNodW5rX2dldF9uZXh0
X25jbmwob3BwKTsKICAgY2h1bmtfdCAqdG1wICA9IGNodW5rX2dldF9uZXh0X25jbmwoY2h1
bmtfZ2V0X25leHRfbmNubChuYW1lKSk7CiAgIGNodW5rX3QgKmNscCAgPSBjaHVua19za2lw
X3RvX21hdGNoKG9wcCk7CiAgIGNodW5rX3QgKmNtYSAgPSBjaHVua19nZXRfbmV4dF9uY25s
KGNscCk7CgogICBpZiAoICAhb3BwCiAgICAgIHx8ICFuYW1lCiAgICAgIHx8ICFjbHAKICAg
ICAgfHwgIWNtYQogICAgICB8fCAhdG1wCiAgICAgIHx8IChuYW1lLT50eXBlICE9IENUX1dP
UkQgJiYgbmFtZS0+dHlwZSAhPSBDVF9UWVBFKQogICAgICB8fCBvcHAtPnR5cGUgIT0gQ1Rf
UEFSRU5fT1BFTikKICAgewogICAgICByZXR1cm47CiAgIH0KCiAgIGlmIChjaHVua19pc190
b2tlbihjbWEsIENUX1NFTUlDT0xPTikpCiAgIHsKICAgICAgc2V0X2NodW5rX3R5cGUocGMs
IENUX0ZVTkNfUFJPVE8pOwogICB9CiAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKGNtYSwg
Q1RfQlJBQ0VfT1BFTikpCiAgIHsKICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiAoMTkp
IFNFVCBUTyBDVF9GVU5DX0RFRjogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1
LCB0ZXh0KCkgJyVzJ1xuIiwKICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBj
LT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQoKSk7CiAgICAgIHNldF9jaHVu
a190eXBlKHBjLCBDVF9GVU5DX0RFRik7CiAgIH0KICAgZWxzZQogICB7CiAgICAgIHJldHVy
bjsKICAgfQogICBzZXRfY2h1bmtfcGFyZW50KG9wcCwgcGMtPnR5cGUpOwogICBzZXRfY2h1
bmtfcGFyZW50KGNscCwgcGMtPnR5cGUpOwoKICAgc2V0X2NodW5rX3BhcmVudCh0bXAsIENU
X1BST1RPX1dSQVApOwoKICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfUEFSRU5fT1BF
TikpCiAgIHsKICAgICAgZml4X2Zjbl9kZWZfcGFyYW1zKHRtcCk7CiAgIH0KICAgZWxzZQog
ICB7CiAgICAgIGZpeF9mY25fZGVmX3BhcmFtcyhvcHApOwogICAgICBzZXRfY2h1bmtfdHlw
ZShuYW1lLCBDVF9XT1JEKTsKICAgfQogICB0bXAgPSBjaHVua19za2lwX3RvX21hdGNoKHRt
cCk7CgogICBpZiAodG1wKQogICB7CiAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBDVF9Q
Uk9UT19XUkFQKTsKICAgfQogICAvLyBNYXJrIHJldHVybiB0eXBlIChUT0RPOiBtb3ZlIHRv
IG93biBmdW5jdGlvbikKICAgdG1wID0gcGM7CgogICB3aGlsZSAoKHRtcCA9IGNodW5rX2dl
dF9wcmV2X25jbmxuaSh0bXApKSAhPSBudWxscHRyKSAgIC8vIElzc3VlICMyMjc5CiAgIHsK
ICAgICAgaWYgKCAgIWNodW5rX2lzX3R5cGUodG1wKQogICAgICAgICAmJiB0bXAtPnR5cGUg
IT0gQ1RfT1BFUkFUT1IKICAgICAgICAgJiYgdG1wLT50eXBlICE9IENUX1dPUkQKICAgICAg
ICAgJiYgdG1wLT50eXBlICE9IENUX0FERFIpCiAgICAgIHsKICAgICAgICAgYnJlYWs7CiAg
ICAgIH0KICAgICAgc2V0X2NodW5rX3BhcmVudCh0bXAsIHBjLT50eXBlKTsKICAgICAgbWFr
ZV90eXBlKHRtcCk7CiAgIH0KfSAvLyBoYW5kbGVfcHJvdG9fd3JhcAoKCi8qKgogKiBKYXZh
IGFzc2VydCBzdGF0ZW1lbnRzIGFyZTogImFzc2VydCBFWFAxIFs6IEVYUDJdIDsiCiAqIE1h
cmsgdGhlIHBhcmVudCBvZiB0aGUgY29sb24gYW5kIHNlbWljb2xvbgogKi8Kc3RhdGljIHZv
aWQgaGFuZGxlX2phdmFfYXNzZXJ0KGNodW5rX3QgKnBjKQp7CiAgIExPR19GVU5DX0VOVFJZ
KCk7CiAgIGJvb2wgICAgZGlkX2NvbG9uID0gZmFsc2U7CiAgIGNodW5rX3QgKnRtcCAgICAg
ID0gcGM7CgogICB3aGlsZSAoKHRtcCA9IGNodW5rX2dldF9uZXh0KHRtcCkpICE9IG51bGxw
dHIpCiAgIHsKICAgICAgaWYgKHRtcC0+bGV2ZWwgPT0gcGMtPmxldmVsKQogICAgICB7CiAg
ICAgICAgIGlmICghZGlkX2NvbG9uICYmIGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfQ09MT04p
KQogICAgICAgICB7CiAgICAgICAgICAgIGRpZF9jb2xvbiA9IHRydWU7CiAgICAgICAgICAg
IHNldF9jaHVua19wYXJlbnQodG1wLCBwYy0+dHlwZSk7CiAgICAgICAgIH0KCiAgICAgICAg
IGlmIChjaHVua19pc190b2tlbih0bXAsIENUX1NFTUlDT0xPTikpCiAgICAgICAgIHsKICAg
ICAgICAgICAgc2V0X2NodW5rX3BhcmVudCh0bXAsIHBjLT50eXBlKTsKICAgICAgICAgICAg
YnJlYWs7CiAgICAgICAgIH0KICAgICAgfQogICB9Cn0K
--------------E0C971C11DC220B22925FC86
Content-Type: text/plain; charset=UTF-8;
 name="git-diff.diff-Y"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="git-diff.diff-Y"

ZGlmZiAtLWdpdCBhL2NvbWJpbmUuY3BwLTIwMjAtMDQtMTYtQSBiL2NvbWJpbmUuY3BwLTIw
MjAtMDQtMTYtUgppbmRleCBiZmRiYjgxLi5kNTRiYzI3IDEwMDY0NAotLS0gYS9jb21iaW5l
LmNwcC0yMDIwLTA0LTE2LUEKKysrIGIvY29tYmluZS5jcHAtMjAyMC0wNC0xNi1SCkBAIC0x
MTUsNiArMTE1LDQ4IEBAIHN0YXRpYyB2b2lkIHByb2Nlc3NfcmV0dXJucyh2b2lkKTsKIHN0
YXRpYyBjaHVua190ICpwcm9jZXNzX3JldHVybihjaHVua190ICpwYyk7CiAKIAorLyoqCisg
KiBUT0RPOiBhZGQgZG9jIGNtdAorICoKKyAqLworc3RhdGljIHBjZl9mbGFnc190IG1hcmtf
d2hlcmVfY2h1bmsoY2h1bmtfdCAqcGMsIGNfdG9rZW5fdCBwYXJlbnRfdHlwZSwgcGNmX2Zs
YWdzX3QgZmxhZ3MpOworCisKKy8qKgorICogV2UncmUgb24gYSAnY2xhc3MnIG9yICdzdHJ1
Y3QnLgorICogU2NhbiBmb3IgQ1RfRlVOQ1RJT04gd2l0aCBhIHN0cmluZyB0aGF0IG1hdGNo
ZXMgcGNsYXNzLT5zdHIKKyAqLworc3RhdGljIHZvaWQgbWFya19jbGFzc19jdG9yKGNodW5r
X3QgKnBjbGFzcyk7CisKKworc3RhdGljIHZvaWQgbWFya19jcHBfY29uc3RydWN0b3IoY2h1
bmtfdCAqcGMpOworCisKKy8qKgorICogIEp1c3QgaGl0IGFuIGFzc2lnbi4gR28gYmFja3dh
cmRzIHVudGlsIHdlIGhpdCBhbiBvcGVuIGJyYWNlL3BhcmVuL3NxdWFyZSBvcgorICogc2Vt
aWNvbG9uIChUT0RPOiBvdGhlciBsaW1pdGVyPykgYW5kIG1hcmsgYXMgYSBMVmFsdWUuCisg
Ki8KK3N0YXRpYyB2b2lkIG1hcmtfbHZhbHVlKGNodW5rX3QgKnBjKTsKKworCisvKioKKyAq
IFdlIGFyZSBvbiBhIHdvcmQgZm9sbG93ZWQgYnkgYSBhbmdsZSBvcGVuIHdoaWNoIGlzIHBh
cnQgb2YgYSB0ZW1wbGF0ZS4KKyAqIElmIHRoZSBhbmdsZSBjbG9zZSBpcyBmb2xsb3dlZCBi
eSBhIG9wZW4gcGFyZW4sIHRoZW4gd2UgYXJlIG9uIGEgdGVtcGxhdGUKKyAqIGZ1bmN0aW9u
IGRlZiBvciBhIHRlbXBsYXRlIGZ1bmN0aW9uIGNhbGw6CisgKiAgIFZlY3RvcjI8ZmxvYXQ+
KC4uLikgWzogLi4uWywgLi4uXV0geyAuLi4gfQorICogT3Igd2UgY291bGQgYmUgb24gYSB2
YXJpYWJsZSBkZWYgaWYgaXQncyBmb2xsb3dlZCBieSBhIHdvcmQ6CisgKiAgIFJlbmRlcmVy
PHJnYjMyPiByZW5kOworICovCitzdGF0aWMgdm9pZCBtYXJrX3RlbXBsYXRlX2Z1bmMoY2h1
bmtfdCAqcGMsIGNodW5rX3QgKnBjX25leHQpOworCisKKy8qKgorICogSnVzdCBtYXJrIGV2
ZXJ5IENUX1dPUkQgdW50aWwgYSBzZW1pY29sb24gYXMgQ1RfU1FMX1dPUkQuCisgKiBBZGp1
c3QgdGhlIGxldmVscyBpZiBwYyBpcyBDVF9TUUxfQkVHSU4KKyAqLworc3RhdGljIHZvaWQg
bWFya19leGVjX3NxbChjaHVua190ICpwYyk7CisKKwogLyoqCiAgKiBQcm9jZXNzIGFuIE9i
akMgJ2NsYXNzJwogICogcGMgaXMgdGhlIGNodW5rIGFmdGVyICdAaW1wbGVtZW50YXRpb24n
IG9yICdAaW50ZXJmYWNlJyBvciAnQHByb3RvY29sJy4KQEAgLTMwMyw2ICszNDUsNDIgQEAg
c3RhdGljIGJvb2wgaXNfb2NfYmxvY2soY2h1bmtfdCAqcGMpOwogc3RhdGljIHZvaWQgaGFu
ZGxlX2phdmFfYXNzZXJ0KGNodW5rX3QgKnBjKTsKIAogCisvKioKKyAqIFBhcnNlIG9mZiB0
aGUgdHlwZXMgaW4gdGhlIEQgdGVtcGxhdGUgYXJncywgYWRkcyB0byBjcworICogcmV0dXJu
cyB0aGUgY2xvc2VfcGFyZW4KKyAqLworc3RhdGljIGNodW5rX3QgKmdldF9kX3RlbXBsYXRl
X3R5cGVzKENodW5rU3RhY2sgJmNzLCBjaHVua190ICpvcGVuX3BhcmVuKTsKKworCitzdGF0
aWMgYm9vbCBjaHVua3N0YWNrX21hdGNoKENodW5rU3RhY2sgJmNzLCBjaHVua190ICpwYyk7
CisKKwordm9pZCBtYWtlX3R5cGUoY2h1bmtfdCAqcGMpCit7CisgICBMT0dfRlVOQ19FTlRS
WSgpOworCisgICBpZiAocGMgIT0gbnVsbHB0cikKKyAgIHsKKyAgICAgIGlmIChjaHVua19p
c190b2tlbihwYywgQ1RfV09SRCkpCisgICAgICB7CisgICAgICAgICBzZXRfY2h1bmtfdHlw
ZShwYywgQ1RfVFlQRSk7CisgICAgICB9CisgICAgICBlbHNlIGlmICggICggIGNodW5rX2lz
X3N0YXIocGMpCisgICAgICAgICAgICAgICAgIHx8IGNodW5rX2lzX21zcmVmKHBjKQorICAg
ICAgICAgICAgICAgICB8fCBjaHVua19pc19udWxsYWJsZShwYykpCisgICAgICAgICAgICAg
ICYmIGNodW5rX2lzX3R5cGUocGMtPnByZXYpKSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIC8vIElzc3VlICMgMjY0MAorICAgICAgeworICAgICAgICAgc2V0X2NodW5rX3R5cGUo
cGMsIENUX1BUUl9UWVBFKTsKKyAgICAgIH0KKyAgICAgIGVsc2UgaWYgKCAgY2h1bmtfaXNf
YWRkcihwYykKKyAgICAgICAgICAgICAgJiYgIWNodW5rX2lzX3Rva2VuKHBjLT5wcmV2LCBD
VF9TUVVBUkVfT1BFTikpICAgICAgICAgICAgLy8gSXNzdWUgIyAyMTY2CisgICAgICB7Cisg
ICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfQllSRUYpOworICAgICAgfQorICAgfQor
fQorCisKIHZvaWQgZmxhZ19zZXJpZXMoY2h1bmtfdCAqc3RhcnQsIGNodW5rX3QgKmVuZCwg
cGNmX2ZsYWdzX3Qgc2V0X2ZsYWdzLCBwY2ZfZmxhZ3NfdCBjbHJfZmxhZ3MsIHNjb3BlX2Ug
bmF2KQogewogICAgTE9HX0ZVTkNfRU5UUlkoKTsKQEAgLTMyNiw2ICs0MDQsMjggQEAgdm9p
ZCBmbGFnX3NlcmllcyhjaHVua190ICpzdGFydCwgY2h1bmtfdCAqZW5kLCBwY2ZfZmxhZ3Nf
dCBzZXRfZmxhZ3MsIHBjZl9mbGFnc18KIH0KIAogCitjaHVua190ICpzZXRfcGFyZW5fcGFy
ZW50KGNodW5rX3QgKnN0YXJ0LCBjX3Rva2VuX3QgcGFyZW50KQoreworICAgTE9HX0ZVTkNf
RU5UUlkoKTsKKyAgIGNodW5rX3QgKmVuZDsKKworICAgZW5kID0gY2h1bmtfc2tpcF90b19t
YXRjaChzdGFydCwgc2NvcGVfZTo6UFJFUFJPQyk7CisKKyAgIGlmIChlbmQgIT0gbnVsbHB0
cikKKyAgIHsKKyAgICAgIExPR19GTVQoTEZMUEFSRU4sICIlcyglZCk6ICV6dTolenUgJyVz
JyBhbmQgJXp1OiV6dSAnJXMnIHR5cGUgaXMgJXMsIHBhcmVudF90eXBlIGlzICVzIiwKKyAg
ICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBzdGFydC0+b3JpZ19saW5lLCBzdGFy
dC0+b3JpZ19jb2wsIHN0YXJ0LT50ZXh0KCksCisgICAgICAgICAgICAgIGVuZC0+b3JpZ19s
aW5lLCBlbmQtPm9yaWdfY29sLCBlbmQtPnRleHQoKSwKKyAgICAgICAgICAgICAgZ2V0X3Rv
a2VuX25hbWUoc3RhcnQtPnR5cGUpLCBnZXRfdG9rZW5fbmFtZShwYXJlbnQpKTsKKyAgICAg
IGxvZ19mdW5jX3N0YWNrX2lubGluZShMRkxQQVJFTik7CisgICAgICBzZXRfY2h1bmtfcGFy
ZW50KHN0YXJ0LCBwYXJlbnQpOworICAgICAgc2V0X2NodW5rX3BhcmVudChlbmQsIHBhcmVu
dCk7CisgICB9CisgICBMT0dfRk1UKExGTFBBUkVOLCAiJXMoJWQpOlxuIiwgX19mdW5jX18s
IF9fTElORV9fKTsKKyAgIHJldHVybihjaHVua19nZXRfbmV4dF9uY25sKGVuZCwgc2NvcGVf
ZTo6UFJFUFJPQykpOworfQorCisKIHN0YXRpYyB2b2lkIGZsYWdfYXNtKGNodW5rX3QgKnBj
KQogewogICAgTE9HX0ZVTkNfRU5UUlkoKTsKQEAgLTM5Nyw2ICs0OTcsNzkgQEAgc3RhdGlj
IHZvaWQgZmxhZ19hc20oY2h1bmtfdCAqcGMpCiB9IC8vIGZsYWdfYXNtCiAKIAorc3RhdGlj
IGJvb2wgY2h1bmtfZW5kc190eXBlKGNodW5rX3QgKnN0YXJ0KQoreworICAgTE9HX0ZVTkNf
RU5UUlkoKTsKKyAgIGNodW5rX3QgKnBjICAgICAgID0gc3RhcnQ7CisgICBib29sICAgIHJl
dCAgICAgICA9IGZhbHNlOworICAgc2l6ZV90ICBjbnQgICAgICAgPSAwOworICAgYm9vbCAg
ICBsYXN0X2V4cHIgPSBmYWxzZTsKKyAgIGJvb2wgICAgbGFzdF9sdmFsID0gZmFsc2U7CisK
KyAgIGZvciAoIDsgcGMgIT0gbnVsbHB0cjsgcGMgPSBjaHVua19nZXRfcHJldl9uY25sbmko
cGMpKSAvLyBJc3N1ZSAjMjI3OQorICAgeworICAgICAgTE9HX0ZNVChMRlRZUEUsICIlcygl
ZCk6IHR5cGUgaXMgJXMsIHRleHQoKSAnJXMnLCBvcmlnX2xpbmUgJXp1LCBvcmlnX2NvbCAl
enVcbiAgICIsCisgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgZ2V0X3Rva2Vu
X25hbWUocGMtPnR5cGUpLCBwYy0+dGV4dCgpLAorICAgICAgICAgICAgICBwYy0+b3JpZ19s
aW5lLCBwYy0+b3JpZ19jb2wpOworICAgICAgbG9nX3BjZl9mbGFncyhMRlRZUEUsIHBjLT5m
bGFncyk7CisKKyAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9XT1JEKQorICAg
ICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RZUEUpCisgICAgICAgICB8fCBjaHVu
a19pc190b2tlbihwYywgQ1RfUFRSX1RZUEUpCisgICAgICAgICB8fCBjaHVua19pc190b2tl
bihwYywgQ1RfU1RBUikKKyAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TVFJV
Q1QpCisgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfRENfTUVNQkVSKQorICAg
ICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1BQKQorICAgICAgICAgfHwgY2h1bmtf
aXNfdG9rZW4ocGMsIENUX1FVQUxJRklFUikKKyAgICAgICAgIHx8ICggIGxhbmd1YWdlX2lz
X3NldChMQU5HX0NQUCB8IExBTkdfT0MpICAgICAgICAgICAgICAgICAgICAgICAvLyBJc3N1
ZSAjMjcyNworICAgICAgICAgICAgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBD
VF9URU1QTEFURQorICAgICAgICAgICAgJiYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FO
R0xFX09QRU4pCisgICAgICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQU5H
TEVfQ0xPU0UpKSkKKyAgICAgICAgIHx8ICggIGxhbmd1YWdlX2lzX3NldChMQU5HX0NTKQor
ICAgICAgICAgICAgJiYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9NRU1CRVIpKSkpCisgICAg
ICB7CisgICAgICAgICBjbnQrKzsKKyAgICAgICAgIGxhc3RfZXhwciA9IHBjLT5mbGFncy50
ZXN0KFBDRl9FWFBSX1NUQVJUKQorICAgICAgICAgICAgICAgICAgICAgJiYgIXBjLT5mbGFn
cy50ZXN0KFBDRl9JTl9GQ05fQ0FMTCk7CisgICAgICAgICBsYXN0X2x2YWwgPSBwYy0+Zmxh
Z3MudGVzdChQQ0ZfTFZBTFVFKTsKKyAgICAgICAgIGNvbnRpbnVlOworICAgICAgfQorCisg
ICAgICBpZiAoICAoICBjaHVua19pc19zZW1pY29sb24ocGMpCisgICAgICAgICAgICAmJiAh
cGMtPmZsYWdzLnRlc3QoUENGX0lOX0ZPUikpCisgICAgICAgICB8fCBjaHVua19pc190b2tl
bihwYywgQ1RfVFlQRURFRikKKyAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9C
UkFDRV9PUEVOKQorICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0JSQUNFX0NM
T1NFKQorICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1ZCUkFDRV9DTE9TRSkK
KyAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9GUEFSRU5fQ0xPU0UpCisgICAg
ICAgICB8fCBjaHVua19pc19mb3JpbihwYykKKyAgICAgICAgIHx8IGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9NQUNSTykKKyAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9QUF9J
RikKKyAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9QUF9FTFNFKQorICAgICAg
ICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1BQX0VORElGKQorICAgICAgICAgfHwgKCAg
KCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0NPTU1BKQorICAgICAgICAgICAgICAgJiYgIXBj
LT5mbGFncy50ZXN0KFBDRl9JTl9GQ05fQ0FMTCkpCisgICAgICAgICAgICAmJiBsYXN0X2V4
cHIpCisgICAgICAgICB8fCAoICBjaHVua19pc190b2tlbihwYywgQ1RfU1BBUkVOX09QRU4p
CisgICAgICAgICAgICAmJiBsYXN0X2x2YWwpKQorICAgICAgeworICAgICAgICAgcmV0ID0g
Y250ID4gMDsKKyAgICAgIH0KKyAgICAgIGJyZWFrOworICAgfQorCisgICBpZiAocGMgPT0g
bnVsbHB0cikKKyAgIHsKKyAgICAgIC8vIGZpcnN0IHRva2VuCisgICAgICByZXQgPSB0cnVl
OworICAgfQorICAgTE9HX0ZNVChMRlRZUEUsICIlcyglZCk6IGZpcnN0IHRva2VuIHZlcmRp
Y3Q6ICVzXG4iLAorICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHJldCA/ICJ5ZXMi
IDogIm5vIik7CisKKyAgIHJldHVybihyZXQpOworfSAvLyBjaHVua19lbmRzX3R5cGUKKwor
CiB2b2lkIGRvX3N5bWJvbF9jaGVjayhjaHVua190ICpwcmV2LCBjaHVua190ICpwYywgY2h1
bmtfdCAqbmV4dCkKIHsKICAgIExPR19GVU5DX0VOVFJZKCk7CkBAIC0yMTMwLDEwNjYgKzIz
MDMsMzQyMSBAQCB2b2lkIGZpeF9zeW1ib2xzKHZvaWQpCiB9IC8vIGZpeF9zeW1ib2xzCiAK
IAotc3RhdGljIHZvaWQgcHJvY2Vzc19yZXR1cm5zKHZvaWQpCitzdGF0aWMgdm9pZCBtYXJr
X2x2YWx1ZShjaHVua190ICpwYykKIHsKICAgIExPR19GVU5DX0VOVFJZKCk7Ci0gICBjaHVu
a190ICpwYzsKKyAgIGNodW5rX3QgKnByZXY7CiAKLSAgIHBjID0gY2h1bmtfZ2V0X2hlYWQo
KTsKKyAgIGlmIChwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykpCisgICB7CisgICAg
ICByZXR1cm47CisgICB9CiAKLSAgIHdoaWxlIChwYyAhPSBudWxscHRyKQorICAgZm9yIChw
cmV2ID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHBjKTsgICAgIC8vIElzc3VlICMyMjc5Cisg
ICAgICAgIHByZXYgIT0gbnVsbHB0cjsKKyAgICAgICAgcHJldiA9IGNodW5rX2dldF9wcmV2
X25jbmxuaShwcmV2KSkgICAvLyBJc3N1ZSAjMjI3OQogICAgewotICAgICAgaWYgKHBjLT50
eXBlICE9IENUX1JFVFVSTikKKyAgICAgIGlmICggIHByZXYtPmxldmVsIDwgcGMtPmxldmVs
CisgICAgICAgICB8fCBjaHVua19pc190b2tlbihwcmV2LCBDVF9BU1NJR04pCisgICAgICAg
ICB8fCBjaHVua19pc190b2tlbihwcmV2LCBDVF9DT01NQSkKKyAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHByZXYsIENUX0JPT0wpCisgICAgICAgICB8fCBjaHVua19pc19zZW1pY29s
b24ocHJldikKKyAgICAgICAgIHx8IGNodW5rX2lzX3N0cihwcmV2LCAiKCIsIDEpCisgICAg
ICAgICB8fCBjaHVua19pc19zdHIocHJldiwgInsiLCAxKQorICAgICAgICAgfHwgY2h1bmtf
aXNfc3RyKHByZXYsICJbIiwgMSkKKyAgICAgICAgIHx8IHByZXYtPmZsYWdzLnRlc3QoUENG
X0lOX1BSRVBST0MpKQogICAgICAgewotICAgICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF90
eXBlKHBjLCBDVF9SRVRVUk4sIC0xKTsKLSAgICAgICAgIGNvbnRpbnVlOworICAgICAgICAg
YnJlYWs7CisgICAgICB9CisgICAgICBjaHVua19mbGFnc19zZXQocHJldiwgUENGX0xWQUxV
RSk7CisKKyAgICAgIGlmIChwcmV2LT5sZXZlbCA9PSBwYy0+bGV2ZWwgJiYgY2h1bmtfaXNf
c3RyKHByZXYsICImIiwgMSkpCisgICAgICB7CisgICAgICAgICBtYWtlX3R5cGUocHJldik7
CiAgICAgICB9Ci0gICAgICBwYyA9IHByb2Nlc3NfcmV0dXJuKHBjKTsKICAgIH0KIH0KIAog
Ci1zdGF0aWMgY2h1bmtfdCAqcHJvY2Vzc19yZXR1cm4oY2h1bmtfdCAqcGMpCitzdGF0aWMg
dm9pZCBtYXJrX2Z1bmN0aW9uX3JldHVybl90eXBlKGNodW5rX3QgKmZuYW1lLCBjaHVua190
ICpzdGFydCwgY190b2tlbl90IHBhcmVudF90eXBlKQogewogICAgTE9HX0ZVTkNfRU5UUlko
KTsKLSAgIGNodW5rX3QgKm5leHQ7Ci0gICBjaHVua190ICp0ZW1wOwotICAgY2h1bmtfdCAq
c2VtaTsKLSAgIGNodW5rX3QgKmNwYXI7Ci0gICBjaHVua190IGNodW5rOwotCi0gICAvLyBn
cmFiIG5leHQgYW5kIGJhaWwgaWYgaXQgaXMgYSBzZW1pY29sb24KLSAgIG5leHQgPSBjaHVu
a19wcGFfZ2V0X25leHRfbmNubChwYyk7Ci0KLSAgIGlmICggIG5leHQgPT0gbnVsbHB0ciB8
fCBjaHVua19pc19zZW1pY29sb24obmV4dCkKLSAgICAgIHx8IGNodW5rX2lzX3Rva2VuKG5l
eHQsIENUX05FV0xJTkUpKQotICAgewotICAgICAgcmV0dXJuKG5leHQpOwotICAgfQotICAg
bG9nX3J1bGVfQigibmxfcmV0dXJuX2V4cHIiKTsKLQotICAgaWYgKCAgb3B0aW9uczo6bmxf
cmV0dXJuX2V4cHIoKSAhPSBJQVJGX0lHTk9SRQotICAgICAgJiYgIXBjLT5mbGFncy50ZXN0
KFBDRl9JTl9QUkVQUk9DKSkKLSAgIHsKLSAgICAgIG5ld2xpbmVfaWFyZihwYywgb3B0aW9u
czo6bmxfcmV0dXJuX2V4cHIoKSk7Ci0gICB9CisgICBjaHVua190ICpwYyA9IHN0YXJ0Owog
Ci0gICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfUEFSRU5fT1BFTikpCisgICBpZiAo
cGMgIT0gbnVsbHB0cikKICAgIHsKLSAgICAgIC8vIFNlZSBpZiB0aGUgcmV0dXJuIGlzIGZ1
bGx5IHBhcmVuJ2QKLSAgICAgIGNwYXIgPSBjaHVua19nZXRfbmV4dF90eXBlKG5leHQsIENU
X1BBUkVOX0NMT1NFLCBuZXh0LT5sZXZlbCk7Ci0KLSAgICAgIGlmIChjcGFyID09IG51bGxw
dHIpCi0gICAgICB7Ci0gICAgICAgICByZXR1cm4obnVsbHB0cik7Ci0gICAgICB9Ci0gICAg
ICBzZW1pID0gY2h1bmtfcHBhX2dldF9uZXh0X25jbmwoY3Bhcik7CisgICAgICAvLyBTdGVw
IGJhY2t3YXJkcyBmcm9tIHBjIGFuZCBtYXJrIHRoZSBwYXJlbnQgb2YgdGhlIHJldHVybiB0
eXBlCisgICAgICBMT0dfRk1UKExGQ05SLCAiJXMoJWQpOiAoYmFja3dhcmRzKSByZXR1cm4g
dHlwZSBmb3IgJyVzJyBAIG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dVxuIiwK
KyAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBmbmFtZS0+dGV4dCgpLCBmbmFt
ZS0+b3JpZ19saW5lLCBmbmFtZS0+b3JpZ19jb2wpOwogCi0gICAgICBpZiAoc2VtaSA9PSBu
dWxscHRyKQotICAgICAgewotICAgICAgICAgcmV0dXJuKG51bGxwdHIpOwotICAgICAgfQor
ICAgICAgY2h1bmtfdCAqZmlyc3QgPSBwYzsKIAotICAgICAgaWYgKGNodW5rX2lzX3Rva2Vu
KHNlbWksIENUX05FV0xJTkUpIHx8IGNodW5rX2lzX3NlbWljb2xvbihzZW1pKSkKKyAgICAg
IHdoaWxlIChwYyAhPSBudWxscHRyKQogICAgICAgewotICAgICAgICAgbG9nX3J1bGVfQigi
bW9kX3BhcmVuX29uX3JldHVybiIpOworICAgICAgICAgTE9HX0ZNVChMRkNOUiwgIiVzKCVk
KTogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJywgdHlw
ZSBpcyAlcywgIiwKKyAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+
b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIHBjLT50ZXh0KCksIGdldF90b2tlbl9uYW1lKHBj
LT50eXBlKSk7CisgICAgICAgICBsb2dfcGNmX2ZsYWdzKExGQ05SLCBwYy0+ZmxhZ3MpOwog
Ci0gICAgICAgICBpZiAob3B0aW9uczo6bW9kX3BhcmVuX29uX3JldHVybigpID09IElBUkZf
UkVNT1ZFKQorICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BTkdMRV9DTE9T
RSkpCiAgICAgICAgICB7Ci0gICAgICAgICAgICBMT0dfRk1UKExSRVRVUk4sICIlcyglZCk6
IHJlbW92aW5nIHBhcmVucyBvbiBvcmlnX2xpbmUgJXp1XG4iLAotICAgICAgICAgICAgICAg
ICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUpOworICAgICAgICAgICAg
cGMgPSBza2lwX3RlbXBsYXRlX3ByZXYocGMpOwogCi0gICAgICAgICAgICAvLyBsb3dlciB0
aGUgbGV2ZWwgb2YgZXZlcnl0aGluZwotICAgICAgICAgICAgZm9yICh0ZW1wID0gbmV4dDsg
dGVtcCAhPSBjcGFyOyB0ZW1wID0gY2h1bmtfZ2V0X25leHQodGVtcCkpCisgICAgICAgICAg
ICBpZiAocGMgPT0gbnVsbHB0ciB8fCBjaHVua19pc190b2tlbihwYywgQ1RfVEVNUExBVEUp
KQogICAgICAgICAgICAgewotICAgICAgICAgICAgICAgaWYgKHRlbXAtPmxldmVsID09IDAp
Ci0gICAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwg
IiVzKCVkKTogdGVtcC0+bGV2ZWwgaXMgWkVSTywgY2Fubm90IGJlIGRlY3JlbWVudGVkLCBh
dCBsaW5lICV6dSwgY29sdW1uICV6dVxuIiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
X19mdW5jX18sIF9fTElORV9fLCB0ZW1wLT5vcmlnX2xpbmUsIHRlbXAtPm9yaWdfY29sKTsK
LSAgICAgICAgICAgICAgICAgIGxvZ19mbHVzaCh0cnVlKTsKLSAgICAgICAgICAgICAgICAg
IGV4aXQoRVhfU09GVFdBUkUpOwotICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgICAg
dGVtcC0+bGV2ZWwtLTsKKyAgICAgICAgICAgICAgIC8vZWl0aGVyIGV4cHJlc3Npb24gaXMg
bm90IGNvbXBsZXRlIG9yIHRoaXMgaXMgc210aCBsaWtlICd0ZW1wbGF0ZTxUPiB2b2lkIGZ1
bmMoKScKKyAgICAgICAgICAgICAgIC8vICAtIHdlIGFyZSBub3QgaW50ZXJlc3RlZCBpbiAn
dGVtcGxhdGU8VD4nIHBhcnQKKyAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg
fQotCi0gICAgICAgICAgICAvLyBkZWxldGUgdGhlIHBhcmVudGhlc2lzCi0gICAgICAgICAg
ICBjaHVua19kZWwobmV4dCk7Ci0gICAgICAgICAgICBjaHVua19kZWwoY3Bhcik7Ci0KLSAg
ICAgICAgICAgIC8vIGJhY2sgdXAgZm9sbG93aW5nIGNodW5rcwotICAgICAgICAgICAgdGVt
cCA9IHNlbWk7Ci0KLSAgICAgICAgICAgIHdoaWxlICh0ZW1wICE9IG51bGxwdHIgJiYgdGVt
cC0+dHlwZSAhPSBDVF9ORVdMSU5FKQorICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg
ewotICAgICAgICAgICAgICAgdGVtcC0+Y29sdW1uICAgICAgID0gdGVtcC0+Y29sdW1uIC0g
MjsKLSAgICAgICAgICAgICAgIHRlbXAtPm9yaWdfY29sICAgICA9IHRlbXAtPm9yaWdfY29s
IC0gMjsKLSAgICAgICAgICAgICAgIHRlbXAtPm9yaWdfY29sX2VuZCA9IHRlbXAtPm9yaWdf
Y29sX2VuZCAtIDI7Ci0gICAgICAgICAgICAgICB0ZW1wICAgICAgICAgICAgICAgPSBjaHVu
a19nZXRfbmV4dCh0ZW1wKTsKKyAgICAgICAgICAgICAgIC8vdGhpcyBpcyBzbXRoIGxpa2Ug
J3ZlY3RvcjxpbnQ+IGZ1bmMoKScgYW5kICdwYycgaXMgY3VycmVudGx5IG9uICd2ZWN0b3In
IC0ganVzdCBwcm9jZWVkCiAgICAgICAgICAgICB9CiAgICAgICAgICB9Ci0gICAgICAgICBl
bHNlCisKKyAgICAgICAgIGlmICggICggICFjaHVua19pc190eXBlKHBjKQorICAgICAgICAg
ICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfT1BFUkFUT1IKKyAgICAgICAgICAgICAgICYmIHBj
LT50eXBlICE9IENUX1dPUkQKKyAgICAgICAgICAgICAgICYmIHBjLT50eXBlICE9IENUX0FE
RFIpCisgICAgICAgICAgICB8fCBwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykpCiAg
ICAgICAgICB7Ci0gICAgICAgICAgICBMT0dfRk1UKExSRVRVUk4sICIlcyglZCk6IGtlZXBp
bmcgcGFyZW5zIG9uIG9yaWdfbGluZSAlenVcbiIsCi0gICAgICAgICAgICAgICAgICAgIF9f
ZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSk7CisgICAgICAgICAgICBicmVhazsK
KyAgICAgICAgIH0KIAotICAgICAgICAgICAgLy8gbWFyayAmIGtlZXAgdGhlbQotICAgICAg
ICAgICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBDVF9SRVRVUk4pOwotICAgICAgICAgICAg
c2V0X2NodW5rX3BhcmVudChjcGFyLCBDVF9SRVRVUk4pOworICAgICAgICAgaWYgKCFjaHVu
a19pc19wdHJfb3BlcmF0b3IocGMpKQorICAgICAgICAgeworICAgICAgICAgICAgZmlyc3Qg
PSBwYzsKICAgICAgICAgIH0KLSAgICAgICAgIHJldHVybihzZW1pKTsKKyAgICAgICAgIHBj
ID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHBjKTsgICAvLyBJc3N1ZSAjMjI3OQogICAgICAg
fQotICAgfQotICAgLy8gV2UgZG9uJ3QgaGF2ZSBhIGZ1bGx5IHBhcmVuJ2QgcmV0dXJuLiBT
aG91bGQgd2UgYWRkIHNvbWU/Ci0gICBsb2dfcnVsZV9CKCJtb2RfcGFyZW5fb25fcmV0dXJu
Iik7CisgICAgICBMT0dfRk1UKExGQ05SLCAiJXMoJWQpOiBtYXJraW5nIHJldHVybnMuLi4i
LCBfX2Z1bmNfXywgX19MSU5FX18pOwogCi0gICBpZiAoIShvcHRpb25zOjptb2RfcGFyZW5f
b25fcmV0dXJuKCkgJiBJQVJGX0FERCkpCi0gICB7Ci0gICAgICByZXR1cm4obmV4dCk7Ci0g
ICB9CisgICAgICAvLyBDaGFuZ2luZyB3b3JkcyB0byB0eXBlcyBpbnRvIHR1cGxlIHJldHVy
biB0eXBlcyBpbiBDUy4KKyAgICAgIGJvb2wgaXNfcmV0dXJuX3R1cGxlID0gZmFsc2U7CiAK
LSAgIC8vIElzc3VlICMxOTE3Ci0gICAvLyBOZXZlciBhZGQgcGFyZW5zIHRvIGEgYnJhY2Vk
IGluaXQgbGlzdDsgdGhhdCBicmVha3MgdGhlIGNvZGUKLSAgIC8vICAgcmV0dXJuIHthcmdz
Li4ufTsgICAgLy8gQysrMTEgdHlwZSBlbGlzaW9uOyBva2F5Ci0gICAvLyAgIHJldHVybiAo
e2FyZ3MuLi59KTsgIC8vIGlsbC1mb3JtZWQKLSAgIGlmICggIGxhbmd1YWdlX2lzX3NldChM
QU5HX0NQUCkgJiYgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfQlJBQ0VfT1BFTikKLSAgICAg
ICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShuZXh0KSA9PSBDVF9CUkFDRURfSU5JVF9MSVNU
KQotICAgewotICAgICAgTE9HX0ZNVChMUkVUVVJOLCAiJXMoJWQpOiBub3QgYWRkaW5nIHBh
cmVucyBhcm91bmQgYnJhY2VkIGluaXRpYWxpemVyIgotICAgICAgICAgICAgICAiIG9uIG9y
aWdfbGluZSAlemRcbiIsCi0gICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMt
Pm9yaWdfbGluZSk7Ci0gICAgICByZXR1cm4obmV4dCk7Ci0gICB9Ci0gICAvLyBmaW5kIHRo
ZSBuZXh0IHNlbWljb2xvbiBvbiB0aGUgc2FtZSBsZXZlbAotICAgc2VtaSA9IG5leHQ7Cisg
ICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1BBUkVOX0NMT1NFKSAmJiAhcGMtPmZs
YWdzLnRlc3QoUENGX0lOX1BSRVBST0MpKQorICAgICAgeworICAgICAgICAgZmlyc3QgICAg
ICAgICAgID0gY2h1bmtfc2tpcF90b19tYXRjaF9yZXYocGMpOworICAgICAgICAgaXNfcmV0
dXJuX3R1cGxlID0gdHJ1ZTsKKyAgICAgIH0KKyAgICAgIHBjID0gZmlyc3Q7CiAKLSAgIGlm
IChwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykpCi0gICB7Ci0gICAgICB3aGlsZSAo
KHNlbWkgPSBzZW1pLT5uZXh0KSAhPSBudWxscHRyKQorICAgICAgd2hpbGUgKHBjICE9IG51
bGxwdHIpCiAgICAgICB7Ci0gICAgICAgICBpZiAoIXNlbWktPmZsYWdzLnRlc3QoUENGX0lO
X1BSRVBST0MpKQorICAgICAgICAgTE9HX0ZNVChMRkNOUiwgIiB0ZXh0KCkgJyVzJywgdHlw
ZSBpcyAlcyIsIHBjLT50ZXh0KCksIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CisKKyAg
ICAgICAgIGlmIChwYXJlbnRfdHlwZSAhPSBDVF9OT05FKQogICAgICAgICAgewotICAgICAg
ICAgICAgYnJlYWs7CisgICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBwYXJlbnRf
dHlwZSk7CiAgICAgICAgICB9CisgICAgICAgICBjaHVua190ICpwcmV2ID0gY2h1bmtfZ2V0
X3ByZXZfbmNubG5pKHBjKTsgICAvLyBJc3N1ZSAjMjI3OQogCi0gICAgICAgICBpZiAoc2Vt
aS0+bGV2ZWwgPCBwYy0+bGV2ZWwpCisgICAgICAgICBpZiAoICAhaXNfcmV0dXJuX3R1cGxl
CisgICAgICAgICAgICB8fCBwYy0+dHlwZSAhPSBDVF9XT1JECisgICAgICAgICAgICB8fCAo
cHJldiAhPSBudWxscHRyICYmIHByZXYtPnR5cGUgIT0gQ1RfVFlQRSkpCiAgICAgICAgICB7
Ci0gICAgICAgICAgICByZXR1cm4oc2VtaSk7CisgICAgICAgICAgICBtYWtlX3R5cGUocGMp
OwogICAgICAgICAgfQogCi0gICAgICAgICBpZiAoY2h1bmtfaXNfc2VtaWNvbG9uKHNlbWkp
ICYmIHBjLT5sZXZlbCA9PSBzZW1pLT5sZXZlbCkKKyAgICAgICAgIGlmIChwYyA9PSBzdGFy
dCkKICAgICAgICAgIHsKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQotICAgICAg
fQotICAgfQotICAgZWxzZQotICAgewotICAgICAgd2hpbGUgKChzZW1pID0gY2h1bmtfZ2V0
X25leHQoc2VtaSkpICE9IG51bGxwdHIpCi0gICAgICB7Ci0gICAgICAgICBpZiAoc2VtaS0+
bGV2ZWwgPCBwYy0+bGV2ZWwpCisgICAgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwo
cGMpOworCisgICAgICAgICAvL3RlbXBsYXRlIGFuZ2xlcyBzaG91bGQga2VlcCBwYXJlbnQg
dHlwZSBDVF9URU1QTEFURQorICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9B
TkdMRV9PUEVOKSkKICAgICAgICAgIHsKLSAgICAgICAgICAgIHJldHVybihzZW1pKTsKKyAg
ICAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRfdHlwZShwYywgQ1RfQU5HTEVfQ0xPU0Us
IHBjLT5sZXZlbCk7CisKKyAgICAgICAgICAgIGlmIChwYyA9PSBzdGFydCkKKyAgICAgICAg
ICAgIHsKKyAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgfQorICAgICAgICAg
ICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKICAgICAgICAgIH0KKyAgICAgIH0K
KyAgICAgIExPR19GTVQoTEZDTlIsICJcbiIpOwogCi0gICAgICAgICBpZiAoY2h1bmtfaXNf
c2VtaWNvbG9uKHNlbWkpICYmIHBjLT5sZXZlbCA9PSBzZW1pLT5sZXZlbCkKKyAgICAgIC8v
IEJhY2sgdXAgYW5kIG1hcmsgcGFyZW50IHR5cGUgb24gZnJpZW5kIGRlY2xhcmF0aW9ucwor
ICAgICAgaWYgKHBhcmVudF90eXBlICE9IENUX05PTkUgJiYgZmlyc3QgJiYgZmlyc3QtPmZs
YWdzLnRlc3QoUENGX0lOX0NMQVNTKSkKKyAgICAgIHsKKyAgICAgICAgIHBjID0gY2h1bmtf
Z2V0X3ByZXZfbmNubG5pKGZpcnN0KTsgICAvLyBJc3N1ZSAjMjI3OQorCisgICAgICAgICBp
ZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0ZSSUVORCkpCiAgICAgICAgICB7Ci0gICAgICAg
ICAgICBicmVhazsKKyAgICAgICAgICAgIExPR19GTVQoTEZDTlIsICIlcyglZCk6IG1hcmtp
bmcgZnJpZW5kXG4iLCBfX2Z1bmNfXywgX19MSU5FX18pOworICAgICAgICAgICAgc2V0X2No
dW5rX3BhcmVudChwYywgcGFyZW50X3R5cGUpOworICAgICAgICAgICAgLy8gQSBmcmllbmQg
bWlnaHQgYmUgcHJlY2VkZWQgYnkgYSB0ZW1wbGF0ZSBzcGVjaWZpY2F0aW9uLCBhcyBpbjoK
KyAgICAgICAgICAgIC8vICAgdGVtcGxhdGUgPC4uLj4gZnJpZW5kIHR5cGUgZnVuYyguLi4p
OworICAgICAgICAgICAgLy8gSWYgc28sIHdlIG5lZWQgdG8gbWFyayB0aGF0IGFsc28KKyAg
ICAgICAgICAgIHBjID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHBjKTsgICAvLyBJc3N1ZSAj
MjI3OQorCisgICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FOR0xFX0NM
T1NFKSkKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgIHBjID0gc2tpcF90ZW1wbGF0
ZV9wcmV2KHBjKTsKKworICAgICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9URU1QTEFURSkpCisgICAgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgICBMT0df
Rk1UKExGQ05SLCAiJXMoJWQpOiBtYXJraW5nIGZyaWVuZCB0ZW1wbGF0ZVxuIiwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fKTsKKyAgICAgICAgICAg
ICAgICAgIHNldF9jaHVua19wYXJlbnQocGMsIHBhcmVudF90eXBlKTsKKyAgICAgICAgICAg
ICAgIH0KKyAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgIH0KICAgIH0KK30gLy8g
bWFya19mdW5jdGlvbl9yZXR1cm5fdHlwZQogCi0gICBpZiAoc2VtaSkKLSAgIHsKLSAgICAg
IC8vIGFkZCB0aGUgcGFyZW50aGVzaXMKLSAgICAgIHNldF9jaHVua190eXBlKCZjaHVuaywg
Q1RfUEFSRU5fT1BFTik7Ci0gICAgICBzZXRfY2h1bmtfcGFyZW50KCZjaHVuaywgQ1RfUkVU
VVJOKTsKLSAgICAgIGNodW5rLnN0ciAgICAgICAgID0gIigiOwotICAgICAgY2h1bmsubGV2
ZWwgICAgICAgPSBwYy0+bGV2ZWw7Ci0gICAgICBjaHVuay5icmFjZV9sZXZlbCA9IHBjLT5i
cmFjZV9sZXZlbDsKLSAgICAgIGNodW5rLm9yaWdfbGluZSAgID0gcGMtPm9yaWdfbGluZTsK
LSAgICAgIGNodW5rLm9yaWdfY29sICAgID0gbmV4dC0+b3JpZ19jb2wgLSAxOwotICAgICAg
Y2h1bmsuZmxhZ3MgICAgICAgPSBwYy0+ZmxhZ3MgJiBQQ0ZfQ09QWV9GTEFHUzsKLSAgICAg
IGNodW5rX2FkZF9iZWZvcmUoJmNodW5rLCBuZXh0KTsKIAotICAgICAgc2V0X2NodW5rX3R5
cGUoJmNodW5rLCBDVF9QQVJFTl9DTE9TRSk7Ci0gICAgICBjaHVuay5zdHIgICAgICAgPSAi
KSI7Ci0gICAgICBjaHVuay5vcmlnX2xpbmUgPSBzZW1pLT5vcmlnX2xpbmU7Ci0gICAgICBj
aHVuay5vcmlnX2NvbCAgPSBzZW1pLT5vcmlnX2NvbCAtIDE7Ci0gICAgICBjcGFyICAgICAg
ICAgICAgPSBjaHVua19hZGRfYmVmb3JlKCZjaHVuaywgc2VtaSk7CitzdGF0aWMgYm9vbCBt
YXJrX2Z1bmN0aW9uX3R5cGUoY2h1bmtfdCAqcGMpCit7CisgICBMT0dfRlVOQ19FTlRSWSgp
OworICAgTE9HX0ZNVChMRlRZUEUsICIlcyglZCk6IHR5cGUgaXMgJXMsIHRleHQoKSAnJXMn
IEAgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1XG4iLAorICAgICAgICAgICBf
X2Z1bmNfXywgX19MSU5FX18sIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSwgcGMtPnRleHQo
KSwKKyAgICAgICAgICAgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sKTsKIAotICAgICAg
TE9HX0ZNVChMUkVUVVJOLCAiJXMoJWQpOiBhZGRlZCBwYXJlbnMgb24gb3JpZ19saW5lICV6
dVxuIiwKLSAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5l
KTsKKyAgIHNpemVfdCAgICBzdGFyX2NvdW50ID0gMDsKKyAgIHNpemVfdCAgICB3b3JkX2Nv
dW50ID0gMDsKKyAgIGNodW5rX3QgICAqcHRyY25rICAgID0gbnVsbHB0cjsKKyAgIGNodW5r
X3QgICAqdG1wOworICAgY2h1bmtfdCAgICphcG87CisgICBjaHVua190ICAgKmFwYzsKKyAg
IGNodW5rX3QgICAqYWZ0OworICAgYm9vbCAgICAgIGFub24gPSBmYWxzZTsKKyAgIGNfdG9r
ZW5fdCBwdCwgcHRwOwogCi0gICAgICBmb3IgKHRlbXAgPSBuZXh0OyB0ZW1wICE9IGNwYXI7
IHRlbXAgPSBjaHVua19nZXRfbmV4dCh0ZW1wKSkKLSAgICAgIHsKLSAgICAgICAgIHRlbXAt
PmxldmVsKys7Ci0gICAgICB9Ci0gICB9Ci0gICByZXR1cm4oc2VtaSk7Ci19IC8vIHByb2Nl
c3NfcmV0dXJuCisgICAvLyBTY2FuIGJhY2t3YXJkcyBhY3Jvc3MgdGhlIG5hbWUsIHdoaWNo
IGNhbiBvbmx5IGJlIGEgd29yZCBhbmQgc2luZ2xlIHN0YXIKKyAgIGNodW5rX3QgKnZhcmNu
ayA9IGNodW5rX2dldF9wcmV2X25jbmxuaShwYyk7ICAgLy8gSXNzdWUgIzIyNzkKIAorICAg
dmFyY25rID0gY2h1bmtfZ2V0X3ByZXZfc3NxKHZhcmNuayk7CiAKLXN0YXRpYyBib29sIGlz
X3VjYXNlX3N0cihjb25zdCBjaGFyICpzdHIsIHNpemVfdCBsZW4pCi17Ci0gICB3aGlsZSAo
bGVuLS0gPiAwKQorICAgaWYgKHZhcmNuayAhPSBudWxscHRyICYmICFjaHVua19pc193b3Jk
KHZhcmNuaykpCiAgICB7Ci0gICAgICBpZiAodW5jX3RvdXBwZXIoKnN0cikgIT0gKnN0cikK
KyAgICAgIGlmICggIGxhbmd1YWdlX2lzX3NldChMQU5HX09DKQorICAgICAgICAgJiYgY2h1
bmtfaXNfc3RyKHZhcmNuaywgIl4iLCAxKQorICAgICAgICAgJiYgY2h1bmtfaXNfcGFyZW5f
b3BlbihjaHVua19nZXRfcHJldl9uY25sbmkodmFyY25rKSkpICAgLy8gSXNzdWUgIzIyNzkK
ICAgICAgIHsKLSAgICAgICAgIHJldHVybihmYWxzZSk7CisgICAgICAgICAvLyBhbm9ueW1v
dXMgT2JqQyBibG9jayB0eXBlIC0tIFJUWVBFICheKShBUkdTKQorICAgICAgICAgYW5vbiA9
IHRydWU7CisgICAgICB9CisgICAgICBlbHNlCisgICAgICB7CisgICAgICAgICBMT0dfRk1U
KExGVFlQRSwgIiVzKCVkKTogbm90IGEgd29yZDogdGV4dCgpICclcycsIHR5cGUgaXMgJXMs
IEAgb3JpZ19saW5lIGlzICV6dTosIG9yaWdfY29sIGlzICV6dVxuIiwKKyAgICAgICAgICAg
ICAgICAgX19mdW5jX18sIF9fTElORV9fLCB2YXJjbmstPnRleHQoKSwgZ2V0X3Rva2VuX25h
bWUodmFyY25rLT50eXBlKSwKKyAgICAgICAgICAgICAgICAgdmFyY25rLT5vcmlnX2xpbmUs
IHZhcmNuay0+b3JpZ19jb2wpOworICAgICAgICAgZ290byBub2dvX2V4aXQ7CiAgICAgICB9
Ci0gICAgICBzdHIrKzsKICAgIH0KLSAgIHJldHVybih0cnVlKTsKLX0KKyAgIGFwbyA9IGNo
dW5rX2dldF9uZXh0X25jbmwocGMpOwogCisgICBpZiAoYXBvID09IG51bGxwdHIpCisgICB7
CisgICAgICByZXR1cm4oZmFsc2UpOworICAgfQorICAgYXBjID0gY2h1bmtfc2tpcF90b19t
YXRjaChhcG8pOwogCi1zdGF0aWMgYm9vbCBpc19vY19ibG9jayhjaHVua190ICpwYykKLXsK
LSAgIHJldHVybiggIHBjICE9IG51bGxwdHIKLSAgICAgICAgICYmICggIGdldF9jaHVua19w
YXJlbnRfdHlwZShwYykgPT0gQ1RfT0NfQkxPQ0tfVFlQRQotICAgICAgICAgICAgfHwgZ2V0
X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9PQ19CTE9DS19FWFBSCi0gICAgICAgICAg
ICB8fCBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09IENUX09DX0JMT0NLX0FSRwotICAg
ICAgICAgICAgfHwgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9PQ19CTE9DSwot
ICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX09DX0JMT0NLX0NBUkVUKQot
ICAgICAgICAgICAgfHwgKHBjLT5uZXh0ICE9IG51bGxwdHIgJiYgcGMtPm5leHQtPnR5cGUg
PT0gQ1RfT0NfQkxPQ0tfQ0FSRVQpCi0gICAgICAgICAgICB8fCAocGMtPnByZXYgIT0gbnVs
bHB0ciAmJiBwYy0+cHJldi0+dHlwZSA9PSBDVF9PQ19CTE9DS19DQVJFVCkpKTsKLX0KKyAg
IGlmICggIGFwYyAhPSBudWxscHRyCisgICAgICAmJiAoICAhY2h1bmtfaXNfcGFyZW5fb3Bl
bihhcG8pCisgICAgICAgICB8fCAoKGFwYyA9IGNodW5rX3NraXBfdG9fbWF0Y2goYXBvKSkg
PT0gbnVsbHB0cikpKQorICAgeworICAgICAgTE9HX0ZNVChMRlRZUEUsICIlcyglZCk6IG5v
dCBmb2xsb3dlZCBieSBwYXJlbnNcbiIsIF9fZnVuY19fLCBfX0xJTkVfXyk7CisgICAgICBn
b3RvIG5vZ29fZXhpdDsKKyAgIH0KKyAgIGFmdCA9IGNodW5rX2dldF9uZXh0X25jbmwoYXBj
KTsKIAorICAgaWYgKGNodW5rX2lzX3Rva2VuKGFmdCwgQ1RfQlJBQ0VfT1BFTikpCisgICB7
CisgICAgICBwdCA9IENUX0ZVTkNfREVGOworICAgfQorICAgZWxzZSBpZiAoY2h1bmtfaXNf
dG9rZW4oYWZ0LCBDVF9TRU1JQ09MT04pIHx8IGNodW5rX2lzX3Rva2VuKGFmdCwgQ1RfQVNT
SUdOKSkKKyAgIHsKKyAgICAgIHB0ID0gQ1RfRlVOQ19QUk9UTzsKKyAgIH0KKyAgIGVsc2UK
KyAgIHsKKyAgICAgIExPR19GTVQoTEZUWVBFLCAiJXMoJWQpOiBub3QgZm9sbG93ZWQgYnkg
J3snIG9yICc7J1xuIiwgX19mdW5jX18sIF9fTElORV9fKTsKKyAgICAgIGdvdG8gbm9nb19l
eGl0OworICAgfQorICAgcHRwID0gcGMtPmZsYWdzLnRlc3QoUENGX0lOX1RZUEVERUYpID8g
Q1RfRlVOQ19UWVBFIDogQ1RfRlVOQ19WQVI7CiAKLXN0YXRpYyB2b2lkIGZpeF9jYXN0cyhj
aHVua190ICpzdGFydCkKLXsKLSAgIExPR19GVU5DX0VOVFJZKCk7Ci0gICBjaHVua190ICAg
ICpwYzsKLSAgIGNodW5rX3QgICAgKnByZXY7Ci0gICBjaHVua190ICAgICpmaXJzdDsKLSAg
IGNodW5rX3QgICAgKmFmdGVyOwotICAgY2h1bmtfdCAgICAqbGFzdCA9IG51bGxwdHI7Ci0g
ICBjaHVua190ICAgICpwYXJlbl9jbG9zZTsKLSAgIGNvbnN0IGNoYXIgKnZlcmIgICAgICA9
ICJsaWtlbHkiOwotICAgY29uc3QgY2hhciAqZGV0YWlsICAgID0gIiI7Ci0gICBzaXplX3Qg
ICAgIGNvdW50ICAgICAgPSAwOwotICAgaW50ICAgICAgICB3b3JkX2NvdW50ID0gMDsKLSAg
IGJvb2wgICAgICAgbm9wZTsKLSAgIGJvb2wgICAgICAgZG91YnRmdWxfY2FzdCA9IGZhbHNl
OworICAgdG1wID0gcGM7CiAKKyAgIHdoaWxlICgodG1wID0gY2h1bmtfZ2V0X3ByZXZfbmNu
bG5pKHRtcCkpICE9IG51bGxwdHIpICAgLy8gSXNzdWUgIzIyNzkKKyAgIHsKKyAgICAgIHRt
cCA9IGNodW5rX2dldF9wcmV2X3NzcSh0bXApOwogCi0gICBMT0dfRk1UKExDQVNUUywgIiVz
KCVkKTogc3RhcnQtPnRleHQoKSBpcyAnJXMnLCBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2Nv
bCBpcyAlenVcbiIsCi0gICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgc3RhcnQtPnRl
eHQoKSwgc3RhcnQtPm9yaWdfbGluZSwgc3RhcnQtPm9yaWdfY29sKTsKKyAgICAgIExPR19G
TVQoTEZUWVBFLCAiIC0tIHR5cGUgaXMgJXMsICVzIG9uIG9yaWdfbGluZSAlenUsIG9yaWdf
Y29sIGlzICV6dSIsCisgICAgICAgICAgICAgIGdldF90b2tlbl9uYW1lKHRtcC0+dHlwZSks
IHRtcC0+dGV4dCgpLAorICAgICAgICAgICAgICB0bXAtPm9yaWdfbGluZSwgdG1wLT5vcmln
X2NvbCk7CiAKLSAgIHByZXYgPSBjaHVua19nZXRfcHJldl9uY25sbmkoc3RhcnQpOyAgIC8v
IElzc3VlICMyMjc5CisgICAgICBpZiAoICBjaHVua19pc19zdGFyKHRtcCkKKyAgICAgICAg
IHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfUFRSX1RZUEUpCisgICAgICAgICB8fCBjaHVu
a19pc190b2tlbih0bXAsIENUX0NBUkVUKSkKKyAgICAgIHsKKyAgICAgICAgIHN0YXJfY291
bnQrKzsKKyAgICAgICAgIHB0cmNuayA9IHRtcDsKKyAgICAgICAgIExPR19GTVQoTEZUWVBF
LCAiIC0tIFBUUl9UWVBFXG4iKTsKKyAgICAgIH0KKyAgICAgIGVsc2UgaWYgKCAgY2h1bmtf
aXNfd29yZCh0bXApCisgICAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1Rf
V09SRCkKKyAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9UWVBFKSkK
KyAgICAgIHsKKyAgICAgICAgIHdvcmRfY291bnQrKzsKKyAgICAgICAgIExPR19GTVQoTEZU
WVBFLCAiIC0tIFRZUEUoJXMpXG4iLCB0bXAtPnRleHQoKSk7CisgICAgICB9CisgICAgICBl
bHNlIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX0RDX01FTUJFUikpCisgICAgICB7Cisg
ICAgICAgICB3b3JkX2NvdW50ID0gMDsKKyAgICAgICAgIExPR19GTVQoTEZUWVBFLCAiIC0t
IDo6IHJlc2V0IHdvcmRfY291bnRcbiIpOworICAgICAgfQorICAgICAgZWxzZSBpZiAoY2h1
bmtfaXNfc3RyKHRtcCwgIigiLCAxKSkKKyAgICAgIHsKKyAgICAgICAgIExPR19GTVQoTEZU
WVBFLCAiIC0tIG9wZW4gcGFyZW4gKGJyZWFrKVxuIik7CisgICAgICAgICBicmVhazsKKyAg
ICAgIH0KKyAgICAgIGVsc2UKKyAgICAgIHsKKyAgICAgICAgIExPR19GTVQoTEZUWVBFLCAi
IC0tICB1bmV4cGVjdGVkIHRva2VuOiB0eXBlIGlzICVzLCB0ZXh0KCkgJyVzJywgb24gb3Jp
Z19saW5lICV6dSwgb3JpZ19jb2wgJXp1XG4iLAorICAgICAgICAgICAgICAgICBnZXRfdG9r
ZW5fbmFtZSh0bXAtPnR5cGUpLCB0bXAtPnRleHQoKSwKKyAgICAgICAgICAgICAgICAgdG1w
LT5vcmlnX2xpbmUsIHRtcC0+b3JpZ19jb2wpOworICAgICAgICAgZ290byBub2dvX2V4aXQ7
CisgICAgICB9CisgICB9CiAKLSAgIGlmIChwcmV2ID09IG51bGxwdHIpCisgICAvLyBGaXhl
cyAjaXNzdWUgMTU3NworICAgLy8gQWxsb3cgd29yZCBjb3VudCAyIGluY2FzZSBvZiBmdW5j
dGlvbiBwb2ludGVyIGRlY2xhcmF0aW9uLgorICAgLy8gRXg6IGJvb2wgKF9fc3RkY2FsbCog
ZnVuY3B0cikoaW50LCBpbnQpOworICAgaWYgKCAgc3Rhcl9jb3VudCA+IDEKKyAgICAgIHx8
ICh3b3JkX2NvdW50ID4gMSAmJiAhKHdvcmRfY291bnQgPT0gMiAmJiBwdHAgPT0gQ1RfRlVO
Q19WQVIpKQorICAgICAgfHwgKChzdGFyX2NvdW50ICsgd29yZF9jb3VudCkgPT0gMCkpCiAg
ICB7Ci0gICAgICByZXR1cm47CisgICAgICBMT0dfRk1UKExGVFlQRSwgIiVzKCVkKTogYmFk
IGNvdW50cyB3b3JkOiAlenUsIHN0YXI6ICV6dVxuIiwKKyAgICAgICAgICAgICAgX19mdW5j
X18sIF9fTElORV9fLCB3b3JkX2NvdW50LCBzdGFyX2NvdW50KTsKKyAgICAgIGdvdG8gbm9n
b19leGl0OwogICAgfQogCi0gICBpZiAoY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfUFBfREVG
SU5FRCkpCisgICAvLyBtYWtlIHN1cmUgd2hhdCBhcHBlYXJzIGJlZm9yZSB0aGUgZmlyc3Qg
b3BlbiBwYXJlbiBjYW4gYmUgYSByZXR1cm4gdHlwZQorICAgaWYgKCFjaHVua19lbmRzX3R5
cGUoY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHRtcCkpKSAgIC8vIElzc3VlICMyMjc5CiAgICB7
Ci0gICAgICBMT0dfRk1UKExDQVNUUywgIiVzKCVkKTogIC0tIG5vdCBhIGNhc3QgLSBhZnRl
ciBkZWZpbmVkXG4iLAotICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18pOwotICAg
ICAgcmV0dXJuOworICAgICAgZ290byBub2dvX2V4aXQ7CiAgICB9CiAKLSAgIGlmIChjaHVu
a19pc190b2tlbihwcmV2LCBDVF9BTkdMRV9DTE9TRSkpCisgICBpZiAocHRyY25rKQogICAg
ewotICAgICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6ICAtLSBub3QgYSBjYXN0IC0gYWZ0
ZXIgPiAodGVtcGxhdGUpXG4iLAotICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18p
OwotICAgICAgcmV0dXJuOworICAgICAgc2V0X2NodW5rX3R5cGUocHRyY25rLCBDVF9QVFJf
VFlQRSk7CiAgICB9Ci0gICAvLyBNYWtlIHN1cmUgdGhlcmUgaXMgb25seSBXT1JELCBUWVBF
LCBhbmQgJyonIG9yICdeJyBiZWZvcmUgdGhlIGNsb3NlIHBhcmVuCi0gICBwYyAgICA9IGNo
dW5rX2dldF9uZXh0X25jbmwoc3RhcnQpOwotICAgZmlyc3QgPSBwYzsKIAotICAgd2hpbGUg
KCAgcGMgIT0gbnVsbHB0cgotICAgICAgICAgJiYgKCAgY2h1bmtfaXNfdHlwZShwYykKLSAg
ICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9XT1JEKQotICAgICAgICAgICAg
fHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1FVQUxJRklFUikKLSAgICAgICAgICAgIHx8IGNo
dW5rX2lzX3Rva2VuKHBjLCBDVF9EQ19NRU1CRVIpCi0gICAgICAgICAgICB8fCBjaHVua19p
c190b2tlbihwYywgQ1RfUFApCi0gICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywg
Q1RfU1RBUikKLSAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9RVUVTVElP
TikKLSAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9DQVJFVCkKLSAgICAg
ICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9UU1FVQVJFKQotICAgICAgICAgICAg
fHwgKCAgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FOR0xFX09QRU4pCi0gICAgICAgICAg
ICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQU5HTEVfQ0xPU0UpKQotICAgICAg
ICAgICAgICAgJiYgbGFuZ3VhZ2VfaXNfc2V0KExBTkdfT0MgfCBMQU5HX0pBVkEpKQotICAg
ICAgICAgICAgfHwgKCAgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1FVRVNUSU9OKQotICAg
ICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0NPTU1BKQotICAgICAg
ICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX01FTUJFUikpCi0gICAgICAg
ICAgICAgICAmJiBsYW5ndWFnZV9pc19zZXQoTEFOR19KQVZBKSkKLSAgICAgICAgICAgIHx8
IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BTVApKSkKKyAgIGlmICghYW5vbikKICAgIHsKLSAg
ICAgIExPR19GTVQoTENBU1RTLCAiJXMoJWQpOiBwYy0+dGV4dCgpIGlzICclcycsIG9yaWdf
bGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdHlwZSBpcyAlc1xuIiwKLSAgICAgICAg
ICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5lLCBw
Yy0+b3JpZ19jb2wsIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7Ci0KLSAgICAgIGlmIChj
aHVua19pc190b2tlbihwYywgQ1RfV09SRCkgfHwgKGNodW5rX2lzX3Rva2VuKGxhc3QsIENU
X0FOR0xFX0NMT1NFKSAmJiBjaHVua19pc190b2tlbihwYywgQ1RfRENfTUVNQkVSKSkpCisg
ICAgICBpZiAocGMtPmZsYWdzLnRlc3QoUENGX0lOX1RZUEVERUYpKQogICAgICAgewotICAg
ICAgICAgd29yZF9jb3VudCsrOworICAgICAgICAgc2V0X2NodW5rX3R5cGUodmFyY25rLCBD
VF9UWVBFKTsKICAgICAgIH0KLSAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9EQ19NRU1CRVIpIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9NRU1CRVIpIHx8IGNodW5r
X2lzX3Rva2VuKHBjLCBDVF9QUCkpCisgICAgICBlbHNlCiAgICAgICB7Ci0gICAgICAgICAv
LyBtaWdodCBiZSBuZWdhdGl2LCBzdWNoIGFzIHdpdGg6Ci0gICAgICAgICAvLyBhID0gdmFs
ICsgKENGb286OmJhcl90KTc7Ci0gICAgICAgICB3b3JkX2NvdW50LS07CisgICAgICAgICBz
ZXRfY2h1bmtfdHlwZSh2YXJjbmssIENUX0ZVTkNfVkFSKTsKKyAgICAgICAgIGNodW5rX2Zs
YWdzX3NldCh2YXJjbmssIFBDRl9WQVJfMVNUX0RFRik7CiAgICAgICB9Ci0gICAgICBsYXN0
ID0gcGM7Ci0gICAgICBwYyAgID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7Ci0gICAgICBj
b3VudCsrOwogICAgfQorICAgc2V0X2NodW5rX3R5cGUocGMsIENUX1RQQVJFTl9DTE9TRSk7
CisgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBwdHApOwogCi0gICBpZiAoICBwYyA9PSBudWxs
cHRyCi0gICAgICB8fCBwYy0+dHlwZSAhPSBDVF9QQVJFTl9DTE9TRQotICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4ocHJldiwgQ1RfT0NfQ0xBU1MpKQorICAgc2V0X2NodW5rX3R5cGUoYXBv
LCBDVF9GUEFSRU5fT1BFTik7CisgICBzZXRfY2h1bmtfcGFyZW50KGFwbywgcHQpOworICAg
c2V0X2NodW5rX3R5cGUoYXBjLCBDVF9GUEFSRU5fQ0xPU0UpOworICAgc2V0X2NodW5rX3Bh
cmVudChhcGMsIHB0KTsKKyAgIGZpeF9mY25fZGVmX3BhcmFtcyhhcG8pOworCisgICBpZiAo
Y2h1bmtfaXNfc2VtaWNvbG9uKGFmdCkpCiAgICB7Ci0gICAgICBMT0dfRk1UKExDQVNUUywg
IiVzKCVkKTogIC0tIG5vdCBhIGNhc3QsIGhpdCB0eXBlIGlzICVzXG4iLAotICAgICAgICAg
ICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjID09IG51bGxwdHIgPyAiTlVMTCIgOiBnZXRf
dG9rZW5fbmFtZShwYy0+dHlwZSkpOwotICAgICAgcmV0dXJuOworICAgICAgc2V0X2NodW5r
X3BhcmVudChhZnQsIGFmdC0+ZmxhZ3MudGVzdChQQ0ZfSU5fVFlQRURFRikgPyBDVF9UWVBF
REVGIDogQ1RfRlVOQ19WQVIpOworICAgfQorICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4o
YWZ0LCBDVF9CUkFDRV9PUEVOKSkKKyAgIHsKKyAgICAgIGZsYWdfcGFyZW5zKGFmdCwgUENG
X05PTkUsIENUX05PTkUsIHB0LCBmYWxzZSk7CisgICB9CisgICAvLyBTdGVwIGJhY2t3YXJk
cyB0byB0aGUgcHJldmlvdXMgb3BlbiBwYXJlbiBhbmQgbWFyayBldmVyeXRoaW5nIGEKKyAg
IHRtcCA9IHBjOworCisgICB3aGlsZSAoKHRtcCA9IGNodW5rX2dldF9wcmV2X25jbmxuaSh0
bXApKSAhPSBudWxscHRyKSAgIC8vIElzc3VlICMyMjc5CisgICB7CisgICAgICBMT0dfRk1U
KExGVFlQRSwgIiArKyB0eXBlIGlzICVzLCB0ZXh0KCkgJyVzJywgb24gb3JpZ19saW5lICV6
dSwgb3JpZ19jb2wgJXp1XG4iLAorICAgICAgICAgICAgICBnZXRfdG9rZW5fbmFtZSh0bXAt
PnR5cGUpLCB0bXAtPnRleHQoKSwKKyAgICAgICAgICAgICAgdG1wLT5vcmlnX2xpbmUsIHRt
cC0+b3JpZ19jb2wpOworCisgICAgICBpZiAoKnRtcC0+c3RyLmNfc3RyKCkgPT0gJygnKQor
ICAgICAgeworICAgICAgICAgaWYgKCFwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fVFlQRURFRikp
CisgICAgICAgICB7CisgICAgICAgICAgICBjaHVua19mbGFnc19zZXQodG1wLCBQQ0ZfVkFS
XzFTVF9ERUYpOworICAgICAgICAgfQorICAgICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBD
VF9UUEFSRU5fT1BFTik7CisgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHRtcCwgcHRwKTsK
KworICAgICAgICAgdG1wID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHRtcCk7ICAgLy8gSXNz
dWUgIzIyNzkKKworICAgICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9GVU5D
VElPTikKKyAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfRlVOQ19DQUxM
KQorICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9GVU5DX0NBTExfVVNF
UikKKyAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfRlVOQ19ERUYpCisg
ICAgICAgICAgICB8fCBjaHVua19pc190b2tlbih0bXAsIENUX0ZVTkNfUFJPVE8pKQorICAg
ICAgICAgeworICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9UWVBFKTsKKyAg
ICAgICAgICAgIGNodW5rX2ZsYWdzX2Nscih0bXAsIFBDRl9WQVJfMVNUX0RFRik7CisgICAg
ICAgICB9CisgICAgICAgICBtYXJrX2Z1bmN0aW9uX3JldHVybl90eXBlKHZhcmNuaywgdG1w
LCBwdHApOworICAgICAgICAgYnJlYWs7CisgICAgICB9CiAgICB9CisgICByZXR1cm4odHJ1
ZSk7CiAKLSAgIGlmICh3b3JkX2NvdW50ID4gMSkKK25vZ29fZXhpdDoKKyAgIHRtcCA9IGNo
dW5rX2dldF9uZXh0X25jbmwocGMpOworCisgICBpZiAoY2h1bmtfaXNfcGFyZW5fb3Blbih0
bXApKQogICAgewotICAgICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6ICAtLSB0b28gbWFu
eSB3b3JkczogJWRcbiIsCi0gICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgd29y
ZF9jb3VudCk7Ci0gICAgICByZXR1cm47CisgICAgICBMT0dfRk1UKExGVFlQRSwgIiVzKCVk
KTogc2V0dGluZyBGVU5DX0NBTEwgb24gb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMg
JXp1XG4iLAorICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHRtcC0+b3JpZ19s
aW5lLCB0bXAtPm9yaWdfY29sKTsKKyAgICAgIGZsYWdfcGFyZW5zKHRtcCwgUENGX05PTkUs
IENUX0ZQQVJFTl9PUEVOLCBDVF9GVU5DX0NBTEwsIGZhbHNlKTsKICAgIH0KLSAgIHBhcmVu
X2Nsb3NlID0gcGM7CisgICByZXR1cm4oZmFsc2UpOworfSAvLyBtYXJrX2Z1bmN0aW9uX3R5
cGUKIAotICAgLy8gSWYgbGFzdCBpcyBhIHR5cGUgb3Igc3Rhci9jYXJldCwgd2UgaGF2ZSBh
IGNhc3QgZm9yIHN1cmUKLSAgIGlmICggIGNodW5rX2lzX3Rva2VuKGxhc3QsIENUX1NUQVIp
Ci0gICAgICB8fCBjaHVua19pc190b2tlbihsYXN0LCBDVF9DQVJFVCkKLSAgICAgIHx8IGNo
dW5rX2lzX3Rva2VuKGxhc3QsIENUX1BUUl9UWVBFKQotICAgICAgfHwgY2h1bmtfaXNfdG9r
ZW4obGFzdCwgQ1RfVFlQRSkKLSAgICAgIHx8IChjaHVua19pc190b2tlbihsYXN0LCBDVF9B
TkdMRV9DTE9TRSkgJiYgbGFuZ3VhZ2VfaXNfc2V0KExBTkdfT0MgfCBMQU5HX0pBVkEpKSkK
Kworc3RhdGljIHZvaWQgcHJvY2Vzc19yZXR1cm5zKHZvaWQpCit7CisgICBMT0dfRlVOQ19F
TlRSWSgpOworICAgY2h1bmtfdCAqcGM7CisKKyAgIHBjID0gY2h1bmtfZ2V0X2hlYWQoKTsK
KworICAgd2hpbGUgKHBjICE9IG51bGxwdHIpCiAgICB7Ci0gICAgICB2ZXJiID0gImZvciBz
dXJlIjsKKyAgICAgIGlmIChwYy0+dHlwZSAhPSBDVF9SRVRVUk4pCisgICAgICB7CisgICAg
ICAgICBwYyA9IGNodW5rX2dldF9uZXh0X3R5cGUocGMsIENUX1JFVFVSTiwgLTEpOworICAg
ICAgICAgY29udGludWU7CisgICAgICB9CisgICAgICBwYyA9IHByb2Nlc3NfcmV0dXJuKHBj
KTsKICAgIH0KLSAgIGVsc2UgaWYgKGNvdW50ID09IDEpCit9CisKKworc3RhdGljIGNodW5r
X3QgKnByb2Nlc3NfcmV0dXJuKGNodW5rX3QgKnBjKQoreworICAgTE9HX0ZVTkNfRU5UUlko
KTsKKyAgIGNodW5rX3QgKm5leHQ7CisgICBjaHVua190ICp0ZW1wOworICAgY2h1bmtfdCAq
c2VtaTsKKyAgIGNodW5rX3QgKmNwYXI7CisgICBjaHVua190IGNodW5rOworCisgICAvLyBn
cmFiIG5leHQgYW5kIGJhaWwgaWYgaXQgaXMgYSBzZW1pY29sb24KKyAgIG5leHQgPSBjaHVu
a19wcGFfZ2V0X25leHRfbmNubChwYyk7CisKKyAgIGlmICggIG5leHQgPT0gbnVsbHB0ciB8
fCBjaHVua19pc19zZW1pY29sb24obmV4dCkKKyAgICAgIHx8IGNodW5rX2lzX3Rva2VuKG5l
eHQsIENUX05FV0xJTkUpKQogICAgewotICAgICAgLyoKLSAgICAgICAqIFdlIGFyZSBvbiBh
IHBvdGVudGlhbCBjYXN0IG9mIHRoZSBmb3JtICIod29yZCkiLgotICAgICAgICogV2UgZG9u
J3Qga25vdyBpZiB0aGUgd29yZCBpcyBhIHR5cGUuIFNvIGxldHMgZ3Vlc3MgYmFzZWQgb24g
c29tZQotICAgICAgICogc2ltcGxlIHJ1bGVzOgotICAgICAgICogIC0gaWYgYWxsIGNhcHMs
IGxpa2VseSBhIHR5cGUKLSAgICAgICAqICAtIGlmIGl0IGVuZHMgaW4gX3QsIGxpa2VseSBh
IHR5cGUKLSAgICAgICAqICAtIGlmIGl0J3Mgb2JqZWN0aXZlLWMgYW5kIHRoZSB0eXBlIGlz
IGlkLCBsaWtlbHkgdmFsaWQKLSAgICAgICAqLwotICAgICAgdmVyYiA9ICJndWVzc2VkIjsK
KyAgICAgIHJldHVybihuZXh0KTsKKyAgIH0KKyAgIGxvZ19ydWxlX0IoIm5sX3JldHVybl9l
eHByIik7CiAKLSAgICAgIGlmICggIChsYXN0LT5sZW4oKSA+IDMpCi0gICAgICAgICAmJiAo
bGFzdC0+c3RyW2xhc3QtPmxlbigpIC0gMl0gPT0gJ18nKQotICAgICAgICAgJiYgKGxhc3Qt
PnN0cltsYXN0LT5sZW4oKSAtIDFdID09ICd0JykpCisgICBpZiAoICBvcHRpb25zOjpubF9y
ZXR1cm5fZXhwcigpICE9IElBUkZfSUdOT1JFCisgICAgICAmJiAhcGMtPmZsYWdzLnRlc3Qo
UENGX0lOX1BSRVBST0MpKQorICAgeworICAgICAgbmV3bGluZV9pYXJmKHBjLCBvcHRpb25z
OjpubF9yZXR1cm5fZXhwcigpKTsKKyAgIH0KKworICAgaWYgKGNodW5rX2lzX3Rva2VuKG5l
eHQsIENUX1BBUkVOX09QRU4pKQorICAgeworICAgICAgLy8gU2VlIGlmIHRoZSByZXR1cm4g
aXMgZnVsbHkgcGFyZW4nZAorICAgICAgY3BhciA9IGNodW5rX2dldF9uZXh0X3R5cGUobmV4
dCwgQ1RfUEFSRU5fQ0xPU0UsIG5leHQtPmxldmVsKTsKKworICAgICAgaWYgKGNwYXIgPT0g
bnVsbHB0cikKKyAgICAgIHsKKyAgICAgICAgIHJldHVybihudWxscHRyKTsKKyAgICAgIH0K
KyAgICAgIHNlbWkgPSBjaHVua19wcGFfZ2V0X25leHRfbmNubChjcGFyKTsKKworICAgICAg
aWYgKHNlbWkgPT0gbnVsbHB0cikKKyAgICAgIHsKKyAgICAgICAgIHJldHVybihudWxscHRy
KTsKKyAgICAgIH0KKworICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHNlbWksIENUX05FV0xJ
TkUpIHx8IGNodW5rX2lzX3NlbWljb2xvbihzZW1pKSkKKyAgICAgIHsKKyAgICAgICAgIGxv
Z19ydWxlX0IoIm1vZF9wYXJlbl9vbl9yZXR1cm4iKTsKKworICAgICAgICAgaWYgKG9wdGlv
bnM6Om1vZF9wYXJlbl9vbl9yZXR1cm4oKSA9PSBJQVJGX1JFTU9WRSkKKyAgICAgICAgIHsK
KyAgICAgICAgICAgIExPR19GTVQoTFJFVFVSTiwgIiVzKCVkKTogcmVtb3ZpbmcgcGFyZW5z
IG9uIG9yaWdfbGluZSAlenVcbiIsCisgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBf
X0xJTkVfXywgcGMtPm9yaWdfbGluZSk7CisKKyAgICAgICAgICAgIC8vIGxvd2VyIHRoZSBs
ZXZlbCBvZiBldmVyeXRoaW5nCisgICAgICAgICAgICBmb3IgKHRlbXAgPSBuZXh0OyB0ZW1w
ICE9IGNwYXI7IHRlbXAgPSBjaHVua19nZXRfbmV4dCh0ZW1wKSkKKyAgICAgICAgICAgIHsK
KyAgICAgICAgICAgICAgIGlmICh0ZW1wLT5sZXZlbCA9PSAwKQorICAgICAgICAgICAgICAg
eworICAgICAgICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsICIlcyglZCk6IHRlbXAtPmxl
dmVsIGlzIFpFUk8sIGNhbm5vdCBiZSBkZWNyZW1lbnRlZCwgYXQgbGluZSAlenUsIGNvbHVt
biAlenVcbiIsCisgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVf
XywgdGVtcC0+b3JpZ19saW5lLCB0ZW1wLT5vcmlnX2NvbCk7CisgICAgICAgICAgICAgICAg
ICBsb2dfZmx1c2godHJ1ZSk7CisgICAgICAgICAgICAgICAgICBleGl0KEVYX1NPRlRXQVJF
KTsKKyAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgICAgIHRlbXAtPmxldmVsLS07Cisg
ICAgICAgICAgICB9CisKKyAgICAgICAgICAgIC8vIGRlbGV0ZSB0aGUgcGFyZW50aGVzaXMK
KyAgICAgICAgICAgIGNodW5rX2RlbChuZXh0KTsKKyAgICAgICAgICAgIGNodW5rX2RlbChj
cGFyKTsKKworICAgICAgICAgICAgLy8gYmFjayB1cCBmb2xsb3dpbmcgY2h1bmtzCisgICAg
ICAgICAgICB0ZW1wID0gc2VtaTsKKworICAgICAgICAgICAgd2hpbGUgKHRlbXAgIT0gbnVs
bHB0ciAmJiB0ZW1wLT50eXBlICE9IENUX05FV0xJTkUpCisgICAgICAgICAgICB7CisgICAg
ICAgICAgICAgICB0ZW1wLT5jb2x1bW4gICAgICAgPSB0ZW1wLT5jb2x1bW4gLSAyOworICAg
ICAgICAgICAgICAgdGVtcC0+b3JpZ19jb2wgICAgID0gdGVtcC0+b3JpZ19jb2wgLSAyOwor
ICAgICAgICAgICAgICAgdGVtcC0+b3JpZ19jb2xfZW5kID0gdGVtcC0+b3JpZ19jb2xfZW5k
IC0gMjsKKyAgICAgICAgICAgICAgIHRlbXAgICAgICAgICAgICAgICA9IGNodW5rX2dldF9u
ZXh0KHRlbXApOworICAgICAgICAgICAgfQorICAgICAgICAgfQorICAgICAgICAgZWxzZQor
ICAgICAgICAgeworICAgICAgICAgICAgTE9HX0ZNVChMUkVUVVJOLCAiJXMoJWQpOiBrZWVw
aW5nIHBhcmVucyBvbiBvcmlnX2xpbmUgJXp1XG4iLAorICAgICAgICAgICAgICAgICAgICBf
X2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUpOworCisgICAgICAgICAgICAvLyBt
YXJrICYga2VlcCB0aGVtCisgICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KG5leHQsIENU
X1JFVFVSTik7CisgICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KGNwYXIsIENUX1JFVFVS
Tik7CisgICAgICAgICB9CisgICAgICAgICByZXR1cm4oc2VtaSk7CisgICAgICB9CisgICB9
CisgICAvLyBXZSBkb24ndCBoYXZlIGEgZnVsbHkgcGFyZW4nZCByZXR1cm4uIFNob3VsZCB3
ZSBhZGQgc29tZT8KKyAgIGxvZ19ydWxlX0IoIm1vZF9wYXJlbl9vbl9yZXR1cm4iKTsKKwor
ICAgaWYgKCEob3B0aW9uczo6bW9kX3BhcmVuX29uX3JldHVybigpICYgSUFSRl9BREQpKQor
ICAgeworICAgICAgcmV0dXJuKG5leHQpOworICAgfQorCisgICAvLyBJc3N1ZSAjMTkxNwor
ICAgLy8gTmV2ZXIgYWRkIHBhcmVucyB0byBhIGJyYWNlZCBpbml0IGxpc3Q7IHRoYXQgYnJl
YWtzIHRoZSBjb2RlCisgICAvLyAgIHJldHVybiB7YXJncy4uLn07ICAgIC8vIEMrKzExIHR5
cGUgZWxpc2lvbjsgb2theQorICAgLy8gICByZXR1cm4gKHthcmdzLi4ufSk7ICAvLyBpbGwt
Zm9ybWVkCisgICBpZiAoICBsYW5ndWFnZV9pc19zZXQoTEFOR19DUFApICYmIGNodW5rX2lz
X3Rva2VuKG5leHQsIENUX0JSQUNFX09QRU4pCisgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50
X3R5cGUobmV4dCkgPT0gQ1RfQlJBQ0VEX0lOSVRfTElTVCkKKyAgIHsKKyAgICAgIExPR19G
TVQoTFJFVFVSTiwgIiVzKCVkKTogbm90IGFkZGluZyBwYXJlbnMgYXJvdW5kIGJyYWNlZCBp
bml0aWFsaXplciIKKyAgICAgICAgICAgICAgIiBvbiBvcmlnX2xpbmUgJXpkXG4iLAorICAg
ICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUpOworICAgICAg
cmV0dXJuKG5leHQpOworICAgfQorICAgLy8gZmluZCB0aGUgbmV4dCBzZW1pY29sb24gb24g
dGhlIHNhbWUgbGV2ZWwKKyAgIHNlbWkgPSBuZXh0OworCisgICBpZiAocGMtPmZsYWdzLnRl
c3QoUENGX0lOX1BSRVBST0MpKQorICAgeworICAgICAgd2hpbGUgKChzZW1pID0gc2VtaS0+
bmV4dCkgIT0gbnVsbHB0cikKKyAgICAgIHsKKyAgICAgICAgIGlmICghc2VtaS0+ZmxhZ3Mu
dGVzdChQQ0ZfSU5fUFJFUFJPQykpCisgICAgICAgICB7CisgICAgICAgICAgICBicmVhazsK
KyAgICAgICAgIH0KKworICAgICAgICAgaWYgKHNlbWktPmxldmVsIDwgcGMtPmxldmVsKQor
ICAgICAgICAgeworICAgICAgICAgICAgcmV0dXJuKHNlbWkpOworICAgICAgICAgfQorCisg
ICAgICAgICBpZiAoY2h1bmtfaXNfc2VtaWNvbG9uKHNlbWkpICYmIHBjLT5sZXZlbCA9PSBz
ZW1pLT5sZXZlbCkKKyAgICAgICAgIHsKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICAg
fQorICAgICAgfQorICAgfQorICAgZWxzZQorICAgeworICAgICAgd2hpbGUgKChzZW1pID0g
Y2h1bmtfZ2V0X25leHQoc2VtaSkpICE9IG51bGxwdHIpCisgICAgICB7CisgICAgICAgICBp
ZiAoc2VtaS0+bGV2ZWwgPCBwYy0+bGV2ZWwpCisgICAgICAgICB7CisgICAgICAgICAgICBy
ZXR1cm4oc2VtaSk7CisgICAgICAgICB9CisKKyAgICAgICAgIGlmIChjaHVua19pc19zZW1p
Y29sb24oc2VtaSkgJiYgcGMtPmxldmVsID09IHNlbWktPmxldmVsKQorICAgICAgICAgewor
ICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICB9CisgICAgICB9CisgICB9CisKKyAgIGlm
IChzZW1pKQorICAgeworICAgICAgLy8gYWRkIHRoZSBwYXJlbnRoZXNpcworICAgICAgc2V0
X2NodW5rX3R5cGUoJmNodW5rLCBDVF9QQVJFTl9PUEVOKTsKKyAgICAgIHNldF9jaHVua19w
YXJlbnQoJmNodW5rLCBDVF9SRVRVUk4pOworICAgICAgY2h1bmsuc3RyICAgICAgICAgPSAi
KCI7CisgICAgICBjaHVuay5sZXZlbCAgICAgICA9IHBjLT5sZXZlbDsKKyAgICAgIGNodW5r
LmJyYWNlX2xldmVsID0gcGMtPmJyYWNlX2xldmVsOworICAgICAgY2h1bmsub3JpZ19saW5l
ICAgPSBwYy0+b3JpZ19saW5lOworICAgICAgY2h1bmsub3JpZ19jb2wgICAgPSBuZXh0LT5v
cmlnX2NvbCAtIDE7CisgICAgICBjaHVuay5mbGFncyAgICAgICA9IHBjLT5mbGFncyAmIFBD
Rl9DT1BZX0ZMQUdTOworICAgICAgY2h1bmtfYWRkX2JlZm9yZSgmY2h1bmssIG5leHQpOwor
CisgICAgICBzZXRfY2h1bmtfdHlwZSgmY2h1bmssIENUX1BBUkVOX0NMT1NFKTsKKyAgICAg
IGNodW5rLnN0ciAgICAgICA9ICIpIjsKKyAgICAgIGNodW5rLm9yaWdfbGluZSA9IHNlbWkt
Pm9yaWdfbGluZTsKKyAgICAgIGNodW5rLm9yaWdfY29sICA9IHNlbWktPm9yaWdfY29sIC0g
MTsKKyAgICAgIGNwYXIgICAgICAgICAgICA9IGNodW5rX2FkZF9iZWZvcmUoJmNodW5rLCBz
ZW1pKTsKKworICAgICAgTE9HX0ZNVChMUkVUVVJOLCAiJXMoJWQpOiBhZGRlZCBwYXJlbnMg
b24gb3JpZ19saW5lICV6dVxuIiwKKyAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9f
LCBwYy0+b3JpZ19saW5lKTsKKworICAgICAgZm9yICh0ZW1wID0gbmV4dDsgdGVtcCAhPSBj
cGFyOyB0ZW1wID0gY2h1bmtfZ2V0X25leHQodGVtcCkpCisgICAgICB7CisgICAgICAgICB0
ZW1wLT5sZXZlbCsrOworICAgICAgfQorICAgfQorICAgcmV0dXJuKHNlbWkpOworfSAvLyBw
cm9jZXNzX3JldHVybgorCisKK3N0YXRpYyBib29sIGlzX3VjYXNlX3N0cihjb25zdCBjaGFy
ICpzdHIsIHNpemVfdCBsZW4pCit7CisgICB3aGlsZSAobGVuLS0gPiAwKQorICAgeworICAg
ICAgaWYgKHVuY190b3VwcGVyKCpzdHIpICE9ICpzdHIpCisgICAgICB7CisgICAgICAgICBy
ZXR1cm4oZmFsc2UpOworICAgICAgfQorICAgICAgc3RyKys7CisgICB9CisgICByZXR1cm4o
dHJ1ZSk7Cit9CisKKworc3RhdGljIGJvb2wgaXNfb2NfYmxvY2soY2h1bmtfdCAqcGMpCit7
CisgICByZXR1cm4oICBwYyAhPSBudWxscHRyCisgICAgICAgICAmJiAoICBnZXRfY2h1bmtf
cGFyZW50X3R5cGUocGMpID09IENUX09DX0JMT0NLX1RZUEUKKyAgICAgICAgICAgIHx8IGdl
dF9jaHVua19wYXJlbnRfdHlwZShwYykgPT0gQ1RfT0NfQkxPQ0tfRVhQUgorICAgICAgICAg
ICAgfHwgZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9PSBDVF9PQ19CTE9DS19BUkcKKyAg
ICAgICAgICAgIHx8IGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgPT0gQ1RfT0NfQkxPQ0sK
KyAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9PQ19CTE9DS19DQVJFVCkK
KyAgICAgICAgICAgIHx8IChwYy0+bmV4dCAhPSBudWxscHRyICYmIHBjLT5uZXh0LT50eXBl
ID09IENUX09DX0JMT0NLX0NBUkVUKQorICAgICAgICAgICAgfHwgKHBjLT5wcmV2ICE9IG51
bGxwdHIgJiYgcGMtPnByZXYtPnR5cGUgPT0gQ1RfT0NfQkxPQ0tfQ0FSRVQpKSk7Cit9CisK
Kworc3RhdGljIHZvaWQgZml4X2Nhc3RzKGNodW5rX3QgKnN0YXJ0KQoreworICAgTE9HX0ZV
TkNfRU5UUlkoKTsKKyAgIGNodW5rX3QgICAgKnBjOworICAgY2h1bmtfdCAgICAqcHJldjsK
KyAgIGNodW5rX3QgICAgKmZpcnN0OworICAgY2h1bmtfdCAgICAqYWZ0ZXI7CisgICBjaHVu
a190ICAgICpsYXN0ID0gbnVsbHB0cjsKKyAgIGNodW5rX3QgICAgKnBhcmVuX2Nsb3NlOwor
ICAgY29uc3QgY2hhciAqdmVyYiAgICAgID0gImxpa2VseSI7CisgICBjb25zdCBjaGFyICpk
ZXRhaWwgICAgPSAiIjsKKyAgIHNpemVfdCAgICAgY291bnQgICAgICA9IDA7CisgICBpbnQg
ICAgICAgIHdvcmRfY291bnQgPSAwOworICAgYm9vbCAgICAgICBub3BlOworICAgYm9vbCAg
ICAgICBkb3VidGZ1bF9jYXN0ID0gZmFsc2U7CisKKworICAgTE9HX0ZNVChMQ0FTVFMsICIl
cyglZCk6IHN0YXJ0LT50ZXh0KCkgaXMgJyVzJywgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19j
b2wgaXMgJXp1XG4iLAorICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHN0YXJ0LT50
ZXh0KCksIHN0YXJ0LT5vcmlnX2xpbmUsIHN0YXJ0LT5vcmlnX2NvbCk7CisKKyAgIHByZXYg
PSBjaHVua19nZXRfcHJldl9uY25sbmkoc3RhcnQpOyAgIC8vIElzc3VlICMyMjc5CisKKyAg
IGlmIChwcmV2ID09IG51bGxwdHIpCisgICB7CisgICAgICByZXR1cm47CisgICB9CisKKyAg
IGlmIChjaHVua19pc190b2tlbihwcmV2LCBDVF9QUF9ERUZJTkVEKSkKKyAgIHsKKyAgICAg
IExPR19GTVQoTENBU1RTLCAiJXMoJWQpOiAgLS0gbm90IGEgY2FzdCAtIGFmdGVyIGRlZmlu
ZWRcbiIsCisgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXyk7CisgICAgICByZXR1
cm47CisgICB9CisKKyAgIGlmIChjaHVua19pc190b2tlbihwcmV2LCBDVF9BTkdMRV9DTE9T
RSkpCisgICB7CisgICAgICBMT0dfRk1UKExDQVNUUywgIiVzKCVkKTogIC0tIG5vdCBhIGNh
c3QgLSBhZnRlciA+ICh0ZW1wbGF0ZSlcbiIsCisgICAgICAgICAgICAgIF9fZnVuY19fLCBf
X0xJTkVfXyk7CisgICAgICByZXR1cm47CisgICB9CisgICAvLyBNYWtlIHN1cmUgdGhlcmUg
aXMgb25seSBXT1JELCBUWVBFLCBhbmQgJyonIG9yICdeJyBiZWZvcmUgdGhlIGNsb3NlIHBh
cmVuCisgICBwYyAgICA9IGNodW5rX2dldF9uZXh0X25jbmwoc3RhcnQpOworICAgZmlyc3Qg
PSBwYzsKKworICAgd2hpbGUgKCAgcGMgIT0gbnVsbHB0cgorICAgICAgICAgJiYgKCAgY2h1
bmtfaXNfdHlwZShwYykKKyAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9X
T1JEKQorICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1FVQUxJRklFUikK
KyAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9EQ19NRU1CRVIpCisgICAg
ICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfUFApCisgICAgICAgICAgICB8fCBj
aHVua19pc190b2tlbihwYywgQ1RfU1RBUikKKyAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rv
a2VuKHBjLCBDVF9RVUVTVElPTikKKyAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBj
LCBDVF9DQVJFVCkKKyAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9UU1FV
QVJFKQorICAgICAgICAgICAgfHwgKCAgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FOR0xF
X09QRU4pCisgICAgICAgICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQU5H
TEVfQ0xPU0UpKQorICAgICAgICAgICAgICAgJiYgbGFuZ3VhZ2VfaXNfc2V0KExBTkdfT0Mg
fCBMQU5HX0pBVkEpKQorICAgICAgICAgICAgfHwgKCAgKCAgY2h1bmtfaXNfdG9rZW4ocGMs
IENUX1FVRVNUSU9OKQorICAgICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMs
IENUX0NPTU1BKQorICAgICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENU
X01FTUJFUikpCisgICAgICAgICAgICAgICAmJiBsYW5ndWFnZV9pc19zZXQoTEFOR19KQVZB
KSkKKyAgICAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BTVApKSkKKyAgIHsK
KyAgICAgIExPR19GTVQoTENBU1RTLCAiJXMoJWQpOiBwYy0+dGV4dCgpIGlzICclcycsIG9y
aWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdHlwZSBpcyAlc1xuIiwKKyAgICAg
ICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5l
LCBwYy0+b3JpZ19jb2wsIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CisKKyAgICAgIGlm
IChjaHVua19pc190b2tlbihwYywgQ1RfV09SRCkgfHwgKGNodW5rX2lzX3Rva2VuKGxhc3Qs
IENUX0FOR0xFX0NMT1NFKSAmJiBjaHVua19pc190b2tlbihwYywgQ1RfRENfTUVNQkVSKSkp
CisgICAgICB7CisgICAgICAgICB3b3JkX2NvdW50Kys7CisgICAgICB9CisgICAgICBlbHNl
IGlmIChjaHVua19pc190b2tlbihwYywgQ1RfRENfTUVNQkVSKSB8fCBjaHVua19pc190b2tl
bihwYywgQ1RfTUVNQkVSKSB8fCBjaHVua19pc190b2tlbihwYywgQ1RfUFApKQorICAgICAg
eworICAgICAgICAgLy8gbWlnaHQgYmUgbmVnYXRpdiwgc3VjaCBhcyB3aXRoOgorICAgICAg
ICAgLy8gYSA9IHZhbCArIChDRm9vOjpiYXJfdCk3OworICAgICAgICAgd29yZF9jb3VudC0t
OworICAgICAgfQorICAgICAgbGFzdCA9IHBjOworICAgICAgcGMgICA9IGNodW5rX2dldF9u
ZXh0X25jbmwocGMpOworICAgICAgY291bnQrKzsKKyAgIH0KKworICAgaWYgKCAgcGMgPT0g
bnVsbHB0cgorICAgICAgfHwgcGMtPnR5cGUgIT0gQ1RfUEFSRU5fQ0xPU0UKKyAgICAgIHx8
IGNodW5rX2lzX3Rva2VuKHByZXYsIENUX09DX0NMQVNTKSkKKyAgIHsKKyAgICAgIExPR19G
TVQoTENBU1RTLCAiJXMoJWQpOiAgLS0gbm90IGEgY2FzdCwgaGl0IHR5cGUgaXMgJXNcbiIs
CisgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMgPT0gbnVsbHB0ciA/ICJO
VUxMIiA6IGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CisgICAgICByZXR1cm47CisgICB9
CisKKyAgIGlmICh3b3JkX2NvdW50ID4gMSkKKyAgIHsKKyAgICAgIExPR19GTVQoTENBU1RT
LCAiJXMoJWQpOiAgLS0gdG9vIG1hbnkgd29yZHM6ICVkXG4iLAorICAgICAgICAgICAgICBf
X2Z1bmNfXywgX19MSU5FX18sIHdvcmRfY291bnQpOworICAgICAgcmV0dXJuOworICAgfQor
ICAgcGFyZW5fY2xvc2UgPSBwYzsKKworICAgLy8gSWYgbGFzdCBpcyBhIHR5cGUgb3Igc3Rh
ci9jYXJldCwgd2UgaGF2ZSBhIGNhc3QgZm9yIHN1cmUKKyAgIGlmICggIGNodW5rX2lzX3Rv
a2VuKGxhc3QsIENUX1NUQVIpCisgICAgICB8fCBjaHVua19pc190b2tlbihsYXN0LCBDVF9D
QVJFVCkKKyAgICAgIHx8IGNodW5rX2lzX3Rva2VuKGxhc3QsIENUX1BUUl9UWVBFKQorICAg
ICAgfHwgY2h1bmtfaXNfdG9rZW4obGFzdCwgQ1RfVFlQRSkKKyAgICAgIHx8IChjaHVua19p
c190b2tlbihsYXN0LCBDVF9BTkdMRV9DTE9TRSkgJiYgbGFuZ3VhZ2VfaXNfc2V0KExBTkdf
T0MgfCBMQU5HX0pBVkEpKSkKKyAgIHsKKyAgICAgIHZlcmIgPSAiZm9yIHN1cmUiOworICAg
fQorICAgZWxzZSBpZiAoY291bnQgPT0gMSkKKyAgIHsKKyAgICAgIC8qCisgICAgICAgKiBX
ZSBhcmUgb24gYSBwb3RlbnRpYWwgY2FzdCBvZiB0aGUgZm9ybSAiKHdvcmQpIi4KKyAgICAg
ICAqIFdlIGRvbid0IGtub3cgaWYgdGhlIHdvcmQgaXMgYSB0eXBlLiBTbyBsZXRzIGd1ZXNz
IGJhc2VkIG9uIHNvbWUKKyAgICAgICAqIHNpbXBsZSBydWxlczoKKyAgICAgICAqICAtIGlm
IGFsbCBjYXBzLCBsaWtlbHkgYSB0eXBlCisgICAgICAgKiAgLSBpZiBpdCBlbmRzIGluIF90
LCBsaWtlbHkgYSB0eXBlCisgICAgICAgKiAgLSBpZiBpdCdzIG9iamVjdGl2ZS1jIGFuZCB0
aGUgdHlwZSBpcyBpZCwgbGlrZWx5IHZhbGlkCisgICAgICAgKi8KKyAgICAgIHZlcmIgPSAi
Z3Vlc3NlZCI7CisKKyAgICAgIGlmICggIChsYXN0LT5sZW4oKSA+IDMpCisgICAgICAgICAm
JiAobGFzdC0+c3RyW2xhc3QtPmxlbigpIC0gMl0gPT0gJ18nKQorICAgICAgICAgJiYgKGxh
c3QtPnN0cltsYXN0LT5sZW4oKSAtIDFdID09ICd0JykpCisgICAgICB7CisgICAgICAgICBk
ZXRhaWwgPSAiIC0tICdfdCciOworICAgICAgfQorICAgICAgZWxzZSBpZiAoaXNfdWNhc2Vf
c3RyKGxhc3QtPnRleHQoKSwgbGFzdC0+bGVuKCkpKQorICAgICAgeworICAgICAgICAgZGV0
YWlsID0gIiAtLSB1cHBlciBjYXNlIjsKKyAgICAgIH0KKyAgICAgIGVsc2UgaWYgKGxhbmd1
YWdlX2lzX3NldChMQU5HX09DKSAmJiBjaHVua19pc19zdHIobGFzdCwgImlkIiwgMikpCisg
ICAgICB7CisgICAgICAgICBkZXRhaWwgPSAiIC0tIE9iamVjdGl2ZS1DIGlkIjsKKyAgICAg
IH0KKyAgICAgIGVsc2UKKyAgICAgIHsKKyAgICAgICAgIC8vIElmIHdlIGNhbid0IHRlbGwg
Zm9yIHN1cmUgd2hldGhlciB0aGlzIGlzIGEgY2FzdCwgZGVjaWRlIGFnYWluc3QgaXQKKyAg
ICAgICAgIGRldGFpbCAgICAgICAgPSAiIC0tIG1peGVkIGNhc2UiOworICAgICAgICAgZG91
YnRmdWxfY2FzdCA9IHRydWU7CisgICAgICB9CisgICAgICAvKgorICAgICAgICogSWYgdGhl
IG5leHQgaXRlbSBpcyBhICogb3IgJiwgdGhlIG5leHQgaXRlbSBhZnRlciB0aGF0IGNhbid0
IGJlIGEKKyAgICAgICAqIG51bWJlciBvciBzdHJpbmcuCisgICAgICAgKgorICAgICAgICog
SWYgdGhlIG5leHQgaXRlbSBpcyBhICssIHRoZSBuZXh0IGl0ZW0gaGFzIHRvIGJlIGEgbnVt
YmVyLgorICAgICAgICoKKyAgICAgICAqIElmIHRoZSBuZXh0IGl0ZW0gaXMgYSAtLCB0aGUg
bmV4dCBpdGVtIGNhbid0IGJlIGEgc3RyaW5nLgorICAgICAgICoKKyAgICAgICAqIEZvciB0
aGlzIHRvIGJlIGEgY2FzdCwgdGhlIGNsb3NlIHBhcmVuIG11c3QgYmUgZm9sbG93ZWQgYnk6
CisgICAgICAgKiAgLSBjb25zdGFudCAobnVtYmVyIG9yIHN0cmluZykKKyAgICAgICAqICAt
IHBhcmVuIG9wZW4KKyAgICAgICAqICAtIHdvcmQKKyAgICAgICAqCisgICAgICAgKiBGaW5k
IHRoZSBuZXh0IG5vbi1vcGVuIHBhcmVuIGl0ZW0uCisgICAgICAgKi8KKyAgICAgIHBjICAg
ID0gY2h1bmtfZ2V0X25leHRfbmNubChwYXJlbl9jbG9zZSk7CisgICAgICBhZnRlciA9IHBj
OworCisgICAgICBkbworICAgICAgeworICAgICAgICAgYWZ0ZXIgPSBjaHVua19nZXRfbmV4
dF9uY25sKGFmdGVyKTsKKyAgICAgIH0gd2hpbGUgKGNodW5rX2lzX3Rva2VuKGFmdGVyLCBD
VF9QQVJFTl9PUEVOKSk7CisKKyAgICAgIGlmIChhZnRlciA9PSBudWxscHRyKQorICAgICAg
eworICAgICAgICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6ICAtLSBub3QgYSBjYXN0IC0g
aGl0IE5VTExcbiIsCisgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXyk7Cisg
ICAgICAgICByZXR1cm47CisgICAgICB9CisgICAgICBub3BlID0gZmFsc2U7CisKKyAgICAg
IGlmIChjaHVua19pc19wdHJfb3BlcmF0b3IocGMpKQorICAgICAgeworICAgICAgICAgLy8g
c3RhciAoKikgYW5kIGFkZHJlc3MgKCYpIGFyZSBhbWJpZ3VvdXMKKyAgICAgICAgIGlmICgg
IGNodW5rX2lzX3Rva2VuKGFmdGVyLCBDVF9OVU1CRVJfRlApCisgICAgICAgICAgICB8fCBj
aHVua19pc190b2tlbihhZnRlciwgQ1RfTlVNQkVSKQorICAgICAgICAgICAgfHwgY2h1bmtf
aXNfdG9rZW4oYWZ0ZXIsIENUX1NUUklORykKKyAgICAgICAgICAgIHx8IGRvdWJ0ZnVsX2Nh
c3QpCisgICAgICAgICB7CisgICAgICAgICAgICBub3BlID0gdHJ1ZTsKKyAgICAgICAgIH0K
KyAgICAgIH0KKyAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9NSU5VUykp
CisgICAgICB7CisgICAgICAgICAvLyAoVUlOVDgpLTEgb3IgKGZvbyktMSBvciAoRk9PKS0n
YScKKyAgICAgICAgIGlmIChjaHVua19pc190b2tlbihhZnRlciwgQ1RfU1RSSU5HKSB8fCBk
b3VidGZ1bF9jYXN0KQorICAgICAgICAgeworICAgICAgICAgICAgbm9wZSA9IHRydWU7Cisg
ICAgICAgICB9CisgICAgICB9CisgICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihwYywg
Q1RfUExVUykpCisgICAgICB7CisgICAgICAgICAvLyAoVUlOVDgpKzEgb3IgKGZvbykrMQor
ICAgICAgICAgaWYgKCAgKGFmdGVyLT50eXBlICE9IENUX05VTUJFUiAmJiBhZnRlci0+dHlw
ZSAhPSBDVF9OVU1CRVJfRlApCisgICAgICAgICAgICB8fCBkb3VidGZ1bF9jYXN0KQorICAg
ICAgICAgeworICAgICAgICAgICAgbm9wZSA9IHRydWU7CisgICAgICAgICB9CisgICAgICB9
CisgICAgICBlbHNlIGlmICggIHBjLT50eXBlICE9IENUX05VTUJFUl9GUAorICAgICAgICAg
ICAgICAmJiBwYy0+dHlwZSAhPSBDVF9OVU1CRVIKKyAgICAgICAgICAgICAgJiYgcGMtPnR5
cGUgIT0gQ1RfV09SRAorICAgICAgICAgICAgICAmJiBwYy0+dHlwZSAhPSBDVF9USElTCisg
ICAgICAgICAgICAgICYmIHBjLT50eXBlICE9IENUX1RZUEUKKyAgICAgICAgICAgICAgJiYg
cGMtPnR5cGUgIT0gQ1RfUEFSRU5fT1BFTgorICAgICAgICAgICAgICAmJiBwYy0+dHlwZSAh
PSBDVF9TVFJJTkcKKyAgICAgICAgICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfREVDTFRZUEUK
KyAgICAgICAgICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfU0laRU9GCisgICAgICAgICAgICAg
ICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgIT0gQ1RfU0laRU9GCisgICAgICAgICAg
ICAgICYmIHBjLT50eXBlICE9IENUX0ZVTkNfQ0FMTAorICAgICAgICAgICAgICAmJiBwYy0+
dHlwZSAhPSBDVF9GVU5DX0NBTExfVVNFUgorICAgICAgICAgICAgICAmJiBwYy0+dHlwZSAh
PSBDVF9GVU5DVElPTgorICAgICAgICAgICAgICAmJiBwYy0+dHlwZSAhPSBDVF9CUkFDRV9P
UEVOCisgICAgICAgICAgICAgICYmICghKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NRVUFS
RV9PUEVOKQorICAgICAgICAgICAgICAgICAgICYmIGxhbmd1YWdlX2lzX3NldChMQU5HX09D
KSkpKQorICAgICAgeworICAgICAgICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6ICAtLSBu
b3QgYSBjYXN0IC0gZm9sbG93ZWQgYnkgdGV4dCgpICclcycsIHR5cGUgaXMgJXNcbiIsCisg
ICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPnRleHQoKSwgZ2V0X3Rv
a2VuX25hbWUocGMtPnR5cGUpKTsKKyAgICAgICAgIHJldHVybjsKKyAgICAgIH0KKworICAg
ICAgaWYgKG5vcGUpCisgICAgICB7CisgICAgICAgICBMT0dfRk1UKExDQVNUUywgIiVzKCVk
KTogIC0tIG5vdCBhIGNhc3QgLSB0ZXh0KCkgJyVzJyBmb2xsb3dlZCBieSB0eXBlICVzXG4i
LAorICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIGdl
dF90b2tlbl9uYW1lKGFmdGVyLT50eXBlKSk7CisgICAgICAgICByZXR1cm47CisgICAgICB9
CisgICB9CisgICAvLyBpZiB0aGUgJ2Nhc3QnIGlzIGZvbGxvd2VkIGJ5IGEgc2VtaWNvbG9u
LCBjb21tYSwgYm9vbCBvciBjbG9zZSBwYXJlbnRoZXNpcywgaXQgaXNuJ3QKKyAgIHBjID0g
Y2h1bmtfZ2V0X25leHRfbmNubChwYXJlbl9jbG9zZSk7CisKKyAgIGlmIChwYyA9PSBudWxs
cHRyKQorICAgeworICAgICAgcmV0dXJuOworICAgfQorCisgICBpZiAoICBjaHVua19pc19z
ZW1pY29sb24ocGMpCisgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQ09NTUEpCisg
ICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQk9PTCkgICAgICAgICAgICAgICAvLyBJ
c3N1ZSAjMjE1MQorICAgICAgfHwgY2h1bmtfaXNfcGFyZW5fY2xvc2UocGMpKQorICAgewor
ICAgICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6ICAtLSBub3QgYSBjYXN0IC0gZm9sbG93
ZWQgYnkgdHlwZSAlc1xuIiwKKyAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBn
ZXRfdG9rZW5fbmFtZShwYy0+dHlwZSkpOworICAgICAgcmV0dXJuOworICAgfQorICAgc2V0
X2NodW5rX3BhcmVudChzdGFydCwgQ1RfQ19DQVNUKTsKKyAgIHNldF9jaHVua19wYXJlbnQo
cGFyZW5fY2xvc2UsIENUX0NfQ0FTVCk7CisKKyAgIExPR19GTVQoTENBU1RTLCAiJXMoJWQp
OiAgLS0gJXMgYy1jYXN0OiAoIiwKKyAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB2
ZXJiKTsKKworICAgZm9yIChwYyA9IGZpcnN0OworICAgICAgICBwYyAhPSBudWxscHRyICYm
IHBjICE9IHBhcmVuX2Nsb3NlOworICAgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwo
cGMpKQorICAgeworICAgICAgc2V0X2NodW5rX3BhcmVudChwYywgQ1RfQ19DQVNUKTsKKyAg
ICAgIG1ha2VfdHlwZShwYyk7CisgICAgICBMT0dfRk1UKExDQVNUUywgIiAlcyIsIHBjLT50
ZXh0KCkpOworICAgfQorCisgICBMT0dfRk1UKExDQVNUUywgIiApJXNcbiIsIGRldGFpbCk7
CisKKyAgIC8vIE1hcmsgdGhlIG5leHQgaXRlbSBhcyBhbiBleHByZXNzaW9uIHN0YXJ0Cisg
ICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGFyZW5fY2xvc2UpOworCisgICBpZiAocGMg
IT0gbnVsbHB0cikKKyAgIHsKKyAgICAgIGNodW5rX2ZsYWdzX3NldChwYywgUENGX0VYUFJf
U1RBUlQpOworCisgICAgICBpZiAoY2h1bmtfaXNfb3BlbmluZ19icmFjZShwYykpCisgICAg
ICB7CisgICAgICAgICBzZXRfcGFyZW5fcGFyZW50KHBjLCBnZXRfY2h1bmtfcGFyZW50X3R5
cGUoc3RhcnQpKTsKKyAgICAgIH0KKyAgIH0KK30gLy8gZml4X2Nhc3RzCisKKworc3RhdGlj
IHZvaWQgZml4X3R5cGVfY2FzdChjaHVua190ICpzdGFydCkKK3sKKyAgIExPR19GVU5DX0VO
VFJZKCk7CisgICBjaHVua190ICpwYzsKKworICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25s
KHN0YXJ0KTsKKworICAgaWYgKHBjID09IG51bGxwdHIgfHwgcGMtPnR5cGUgIT0gQ1RfQU5H
TEVfT1BFTikKKyAgIHsKKyAgICAgIHJldHVybjsKKyAgIH0KKworICAgd2hpbGUgKCAgKChw
YyA9IGNodW5rX2dldF9uZXh0X25jbmwocGMpKSAhPSBudWxscHRyKQorICAgICAgICAgJiYg
cGMtPmxldmVsID49IHN0YXJ0LT5sZXZlbCkKKyAgIHsKKyAgICAgIGlmIChwYy0+bGV2ZWwg
PT0gc3RhcnQtPmxldmVsICYmIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BTkdMRV9DTE9TRSkp
CisgICAgICB7CisgICAgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGMpOworCisg
ICAgICAgICBpZiAocGMgPT0gbnVsbHB0cikKKyAgICAgICAgIHsKKyAgICAgICAgICAgIHJl
dHVybjsKKyAgICAgICAgIH0KKworICAgICAgICAgaWYgKGNodW5rX2lzX3N0cihwYywgIigi
LCAxKSkKKyAgICAgICAgIHsKKyAgICAgICAgICAgIHNldF9wYXJlbl9wYXJlbnQocGMsIENU
X1RZUEVfQ0FTVCk7CisgICAgICAgICB9CisgICAgICAgICByZXR1cm47CisgICAgICB9Cisg
ICAgICBtYWtlX3R5cGUocGMpOworICAgfQorfQorCisKK3N0YXRpYyB2b2lkIGZpeF9lbnVt
X3N0cnVjdF91bmlvbihjaHVua190ICpwYykKK3sKKyAgIExPR19GVU5DX0VOVFJZKCk7Cisg
ICBjaHVua190ICAgICAqbmV4dDsKKyAgIGNodW5rX3QgICAgICpwcmV2ICAgICAgICA9IG51
bGxwdHI7CisgICBwY2ZfZmxhZ3NfdCBmbGFncyAgICAgICAgPSBQQ0ZfVkFSXzFTVF9ERUY7
CisgICBhdXRvIGNvbnN0ICBpbl9mY25fcGFyZW4gPSBwYy0+ZmxhZ3MgJiBQQ0ZfSU5fRkNO
X0RFRjsKKworICAgLy8gTWFrZSBzdXJlIHRoaXMgd2Fzbid0IGEgY2FzdAorICAgaWYgKGdl
dF9jaHVua19wYXJlbnRfdHlwZShwYykgPT0gQ1RfQ19DQVNUKQorICAgeworICAgICAgcmV0
dXJuOworICAgfQorICAgLy8gdGhlIG5leHQgaXRlbSBpcyBlaXRoZXIgYSB0eXBlIG9yIG9w
ZW4gYnJhY2UKKyAgIG5leHQgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKKworICAgLy8g
dGhlIGVudW0ta2V5IG1pZ2h0IGJlIGVudW0sIGVudW0gY2xhc3Mgb3IgZW51bSBzdHJ1Y3Qg
KFRPRE8pCisgICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfRU5VTV9DTEFTUykpCisg
ICB7CisgICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0KTsgLy8gZ2V0IHRo
ZSBuZXh0IG9uZQorICAgfQorCisgICBpZiAobGFuZ3VhZ2VfaXNfc2V0KExBTkdfQ1BQKSkK
KyAgIHsKKyAgICAgIG5leHQgPSBza2lwX2F0dHJpYnV0ZV9uZXh0KG5leHQpOyAvLyBnZXQg
dGhlIG5leHQgb25lCisgICB9CisKKyAgIC8vIHRoZSBuZXh0IGl0ZW0gaXMgZWl0aGVyIGEg
dHlwZSwgYW4gYXR0cmlidXRlIChUT0RPKSwgYW4gaWRlbnRpZmllciwgYSBjb2xvbiBvciBv
cGVuIGJyYWNlCisgICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfVFlQRSkgfHwgY2h1
bmtfaXNfdG9rZW4obmV4dCwgQ1RfV09SRCkgfHwgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1Rf
Q09MT04pKQorICAgeworICAgICAgLy8gaS5lLiAiZW51bSB4eXogOiB1bnNpZ25lZCBpbnQg
eyAuLi4gfTsiCisgICAgICAvLyBpLmUuICJlbnVtIGNsYXNzIHh5eiA6IHVuc2lnbmVkIGlu
dCB7IC4uLiB9OyIKKyAgICAgIC8vIGkuZS4gImVudW0gOiB1bnNpZ25lZCBpbnQgeyAuLi4g
fTsiCisgICAgICAvLyB4eXogaXMgYSB0eXBlCisKKyAgICAgIC8vIHNhdmUgdGhlIHR5cGUg
aWYgaXQgZXhpc3RzCisgICAgICBpZiAoIWNodW5rX2lzX3Rva2VuKG5leHQsIENUX0NPTE9O
KSkKKyAgICAgIHsKKyAgICAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgcGMtPnR5cGUp
OworICAgICAgICAgcHJldiA9IG5leHQ7CisgICAgICAgICBuZXh0ID0gY2h1bmtfZ2V0X25l
eHRfbmNubChuZXh0KTsKKyAgICAgIH0KKworICAgICAgaWYgKG5leHQgPT0gbnVsbHB0cikK
KyAgICAgIHsKKyAgICAgICAgIHJldHVybjsKKyAgICAgIH0KKyAgICAgIHNldF9jaHVua19w
YXJlbnQobmV4dCwgcGMtPnR5cGUpOworICAgICAgYXV0byBjb25zdCBpc19zdHJ1Y3Rfb3Jf
Y2xhc3MgPQorICAgICAgICAgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TVFJVQ1QpIHx8IGNo
dW5rX2lzX3Rva2VuKHBjLCBDVF9DTEFTUykpOworCisgICAgICAvLyBuZXh0IHVwIGlzIGVp
dGhlciBhIGNvbG9uLCBvcGVuIGJyYWNlLCBvciBvcGVuIHBhcmVudGhlc2lzIChwYXduKQor
ICAgICAgaWYgKGxhbmd1YWdlX2lzX3NldChMQU5HX1BBV04pICYmIGNodW5rX2lzX3Rva2Vu
KG5leHQsIENUX1BBUkVOX09QRU4pKQorICAgICAgeworICAgICAgICAgbmV4dCA9IHNldF9w
YXJlbl9wYXJlbnQobmV4dCwgQ1RfRU5VTSk7CisgICAgICB9CisgICAgICBlbHNlIGlmIChj
aHVua19pc190b2tlbihuZXh0LCBDVF9DT0xPTikpCisgICAgICB7CisgICAgICAgICBpZiAo
Y2h1bmtfaXNfdG9rZW4ocGMsIENUX0VOVU0pKQorICAgICAgICAgeworICAgICAgICAgICAg
Ly8gZW51bSBUWVBFIDogSU5UX1RZUEUgeyAuLi4gfTsKKyAgICAgICAgICAgIG5leHQgPSBj
aHVua19nZXRfbmV4dF9uY25sKG5leHQpOworCisgICAgICAgICAgICBpZiAobmV4dCAhPSBu
dWxscHRyKQorICAgICAgICAgICAgeworICAgICAgICAgICAgICAgbWFrZV90eXBlKG5leHQp
OworICAgICAgICAgICAgICAgbmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwobmV4dCk7CisK
KyAgICAgICAgICAgICAgIC8vIGVudW0gVFlQRSA6IHVuc2lnbmVkIGludCB7IC4uLiB9Owor
ICAgICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1RZUEUpKQorICAg
ICAgICAgICAgICAgeworICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBuZXh0IHBhcnQg
b2YgdGhlIHR5cGUKKyAgICAgICAgICAgICAgICAgIG5leHQgPSBjaHVua19nZXRfbmV4dF9u
Y25sKG5leHQpOworICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgfQorICAgICAgICAg
fQorICAgICAgICAgZWxzZSBpZiAoaXNfc3RydWN0X29yX2NsYXNzKQorICAgICAgICAgewor
ICAgICAgICAgICAgbmV4dCA9IHNraXBfcGFyZW50X3R5cGVzKG5leHQpOworICAgICAgICAg
fQorICAgICAgfQorICAgICAgZWxzZSBpZiAoaXNfc3RydWN0X29yX2NsYXNzICYmIGNodW5r
X2lzX3Rva2VuKG5leHQsIENUX1BBUkVOX09QRU4pKQorICAgICAgeworICAgICAgICAgLy8g
Rml4ICMxMjY3IHN0cnVjdHVyZSBhdHRyaWJ1dGVzCisgICAgICAgICAvLyBzdHJ1Y3QgX19h
dHRyaWJ1dGVfXyhhbGlnbih4KSkgc3RydWN0X25hbWU7CisgICAgICAgICAvLyBza2lwIHRv
IG1hdGNoaW5nIHBhcmVuY2xvc2UgYW5kIG1ha2UgbmV4dCB0b2tlbiBhcyB0eXBlLgorICAg
ICAgICAgbmV4dCA9IGNodW5rX3NraXBfdG9fbWF0Y2gobmV4dCk7CisgICAgICAgICBuZXh0
ID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0KTsKKyAgICAgICAgIHNldF9jaHVua190eXBl
KG5leHQsIENUX1RZUEUpOworICAgICAgICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBwYy0+
dHlwZSk7CisgICAgICB9CisKKyAgICAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9T
RU1JQ09MT04pKSAvLyBjKysgZm9yd2FyZCBkZWNsYXJhdGlvbgorICAgICAgeworICAgICAg
ICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBwYy0+dHlwZSk7CisgICAgICAgICBmbGFnX3Nl
cmllcyhwYywgcHJldiwgUENGX0lOQ09NUExFVEUpOworICAgICAgICAgcmV0dXJuOworICAg
ICAgfQorICAgfQorCisgICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfQlJBQ0VfT1BF
TikpCisgICB7CisgICAgICBhdXRvIGNvbnN0IGZsYWcgPSBbcGNdIHsKKyAgICAgICAgIHN3
aXRjaCAocGMtPnR5cGUpCisgICAgICAgICB7CisgICAgICAgICBjYXNlIENUX0VOVU06Cisg
ICAgICAgICAgICByZXR1cm4oUENGX0lOX0VOVU0pOworCisgICAgICAgICBjYXNlIENUX1NU
UlVDVDoKKyAgICAgICAgICAgIHJldHVybihQQ0ZfSU5fU1RSVUNUKTsKKworICAgICAgICAg
Y2FzZSBDVF9DTEFTUzoKKyAgICAgICAgICAgIHJldHVybihQQ0ZfSU5fQ0xBU1MpOworCisg
ICAgICAgICBkZWZhdWx0OgorICAgICAgICAgICAgcmV0dXJuKFBDRl9OT05FKTsKKyAgICAg
ICAgIH0KKyAgICAgIH0oKTsKKworICAgICAgZmxhZ19wYXJlbnMobmV4dCwgZmxhZywgQ1Rf
Tk9ORSwgQ1RfTk9ORSwgZmFsc2UpOworCisgICAgICBpZiAoICBjaHVua19pc190b2tlbihw
YywgQ1RfVU5JT04pCisgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfU1RSVUNU
KQorICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0NMQVNTKSkKKyAgICAgIHsK
KyAgICAgICAgIG1hcmtfc3RydWN0X3VuaW9uX2JvZHkobmV4dCk7CisgICAgICB9CisgICAg
ICAvLyBTa2lwIHRvIHRoZSBjbG9zaW5nIGJyYWNlCisgICAgICBzZXRfY2h1bmtfcGFyZW50
KG5leHQsIHBjLT50eXBlKTsKKyAgICAgIG5leHQgICA9IGNodW5rX2dldF9uZXh0X3R5cGUo
bmV4dCwgQ1RfQlJBQ0VfQ0xPU0UsIHBjLT5sZXZlbCk7CisgICAgICBmbGFncyB8PSBQQ0Zf
VkFSX0lOTElORTsKKworICAgICAgaWYgKG5leHQgIT0gbnVsbHB0cikKKyAgICAgIHsKKyAg
ICAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgcGMtPnR5cGUpOworICAgICAgICAgbmV4
dCA9IGNodW5rX2dldF9uZXh0X25jbmwobmV4dCk7CisgICAgICB9CisgICAgICBwcmV2ID0g
bnVsbHB0cjsKKyAgIH0KKyAgIC8vIHJlc2V0IHZhciBuYW1lIHBhcmVudCB0eXBlCisgICBl
bHNlIGlmIChuZXh0ICYmIHByZXYpCisgICB7CisgICAgICBzZXRfY2h1bmtfcGFyZW50KHBy
ZXYsIENUX05PTkUpOworICAgfQorCisgICBpZiAobmV4dCA9PSBudWxscHRyIHx8IGNodW5r
X2lzX3Rva2VuKG5leHQsIENUX1BBUkVOX0NMT1NFKSkKKyAgIHsKKyAgICAgIHJldHVybjsK
KyAgIH0KKworICAgaWYgKCFjaHVua19pc19zZW1pY29sb24obmV4dCkpCisgICB7CisgICAg
ICAvLyBQYXduIGRvZXMgbm90IHJlcXVpcmUgYSBzZW1pY29sb24gYWZ0ZXIgYW4gZW51bQor
ICAgICAgaWYgKGxhbmd1YWdlX2lzX3NldChMQU5HX1BBV04pKQorICAgICAgeworICAgICAg
ICAgcmV0dXJuOworICAgICAgfQorCisgICAgICAvKgorICAgICAgICogRCBkb2VzIG5vdCBy
ZXF1aXJlIGEgc2VtaWNvbG9uIGFmdGVyIGFuIGVudW0sIGJ1dCB3ZSBhZGQgb25lIHRvIG1h
a2UKKyAgICAgICAqIG90aGVyIGNvZGUgaGFwcHkuCisgICAgICAgKi8KKyAgICAgIGlmIChs
YW5ndWFnZV9pc19zZXQoTEFOR19EKSkKKyAgICAgIHsKKyAgICAgICAgIG5leHQgPSBwYXdu
X2FkZF92c2VtaV9hZnRlcihjaHVua19nZXRfcHJldl9uY25sbmkobmV4dCkpOyAgIC8vIElz
c3VlICMyMjc5CisgICAgICB9CisgICB9CisKKyAgIC8vIFdlIGFyZSBlaXRoZXIgcG9pbnRp
bmcgdG8gYSAnOycgb3IgYSB2YXJpYWJsZQorICAgd2hpbGUgKCAgbmV4dCAhPSBudWxscHRy
CisgICAgICAgICAmJiAhY2h1bmtfaXNfc2VtaWNvbG9uKG5leHQpCisgICAgICAgICAmJiBu
ZXh0LT50eXBlICE9IENUX0FTU0lHTgorICAgICAgICAgJiYgIShpbl9mY25fcGFyZW4gXiAo
bmV4dC0+ZmxhZ3MgJiBQQ0ZfSU5fRkNOX0RFRikpLnRlc3RfYW55KCkpCisgICB7CisgICAg
ICBpZiAobmV4dC0+bGV2ZWwgPT0gcGMtPmxldmVsKQorICAgICAgeworICAgICAgICAgaWYg
KGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1dPUkQpKQorICAgICAgICAgeworICAgICAgICAg
ICAgY2h1bmtfZmxhZ3Nfc2V0KG5leHQsIGZsYWdzKTsKKyAgICAgICAgICAgIGZsYWdzICY9
IH5QQ0ZfVkFSXzFTVDsgICAvLyBjbGVhciB0aGUgZmlyc3QgZmxhZyBmb3IgdGhlIG5leHQg
aXRlbXMKKyAgICAgICAgICAgIExPR19GTVQoTENBU1RTLCAiJXMoJWQpOiBvcmlnX2xpbmUg
aXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSAnJXMnLCBzZXQgUENGX1ZBUl8xU1Rc
biIsCisgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdf
bGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpKTsKKyAgICAgICAgIH0KKworICAgICAg
ICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfU1RBUikKKyAgICAgICAgICAgIHx8
IChsYW5ndWFnZV9pc19zZXQoTEFOR19DUFApICYmIGNodW5rX2lzX3Rva2VuKG5leHQsIENU
X0NBUkVUKSkpCisgICAgICAgICB7CisgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShuZXh0
LCBDVF9QVFJfVFlQRSk7CisgICAgICAgICB9CisKKyAgICAgICAgIC8vIElmIHdlIGhpdCBh
IGNvbW1hIGluIGEgZnVuY3Rpb24gcGFyYW0sIHdlIGFyZSBkb25lCisgICAgICAgICBpZiAo
ICAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfQ09NTUEpIHx8IGNodW5rX2lzX3Rva2VuKG5l
eHQsIENUX0ZQQVJFTl9DTE9TRSkpCisgICAgICAgICAgICAmJiAobmV4dC0+ZmxhZ3MudGVz
dF9hbnkoUENGX0lOX0ZDTl9ERUYgfCBQQ0ZfSU5fRkNOX0NBTEwpKSkKKyAgICAgICAgIHsK
KyAgICAgICAgICAgIHJldHVybjsKKyAgICAgICAgIH0KKyAgICAgIH0KKyAgICAgIG5leHQg
PSBjaHVua19nZXRfbmV4dF9uY25sKG5leHQpOworICAgfQorCisgICBpZiAoICBuZXh0ICE9
IG51bGxwdHIKKyAgICAgICYmIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1NFTUlDT0xPTikp
CisgICB7CisgICAgICBzZXRfY2h1bmtfcGFyZW50KG5leHQsIHBjLT50eXBlKTsKKyAgIH0K
K30gLy8gZml4X2VudW1fc3RydWN0X3VuaW9uCisKKworc3RhdGljIHZvaWQgZml4X3R5cGVk
ZWYoY2h1bmtfdCAqc3RhcnQpCit7CisgICBMT0dfRlVOQ19FTlRSWSgpOworCisgICBpZiAo
c3RhcnQgPT0gbnVsbHB0cikKKyAgIHsKKyAgICAgIHJldHVybjsKKyAgIH0KKyAgIExPR19G
TVQoTFRZUEVERUYsICIlcyglZCk6IHR5cGVkZWYgQCBvcmlnX2xpbmUgJXp1LCBvcmlnX2Nv
bCAlenVcbiIsCisgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgc3RhcnQtPm9yaWdf
bGluZSwgc3RhcnQtPm9yaWdfY29sKTsKKworICAgY2h1bmtfdCAqdGhlX3R5cGUgPSBudWxs
cHRyOworICAgY2h1bmtfdCAqbGFzdF9vcCAgPSBudWxscHRyOworCisgICAvKgorICAgICog
TWFyayBldmVyeXRoaW5nIGluIHRoZSB0eXBlZGVmIGFuZCBzY2FuIGZvciAiKSgiLCB3aGlj
aCBtYWtlcyBpdCBhCisgICAgKiBmdW5jdGlvbiB0eXBlCisgICAgKi8KKyAgIGZvciAoY2h1
bmtfdCAqbmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwoc3RhcnQsIHNjb3BlX2U6OlBSRVBS
T0MpCisgICAgICAgIDsgbmV4dCAhPSBudWxscHRyICYmIG5leHQtPmxldmVsID49IHN0YXJ0
LT5sZXZlbAorICAgICAgICA7IG5leHQgPSBjaHVua19nZXRfbmV4dF9uY25sKG5leHQsIHNj
b3BlX2U6OlBSRVBST0MpKQorICAgeworICAgICAgY2h1bmtfZmxhZ3Nfc2V0KG5leHQsIFBD
Rl9JTl9UWVBFREVGKTsKKworICAgICAgaWYgKHN0YXJ0LT5sZXZlbCA9PSBuZXh0LT5sZXZl
bCkKKyAgICAgIHsKKyAgICAgICAgIGlmIChjaHVua19pc19zZW1pY29sb24obmV4dCkpCisg
ICAgICAgICB7CisgICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KG5leHQsIENUX1RZUEVE
RUYpOworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICB9CisKKyAgICAgICAgIGlmIChj
aHVua19pc190b2tlbihuZXh0LCBDVF9BVFRSSUJVVEUpKQorICAgICAgICAgeworICAgICAg
ICAgICAgYnJlYWs7CisgICAgICAgICB9CisKKyAgICAgICAgIGlmIChsYW5ndWFnZV9pc19z
ZXQoTEFOR19EKSAmJiBjaHVua19pc190b2tlbihuZXh0LCBDVF9BU1NJR04pKQorICAgICAg
ICAgeworICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBDVF9UWVBFREVGKTsK
KyAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgfQorICAgICAgICAgbWFrZV90eXBlKG5l
eHQpOworCisgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfVFlQRSkpCisg
ICAgICAgICB7CisgICAgICAgICAgICB0aGVfdHlwZSA9IG5leHQ7CisgICAgICAgICB9Cisg
ICAgICAgICBjaHVua19mbGFnc19jbHIobmV4dCwgUENGX1ZBUl8xU1RfREVGKTsKKworICAg
ICAgICAgaWYgKCpuZXh0LT5zdHIuY19zdHIoKSA9PSAnKCcpCisgICAgICAgICB7CisgICAg
ICAgICAgICBsYXN0X29wID0gbmV4dDsKKyAgICAgICAgIH0KKyAgICAgIH0KKyAgIH0KKwor
ICAgLy8gYXZvaWQgaW50ZXJwcmV0aW5nIHR5cGVkZWYgTlNfRU5VTSAoTlNJbnRlZ2VyLCBN
eUVudW0pIGFzIGEgZnVuY3Rpb24gZGVmCisgICBpZiAoICBsYXN0X29wICE9IG51bGxwdHIK
KyAgICAgICYmICEobGFuZ3VhZ2VfaXNfc2V0KExBTkdfT0MpICYmIGdldF9jaHVua19wYXJl
bnRfdHlwZShsYXN0X29wKSA9PSBDVF9FTlVNKSkKKyAgIHsKKyAgICAgIGZsYWdfcGFyZW5z
KGxhc3Rfb3AsIFBDRl9OT05FLCBDVF9GUEFSRU5fT1BFTiwgQ1RfVFlQRURFRiwgZmFsc2Up
OworICAgICAgZml4X2Zjbl9kZWZfcGFyYW1zKGxhc3Rfb3ApOworCisgICAgICB0aGVfdHlw
ZSA9IGNodW5rX2dldF9wcmV2X25jbmxuaShsYXN0X29wLCBzY29wZV9lOjpQUkVQUk9DKTsg
ICAvLyBJc3N1ZSAjMjI3OQorCisgICAgICBpZiAodGhlX3R5cGUgPT0gbnVsbHB0cikKKyAg
ICAgIHsKKyAgICAgICAgIHJldHVybjsKKyAgICAgIH0KKyAgICAgIGNodW5rX3QgKm9wZW5f
cGFyZW4gPSBudWxscHRyOworCisgICAgICBpZiAoY2h1bmtfaXNfcGFyZW5fY2xvc2UodGhl
X3R5cGUpKQorICAgICAgeworICAgICAgICAgb3Blbl9wYXJlbiA9IGNodW5rX3NraXBfdG9f
bWF0Y2hfcmV2KHRoZV90eXBlKTsKKyAgICAgICAgIG1hcmtfZnVuY3Rpb25fdHlwZSh0aGVf
dHlwZSk7CisgICAgICAgICB0aGVfdHlwZSA9IGNodW5rX2dldF9wcmV2X25jbmxuaSh0aGVf
dHlwZSwgc2NvcGVfZTo6UFJFUFJPQyk7ICAgLy8gSXNzdWUgIzIyNzkKKworICAgICAgICAg
aWYgKHRoZV90eXBlID09IG51bGxwdHIpCisgICAgICAgICB7CisgICAgICAgICAgICByZXR1
cm47CisgICAgICAgICB9CisgICAgICB9CisgICAgICBlbHNlCisgICAgICB7CisgICAgICAg
ICAvLyBtdXN0IGJlOiAidHlwZWRlZiA8cmV0dXJuIHR5cGU+ZnVuYyhwYXJhbXMpOyIKKyAg
ICAgICAgIHNldF9jaHVua190eXBlKHRoZV90eXBlLCBDVF9GVU5DX1RZUEUpOworICAgICAg
fQorICAgICAgc2V0X2NodW5rX3BhcmVudCh0aGVfdHlwZSwgQ1RfVFlQRURFRik7CisKKyAg
ICAgIExPR19GTVQoTFRZUEVERUYsICIlcyglZCk6IGZjbiB0eXBlZGVmIHRleHQoKSAnJXMn
LCBvbiBvcmlnX2xpbmUgJXp1XG4iLAorICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5F
X18sIHRoZV90eXBlLT50ZXh0KCksIHRoZV90eXBlLT5vcmlnX2xpbmUpOworCisgICAgICAv
LyBJZiB3ZSBhcmUgYWxpZ25pbmcgb24gdGhlIG9wZW4gcGFyZW50aGVzaXMsIGdyYWIgdGhh
dCBpbnN0ZWFkCisgICAgICBsb2dfcnVsZV9CKCJhbGlnbl90eXBlZGVmX2Z1bmMiKTsKKwor
ICAgICAgaWYgKG9wZW5fcGFyZW4gIT0gbnVsbHB0ciAmJiBvcHRpb25zOjphbGlnbl90eXBl
ZGVmX2Z1bmMoKSA9PSAxKQorICAgICAgeworICAgICAgICAgdGhlX3R5cGUgPSBvcGVuX3Bh
cmVuOworICAgICAgfQorICAgICAgbG9nX3J1bGVfQigiYWxpZ25fdHlwZWRlZl9mdW5jIik7
CisKKyAgICAgIGlmIChvcHRpb25zOjphbGlnbl90eXBlZGVmX2Z1bmMoKSAhPSAwKQorICAg
ICAgeworICAgICAgICAgTE9HX0ZNVChMVFlQRURFRiwgIiVzKCVkKTogIC0tIGFsaWduIGFu
Y2hvciBvbiB0ZXh0KCkgJXMsIEAgb3JpZ19saW5lICV6dSwgb3JpZ19jb2wgJXp1XG4iLAor
ICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHRoZV90eXBlLT50ZXh0KCks
IHRoZV90eXBlLT5vcmlnX2xpbmUsIHRoZV90eXBlLT5vcmlnX2NvbCk7CisgICAgICAgICBj
aHVua19mbGFnc19zZXQodGhlX3R5cGUsIFBDRl9BTkNIT1IpOworICAgICAgfQorICAgICAg
Ly8gYWxyZWFkeSBkaWQgZXZlcnl0aGluZyB3ZSBuZWVkIHRvIGRvCisgICAgICByZXR1cm47
CisgICB9CisgICAvKgorICAgICogU2tpcCBvdmVyIGVudW0vc3RydWN0L3VuaW9uIHN0dWZm
LCBhcyB3ZSBrbm93IGl0IGlzbid0IGEgcmV0dXJuIHR5cGUKKyAgICAqIGZvciBhIGZ1bmN0
aW9uIHR5cGUKKyAgICAqLworICAgY2h1bmtfdCAqYWZ0ZXIgPSBjaHVua19nZXRfbmV4dF9u
Y25sKHN0YXJ0LCBzY29wZV9lOjpQUkVQUk9DKTsKKworICAgaWYgKGFmdGVyID09IG51bGxw
dHIpCisgICB7CisgICAgICByZXR1cm47CisgICB9CisKKyAgIGlmICggIGFmdGVyLT50eXBl
ICE9IENUX0VOVU0KKyAgICAgICYmIGFmdGVyLT50eXBlICE9IENUX1NUUlVDVAorICAgICAg
JiYgYWZ0ZXItPnR5cGUgIT0gQ1RfVU5JT04pCisgICB7CisgICAgICBpZiAodGhlX3R5cGUg
IT0gbnVsbHB0cikKKyAgICAgIHsKKyAgICAgICAgIC8vIFdlIGhhdmUganVzdCBhIHJlZ3Vs
YXIgdHlwZWRlZgorICAgICAgICAgTE9HX0ZNVChMVFlQRURFRiwgIiVzKCVkKTogcmVndWxh
ciB0eXBlZGVmIHRleHQoKSAlcywgb24gb3JpZ19saW5lICV6dVxuIiwKKyAgICAgICAgICAg
ICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0aGVfdHlwZS0+dGV4dCgpLCB0aGVfdHlwZS0+
b3JpZ19saW5lKTsKKyAgICAgICAgIGNodW5rX2ZsYWdzX3NldCh0aGVfdHlwZSwgUENGX0FO
Q0hPUik7CisgICAgICB9CisgICAgICByZXR1cm47CisgICB9CisgICAvLyBXZSBoYXZlIGEg
c3RydWN0L3VuaW9uL2VudW0sIG5leHQgc2hvdWxkIGJlIGVpdGhlciBhIHR5cGUgb3Igewor
ICAgY2h1bmtfdCAqbmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwoYWZ0ZXIsIHNjb3BlX2U6
OlBSRVBST0MpOworCisgICBpZiAobmV4dCA9PSBudWxscHRyKQorICAgeworICAgICAgcmV0
dXJuOworICAgfQorCisgICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfVFlQRSkpCisg
ICB7CisgICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0LCBzY29wZV9lOjpQ
UkVQUk9DKTsKKworICAgICAgaWYgKG5leHQgPT0gbnVsbHB0cikKKyAgICAgIHsKKyAgICAg
ICAgIHJldHVybjsKKyAgICAgIH0KKyAgIH0KKworICAgaWYgKGNodW5rX2lzX3Rva2VuKG5l
eHQsIENUX0JSQUNFX09QRU4pKQorICAgeworICAgICAgLy8gU2tpcCB0byB0aGUgY2xvc2lu
ZyBicmFjZQorICAgICAgY2h1bmtfdCAqYnJfYyA9IGNodW5rX2dldF9uZXh0X3R5cGUobmV4
dCwgQ1RfQlJBQ0VfQ0xPU0UsIG5leHQtPmxldmVsLCBzY29wZV9lOjpQUkVQUk9DKTsKKwor
ICAgICAgaWYgKGJyX2MgIT0gbnVsbHB0cikKKyAgICAgIHsKKyAgICAgICAgIGNvbnN0IGNf
dG9rZW5fdCB0YWcgPSBhZnRlci0+dHlwZTsKKyAgICAgICAgIHNldF9jaHVua19wYXJlbnQo
bmV4dCwgdGFnKTsKKyAgICAgICAgIHNldF9jaHVua19wYXJlbnQoYnJfYywgdGFnKTsKKwor
ICAgICAgICAgaWYgKHRhZyA9PSBDVF9FTlVNKQorICAgICAgICAgeworICAgICAgICAgICAg
ZmxhZ19zZXJpZXMoYWZ0ZXIsIGJyX2MsIFBDRl9JTl9FTlVNKTsKKyAgICAgICAgIH0KKyAg
ICAgICAgIGVsc2UgaWYgKHRhZyA9PSBDVF9TVFJVQ1QpCisgICAgICAgICB7CisgICAgICAg
ICAgICBmbGFnX3NlcmllcyhhZnRlciwgYnJfYywgUENGX0lOX1NUUlVDVCk7CisgICAgICAg
ICB9CisgICAgICB9CisgICB9CisKKyAgIGlmICh0aGVfdHlwZSAhPSBudWxscHRyKQorICAg
eworICAgICAgTE9HX0ZNVChMVFlQRURFRiwgIiVzKCVkKTogJXMgdHlwZWRlZiB0ZXh0KCkg
JXMsIG9uIG9yaWdfbGluZSAlenVcbiIsCisgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJ
TkVfXywgZ2V0X3Rva2VuX25hbWUoYWZ0ZXItPnR5cGUpLCB0aGVfdHlwZS0+dGV4dCgpLAor
ICAgICAgICAgICAgICB0aGVfdHlwZS0+b3JpZ19saW5lKTsKKyAgICAgIGNodW5rX2ZsYWdz
X3NldCh0aGVfdHlwZSwgUENGX0FOQ0hPUik7CisgICB9Cit9IC8vIGZpeF90eXBlZGVmCisK
Kworc3RhdGljIHZvaWQgbWFya192YXJpYWJsZV9zdGFjayhDaHVua1N0YWNrICZjcywgbG9n
X3Nldl90IHNldikKK3sKKyAgIFVOVVNFRChzZXYpOworICAgTE9HX0ZVTkNfRU5UUlkoKTsK
KworICAgLy8gdGhyb3cgb3V0IHRoZSBsYXN0IHdvcmQgYW5kIG1hcmsgdGhlIHJlc3QKKyAg
IGNodW5rX3QgKnZhcl9uYW1lID0gY3MuUG9wX0JhY2soKTsKKworICAgaWYgKHZhcl9uYW1l
ICYmIHZhcl9uYW1lLT5wcmV2LT50eXBlID09IENUX0RDX01FTUJFUikKKyAgIHsKKyAgICAg
IGNzLlB1c2hfQmFjayh2YXJfbmFtZSk7CisgICB9CisKKyAgIGlmICh2YXJfbmFtZSAhPSBu
dWxscHRyKQorICAgeworICAgICAgTE9HX0ZNVChMRkNOUCwgIiVzKCVkKTogcGFyYW1ldGVy
IG9uIG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dTpcbiIsCisgICAgICAgICAgICAgIF9f
ZnVuY19fLCBfX0xJTkVfXywgdmFyX25hbWUtPm9yaWdfbGluZSwgdmFyX25hbWUtPm9yaWdf
Y29sKTsKKworICAgICAgc2l6ZV90ICB3b3JkX2NudCA9IDA7CisgICAgICBjaHVua190ICp3
b3JkX3R5cGU7CisKKyAgICAgIHdoaWxlICgod29yZF90eXBlID0gY3MuUG9wX0JhY2soKSkg
IT0gbnVsbHB0cikKKyAgICAgIHsKKyAgICAgICAgIGlmIChjaHVua19pc190b2tlbih3b3Jk
X3R5cGUsIENUX1dPUkQpIHx8IGNodW5rX2lzX3Rva2VuKHdvcmRfdHlwZSwgQ1RfVFlQRSkp
CisgICAgICAgICB7CisgICAgICAgICAgICBMT0dfRk1UKExGQ05QLCAiJXMoJWQpOiBwYXJh
bWV0ZXIgb24gb3JpZ19saW5lICV6dSwgb3JpZ19jb2wgJXp1OiA8JXM+IGFzIFRZUEVcbiIs
CisgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgdmFyX25hbWUtPm9y
aWdfbGluZSwgdmFyX25hbWUtPm9yaWdfY29sLCB3b3JkX3R5cGUtPnRleHQoKSk7CisgICAg
ICAgICAgICBzZXRfY2h1bmtfdHlwZSh3b3JkX3R5cGUsIENUX1RZUEUpOworICAgICAgICAg
ICAgY2h1bmtfZmxhZ3Nfc2V0KHdvcmRfdHlwZSwgUENGX1ZBUl9UWVBFKTsKKyAgICAgICAg
IH0KKyAgICAgICAgIHdvcmRfY250Kys7CisgICAgICB9CisKKyAgICAgIGlmIChjaHVua19p
c190b2tlbih2YXJfbmFtZSwgQ1RfV09SRCkpCisgICAgICB7CisgICAgICAgICBpZiAod29y
ZF9jbnQgPiAwKQorICAgICAgICAgeworICAgICAgICAgICAgTE9HX0ZNVChMRkNOUCwgIiVz
KCVkKTogcGFyYW1ldGVyIG9uIG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dTogPCVzPiBh
cyBWQVJcbiIsCisgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgdmFy
X25hbWUtPm9yaWdfbGluZSwgdmFyX25hbWUtPm9yaWdfY29sLCB2YXJfbmFtZS0+dGV4dCgp
KTsKKyAgICAgICAgICAgIGNodW5rX2ZsYWdzX3NldCh2YXJfbmFtZSwgUENGX1ZBUl9ERUYp
OworICAgICAgICAgfQorICAgICAgICAgZWxzZQorICAgICAgICAgeworICAgICAgICAgICAg
TE9HX0ZNVChMRkNOUCwgIiVzKCVkKTogcGFyYW1ldGVyIG9uIG9yaWdfbGluZSAlenUsIG9y
aWdfY29sICV6dTogPCVzPiBhcyBUWVBFXG4iLAorICAgICAgICAgICAgICAgICAgICBfX2Z1
bmNfXywgX19MSU5FX18sIHZhcl9uYW1lLT5vcmlnX2xpbmUsIHZhcl9uYW1lLT5vcmlnX2Nv
bCwgdmFyX25hbWUtPnRleHQoKSk7CisgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZSh2YXJf
bmFtZSwgQ1RfVFlQRSk7CisgICAgICAgICAgICBjaHVua19mbGFnc19zZXQodmFyX25hbWUs
IFBDRl9WQVJfVFlQRSk7CisgICAgICAgICB9CisgICAgICB9CisgICB9Cit9IC8vIG1hcmtf
dmFyaWFibGVfc3RhY2sKKworCitzdGF0aWMgdm9pZCBmaXhfZmNuX2RlZl9wYXJhbXMoY2h1
bmtfdCAqc3RhcnQpCit7CisgICBMT0dfRlVOQ19FTlRSWSgpOworCisgICBpZiAoc3RhcnQg
PT0gbnVsbHB0cikKKyAgIHsKKyAgICAgIHJldHVybjsKKyAgIH0KKyAgIExPR19GTVQoTEZD
TlAsICIlcyglZCk6IHRleHQoKSAnJXMnLCB0eXBlIGlzICVzLCBvbiBvcmlnX2xpbmUgJXp1
LCBsZXZlbCBpcyAlenVcbiIsCisgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgc3Rh
cnQtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUoc3RhcnQtPnR5cGUpLCBzdGFydC0+b3JpZ19s
aW5lLCBzdGFydC0+bGV2ZWwpOworCisgICB3aGlsZSAoc3RhcnQgIT0gbnVsbHB0ciAmJiAh
Y2h1bmtfaXNfcGFyZW5fb3BlbihzdGFydCkpCisgICB7CisgICAgICBzdGFydCA9IGNodW5r
X2dldF9uZXh0X25jbmwoc3RhcnQpOworICAgfQorCisgICBpZiAoc3RhcnQgPT0gbnVsbHB0
cikvLyBDb3Zlcml0eSBDSUQgNzYwMDMsIDExMDA3ODIKKyAgIHsKKyAgICAgIHJldHVybjsK
KyAgIH0KKyAgIC8vIGVuc3VyZSBzdGFydCBjaHVuayBob2xkcyBhIHNpbmdsZSAnKCcgY2hh
cmFjdGVyCisgICBhc3NlcnQoKHN0YXJ0LT5sZW4oKSA9PSAxKSAmJiAoc3RhcnQtPnN0clsw
XSA9PSAnKCcpKTsKKworICAgQ2h1bmtTdGFjayBjczsKKyAgIHNpemVfdCAgICAgbGV2ZWwg
PSBzdGFydC0+bGV2ZWwgKyAxOworICAgY2h1bmtfdCAgICAqcGMgICA9IHN0YXJ0OworCisg
ICB3aGlsZSAoKHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChwYykpICE9IG51bGxwdHIpCisg
ICB7CisgICAgICBpZiAoICAoKHN0YXJ0LT5sZW4oKSA9PSAxKSAmJiAoc3RhcnQtPnN0clsw
XSA9PSAnKScpKQorICAgICAgICAgfHwgcGMtPmxldmVsIDwgbGV2ZWwpCisgICAgICB7Cisg
ICAgICAgICBMT0dfRk1UKExGQ05QLCAiJXMoJWQpOiBiYWlsZWQgb24gdGV4dCgpICclcycs
IG9uIG9yaWdfbGluZSAlenVcbiIsCisgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJ
TkVfXywgcGMtPnRleHQoKSwgcGMtPm9yaWdfbGluZSk7CisgICAgICAgICBicmVhazsKKyAg
ICAgIH0KKyAgICAgIExPR19GTVQoTEZDTlAsICIlcyglZCk6ICVzLCB0ZXh0KCkgJyVzJyBv
biBvcmlnX2xpbmUgJXp1LCBsZXZlbCAlenVcbiIsCisgICAgICAgICAgICAgIF9fZnVuY19f
LCBfX0xJTkVfXywgKHBjLT5sZXZlbCA+IGxldmVsKSA/ICJza2lwcGluZyIgOiAibG9va2lu
ZyBhdCIsCisgICAgICAgICAgICAgIHBjLT50ZXh0KCksIHBjLT5vcmlnX2xpbmUsIHBjLT5s
ZXZlbCk7CisKKyAgICAgIGlmIChwYy0+bGV2ZWwgPiBsZXZlbCkKKyAgICAgIHsKKyAgICAg
ICAgIGNvbnRpbnVlOworICAgICAgfQorCisgICAgICBpZiAoY2h1bmtfaXNfc3RhcihwYykg
fHwgY2h1bmtfaXNfbXNyZWYocGMpIHx8IGNodW5rX2lzX251bGxhYmxlKHBjKSkKKyAgICAg
IHsKKyAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9QVFJfVFlQRSk7CisgICAgICAg
ICBjcy5QdXNoX0JhY2socGMpOworICAgICAgfQorICAgICAgZWxzZSBpZiAoICBjaHVua19p
c190b2tlbihwYywgQ1RfQU1QKQorICAgICAgICAgICAgICB8fCAobGFuZ3VhZ2VfaXNfc2V0
KExBTkdfQ1BQKSAmJiBjaHVua19pc19zdHIocGMsICImJiIsIDIpKSkKKyAgICAgIHsKKyAg
ICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9CWVJFRik7CisgICAgICAgICBjcy5QdXNo
X0JhY2socGMpOworICAgICAgfQorICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4ocGMs
IENUX1RZUEVfV1JBUCkpCisgICAgICB7CisgICAgICAgICBjcy5QdXNoX0JhY2socGMpOwor
ICAgICAgfQorICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1dPUkQpIHx8
IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9UWVBFKSkKKyAgICAgIHsKKyAgICAgICAgIGNzLlB1
c2hfQmFjayhwYyk7CisgICAgICB9CisgICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihw
YywgQ1RfQ09NTUEpIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9BU1NJR04pKQorICAgICAg
eworICAgICAgICAgbWFya192YXJpYWJsZV9zdGFjayhjcywgTEZDTlApOworCisgICAgICAg
ICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FTU0lHTikpCisgICAgICAgICB7CisgICAg
ICAgICAgICAvLyBNYXJrIGFzc2lnbm1lbnQgZm9yIGRlZmF1bHQgcGFyYW0gc3BhY2luZwor
ICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVudChwYywgQ1RfRlVOQ19QUk9UTyk7CisgICAg
ICAgICB9CisgICAgICB9CisgICB9CisgICBtYXJrX3ZhcmlhYmxlX3N0YWNrKGNzLCBMRkNO
UCk7Cit9IC8vIGZpeF9mY25fZGVmX3BhcmFtcworCisKK3N0YXRpYyBjaHVua190ICpza2lw
X3RvX25leHRfc3RhdGVtZW50KGNodW5rX3QgKnBjKQoreworICAgd2hpbGUgKCAgcGMgIT0g
bnVsbHB0cgorICAgICAgICAgJiYgIWNodW5rX2lzX3NlbWljb2xvbihwYykKKyAgICAgICAg
ICYmIHBjLT50eXBlICE9IENUX0JSQUNFX09QRU4KKyAgICAgICAgICYmIHBjLT50eXBlICE9
IENUX0JSQUNFX0NMT1NFKQorICAgeworICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25s
KHBjKTsKKyAgIH0KKyAgIHJldHVybihwYyk7Cit9CisKKworc3RhdGljIGNodW5rX3QgKmZp
eF92YXJpYWJsZV9kZWZpbml0aW9uKGNodW5rX3QgKnN0YXJ0KQoreworICAgTE9HX0ZVTkNf
RU5UUlkoKTsKKyAgIGNodW5rX3QgICAgKnBjID0gc3RhcnQ7CisgICBjaHVua190ICAgICpl
bmQ7CisgICBjaHVua190ICAgICp0bXBfcGM7CisgICBDaHVua1N0YWNrIGNzOworICAgaW50
ICAgICAgICBpZHg7CisgICBpbnQgICAgICAgIHJlZl9pZHg7CisKKyAgIExPR19GTVQoTEZW
RCwgIiVzKCVkKTogc3RhcnQgYXQgcGMtPm9yaWdfbGluZSBpcyAlenUsIHBjLT5vcmlnX2Nv
bCBpcyAlenVcbiIsCisgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdf
bGluZSwgcGMtPm9yaWdfY29sKTsKKworICAgLy8gU2NhbiBmb3Igd29yZHMgYW5kIHR5cGVz
IGFuZCBzdGFycyBvaCBteSEKKyAgIHdoaWxlICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9U
WVBFKQorICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1dPUkQpCisgICAgICAg
ICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfUVVBTElGSUVSKQorICAgICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX1RZUEVOQU1FKQorICAgICAgICAgfHwgY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX0RDX01FTUJFUikKKyAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9NRU1CRVIpCisgICAgICAgICB8fCBjaHVua19pc19wdHJfb3BlcmF0b3IocGMpKQorICAg
eworICAgICAgTE9HX0ZNVChMRlZELCAiJXMoJWQpOiAgIDE6cGMtPnRleHQoKSAnJXMnLCB0
eXBlIGlzICVzXG4iLAorICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50
ZXh0KCksIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CisgICAgICBjcy5QdXNoX0JhY2so
cGMpOworICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKKworICAgICAgaWYg
KHBjID09IG51bGxwdHIpCisgICAgICB7CisgICAgICAgICBMT0dfRk1UKExGVkQsICIlcygl
ZCk6IHBjIGlzIG51bGxwdHJcbiIsIF9fZnVuY19fLCBfX0xJTkVfXyk7CisgICAgICAgICBy
ZXR1cm4obnVsbHB0cik7CisgICAgICB9CisgICAgICBMT0dfRk1UKExGVkQsICIlcyglZCk6
ICAgMjpwYy0+dGV4dCgpICclcycsIHR5cGUgaXMgJXNcbiIsCisgICAgICAgICAgICAgIF9f
ZnVuY19fLCBfX0xJTkVfXywgcGMtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUp
KTsKKworICAgICAgLy8gU2tpcCB0ZW1wbGF0ZXMgYW5kIGF0dHJpYnV0ZXMKKyAgICAgIHBj
ID0gc2tpcF90ZW1wbGF0ZV9uZXh0KHBjKTsKKworICAgICAgaWYgKHBjID09IG51bGxwdHIp
CisgICAgICB7CisgICAgICAgICBMT0dfRk1UKExGVkQsICIlcyglZCk6IHBjIGlzIG51bGxw
dHJcbiIsIF9fZnVuY19fLCBfX0xJTkVfXyk7CisgICAgICAgICByZXR1cm4obnVsbHB0cik7
CisgICAgICB9CisgICAgICBMT0dfRk1UKExGVkQsICIlcyglZCk6ICAgMzpwYy0+dGV4dCgp
ICclcycsIHR5cGUgaXMgJXNcbiIsCisgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVf
XywgcGMtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUpKTsKKworICAgICAgcGMg
PSBza2lwX2F0dHJpYnV0ZV9uZXh0KHBjKTsKKworICAgICAgaWYgKHBjID09IG51bGxwdHIp
CisgICAgICB7CisgICAgICAgICBMT0dfRk1UKExGVkQsICIlcyglZCk6IHBjIGlzIG51bGxw
dHJcbiIsIF9fZnVuY19fLCBfX0xJTkVfXyk7CisgICAgICAgICByZXR1cm4obnVsbHB0cik7
CisgICAgICB9CisgICAgICBMT0dfRk1UKExGVkQsICIlcyglZCk6ICAgNDpwYy0+dGV4dCgp
ICclcycsIHR5cGUgaXMgJXNcbiIsCisgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVf
XywgcGMtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUpKTsKKworICAgICAgaWYg
KGxhbmd1YWdlX2lzX3NldChMQU5HX0pBVkEpKQorICAgICAgeworICAgICAgICAgcGMgPSBz
a2lwX3RzcXVhcmVfbmV4dChwYyk7CisgICAgICAgICBMT0dfRk1UKExGVkQsICIlcyglZCk6
ICAgNTpwYy0+dGV4dCgpICclcycsIHR5cGUgaXMgJXNcbiIsIF9fZnVuY19fLCBfX0xJTkVf
XywgcGMtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUpKTsKKyAgICAgIH0KKyAg
IH0KKyAgIGVuZCA9IHBjOworCisgICBpZiAoZW5kID09IG51bGxwdHIpCisgICB7CisgICAg
ICBMT0dfRk1UKExGVkQsICIlcyglZCk6IGVuZCBpcyBudWxscHRyXG4iLCBfX2Z1bmNfXywg
X19MSU5FX18pOworICAgICAgcmV0dXJuKG51bGxwdHIpOworICAgfQorICAgTE9HX0ZNVChM
RlZELCAiJXMoJWQpOiBlbmQtPnR5cGUgaXMgJXNcbiIsIF9fZnVuY19fLCBfX0xJTkVfXywg
Z2V0X3Rva2VuX25hbWUoZW5kLT50eXBlKSk7CisKKyAgIGlmICggIGNzLkxlbigpID09IDEK
KyAgICAgICYmIGNodW5rX2lzX3Rva2VuKGVuZCwgQ1RfQlJBQ0VfT1BFTikKKyAgICAgICYm
IGdldF9jaHVua19wYXJlbnRfdHlwZShlbmQpID09IENUX0JSQUNFRF9JTklUX0xJU1QpCisg
ICB7CisgICAgICBzZXRfY2h1bmtfdHlwZShjcy5HZXQoMCktPm1fcGMsIENUX1RZUEUpOwor
ICAgfQorCisgICAvLyBGdW5jdGlvbiBkZWZzIGFyZSBoYW5kbGVkIGVsc2V3aGVyZQorICAg
aWYgKCAgKGNzLkxlbigpIDw9IDEpCisgICAgICB8fCBjaHVua19pc190b2tlbihlbmQsIENU
X0ZVTkNfREVGKQorICAgICAgfHwgY2h1bmtfaXNfdG9rZW4oZW5kLCBDVF9GVU5DX1BST1RP
KQorICAgICAgfHwgY2h1bmtfaXNfdG9rZW4oZW5kLCBDVF9GVU5DX0NMQVNTX0RFRikKKyAg
ICAgIHx8IGNodW5rX2lzX3Rva2VuKGVuZCwgQ1RfRlVOQ19DTEFTU19QUk9UTykKKyAgICAg
IHx8IGNodW5rX2lzX3Rva2VuKGVuZCwgQ1RfT1BFUkFUT1IpKQorICAgeworICAgICAgcmV0
dXJuKHNraXBfdG9fbmV4dF9zdGF0ZW1lbnQoZW5kKSk7CisgICB9CisgICAvLyByZWZfaWR4
IHBvaW50cyB0byB0aGUgYWxpZ25hYmxlIHBhcnQgb2YgdGhlIHZhcmlhYmxlIGRlZmluaXRp
b24KKyAgIHJlZl9pZHggPSBjcy5MZW4oKSAtIDE7CisKKyAgIC8vIENoZWNrIGZvciB0aGUg
Jzo6JyBzdHVmZjogImNoYXIgKkVuZ2luZTo6bmFtZSIKKyAgIGlmICggIChjcy5MZW4oKSA+
PSAzKQorICAgICAgJiYgKCAgKGNzLkdldChjcy5MZW4oKSAtIDIpLT5tX3BjLT50eXBlID09
IENUX01FTUJFUikKKyAgICAgICAgIHx8IChjcy5HZXQoY3MuTGVuKCkgLSAyKS0+bV9wYy0+
dHlwZSA9PSBDVF9EQ19NRU1CRVIpKSkKKyAgIHsKKyAgICAgIGlkeCA9IGNzLkxlbigpIC0g
MjsKKworICAgICAgd2hpbGUgKGlkeCA+IDApCisgICAgICB7CisgICAgICAgICB0bXBfcGMg
PSBjcy5HZXQoaWR4KS0+bV9wYzsKKworICAgICAgICAgaWYgKCAgdG1wX3BjLT50eXBlICE9
IENUX0RDX01FTUJFUgorICAgICAgICAgICAgJiYgdG1wX3BjLT50eXBlICE9IENUX01FTUJF
UikKKyAgICAgICAgIHsKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgfQorCisgICAg
ICAgICBpZiAoaWR4ID09IDApCisgICAgICAgICB7CisgICAgICAgICAgICBmcHJpbnRmKHN0
ZGVyciwgIiVzKCVkKTogaWR4IGlzIFpFUk8sIGNhbm5vdCBiZSBkZWNyZW1lbnRlZCwgYXQg
bGluZSAlenUsIGNvbHVtbiAlenVcbiIsCisgICAgICAgICAgICAgICAgICAgIF9fZnVuY19f
LCBfX0xJTkVfXywgdG1wX3BjLT5vcmlnX2xpbmUsIHRtcF9wYy0+b3JpZ19jb2wpOworICAg
ICAgICAgICAgbG9nX2ZsdXNoKHRydWUpOworICAgICAgICAgICAgZXhpdChFWF9TT0ZUV0FS
RSk7CisgICAgICAgICB9CisgICAgICAgICBpZHgtLTsKKyAgICAgICAgIHRtcF9wYyA9IGNz
LkdldChpZHgpLT5tX3BjOworCisgICAgICAgICBpZiAoICB0bXBfcGMtPnR5cGUgIT0gQ1Rf
V09SRAorICAgICAgICAgICAgJiYgdG1wX3BjLT50eXBlICE9IENUX1RZUEUpCisgICAgICAg
ICB7CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgIH0KKyAgICAgICAgIG1ha2VfdHlw
ZSh0bXBfcGMpOworICAgICAgICAgaWR4LS07CisgICAgICB9CisgICAgICByZWZfaWR4ID0g
aWR4ICsgMTsKKyAgIH0KKyAgIHRtcF9wYyA9IGNzLkdldChyZWZfaWR4KS0+bV9wYzsKKyAg
IExPR19GTVQoTEZWRCwgIiVzKCVkKTogcmVmX2lkeCglZCkgaXMgJyVzJ1xuIiwgX19mdW5j
X18sIF9fTElORV9fLCByZWZfaWR4LCB0bXBfcGMtPnRleHQoKSk7CisKKyAgIC8vIE5vIHR5
cGUgcGFydCBmb3VuZCEKKyAgIGlmIChyZWZfaWR4IDw9IDApCisgICB7CisgICAgICByZXR1
cm4oc2tpcF90b19uZXh0X3N0YXRlbWVudChlbmQpKTsKKyAgIH0KKyAgIExPR19GTVQoTEZW
RDIsICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIFRZUEUgOiAiLCBfX2Z1bmNfXywgX19M
SU5FX18sIHN0YXJ0LT5vcmlnX2xpbmUpOworCisgICBmb3IgKHNpemVfdCBpZHhGb3JDcyA9
IDA7IGlkeEZvckNzIDwgY3MuTGVuKCkgLSAxOyBpZHhGb3JDcysrKQorICAgeworICAgICAg
dG1wX3BjID0gY3MuR2V0KGlkeEZvckNzKS0+bV9wYzsKKyAgICAgIG1ha2VfdHlwZSh0bXBf
cGMpOworICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHRtcF9wYywgUENGX1ZBUl9UWVBFKTsKKyAg
ICAgIExPR19GTVQoTEZWRDIsICIgdGV4dCgpIGlzICclcycsIHR5cGUgaXMgJXMiLCB0bXBf
cGMtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUodG1wX3BjLT50eXBlKSk7CisgICB9CisKKyAg
IExPR19GTVQoTEZWRDIsICJcbiIpOworCisgICAvLyBPSyB3ZSBoYXZlIHR3byBvciBtb3Jl
IGl0ZW1zLCBtYXJrIHR5cGVzIHVwIHRvIHRoZSBlbmQuCisgICBMT0dfRk1UKExGVkQsICIl
cyglZCk6IHBjLT5vcmlnX2xpbmUgaXMgJXp1LCBwYy0+b3JpZ19jb2wgaXMgJXp1XG4iLAor
ICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmln
X2NvbCk7CisgICBtYXJrX3ZhcmlhYmxlX2RlZmluaXRpb24oY3MuR2V0KGNzLkxlbigpIC0g
MSktPm1fcGMpOworCisgICBpZiAoY2h1bmtfaXNfdG9rZW4oZW5kLCBDVF9DT01NQSkpCisg
ICB7CisgICAgICByZXR1cm4oY2h1bmtfZ2V0X25leHRfbmNubChlbmQpKTsKKyAgIH0KKyAg
IHJldHVybihza2lwX3RvX25leHRfc3RhdGVtZW50KGVuZCkpOworfSAvLyBmaXhfdmFyaWFi
bGVfZGVmaW5pdGlvbgorCisKK3N0YXRpYyBjaHVua190ICpza2lwX2V4cHJlc3Npb24oY2h1
bmtfdCAqc3RhcnQpCit7CisgICBjaHVua190ICpwYyA9IHN0YXJ0OworCisgICB3aGlsZSAo
cGMgIT0gbnVsbHB0ciAmJiBwYy0+bGV2ZWwgPj0gc3RhcnQtPmxldmVsKQorICAgeworICAg
ICAgaWYgKCAgcGMtPmxldmVsID09IHN0YXJ0LT5sZXZlbAorICAgICAgICAgJiYgKGNodW5r
X2lzX3NlbWljb2xvbihwYykgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0NPTU1BKSkpCisg
ICAgICB7CisgICAgICAgICByZXR1cm4ocGMpOworICAgICAgfQorICAgICAgcGMgPSBjaHVu
a19nZXRfbmV4dF9uY25sKHBjKTsKKyAgIH0KKyAgIHJldHVybihwYyk7Cit9CisKKworYm9v
bCBnb19vbihjaHVua190ICpwYywgY2h1bmtfdCAqc3RhcnQpCit7CisgICBpZiAocGMgPT0g
bnVsbHB0ciB8fCBwYy0+bGV2ZWwgIT0gc3RhcnQtPmxldmVsKQorICAgeworICAgICAgcmV0
dXJuKGZhbHNlKTsKKyAgIH0KKworICAgaWYgKHBjLT5mbGFncy50ZXN0KFBDRl9JTl9GT1Ip
KQorICAgeworICAgICAgcmV0dXJuKCghY2h1bmtfaXNfc2VtaWNvbG9uKHBjKSkgJiYgKCEo
Y2h1bmtfaXNfdG9rZW4ocGMsIENUX0NPTE9OKSkpKTsKKyAgIH0KKyAgIHJldHVybighY2h1
bmtfaXNfc2VtaWNvbG9uKHBjKSk7Cit9IC8vIGdvX29uCisKKworc3RhdGljIGNodW5rX3Qg
Km1hcmtfdmFyaWFibGVfZGVmaW5pdGlvbihjaHVua190ICpzdGFydCkKK3sKKyAgIExPR19G
VU5DX0VOVFJZKCk7CisKKyAgIGlmIChzdGFydCA9PSBudWxscHRyKQorICAgeworICAgICAg
cmV0dXJuKG51bGxwdHIpOworICAgfQorICAgY2h1bmtfdCAgICAgKnBjICAgPSBzdGFydDsK
KyAgIHBjZl9mbGFnc190IGZsYWdzID0gUENGX1ZBUl8xU1RfREVGOworCisgICBMT0dfRk1U
KExWQVJERUYsICIlcyglZCk6IG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dSwgdGV4dCgp
ICclcycsIHR5cGUgaXMgJXNcbiIsCisgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywg
cGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpLAorICAgICAgICAgICBn
ZXRfdG9rZW5fbmFtZShwYy0+dHlwZSkpOworCisgICAvLyBJc3N1ZSAjNTk2CisgICBib29s
IGJpdF9maWVsZF9jb2xvbl9pc19wcmVzZW50ID0gZmFsc2U7CisKKyAgIHdoaWxlIChnb19v
bihwYywgc3RhcnQpKQorICAgeworICAgICAgaWYgKCAgY2h1bmtfaXNfdG9rZW4ocGMsIENU
X1dPUkQpCisgICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfRlVOQ19DVE9SX1ZB
UikpCisgICAgICB7CisgICAgICAgICBhdXRvIGNvbnN0IG9yaWdfZmxhZ3MgPSBwYy0+Zmxh
Z3M7CisKKyAgICAgICAgIGlmICghcGMtPmZsYWdzLnRlc3QoUENGX0lOX0VOVU0pKQorICAg
ICAgICAgeworICAgICAgICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHBjLCBmbGFncyk7CisgICAg
ICAgICB9CisgICAgICAgICBmbGFncyAmPSB+UENGX1ZBUl8xU1Q7CisgICAgICAgICBMT0df
Rk1UKExWQVJERUYsICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6
dSwgdGV4dCgpICclcycsIHNldCBQQ0ZfVkFSXzFTVFxuIiwKKyAgICAgICAgICAgICAgICAg
X19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIHBjLT50
ZXh0KCkpOworCisgICAgICAgICBMT0dfRk1UKExWQVJERUYsCisgICAgICAgICAgICAgICAg
ICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG1hcmtlZCB0ZXh0KCkgJyVzJ1slc10gIgor
ICAgICAgICAgICAgICAgICAiaW4gb3JpZ19jb2wgJXp1LCBmbGFnczogJXMgLT4gJXNcbiIs
CisgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwg
cGMtPnRleHQoKSwKKyAgICAgICAgICAgICAgICAgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUp
LCBwYy0+b3JpZ19jb2wsCisgICAgICAgICAgICAgICAgIHBjZl9mbGFnc19zdHIob3JpZ19m
bGFncykuY19zdHIoKSwKKyAgICAgICAgICAgICAgICAgcGNmX2ZsYWdzX3N0cihwYy0+Zmxh
Z3MpLmNfc3RyKCkpOworICAgICAgfQorICAgICAgZWxzZSBpZiAoICAhYml0X2ZpZWxkX2Nv
bG9uX2lzX3ByZXNlbnQgICAgICAgICAgICAgICAgICAgICAgLy8gSXNzdWUgIzI2ODkKKyAg
ICAgICAgICAgICAgJiYgKCAgY2h1bmtfaXNfc3RhcihwYykKKyAgICAgICAgICAgICAgICAg
fHwgY2h1bmtfaXNfbXNyZWYocGMpKSkKKyAgICAgIHsKKyAgICAgICAgIHNldF9jaHVua190
eXBlKHBjLCBDVF9QVFJfVFlQRSk7CisgICAgICB9CisgICAgICBlbHNlIGlmIChjaHVua19p
c19hZGRyKHBjKSkKKyAgICAgIHsKKyAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9C
WVJFRik7CisgICAgICB9CisgICAgICBlbHNlIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9TUVVBUkVfT1BFTikKKyAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENU
X0FTU0lHTikpCisgICAgICB7CisgICAgICAgICBwYyA9IHNraXBfZXhwcmVzc2lvbihwYyk7
CisgICAgICAgICBjb250aW51ZTsKKyAgICAgIH0KKyAgICAgIGVsc2UgaWYgKGNodW5rX2lz
X3Rva2VuKHBjLCBDVF9DT0xPTikpCisgICAgICB7CisgICAgICAgICBiaXRfZmllbGRfY29s
b25faXNfcHJlc2VudCA9IHRydWU7ICAgICAgICAgICAgICAgICAgICAvLyBJc3N1ZSAjMjY4
OQorICAgICAgfQorICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKKyAgIH0K
KyAgIHJldHVybihwYyk7Cit9IC8vIG1hcmtfdmFyaWFibGVfZGVmaW5pdGlvbgorCisKK3N0
YXRpYyBib29sIGNhbl9iZV9mdWxsX3BhcmFtKGNodW5rX3QgKnN0YXJ0LCBjaHVua190ICpl
bmQpCit7CisgICBMT0dfRlVOQ19FTlRSWSgpOworCisgICBMT0dfRk1UKExGUEFSQU0sICIl
czoiLCBfX2Z1bmNfXyk7CisKKyAgIGludCAgICAgd29yZF9jb3VudCA9IDA7CisgICBpbnQg
ICAgIHR5cGVfY291bnQgPSAwOworICAgY2h1bmtfdCAqcGM7CisKKyAgIGZvciAocGMgPSBz
dGFydDsKKyAgICAgICAgcGMgIT0gbnVsbHB0ciAmJiBwYyAhPSBlbmQ7CisgICAgICAgIHBj
ID0gY2h1bmtfZ2V0X25leHRfbmNubChwYywgc2NvcGVfZTo6UFJFUFJPQykpCisgICB7Cisg
ICAgICBMT0dfRk1UKExGUEFSQU0sICIgWyVzXSIsIHBjLT50ZXh0KCkpOworCisgICAgICBp
ZiAoICBjaHVua19pc190b2tlbihwYywgQ1RfUVVBTElGSUVSKQorICAgICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX1NUUlVDVCkKKyAgICAgICAgIHx8IGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9FTlVNKQorICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1VOSU9O
KQorICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RZUEVOQU1FKSkKKyAgICAg
IHsKKyAgICAgICAgIExPR19GTVQoTEZQQVJBTSwgIiA8PT0gJXMhICh5ZXMpXG4iLCBnZXRf
dG9rZW5fbmFtZShwYy0+dHlwZSkpOworICAgICAgICAgcmV0dXJuKHRydWUpOworICAgICAg
fQorCisgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1dPUkQpIHx8IGNodW5rX2lz
X3Rva2VuKHBjLCBDVF9UWVBFKSkKKyAgICAgIHsKKyAgICAgICAgICsrd29yZF9jb3VudDsK
KworICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9UWVBFKSkKKyAgICAgICAg
IHsKKyAgICAgICAgICAgICsrdHlwZV9jb3VudDsKKyAgICAgICAgIH0KKyAgICAgIH0KKyAg
ICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9NRU1CRVIpIHx8IGNodW5rX2lz
X3Rva2VuKHBjLCBDVF9EQ19NRU1CRVIpKQorICAgICAgeworICAgICAgICAgaWYgKHdvcmRf
Y291bnQgPiAwKQorICAgICAgICAgeworICAgICAgICAgICAgLS13b3JkX2NvdW50OworICAg
ICAgICAgfQorICAgICAgfQorICAgICAgZWxzZSBpZiAocGMgIT0gc3RhcnQgJiYgY2h1bmtf
aXNfcHRyX29wZXJhdG9yKHBjKSkKKyAgICAgIHsKKyAgICAgICAgIC8vIGNodW5rIGlzIE9L
CisgICAgICB9CisgICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfQVNTSUdO
KSkKKyAgICAgIHsKKyAgICAgICAgIC8vIGNodW5rIGlzIE9LIChkZWZhdWx0IHZhbHVlcykK
KyAgICAgICAgIGJyZWFrOworICAgICAgfQorICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9r
ZW4ocGMsIENUX0FOR0xFX09QRU4pKQorICAgICAgeworICAgICAgICAgTE9HX0ZNVChMRlBB
UkFNLCAiIDw9PSB0ZW1wbGF0ZVxuIik7CisgICAgICAgICByZXR1cm4odHJ1ZSk7CisgICAg
ICB9CisgICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfRUxMSVBTSVMpKQor
ICAgICAgeworICAgICAgICAgTE9HX0ZNVChMRlBBUkFNLCAiIDw9PSBlbGlwc2VzXG4iKTsK
KyAgICAgICAgIHJldHVybih0cnVlKTsKKyAgICAgIH0KKyAgICAgIGVsc2UgaWYgKHdvcmRf
Y291bnQgPT0gMCAmJiBjaHVua19pc190b2tlbihwYywgQ1RfUEFSRU5fT1BFTikpCisgICAg
ICB7CisgICAgICAgICAvLyBDaGVjayBmb3Igb2xkLXNjaG9vbCBmdW5jIHByb3RvIHBhcmFt
ICcodHlwZSknCisgICAgICAgICBjaHVua190ICp0bXAxID0gY2h1bmtfc2tpcF90b19tYXRj
aChwYywgc2NvcGVfZTo6UFJFUFJPQyk7CisKKyAgICAgICAgIGlmICh0bXAxID09IG51bGxw
dHIpCisgICAgICAgICB7CisgICAgICAgICAgICByZXR1cm4oZmFsc2UpOworICAgICAgICAg
fQorICAgICAgICAgY2h1bmtfdCAqdG1wMiA9IGNodW5rX2dldF9uZXh0X25jbmwodG1wMSwg
c2NvcGVfZTo6UFJFUFJPQyk7CisKKyAgICAgICAgIGlmICh0bXAyID09IG51bGxwdHIpCisg
ICAgICAgICB7CisgICAgICAgICAgICByZXR1cm4oZmFsc2UpOworICAgICAgICAgfQorCisg
ICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wMiwgQ1RfQ09NTUEpIHx8IGNodW5rX2lz
X3BhcmVuX2Nsb3NlKHRtcDIpKQorICAgICAgICAgeworICAgICAgICAgICAgZG8KKyAgICAg
ICAgICAgIHsKKyAgICAgICAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChwYywg
c2NvcGVfZTo6UFJFUFJPQyk7CisKKyAgICAgICAgICAgICAgIGlmIChwYyA9PSBudWxscHRy
KQorICAgICAgICAgICAgICAgeworICAgICAgICAgICAgICAgICAgcmV0dXJuKGZhbHNlKTsK
KyAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgICAgIExPR19GTVQoTEZQQVJBTSwgIiBb
JXNdIiwgcGMtPnRleHQoKSk7CisgICAgICAgICAgICB9IHdoaWxlIChwYyAhPSB0bXAxKTsK
KworICAgICAgICAgICAgLy8gcmVzZXQgc29tZSB2YXJzIHRvIGFsbG93IFtdIGFmdGVyIHBh
cmVucworICAgICAgICAgICAgd29yZF9jb3VudCA9IDE7CisgICAgICAgICAgICB0eXBlX2Nv
dW50ID0gMTsKKyAgICAgICAgIH0KKyAgICAgICAgIGVsc2UKKyAgICAgICAgIHsKKyAgICAg
ICAgICAgIExPR19GTVQoTEZQQVJBTSwgIiA8PT0gWyVzXSBub3QgZmNuIHR5cGUhXG4iLCBn
ZXRfdG9rZW5fbmFtZShwYy0+dHlwZSkpOworICAgICAgICAgICAgcmV0dXJuKGZhbHNlKTsK
KyAgICAgICAgIH0KKyAgICAgIH0KKyAgICAgIGVsc2UgaWYgKCAgKHdvcmRfY291bnQgPT0g
MSB8fCAod29yZF9jb3VudCA9PSB0eXBlX2NvdW50KSkKKyAgICAgICAgICAgICAgJiYgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX1BBUkVOX09QRU4pKQorICAgICAgeworICAgICAgICAgLy8g
Q2hlY2sgZm9yIGZ1bmMgcHJvdG8gcGFyYW0gJ3ZvaWQgKCpuYW1lKScgb3IgJ3ZvaWQgKCpu
YW1lKShwYXJhbXMpJyBvciAndm9pZCAoXm5hbWUpKHBhcmFtcyknCisgICAgICAgICAvLyA8
bmFtZT4gY2FuIGJlIG9wdGlvbmFsCisgICAgICAgICBjaHVua190ICp0bXAxID0gY2h1bmtf
Z2V0X25leHRfbmNubChwYywgc2NvcGVfZTo6UFJFUFJPQyk7CisKKyAgICAgICAgIGlmICh0
bXAxID09IG51bGxwdHIpCisgICAgICAgICB7CisgICAgICAgICAgICByZXR1cm4oZmFsc2Up
OworICAgICAgICAgfQorICAgICAgICAgY2h1bmtfdCAqdG1wMiA9IGNodW5rX2dldF9uZXh0
X25jbmwodG1wMSwgc2NvcGVfZTo6UFJFUFJPQyk7CisKKyAgICAgICAgIGlmICh0bXAyID09
IG51bGxwdHIpCisgICAgICAgICB7CisgICAgICAgICAgICByZXR1cm4oZmFsc2UpOworICAg
ICAgICAgfQorICAgICAgICAgY2h1bmtfdCAqdG1wMyA9IChjaHVua19pc19zdHIodG1wMiwg
IikiLCAxKSkgPyB0bXAyIDogY2h1bmtfZ2V0X25leHRfbmNubCh0bXAyLCBzY29wZV9lOjpQ
UkVQUk9DKTsKKworICAgICAgICAgaWYgKHRtcDMgPT0gbnVsbHB0cikKKyAgICAgICAgIHsK
KyAgICAgICAgICAgIHJldHVybihmYWxzZSk7CisgICAgICAgICB9CisKKyAgICAgICAgIGlm
ICggICFjaHVua19pc19zdHIodG1wMywgIikiLCAxKQorICAgICAgICAgICAgfHwgIShjaHVu
a19pc19zdHIodG1wMSwgIioiLCAxKSB8fCBjaHVua19pc19zdHIodG1wMSwgIl4iLCAxKSkg
Ly8gSXNzdWUgIzI2NTYKKyAgICAgICAgICAgIHx8ICEodG1wMi0+dHlwZSA9PSBDVF9XT1JE
IHx8IGNodW5rX2lzX3N0cih0bXAyLCAiKSIsIDEpKSkKKyAgICAgICAgIHsKKyAgICAgICAg
ICAgIExPR19GTVQoTEZQQVJBTSwgIiA8PT0gWyVzXSBub3QgZmNuIHR5cGUhXG4iLCBnZXRf
dG9rZW5fbmFtZShwYy0+dHlwZSkpOworICAgICAgICAgICAgcmV0dXJuKGZhbHNlKTsKKyAg
ICAgICAgIH0KKyAgICAgICAgIExPR19GTVQoTEZQQVJBTSwgIiA8c2tpcCBmY24gdHlwZT4i
KTsKKyAgICAgICAgIHRtcDEgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcDMsIHNjb3BlX2U6
OlBSRVBST0MpOworCisgICAgICAgICBpZiAodG1wMSA9PSBudWxscHRyKQorICAgICAgICAg
eworICAgICAgICAgICAgcmV0dXJuKGZhbHNlKTsKKyAgICAgICAgIH0KKworICAgICAgICAg
aWYgKGNodW5rX2lzX3N0cih0bXAxLCAiKCIsIDEpKQorICAgICAgICAgeworICAgICAgICAg
ICAgdG1wMyA9IGNodW5rX3NraXBfdG9fbWF0Y2godG1wMSwgc2NvcGVfZTo6UFJFUFJPQyk7
CisgICAgICAgICB9CisgICAgICAgICBwYyA9IHRtcDM7CisKKyAgICAgICAgIC8vIHJlc2V0
IHNvbWUgdmFycyB0byBhbGxvdyBbXSBhZnRlciBwYXJlbnMKKyAgICAgICAgIHdvcmRfY291
bnQgPSAxOworICAgICAgICAgdHlwZV9jb3VudCA9IDE7CisgICAgICB9CisgICAgICBlbHNl
IGlmIChjaHVua19pc190b2tlbihwYywgQ1RfVFNRVUFSRSkpCisgICAgICB7CisgICAgICAg
ICAvLyBpZ25vcmUgaXQKKyAgICAgIH0KKyAgICAgIGVsc2UgaWYgKHdvcmRfY291bnQgPT0g
MSAmJiBjaHVua19pc190b2tlbihwYywgQ1RfU1FVQVJFX09QRU4pKQorICAgICAgeworICAg
ICAgICAgLy8gc2tpcCBvdmVyIGFueSBhcnJheSBzdHVmZgorICAgICAgICAgcGMgPSBjaHVu
a19za2lwX3RvX21hdGNoKHBjLCBzY29wZV9lOjpQUkVQUk9DKTsKKyAgICAgIH0KKyAgICAg
IGVsc2UgaWYgKHdvcmRfY291bnQgPT0gMiAmJiBjaHVua19pc190b2tlbihwYywgQ1RfU1FV
QVJFX09QRU4pKQorICAgICAgeworICAgICAgICAgLy8gQnVnICM2NzE6IGlzIGl0IHN1Y2gg
YXM6IGJvb2wgZm9vW0ZPT19NQVhdCisgICAgICAgICBwYyA9IGNodW5rX3NraXBfdG9fbWF0
Y2gocGMsIHNjb3BlX2U6OlBSRVBST0MpOworICAgICAgfQorICAgICAgZWxzZSBpZiAoICB3
b3JkX2NvdW50ID09IDEKKyAgICAgICAgICAgICAgJiYgbGFuZ3VhZ2VfaXNfc2V0KExBTkdf
Q1BQKQorICAgICAgICAgICAgICAmJiBjaHVua19pc19zdHIocGMsICImJiIsIDIpKQorICAg
ICAgeworICAgICAgICAgLy8gaWdub3JlIHBvc3NpYmxlICdtb3ZlJyBvcGVyYXRvcgorICAg
ICAgfQorICAgICAgZWxzZQorICAgICAgeworICAgICAgICAgTE9HX0ZNVChMRlBBUkFNLCAi
IDw9PSBbJXNdIG5vIHdheSEgdGM9JWQgd2M9JWRcbiIsCisgICAgICAgICAgICAgICAgIGdl
dF90b2tlbl9uYW1lKHBjLT50eXBlKSwgdHlwZV9jb3VudCwgd29yZF9jb3VudCk7CisgICAg
ICAgICByZXR1cm4oZmFsc2UpOworICAgICAgfQorICAgfQorCisgICBjaHVua190ICpsYXN0
ID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHBjKTsgICAvLyBJc3N1ZSAjMjI3OQorCisgICBp
ZiAoY2h1bmtfaXNfcHRyX29wZXJhdG9yKGxhc3QpKQorICAgeworICAgICAgTE9HX0ZNVChM
RlBBUkFNLCAiIDw9PSBbJXNdIHN1cmUhXG4iLCBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSkp
OworICAgICAgcmV0dXJuKHRydWUpOworICAgfQorCisgICBpZiAod29yZF9jb3VudCA8IDIg
JiYgdHlwZV9jb3VudCA8IDEgJiYgc3RhcnQtPmJyYWNlX2xldmVsID4gMCkKKyAgIHsKKyAg
ICAgIExPR19GTVQoTEZQQVJBTSwgIiAhTVZQISIpOworICAgICAgLy8gT2gsIGpveSwgd2Ug
YXJlIGluIE1vc3QgVmV4aW5nIFBhcnNlIHRlcnJpdG9yeQorICAgICAgYXV0byBjb25zdCBi
cmFjZSA9CisgICAgICAgICBjaHVua19nZXRfcHJldl90eXBlKHN0YXJ0LCBDVF9CUkFDRV9P
UEVOLCBzdGFydC0+YnJhY2VfbGV2ZWwgLSAxKTsKKworICAgICAgaWYgKGJyYWNlKQorICAg
ICAgeworICAgICAgICAgTE9HX0ZNVChMRlBBUkFNLCAiIChtYXRjaGluZyAlcyBicmFjZSBh
dCAlenU6JXp1KSIsCisgICAgICAgICAgICAgICAgIGdldF90b2tlbl9uYW1lKGdldF9jaHVu
a19wYXJlbnRfdHlwZShicmFjZSkpLAorICAgICAgICAgICAgICAgICBicmFjZS0+b3JpZ19s
aW5lLCBicmFjZS0+b3JpZ19jb2wpOworICAgICAgfQorCisgICAgICBpZiAoICBicmFjZQor
ICAgICAgICAgJiYgKCAgZ2V0X2NodW5rX3BhcmVudF90eXBlKGJyYWNlKSA9PSBDVF9DTEFT
UworICAgICAgICAgICAgfHwgZ2V0X2NodW5rX3BhcmVudF90eXBlKGJyYWNlKSA9PSBDVF9T
VFJVQ1QpKQorICAgICAgeworICAgICAgICAgLy8gQSBNb3N0IFZleGluZyBQYXJzZSB2YXJp
YWJsZSBkZWNsYXJhdGlvbiBjYW5ub3Qgb2NjdXIgaW4gdGhlIGJvZHkKKyAgICAgICAgIC8v
IG9mIGEgc3RydWN0L2NsYXNzLCBzbyB3ZSBwcm9iYWJseSBoYXZlIGEgZnVuY3Rpb24gcHJv
dG90eXBlCisgICAgICAgICBMT0dfRk1UKExGUEFSQU0sICIgPD09IFslc10gTGlrZWx5IVxu
IiwKKyAgICAgICAgICAgICAgICAgKHBjID09IG51bGxwdHIgPyAibnVsbHB0ciIgOiBnZXRf
dG9rZW5fbmFtZShwYy0+dHlwZSkpKTsKKyAgICAgICAgIHJldHVybih0cnVlKTsKKyAgICAg
IH0KKyAgIH0KKyAgIGJvb2wgcmV0ID0gKCAgd29yZF9jb3VudCA+PSAyCisgICAgICAgICAg
ICAgIHx8ICh3b3JkX2NvdW50ID09IDEgJiYgdHlwZV9jb3VudCA9PSAxKSk7CisKKyAgIExP
R19GTVQoTEZQQVJBTSwgIiA8PT0gWyVzXSAlcyFcbiIsCisgICAgICAgICAgIChwYyA9PSBu
dWxscHRyID8gIm51bGxwdHIiIDogZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUpKSwKKyAgICAg
ICAgICAgcmV0ID8gIll1cCIgOiAiVW5saWtlbHkiKTsKKyAgIHJldHVybihyZXQpOworfSAv
LyBjYW5fYmVfZnVsbF9wYXJhbQorCisKK3N0YXRpYyB2b2lkIG1hcmtfZnVuY3Rpb24oY2h1
bmtfdCAqcGMpCit7CisgICBMT0dfRlVOQ19FTlRSWSgpOworCisgICBpZiAocGMgPT0gbnVs
bHB0cikKKyAgIHsKKyAgICAgIHJldHVybjsKKyAgIH0KKyAgIExPR19GTVQoTEZDTiwgIiVz
KCVkKTogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xu
IiwKKyAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+
b3JpZ19jb2wsIHBjLT50ZXh0KCkpOworICAgY2h1bmtfdCAqcHJldiA9IGNodW5rX2dldF9w
cmV2X25jbmxuaShwYyk7ICAgLy8gSXNzdWUgIzIyNzkKKyAgIGNodW5rX3QgKm5leHQgPSBj
aHVua19nZXRfbmV4dF9uY25sbnAocGMpOworCisgICBpZiAobmV4dCA9PSBudWxscHRyKQor
ICAgeworICAgICAgcmV0dXJuOworICAgfQorICAgY2h1bmtfdCAqdG1wOworICAgY2h1bmtf
dCAqc2VtaSA9IG51bGxwdHI7CisgICBjaHVua190ICpwYXJlbl9vcGVuOworICAgY2h1bmtf
dCAqcGFyZW5fY2xvc2U7CisKKyAgIC8vIEZpbmQgb3V0IHdoYXQgaXMgYmVmb3JlIHRoZSBv
cGVyYXRvcgorICAgaWYgKGdldF9jaHVua19wYXJlbnRfdHlwZShwYykgPT0gQ1RfT1BFUkFU
T1IpCisgICB7CisgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IG9yaWdfbGluZSBpcyAl
enUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcyIsCisgICAgICAgICAgICAgIF9fZnVu
Y19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgp
KTsKKyAgICAgIGxvZ19wY2ZfZmxhZ3MoTEdVWSwgcGMtPmZsYWdzKTsKKyAgICAgIGNodW5r
X3QgKnBjX29wID0gY2h1bmtfZ2V0X3ByZXZfdHlwZShwYywgQ1RfT1BFUkFUT1IsIHBjLT5s
ZXZlbCk7CisKKyAgICAgIGlmICggIHBjX29wICE9IG51bGxwdHIKKyAgICAgICAgICYmIHBj
X29wLT5mbGFncy50ZXN0KFBDRl9FWFBSX1NUQVJUKSkKKyAgICAgIHsKKyAgICAgICAgIExP
R19GTVQoTEZDTiwgIiVzKCVkKTogKDQpIFNFVCBUTyBDVF9GVU5DX0NBTEw6IG9yaWdfbGlu
ZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcydcbiIsCisgICAgICAgICAg
ICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29s
LCBwYy0+dGV4dCgpKTsKKyAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DX0NB
TEwpOworICAgICAgfQorCisgICAgICBpZiAobGFuZ3VhZ2VfaXNfc2V0KExBTkdfQ1BQKSkK
KyAgICAgIHsKKyAgICAgICAgIHRtcCA9IHBjOworCisgICAgICAgICB3aGlsZSAoKHRtcCA9
IGNodW5rX2dldF9wcmV2X25jbmxuaSh0bXApKSAhPSBudWxscHRyKSAgIC8vIElzc3VlICMy
Mjc5CisgICAgICAgICB7CisgICAgICAgICAgICBpZiAoICBjaHVua19pc190b2tlbih0bXAs
IENUX0JSQUNFX0NMT1NFKQorICAgICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4odG1w
LCBDVF9CUkFDRV9PUEVOKSAgICAgICAgICAgICAvLyBJc3N1ZSA1NzUKKyAgICAgICAgICAg
ICAgIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfU0VNSUNPTE9OKSkKKyAgICAgICAgICAg
IHsKKyAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgfQorCisgICAgICAgICAg
ICBpZiAoICBjaHVua19pc19wYXJlbl9vcGVuKHRtcCkKKyAgICAgICAgICAgICAgICYmICFw
Yy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykpICAgICAgICAgICAgICAgLy8gSXNzdWUg
IzI3MDMKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVz
KCVkKTogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xu
IiwKKyAgICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0bXAtPm9y
aWdfbGluZSwgdG1wLT5vcmlnX2NvbCwgdG1wLT50ZXh0KCkpOworICAgICAgICAgICAgICAg
TE9HX0ZNVChMRkNOLCAiJXMoJWQpOiAoNSkgU0VUIFRPIENUX0ZVTkNfQ0FMTDogb3JpZ19s
aW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xuIiwKKyAgICAgICAg
ICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+
b3JpZ19jb2wsIHBjLT50ZXh0KCkpOworICAgICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUo
cGMsIENUX0ZVTkNfQ0FMTCk7CisgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAg
IH0KKworICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfQVNTSUdOKSkK
KyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTog
KDYpIFNFVCBUTyBDVF9GVU5DX0NBTEw6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlz
ICV6dSwgdGV4dCgpICclcydcbiIsCisgICAgICAgICAgICAgICAgICAgICAgIF9fZnVuY19f
LCBfX0xJTkVfXywgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpKTsK
KyAgICAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DX0NBTEwpOworICAg
ICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICAgICB9CisKKyAgICAgICAgICAgIGlmIChj
aHVua19pc190b2tlbih0bXAsIENUX1RFTVBMQVRFKSkKKyAgICAgICAgICAgIHsKKyAgICAg
ICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogKDcpIFNFVCBUTyBDVF9GVU5DX0RF
Rjogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xuIiwK
KyAgICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19s
aW5lLCBwYy0+b3JpZ19jb2wsIHBjLT50ZXh0KCkpOworICAgICAgICAgICAgICAgc2V0X2No
dW5rX3R5cGUocGMsIENUX0ZVTkNfREVGKTsKKyAgICAgICAgICAgICAgIGJyZWFrOworICAg
ICAgICAgICAgfQorCisgICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9C
UkFDRV9PUEVOKSkKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgIGlmIChnZXRfY2h1
bmtfcGFyZW50X3R5cGUodG1wKSA9PSBDVF9GVU5DX0RFRikKKyAgICAgICAgICAgICAgIHsK
KyAgICAgICAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogKDgpIFNFVCBUTyBD
VF9GVU5DX0NBTEw6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgp
ICclcydcbiIsCisgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVf
XywgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpKTsKKyAgICAgICAg
ICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DX0NBTEwpOworICAgICAgICAg
ICAgICAgfQorCisgICAgICAgICAgICAgICBpZiAoICBnZXRfY2h1bmtfcGFyZW50X3R5cGUo
dG1wKSA9PSBDVF9DTEFTUworICAgICAgICAgICAgICAgICAgfHwgZ2V0X2NodW5rX3BhcmVu
dF90eXBlKHRtcCkgPT0gQ1RfU1RSVUNUKQorICAgICAgICAgICAgICAgeworICAgICAgICAg
ICAgICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiAoOSkgU0VUIFRPIENUX0ZVTkNfREVG
OiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSAnJXMnXG4iLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmln
X2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQoKSk7CisgICAgICAgICAgICAgICAgICBz
ZXRfY2h1bmtfdHlwZShwYywgQ1RfRlVOQ19ERUYpOworICAgICAgICAgICAgICAgfQorICAg
ICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICAgICB9CisgICAgICAgICB9CisKKyAgICAg
ICAgIGlmICggIHRtcCAhPSBudWxscHRyCisgICAgICAgICAgICAmJiBwYy0+dHlwZSAhPSBD
VF9GVU5DX0NBTEwpCisgICAgICAgICB7CisgICAgICAgICAgICAvLyBNYXJrIHRoZSByZXR1
cm4gdHlwZQorICAgICAgICAgICAgd2hpbGUgKCAgKHRtcCA9IGNodW5rX2dldF9uZXh0X25j
bmwodG1wKSkgIT0gcGMKKyAgICAgICAgICAgICAgICAgICYmIHRtcCAhPSBudWxscHRyKQor
ICAgICAgICAgICAgeworICAgICAgICAgICAgICAgbWFrZV90eXBlKHRtcCk7IC8vIE1hcmsg
dGhlIHJldHVybiB0eXBlCisgICAgICAgICAgICB9CisgICAgICAgICB9CisgICAgICB9Cisg
ICB9CisKKyAgIGlmIChjaHVua19pc19wdHJfb3BlcmF0b3IobmV4dCkpCisgICB7CisgICAg
ICBuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubG5wKG5leHQpOworCisgICAgICBpZiAobmV4
dCA9PSBudWxscHRyKQorICAgICAgeworICAgICAgICAgcmV0dXJuOworICAgICAgfQorICAg
fQorICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2Nv
bCBpcyAlenUsIHRleHQoKSAnJXMsIHR5cGUgaXMgJXMsIHBhcmVudF90eXBlIGlzICVzXG4i
LAorICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5v
cmlnX2NvbCwgcGMtPnRleHQoKSwKKyAgICAgICAgICAgZ2V0X3Rva2VuX25hbWUocGMtPnR5
cGUpLCBnZXRfdG9rZW5fbmFtZShnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpKSk7CisgICBM
T0dfRk1UKExGQ04sICIgICBsZXZlbCBpcyAlenUsIGJyYWNlX2xldmVsIGlzICV6dSwgbmV4
dC0+dGV4dCgpICclcycsIG5leHQtPnR5cGUgaXMgJXMsIG5leHQtPmxldmVsIGlzICV6dVxu
IiwKKyAgICAgICAgICAgcGMtPmxldmVsLCBwYy0+YnJhY2VfbGV2ZWwsCisgICAgICAgICAg
IG5leHQtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUobmV4dC0+dHlwZSksIG5leHQtPmxldmVs
KTsKKworICAgaWYgKHBjLT5mbGFncy50ZXN0KFBDRl9JTl9DT05TVF9BUkdTKSkKKyAgIHsK
KyAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DX0NUT1JfVkFSKTsKKyAgICAgIExP
R19GTVQoTEZDTiwgIiVzKCVkKTogICAxKSBNYXJrZWQgWyVzXSBhcyBGVU5DX0NUT1JfVkFS
IG9uIGxpbmUgJXp1IGNvbCAlenVcbiIsCisgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJ
TkVfXywgcGMtPnRleHQoKSwgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sKTsKKyAgICAg
IG5leHQgPSBza2lwX3RlbXBsYXRlX25leHQobmV4dCk7CisKKyAgICAgIGlmIChuZXh0ID09
IG51bGxwdHIpCisgICAgICB7CisgICAgICAgICByZXR1cm47CisgICAgICB9CisgICAgICBm
bGFnX3BhcmVucyhuZXh0LCBQQ0ZfTk9ORSwgQ1RfRlBBUkVOX09QRU4sIHBjLT50eXBlLCB0
cnVlKTsKKyAgICAgIHJldHVybjsKKyAgIH0KKyAgIC8vIFNraXAgb3ZlciBhbnkgdGVtcGxh
dGUgYW5kIGF0dHJpYnV0ZSBtYWRuZXNzCisgICBuZXh0ID0gc2tpcF90ZW1wbGF0ZV9uZXh0
KG5leHQpOworCisgICBpZiAobmV4dCA9PSBudWxscHRyKQorICAgeworICAgICAgcmV0dXJu
OworICAgfQorICAgbmV4dCA9IHNraXBfYXR0cmlidXRlX25leHQobmV4dCk7CisKKyAgIGlm
IChuZXh0ID09IG51bGxwdHIpCisgICB7CisgICAgICByZXR1cm47CisgICB9CisgICAvLyBG
aW5kIHRoZSBvcGVuIGFuZCBjbG9zZSBwYXJlbnRoZXNpcworICAgcGFyZW5fb3BlbiAgPSBj
aHVua19nZXRfbmV4dF9zdHIocGMsICIoIiwgMSwgcGMtPmxldmVsKTsKKyAgIHBhcmVuX2Ns
b3NlID0gY2h1bmtfZ2V0X25leHRfc3RyKHBhcmVuX29wZW4sICIpIiwgMSwgcGMtPmxldmVs
KTsKKworICAgaWYgKCAgcGFyZW5fb3BlbiA9PSBudWxscHRyCisgICAgICB8fCBwYXJlbl9j
bG9zZSA9PSBudWxscHRyKQorICAgeworICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiBO
byBwYXJlbnMgZm91bmQgZm9yIFslc10gb24gb3JpZ19saW5lICV6dSwgb3JpZ19jb2wgJXp1
XG4iLAorICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIHBj
LT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCk7CisgICAgICByZXR1cm47CisgICB9CisgICAv
KgorICAgICogVGhpcyBwYXJ0IGRldGVjdHMgZWl0aGVyIGNoYWluZWQgZnVuY3Rpb24gY2Fs
bHMgb3IgYSBmdW5jdGlvbiBwdHIgZGVmaW5pdGlvbi4KKyAgICAqIE1ZVFlQRSAoKmZ1bmMp
KHZvaWQpOworICAgICogbVdyaXRlciggImNsYXNzIENsc3RfImMgKSggc29tZXN0ci5nZXRU
ZXh0KCkgKSggIiA6IENsdXN0ZXIgeyJjICkubmV3bGluZTsKKyAgICAqCisgICAgKiBGb3Ig
aXQgdG8gYmUgYSBmdW5jdGlvbiB2YXJpYWJsZSBkZWYsIHRoZXJlIG11c3QgYmUgYSAnKicg
Zm9sbG93ZWQgYnkgYQorICAgICogc2luZ2xlIHdvcmQuCisgICAgKgorICAgICogT3RoZXJ3
aXNlLCBpdCBtdXN0IGJlIGNoYWluZWQgZnVuY3Rpb24gY2FsbHMuCisgICAgKi8KKyAgIHRt
cCA9IGNodW5rX2dldF9uZXh0X25jbmwocGFyZW5fY2xvc2UpOworCisgICBpZiAoICB0bXAg
IT0gbnVsbHB0cgorICAgICAgJiYgY2h1bmtfaXNfc3RyKHRtcCwgIigiLCAxKSkKKyAgIHsK
KyAgICAgIGNodW5rX3QgKnRtcDE7CisgICAgICBjaHVua190ICp0bXAyOworICAgICAgY2h1
bmtfdCAqdG1wMzsKKworICAgICAgLy8gc2tpcCBvdmVyIGFueSBsZWFkaW5nIGNsYXNzL25h
bWVzcGFjZSBpbjogIlQoRjo6KkEpKCk7IgorICAgICAgdG1wMSA9IGNodW5rX2dldF9uZXh0
X25jbmwobmV4dCk7CisKKyAgICAgIHdoaWxlICh0bXAxICE9IG51bGxwdHIpCisgICAgICB7
CisgICAgICAgICB0bXAyID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXAxKTsKKworICAgICAg
ICAgaWYgKCFjaHVua19pc193b3JkKHRtcDEpIHx8ICFjaHVua19pc190b2tlbih0bXAyLCBD
VF9EQ19NRU1CRVIpKQorICAgICAgICAgeworICAgICAgICAgICAgYnJlYWs7CisgICAgICAg
ICB9CisgICAgICAgICB0bXAxID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXAyKTsKKyAgICAg
IH0KKyAgICAgIHRtcDIgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcDEpOworCisgICAgICBp
ZiAoY2h1bmtfaXNfc3RyKHRtcDIsICIpIiwgMSkpCisgICAgICB7CisgICAgICAgICB0bXAz
ID0gdG1wMjsKKyAgICAgICAgIHRtcDIgPSBudWxscHRyOworICAgICAgfQorICAgICAgZWxz
ZQorICAgICAgeworICAgICAgICAgdG1wMyA9IGNodW5rX2dldF9uZXh0X25jbmwodG1wMik7
CisgICAgICB9CisgICAgICB0bXAzID0gY2h1bmtfZ2V0X25leHRfc3NxKHRtcDMpOworCisg
ICAgICBpZiAoICBjaHVua19pc19zdHIodG1wMywgIikiLCAxKQorICAgICAgICAgJiYgKCAg
Y2h1bmtfaXNfc3Rhcih0bXAxKQorICAgICAgICAgICAgfHwgY2h1bmtfaXNfbXNyZWYodG1w
MSkKKyAgICAgICAgICAgIHx8IChsYW5ndWFnZV9pc19zZXQoTEFOR19PQykgJiYgY2h1bmtf
aXNfdG9rZW4odG1wMSwgQ1RfQ0FSRVQpKSkKKyAgICAgICAgICYmICh0bXAyID09IG51bGxw
dHIgfHwgY2h1bmtfaXNfdG9rZW4odG1wMiwgQ1RfV09SRCkpKQorICAgICAgeworICAgICAg
ICAgaWYgKHRtcDIpCisgICAgICAgICB7CisgICAgICAgICAgICBMT0dfRk1UKExGQ04sICIl
cyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgZnVuY3Rpb24gdmFy
aWFibGUgJyVzJywgY2hhbmdpbmcgJyVzJyBpbnRvIGEgdHlwZVxuIiwKKyAgICAgICAgICAg
ICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19j
b2wsIHRtcDItPnRleHQoKSwgcGMtPnRleHQoKSk7CisgICAgICAgICAgICBzZXRfY2h1bmtf
dHlwZSh0bXAyLCBDVF9GVU5DX1ZBUik7CisgICAgICAgICAgICBmbGFnX3BhcmVucyhwYXJl
bl9vcGVuLCBQQ0ZfTk9ORSwgQ1RfUEFSRU5fT1BFTiwgQ1RfRlVOQ19WQVIsIGZhbHNlKTsK
KworICAgICAgICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiBwYXJlbiBvcGVuIEAgb3Jp
Z19saW5lICV6dSwgb3JpZ19jb2wgJXp1XG4iLAorICAgICAgICAgICAgICAgICAgICBfX2Z1
bmNfXywgX19MSU5FX18sIHBhcmVuX29wZW4tPm9yaWdfbGluZSwgcGFyZW5fb3Blbi0+b3Jp
Z19jb2wpOworICAgICAgICAgfQorICAgICAgICAgZWxzZQorICAgICAgICAgeworICAgICAg
ICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2Nv
bCBpcyAlenUsIGZ1bmN0aW9uIHR5cGUsIGNoYW5naW5nICclcycgaW50byBhIHR5cGVcbiIs
CisgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPm9yaWdfbGlu
ZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpKTsKKworICAgICAgICAgICAgaWYgKHRtcDIp
CisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZSh0bXAyLCBD
VF9GVU5DX1RZUEUpOworICAgICAgICAgICAgfQorICAgICAgICAgICAgZmxhZ19wYXJlbnMo
cGFyZW5fb3BlbiwgUENGX05PTkUsIENUX1BBUkVOX09QRU4sIENUX0ZVTkNfVFlQRSwgZmFs
c2UpOworICAgICAgICAgfQorICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX1RZUEUp
OworICAgICAgICAgc2V0X2NodW5rX3R5cGUodG1wMSwgQ1RfUFRSX1RZUEUpOworICAgICAg
ICAgY2h1bmtfZmxhZ3NfY2xyKHBjLCBQQ0ZfVkFSXzFTVF9ERUYpOworCisgICAgICAgICBp
ZiAodG1wMiAhPSBudWxscHRyKQorICAgICAgICAgeworICAgICAgICAgICAgY2h1bmtfZmxh
Z3Nfc2V0KHRtcDIsIFBDRl9WQVJfMVNUX0RFRik7CisgICAgICAgICB9CisgICAgICAgICBm
bGFnX3BhcmVucyh0bXAsIFBDRl9OT05FLCBDVF9GUEFSRU5fT1BFTiwgQ1RfRlVOQ19QUk9U
TywgZmFsc2UpOworICAgICAgICAgZml4X2Zjbl9kZWZfcGFyYW1zKHRtcCk7CisgICAgICAg
ICByZXR1cm47CisgICAgICB9CisgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IGNoYWlu
ZWQgZnVuY3Rpb24gY2FsbHM/IHRleHQoKSBpcyAnJXMnLCBvcmlnX2xpbmUgaXMgJXp1LCBv
cmlnX2NvbCBpcyAlenVcbiIsCisgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywg
cGMtPnRleHQoKSwgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sKTsKKyAgIH0KKworICAg
Ly8gQXNzdW1lIGl0IGlzIGEgZnVuY3Rpb24gY2FsbCBpZiBub3QgYWxyZWFkeSBsYWJlbGVk
CisgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0ZVTkNUSU9OKSkKKyAgIHsKKyAgICAg
IExPR19GTVQoTEZDTiwgIiVzKCVkKTogZXhhbWluZTogdGV4dCgpIGlzICclcycsIG9yaWdf
bGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdHlwZSBpcyAlc1xuIiwKKyAgICAgICAg
ICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5lLCBw
Yy0+b3JpZ19jb2wsIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSk7CisgICAgICAvLyBsb29r
IGZvciBhbiBhc3NpZ21lbnQuIElzc3VlICM1NzUKKyAgICAgIGNodW5rX3QgKnRlbXAgPSBj
aHVua19nZXRfbmV4dF90eXBlKHBjLCBDVF9BU1NJR04sIHBjLT5sZXZlbCk7CisKKyAgICAg
IGlmICh0ZW1wICE9IG51bGxwdHIpCisgICAgICB7CisgICAgICAgICBMT0dfRk1UKExGQ04s
ICIlcyglZCk6IGFzc2lnbWVudCBmb3VuZCwgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wg
aXMgJXp1LCB0ZXh0KCkgJyVzJ1xuIiwKKyAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9f
TElORV9fLCB0ZW1wLT5vcmlnX2xpbmUsIHRlbXAtPm9yaWdfY29sLCB0ZW1wLT50ZXh0KCkp
OworICAgICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiAoMTApIFNFVCBUTyBDVF9GVU5D
X0NBTEw6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcyci
LAorICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUs
IHBjLT5vcmlnX2NvbCwgcGMtPnRleHQoKSk7CisgICAgICAgICBzZXRfY2h1bmtfdHlwZShw
YywgQ1RfRlVOQ19DQUxMKTsKKyAgICAgIH0KKyAgICAgIGVsc2UKKyAgICAgIHsKKyAgICAg
ICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogKDExKSBTRVQgVE8gJXM6IG9yaWdfbGluZSBp
cyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcyciLAorICAgICAgICAgICAgICAg
ICBfX2Z1bmNfXywgX19MSU5FX18sIChnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpID09IENU
X09QRVJBVE9SKSA/ICJDVF9GVU5DX0RFRiIgOiAiQ1RfRlVOQ19DQUxMIiwKKyAgICAgICAg
ICAgICAgICAgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLCBwYy0+dGV4dCgpKTsKKyAg
ICAgICAgIHNldF9jaHVua190eXBlKHBjLCAoZ2V0X2NodW5rX3BhcmVudF90eXBlKHBjKSA9
PSBDVF9PUEVSQVRPUikgPyBDVF9GVU5DX0RFRiA6IENUX0ZVTkNfQ0FMTCk7CisgICAgICB9
CisgICB9CisgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IENoZWNrIGZvciBDKysgZnVuY3Rp
b24gZGVmLCB0ZXh0KCkgaXMgJyVzJywgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMg
JXp1LCB0eXBlIGlzICVzXG4iLAorICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBj
LT50ZXh0KCksIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgZ2V0X3Rva2VuX25hbWUo
cGMtPnR5cGUpKTsKKworICAgaWYgKHByZXYgIT0gbnVsbHB0cikKKyAgIHsKKyAgICAgIExP
R19GTVQoTEZDTiwgIiVzKCVkKTogcHJldi0+dGV4dCgpIGlzICclcycsIG9yaWdfbGluZSBp
cyAlenUsIG9yaWdfY29sIGlzICV6dSwgdHlwZSBpcyAlc1xuIiwKKyAgICAgICAgICAgICAg
X19mdW5jX18sIF9fTElORV9fLCBwcmV2LT50ZXh0KCksIHByZXYtPm9yaWdfbGluZSwgcHJl
di0+b3JpZ19jb2wsIGdldF90b2tlbl9uYW1lKHByZXYtPnR5cGUpKTsKKyAgIH0KKworICAg
Ly8gQ2hlY2sgZm9yIEMrKyBmdW5jdGlvbiBkZWYKKyAgIGlmICggIGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9GVU5DX0NMQVNTX0RFRikKKyAgICAgIHx8ICggIHByZXYgIT0gbnVsbHB0cgor
ICAgICAgICAgJiYgKCAgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfSU5WKQorICAgICAgICAg
ICAgfHwgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfRENfTUVNQkVSKSkpKQorICAgeworICAg
ICAgY2h1bmtfdCAqZGVzdHIgPSBudWxscHRyOworCisgICAgICBpZiAoY2h1bmtfaXNfdG9r
ZW4ocHJldiwgQ1RfSU5WKSkKKyAgICAgIHsKKyAgICAgICAgIC8vIFRPRE86IGRvIHdlIGNh
cmUgdGhhdCB0aGlzIGlzIHRoZSBkZXN0cnVjdG9yPworICAgICAgICAgc2V0X2NodW5rX3R5
cGUocHJldiwgQ1RfREVTVFJVQ1RPUik7CisgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywg
Q1RfRlVOQ19DTEFTU19ERUYpOworCisgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBD
VF9ERVNUUlVDVE9SKTsKKworICAgICAgICAgZGVzdHIgPSBwcmV2OworICAgICAgICAgLy8g
UG9pbnQgdG8gdGhlIGl0ZW0gcHJldmlvdXMgdG8gdGhlIGNsYXNzIG5hbWUKKyAgICAgICAg
IHByZXYgPSBjaHVua19nZXRfcHJldl9uY25sbnAocHJldik7CisgICAgICB9CisKKyAgICAg
IGlmIChjaHVua19pc190b2tlbihwcmV2LCBDVF9EQ19NRU1CRVIpKQorICAgICAgeworICAg
ICAgICAgcHJldiA9IGNodW5rX2dldF9wcmV2X25jbmxucChwcmV2KTsKKyAgICAgICAgIExP
R19GTVQoTEZDTiwgIiVzKCVkKTogcHJldi0+dGV4dCgpIGlzICclcycsIG9yaWdfbGluZSBp
cyAlenUsIG9yaWdfY29sIGlzICV6dSwgdHlwZSBpcyAlc1xuIiwKKyAgICAgICAgICAgICAg
ICAgX19mdW5jX18sIF9fTElORV9fLCBwcmV2LT50ZXh0KCksIHByZXYtPm9yaWdfbGluZSwg
cHJldi0+b3JpZ19jb2wsCisgICAgICAgICAgICAgICAgIGdldF90b2tlbl9uYW1lKHByZXYt
PnR5cGUpKTsKKyAgICAgICAgIHByZXYgPSBza2lwX3RlbXBsYXRlX3ByZXYocHJldik7Cisg
ICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IHByZXYtPnRleHQoKSBpcyAnJXMnLCBv
cmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHR5cGUgaXMgJXNcbiIsCisgICAg
ICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcHJldi0+dGV4dCgpLCBwcmV2LT5v
cmlnX2xpbmUsIHByZXYtPm9yaWdfY29sLAorICAgICAgICAgICAgICAgICBnZXRfdG9rZW5f
bmFtZShwcmV2LT50eXBlKSk7CisgICAgICAgICBwcmV2ID0gc2tpcF9hdHRyaWJ1dGVfcHJl
dihwcmV2KTsKKyAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogcHJldi0+dGV4dCgp
IGlzICclcycsIG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdHlwZSBpcyAl
c1xuIiwKKyAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwcmV2LT50ZXh0
KCksIHByZXYtPm9yaWdfbGluZSwgcHJldi0+b3JpZ19jb2wsCisgICAgICAgICAgICAgICAg
IGdldF90b2tlbl9uYW1lKHByZXYtPnR5cGUpKTsKKworICAgICAgICAgaWYgKGNodW5rX2lz
X3Rva2VuKHByZXYsIENUX1dPUkQpIHx8IGNodW5rX2lzX3Rva2VuKHByZXYsIENUX1RZUEUp
KQorICAgICAgICAgeworICAgICAgICAgICAgaWYgKHBjLT5zdHIuZXF1YWxzKHByZXYtPnN0
cikpCisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICBMT0dfRk1UKExGQ04sICIlcygl
ZCk6IHBjLT50ZXh0KCkgaXMgJyVzJywgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMg
JXp1LCB0eXBlIGlzICVzXG4iLAorICAgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywg
X19MSU5FX18sIHBjLT50ZXh0KCksIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwKKyAg
ICAgICAgICAgICAgICAgICAgICAgZ2V0X3Rva2VuX25hbWUocHJldi0+dHlwZSkpOworICAg
ICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0ZVTkNfQ0xBU1NfREVGKTsKKyAg
ICAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogb3JpZ19saW5lIGlzICV6dSwg
b3JpZ19jb2wgaXMgJXp1IC0gRk9VTkQgJXNTVFJVQ1RPUiBmb3IgJyVzJywgdHlwZSBpcyAl
c1xuIiwKKyAgICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLAorICAg
ICAgICAgICAgICAgICAgICAgICBwcmV2LT5vcmlnX2xpbmUsIHByZXYtPm9yaWdfY29sLAor
ICAgICAgICAgICAgICAgICAgICAgICAoZGVzdHIgIT0gbnVsbHB0cikgPyAiREUiIDogIkNP
TiIsCisgICAgICAgICAgICAgICAgICAgICAgIHByZXYtPnRleHQoKSwgZ2V0X3Rva2VuX25h
bWUocHJldi0+dHlwZSkpOworCisgICAgICAgICAgICAgICBtYXJrX2NwcF9jb25zdHJ1Y3Rv
cihwYyk7CisgICAgICAgICAgICAgICByZXR1cm47CisgICAgICAgICAgICB9CisgICAgICAg
ICAgICAvLyBQb2ludCB0byB0aGUgaXRlbSBwcmV2aW91cyB0byB0aGUgY2xhc3MgbmFtZQor
ICAgICAgICAgICAgcHJldiA9IGNodW5rX2dldF9wcmV2X25jbmxucChwcmV2KTsKKyAgICAg
ICAgIH0KKyAgICAgIH0KKyAgIH0KKworICAgLyoKKyAgICAqIERldGVybWluZSBpZiB0aGlz
IGlzIGEgZnVuY3Rpb24gY2FsbCBvciBhIGZ1bmN0aW9uIGRlZi9wcm90bworICAgICogV2Ug
Y2hlY2sgZm9yIGxldmVsPT0xIHRvIGFsbG93IHRoZSBjYXNlIHRoYXQgYSBmdW5jdGlvbiBw
cm90b3R5cGUgaXMKKyAgICAqIHdyYXBwZWQgaW4gYSBtYWNybzogIk1BQ1JPKHZvaWQgZm9v
KHZvaWQpKTsiCisgICAgKi8KKyAgIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBDVF9GVU5D
X0NBTEwpCisgICAgICAmJiAoICBwYy0+bGV2ZWwgPT0gcGMtPmJyYWNlX2xldmVsCisgICAg
ICAgICB8fCBwYy0+bGV2ZWwgPT0gMSkKKyAgICAgICYmICFwYy0+ZmxhZ3MudGVzdChQQ0Zf
SU5fQVJSQVlfQVNTSUdOKSkKKyAgIHsKKyAgICAgIGJvb2wgaXNhX2RlZiAgPSBmYWxzZTsK
KyAgICAgIGJvb2wgaGl0X3N0YXIgPSBmYWxzZTsKKyAgICAgIExPR19GTVQoTEZDTiwgIiVz
KCVkKTogcGMtPnRleHQoKSBpcyAnJXMnLCBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBp
cyAlenUsIHR5cGUgaXMgJXNcbiIsCisgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVf
XywgcGMtPnRleHQoKSwgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sLAorICAgICAgICAg
ICAgICBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSkpOworCisgICAgICBpZiAocHJldiA9PSBu
dWxscHRyKQorICAgICAgeworICAgICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiBDaGVj
a2luZyBmdW5jIGNhbGw6IHByZXYgaXMgTlVMTFxuIiwKKyAgICAgICAgICAgICAgICAgX19m
dW5jX18sIF9fTElORV9fKTsKKyAgICAgIH0KKyAgICAgIGVsc2UKKyAgICAgIHsKKyAgICAg
ICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogQ2hlY2tpbmcgZnVuYyBjYWxsOiBwcmV2LT50
ZXh0KCkgJyVzJywgcHJldi0+dHlwZSBpcyAlc1xuIiwKKyAgICAgICAgICAgICAgICAgX19m
dW5jX18sIF9fTElORV9fLCBwcmV2LT50ZXh0KCksIGdldF90b2tlbl9uYW1lKHByZXYtPnR5
cGUpKTsKKyAgICAgIH0KKyAgICAgIC8vIGlmICghY2h1bmtfZW5kc190eXBlKHByZXYpKQor
ICAgICAgLy8geworICAgICAgLy8gICAgZ290byBiYWRfcmV0X3R5cGU7CisgICAgICAvLyB9
CisKKyAgICAgIC8qCisgICAgICAgKiBSRVZJU0lUOgorICAgICAgICogYSBmdW5jdGlvbiBk
ZWYgY2FuIG9ubHkgb2NjdXIgYXQgYnJhY2UgbGV2ZWwsIGJ1dCBub3QgaW5zaWRlIGFuCisg
ICAgICAgKiBhc3NpZ25tZW50LCBzdHJ1Y3R1cmUsIGVudW0sIG9yIHVuaW9uLgorICAgICAg
ICogVGhlIGNsb3NlIHBhcmVuIG11c3QgYmUgZm9sbG93ZWQgYnkgYW4gb3BlbiBicmFjZSwg
d2l0aCBhbiBvcHRpb25hbAorICAgICAgICogcXVhbGlmaWVyIChjb25zdCkgaW4gYmV0d2Vl
bi4KKyAgICAgICAqIFRoZXJlIGNhbiBiZSBhbGwgc29ydHMgb2YgdGVtcGxhdGUgc3R1ZmYg
YW5kL29yICdbXScgaW4gdGhlIHR5cGUuCisgICAgICAgKiBUaGlzIGhhY2sgbW9zdGx5IGNo
ZWNrcyB0aGF0LgorICAgICAgICoKKyAgICAgICAqIEV4YW1wbGVzOgorICAgICAgICogZm9v
LT5iYXIobWFpZCk7ICAgICAgICAgICAgICAgICAgIC0tIGZjbiBjYWxsCisgICAgICAgKiBG
T08gKiBiYXIoKTsgICAgICAgICAgICAgICAgICAgICAgLS0gZmNuIHByb3RvIG9yIGNsYXNz
IHZhcmlhYmxlCisgICAgICAgKiBGT08gZm9vKCk7ICAgICAgICAgICAgICAgICAgICAgICAg
LS0gZmNuIHByb3RvIG9yIGNsYXNzIHZhcmlhYmxlCisgICAgICAgKiBGT08gZm9vKDEpOyAg
ICAgICAgICAgICAgICAgICAgICAgLS0gY2xhc3MgdmFyaWFibGUKKyAgICAgICAqIGEgPSBG
T08gKiBiYXIoKTsgICAgICAgICAgICAgICAgICAtLSBmY24gY2FsbAorICAgICAgICogYS55
ID0gZm9vKCkgKiBiYXIoKTsgICAgICAgICAgICAgIC0tIGZjbiBjYWxsCisgICAgICAgKiBz
dGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IGZpenooKTsgLS0gZmNuIGRlZgorICAgICAgICov
CisgICAgICB3aGlsZSAocHJldiAhPSBudWxscHRyKQorICAgICAgeworICAgICAgICAgTE9H
X0ZNVChMRkNOLCAiJXMoJWQpOiBuZXh0IHN0ZXAgd2l0aDogcHJldi0+b3JpZ19saW5lIGlz
ICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xuIiwKKyAgICAgICAgICAgICAg
ICAgX19mdW5jX18sIF9fTElORV9fLCBwcmV2LT5vcmlnX2xpbmUsIHByZXYtPm9yaWdfY29s
LCBwcmV2LT50ZXh0KCkpOworCisgICAgICAgICBpZiAoZ2V0X2NodW5rX3BhcmVudF90eXBl
KHBjKSA9PSBDVF9GSVhFRCkKKyAgICAgICAgIHsKKyAgICAgICAgICAgIGlzYV9kZWYgPSB0
cnVlOworICAgICAgICAgfQorCisgICAgICAgICBpZiAocHJldi0+ZmxhZ3MudGVzdChQQ0Zf
SU5fUFJFUFJPQykpCisgICAgICAgICB7CisgICAgICAgICAgICBwcmV2ID0gY2h1bmtfZ2V0
X3ByZXZfbmNubG5wKHByZXYpOworICAgICAgICAgICAgY29udGludWU7CisgICAgICAgICB9
CisKKyAgICAgICAgIC8vIFNvbWUgY29kZSBzbGlwcyBhbiBhdHRyaWJ1dGUgYmV0d2VlbiB0
aGUgdHlwZSBhbmQgZnVuY3Rpb24KKyAgICAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKHBy
ZXYsIENUX0ZQQVJFTl9DTE9TRSkKKyAgICAgICAgICAgICYmIGdldF9jaHVua19wYXJlbnRf
dHlwZShwcmV2KSA9PSBDVF9BVFRSSUJVVEUpCisgICAgICAgICB7CisgICAgICAgICAgICBw
cmV2ID0gc2tpcF9hdHRyaWJ1dGVfcHJldihwcmV2KTsKKyAgICAgICAgICAgIGNvbnRpbnVl
OworICAgICAgICAgfQorCisgICAgICAgICAvLyBza2lwIGNvbnN0KFRZUEUpCisgICAgICAg
ICBpZiAoICBjaHVua19pc190b2tlbihwcmV2LCBDVF9QQVJFTl9DTE9TRSkKKyAgICAgICAg
ICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShwcmV2KSA9PSBDVF9EX0NBU1QpCisgICAg
ICAgICB7CisgICAgICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IC0tPiBGb3Igc3Vy
ZSBhIHByb3RvdHlwZSBvciBkZWZpbml0aW9uXG4iLAorICAgICAgICAgICAgICAgICAgICBf
X2Z1bmNfXywgX19MSU5FX18pOworICAgICAgICAgICAgaXNhX2RlZiA9IHRydWU7CisgICAg
ICAgICAgICBicmVhazsKKyAgICAgICAgIH0KKworICAgICAgICAgaWYgKGdldF9jaHVua19w
YXJlbnRfdHlwZShwcmV2KSA9PSBDVF9ERUNMU1BFQykgIC8vIElzc3VlIDEyODkKKyAgICAg
ICAgIHsKKyAgICAgICAgICAgIHByZXYgPSBjaHVua19za2lwX3RvX21hdGNoX3JldihwcmV2
KTsKKyAgICAgICAgICAgIHByZXYgPSBjaHVua19nZXRfcHJldihwcmV2KTsKKworICAgICAg
ICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHByZXYsIENUX0RFQ0xTUEVDKSkKKyAgICAgICAg
ICAgIHsKKyAgICAgICAgICAgICAgIHByZXYgPSBjaHVua19nZXRfcHJldihwcmV2KTsKKyAg
ICAgICAgICAgIH0KKyAgICAgICAgIH0KKworICAgICAgICAgLy8gaWYgaXQgd2FzIGRldGVy
bWluZWQgdGhhdCB0aGlzIGNvdWxkIGJlIGEgZnVuY3Rpb24gZGVmaW5pdGlvbgorICAgICAg
ICAgLy8gYnV0IG9uZSBvZiB0aGUgcHJlY2VkaW5nIHRva2VucyBpcyBhIENUX01FTUJFUiB0
aGFuIHRoaXMgaXMgbm90IGEKKyAgICAgICAgIC8vIGZjbiBkZWYsIGlzc3VlICMxNDY2Cisg
ICAgICAgICBpZiAoICBpc2FfZGVmCisgICAgICAgICAgICAmJiBjaHVua19pc190b2tlbihw
cmV2LCBDVF9NRU1CRVIpKQorICAgICAgICAgeworICAgICAgICAgICAgaXNhX2RlZiA9IGZh
bHNlOworICAgICAgICAgfQorCisgICAgICAgICAvLyBnZXQgZmlyc3QgY2h1bmsgYmVmb3Jl
OiBBOjpCOjpwYyB8IHRoaXMuQi5wYyB8IHRoaXMtPkItPnBjCisgICAgICAgICBpZiAoICBj
aHVua19pc190b2tlbihwcmV2LCBDVF9EQ19NRU1CRVIpCisgICAgICAgICAgICB8fCBjaHVu
a19pc190b2tlbihwcmV2LCBDVF9NRU1CRVIpKQorICAgICAgICAgeworICAgICAgICAgICAg
d2hpbGUgKCAgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfRENfTUVNQkVSKQorICAgICAgICAg
ICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfTUVNQkVSKSkKKyAgICAgICAg
ICAgIHsKKyAgICAgICAgICAgICAgIHByZXYgPSBjaHVua19nZXRfcHJldl9uY25sbnAocHJl
dik7CisKKyAgICAgICAgICAgICAgIGlmICggIHByZXYgPT0gbnVsbHB0cgorICAgICAgICAg
ICAgICAgICAgfHwgKCAgcHJldi0+dHlwZSAhPSBDVF9XT1JECisgICAgICAgICAgICAgICAg
ICAgICAmJiBwcmV2LT50eXBlICE9IENUX1RZUEUKKyAgICAgICAgICAgICAgICAgICAgICYm
IHByZXYtPnR5cGUgIT0gQ1RfVEhJUykpCisgICAgICAgICAgICAgICB7CisgICAgICAgICAg
ICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IC0tPyBza2lwcGVkIE1FTUJFUiBhbmQg
bGFuZGVkIG9uICVzXG4iLAorICAgICAgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywg
X19MSU5FX18sIChwcmV2ID09IG51bGxwdHIpID8gIjxudWxsPiIgOiBnZXRfdG9rZW5fbmFt
ZShwcmV2LT50eXBlKSk7CisgICAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAg
ICAgIH0KKyAgICAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogPHNraXA+ICcl
cydcbiIsCisgICAgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcHJl
di0+dGV4dCgpKTsKKworICAgICAgICAgICAgICAgLy8gSXNzdWUgIzExMTIKKyAgICAgICAg
ICAgICAgIC8vIGNsYXJpZmljYXRpb246IHRoaXMgd2lsbCBza2lwIHRoZSBDVF9XT1JELCBD
VF9UWVBFIG9yIENUX1RISVMgbGFuZGluZyBvbiBlaXRoZXIKKyAgICAgICAgICAgICAgIC8v
IGFub3RoZXIgQ1RfRENfTUVNQkVSIG9yIENUX01FTUJFUiBvciBhIHRva2VuIHRoYXQgaW5k
aWNhdGVzIHRoZSBjb250ZXh0IG9mIHRoZQorICAgICAgICAgICAgICAgLy8gdG9rZW4gaW4g
cXVlc3Rpb247IHRoZXJlZm9yZSwgZXhpdCBsb29wIHdoZW4gbm90IGEgQ1RfRENfTUVNQkVS
IG9yIENUX01FTUJFUgorICAgICAgICAgICAgICAgcHJldiA9IGNodW5rX2dldF9wcmV2X25j
bmxucChwcmV2KTsKKworICAgICAgICAgICAgICAgaWYgKHByZXYgPT0gbnVsbHB0cikKKyAg
ICAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVk
KTogcHJldiBpcyBudWxscHRyXG4iLAorICAgICAgICAgICAgICAgICAgICAgICAgICBfX2Z1
bmNfXywgX19MSU5FX18pOworICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgICAgZWxz
ZQorICAgICAgICAgICAgICAgeworICAgICAgICAgICAgICAgICAgTE9HX0ZNVChMRkNOLCAi
JXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSAnJXMn
XG4iLAorICAgICAgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBy
ZXYtPm9yaWdfbGluZSwgcHJldi0+b3JpZ19jb2wsIHByZXYtPnRleHQoKSk7CisgICAgICAg
ICAgICAgICB9CisgICAgICAgICAgICB9CisKKyAgICAgICAgICAgIGlmIChwcmV2ID09IG51
bGxwdHIpCisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAg
ICAgIH0KKyAgICAgICAgIH0KKworICAgICAgICAgLy8gSWYgd2UgYXJlIG9uIGEgVFlQRSBv
ciBXT1JELCB0aGVuIHRoaXMgY291bGQgYmUgYSBwcm90byBvciBkZWYKKyAgICAgICAgIGlm
ICggIGNodW5rX2lzX3Rva2VuKHByZXYsIENUX1RZUEUpCisgICAgICAgICAgICB8fCBjaHVu
a19pc190b2tlbihwcmV2LCBDVF9XT1JEKSkKKyAgICAgICAgIHsKKyAgICAgICAgICAgIGlm
ICghaGl0X3N0YXIpCisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICBMT0dfRk1UKExG
Q04sICIlcyglZCk6ICAgLS0+IEZvciBzdXJlIGEgcHJvdG90eXBlIG9yIGRlZmluaXRpb25c
biIsCisgICAgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXyk7CisgICAg
ICAgICAgICAgICBpc2FfZGVmID0gdHJ1ZTsKKyAgICAgICAgICAgICAgIGJyZWFrOworICAg
ICAgICAgICAgfQorICAgICAgICAgICAgY2h1bmtfdCAqcHJldl9wcmV2ID0gY2h1bmtfZ2V0
X3ByZXZfbmNubG5wKHByZXYpOworCisgICAgICAgICAgICBpZiAoIWNodW5rX2lzX3Rva2Vu
KHByZXZfcHJldiwgQ1RfUVVFU1RJT04pKSAgICAgICAgICAgICAgIC8vIElzc3VlICMxNzUz
CisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6
ICAgLS0+IG1heWJlIGEgcHJvdG8vZGVmXG4iLAorICAgICAgICAgICAgICAgICAgICAgICBf
X2Z1bmNfXywgX19MSU5FX18pOworCisgICAgICAgICAgICAgICBMT0dfRk1UKExGQ04sICIl
cyglZCk6IHByZXYgaXMgJyVzJywgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1
LCB0eXBlIGlzICVzLCBwYXJlbnRfdHlwZSBpcyAlc1xuIiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwcmV2LT50ZXh0KCksIHByZXYtPm9yaWdfbGlu
ZSwgcHJldi0+b3JpZ19jb2wsCisgICAgICAgICAgICAgICAgICAgICAgIGdldF90b2tlbl9u
YW1lKHByZXYtPnR5cGUpLCBnZXRfdG9rZW5fbmFtZShnZXRfY2h1bmtfcGFyZW50X3R5cGUo
cHJldikpKTsKKyAgICAgICAgICAgICAgIGxvZ19wY2ZfZmxhZ3MoTEZDTiwgcGMtPmZsYWdz
KTsKKyAgICAgICAgICAgICAgIGlzYV9kZWYgPSB0cnVlOworICAgICAgICAgICAgfQorICAg
ICAgICAgfQorCisgICAgICAgICBpZiAoY2h1bmtfaXNfcHRyX29wZXJhdG9yKHByZXYpKQor
ICAgICAgICAgeworICAgICAgICAgICAgaGl0X3N0YXIgPSB0cnVlOworICAgICAgICAgfQor
CisgICAgICAgICBpZiAoICBwcmV2LT50eXBlICE9IENUX09QRVJBVE9SCisgICAgICAgICAg
ICAmJiBwcmV2LT50eXBlICE9IENUX1RTUVVBUkUKKyAgICAgICAgICAgICYmIHByZXYtPnR5
cGUgIT0gQ1RfQU5HTEVfQ0xPU0UKKyAgICAgICAgICAgICYmIHByZXYtPnR5cGUgIT0gQ1Rf
UVVBTElGSUVSCisgICAgICAgICAgICAmJiBwcmV2LT50eXBlICE9IENUX1RZUEUKKyAgICAg
ICAgICAgICYmIHByZXYtPnR5cGUgIT0gQ1RfV09SRAorICAgICAgICAgICAgJiYgIWNodW5r
X2lzX3B0cl9vcGVyYXRvcihwcmV2KSkKKyAgICAgICAgIHsKKyAgICAgICAgICAgIExPR19G
TVQoTEZDTiwgIiVzKCVkKTogIC0tPiBTdG9wcGluZyBvbiBwcmV2IGlzICclcycsIG9yaWdf
bGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdHlwZSBpcyAlc1xuIiwKKyAgICAgICAg
ICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwcmV2LT50ZXh0KCksIHByZXYtPm9y
aWdfbGluZSwgcHJldi0+b3JpZ19jb2wsIGdldF90b2tlbl9uYW1lKHByZXYtPnR5cGUpKTsK
KworICAgICAgICAgICAgLy8gY2VydGFpbiB0b2tlbnMgYXJlIHVubGlrZWx5IHRvIHByZWNl
ZGUgYSBwcm90b3R5cGUgb3IgZGVmaW5pdGlvbgorICAgICAgICAgICAgaWYgKCAgY2h1bmtf
aXNfdG9rZW4ocHJldiwgQ1RfQVJJVEgpCisgICAgICAgICAgICAgICB8fCBjaHVua19pc190
b2tlbihwcmV2LCBDVF9BU1NJR04pCisgICAgICAgICAgICAgICB8fCBjaHVua19pc190b2tl
bihwcmV2LCBDVF9DT01NQSkKKyAgICAgICAgICAgICAgIHx8IChjaHVua19pc190b2tlbihw
cmV2LCBDVF9TVFJJTkcpICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShwcmV2KSAhPSBDVF9F
WFRFUk4pICAvLyBmaXhlcyBpc3N1ZSAxMjU5CisgICAgICAgICAgICAgICB8fCBjaHVua19p
c190b2tlbihwcmV2LCBDVF9TVFJJTkdfTVVMVEkpCisgICAgICAgICAgICAgICB8fCBjaHVu
a19pc190b2tlbihwcmV2LCBDVF9OVU1CRVIpCisgICAgICAgICAgICAgICB8fCBjaHVua19p
c190b2tlbihwcmV2LCBDVF9OVU1CRVJfRlApCisgICAgICAgICAgICAgICB8fCBjaHVua19p
c190b2tlbihwcmV2LCBDVF9GUEFSRU5fT1BFTikpIC8vIGlzc3VlICMxNDY0CisgICAgICAg
ICAgICB7CisgICAgICAgICAgICAgICBpc2FfZGVmID0gZmFsc2U7CisgICAgICAgICAgICB9
CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgIH0KKworICAgICAgICAgLy8gU2tpcCBv
dmVyIHRlbXBsYXRlIGFuZCBhdHRyaWJ1dGUgc3R1ZmYKKyAgICAgICAgIGlmIChjaHVua19p
c190b2tlbihwcmV2LCBDVF9BTkdMRV9DTE9TRSkpCisgICAgICAgICB7CisgICAgICAgICAg
ICBwcmV2ID0gc2tpcF90ZW1wbGF0ZV9wcmV2KHByZXYpOworICAgICAgICAgfQorICAgICAg
ICAgZWxzZQorICAgICAgICAgeworICAgICAgICAgICAgcHJldiA9IGNodW5rX2dldF9wcmV2
X25jbmxucChwcmV2KTsKKyAgICAgICAgIH0KKyAgICAgIH0KKyAgICAgIC8vTE9HX0ZNVChM
RkNOLCAiIC0tIHN0b3BwZWQgb24gJXMgWyVzXVxuIiwKKyAgICAgIC8vICAgICAgICBwcmV2
LT50ZXh0KCksIGdldF90b2tlbl9uYW1lKHByZXYtPnR5cGUpKTsKKworICAgICAgLy8gRml4
ZXMgaXNzdWUgIzE2MzQKKyAgICAgIGlmIChjaHVua19pc19wYXJlbl9jbG9zZShwcmV2KSkK
KyAgICAgIHsKKyAgICAgICAgIGNodW5rX3QgKnByZXByb2MgPSBjaHVua19nZXRfbmV4dF9u
Y25sKHByZXYpOworCisgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocHJlcHJvYywgQ1Rf
UFJFUFJPQykpCisgICAgICAgICB7CisgICAgICAgICAgICBzaXplX3QgcHBfbGV2ZWwgPSBw
cmVwcm9jLT5wcF9sZXZlbDsKKworICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKGNo
dW5rX2dldF9uZXh0X25jbmwocHJlcHJvYyksIENUX1BQX0VMU0UpKQorICAgICAgICAgICAg
eworICAgICAgICAgICAgICAgZG8KKyAgICAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAg
ICAgIHByZXByb2MgPSBjaHVua19nZXRfcHJldl9uY25sbmkocHJlcHJvYyk7ICAgICAgLy8g
SXNzdWUgIzIyNzkKKworICAgICAgICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBy
ZXByb2MsIENUX1BQX0lGKSkKKyAgICAgICAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAg
ICAgICAgIHByZXByb2MgPSBjaHVua19nZXRfcHJldl9uY25sbmkocHJlcHJvYyk7ICAgLy8g
SXNzdWUgIzIyNzkKKworICAgICAgICAgICAgICAgICAgICAgaWYgKHByZXByb2MtPnBwX2xl
dmVsID09IHBwX2xldmVsKQorICAgICAgICAgICAgICAgICAgICAgeworICAgICAgICAgICAg
ICAgICAgICAgICAgcHJldiA9IGNodW5rX2dldF9wcmV2X25jbmxucChwcmVwcm9jKTsKKyAg
ICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgICAgICAgICAgfQor
ICAgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgICAgfSB3aGlsZSAocHJlcHJvYyAh
PSBudWxscHRyKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgIH0KKyAgICAgIH0KKworICAg
ICAgaWYgKCAgaXNhX2RlZgorICAgICAgICAgJiYgcHJldiAhPSBudWxscHRyCisgICAgICAg
ICAmJiAoICAoICBjaHVua19pc19wYXJlbl9jbG9zZShwcmV2KQorICAgICAgICAgICAgICAg
JiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHByZXYpICE9IENUX0RfQ0FTVAorICAgICAgICAg
ICAgICAgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKHByZXYpICE9IENUX01BQ1JPX09QRU4g
IC8vIElzc3VlICMyNzI2CisgICAgICAgICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5
cGUocHJldikgIT0gQ1RfTUFDUk9fQ0xPU0UpCisgICAgICAgICAgICB8fCBwcmV2LT50eXBl
ID09IENUX0FTU0lHTgorICAgICAgICAgICAgfHwgcHJldi0+dHlwZSA9PSBDVF9SRVRVUk4p
KQorICAgICAgeworICAgICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiAtLSBvdmVycmlk
aW5nIERFRiBkdWUgdG8gcHJldiBpcyAnJXMnLCB0eXBlIGlzICVzXG4iLAorICAgICAgICAg
ICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHByZXYtPnRleHQoKSwgZ2V0X3Rva2VuX25h
bWUocHJldi0+dHlwZSkpOworICAgICAgICAgaXNhX2RlZiA9IGZhbHNlOworICAgICAgfQor
CisgICAgICAvLyBGaXhlcyBpc3N1ZSAjMTI2NiwgaWRlbnRpZmljYXRpb24gb2YgYSB0dXBs
ZSByZXR1cm4gdHlwZSBpbiBDUy4KKyAgICAgIGlmICggICFpc2FfZGVmCisgICAgICAgICAm
JiBjaHVua19pc190b2tlbihwcmV2LCBDVF9QQVJFTl9DTE9TRSkKKyAgICAgICAgICYmIGNo
dW5rX2dldF9uZXh0X25jbmwocHJldikgPT0gcGMpCisgICAgICB7CisgICAgICAgICB0bXAg
PSBjaHVua19za2lwX3RvX21hdGNoX3JldihwcmV2KTsKKworICAgICAgICAgd2hpbGUgKCAg
dG1wICE9IG51bGxwdHIgICAgICAgICAgICAgICAgICAgICAvLyBJc3N1ZSAjMjMxNQorICAg
ICAgICAgICAgICAgJiYgdG1wICE9IHByZXYpCisgICAgICAgICB7CisgICAgICAgICAgICBp
ZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9DT01NQSkgJiYgdG1wLT5sZXZlbCA9PSBwcmV2
LT5sZXZlbCArIDEpCisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICBMT0dfRk1UKExG
Q04sICIlcyglZCk6IC0tIG92ZXJyaWRpbmcgY2FsbCBkdWUgdG8gdHVwbGUgcmV0dXJuIHR5
cGUgLS0gcHJldiBpcyAnJXMnLCB0eXBlIGlzICVzXG4iLAorICAgICAgICAgICAgICAgICAg
ICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHByZXYtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUo
cHJldi0+dHlwZSkpOworICAgICAgICAgICAgICAgaXNhX2RlZiA9IHRydWU7CisgICAgICAg
ICAgICAgICBicmVhazsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIHRtcCA9IGNodW5r
X2dldF9uZXh0X25jbmwodG1wKTsKKyAgICAgICAgIH0KKyAgICAgIH0KKworICAgICAgaWYg
KGlzYV9kZWYpCiAgICAgICB7Ci0gICAgICAgICBkZXRhaWwgPSAiIC0tICdfdCciOworICAg
ICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiBwYyBpcyAnJXMnLCBvcmlnX2xpbmUgaXMg
JXp1LCBvcmlnX2NvbCBpcyAlenUsIHR5cGUgaXMgJXNcbiIsCisgICAgICAgICAgICAgICAg
IF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPnRleHQoKSwgcGMtPm9yaWdfbGluZSwgcGMtPm9y
aWdfY29sLCBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSkpOworICAgICAgICAgTE9HX0ZNVChM
RkNOLCAiJXMoJWQpOiAoMTIpIFNFVCBUTyBDVF9GVU5DX0RFRjogb3JpZ19saW5lIGlzICV6
dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xuIiwKKyAgICAgICAgICAgICAgICAg
X19mdW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIHBjLT50
ZXh0KCkpOworICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX0ZVTkNfREVGKTsKKwor
ICAgICAgICAgaWYgKHByZXYgPT0gbnVsbHB0cikKKyAgICAgICAgIHsKKyAgICAgICAgICAg
IHByZXYgPSBjaHVua19nZXRfaGVhZCgpOworICAgICAgICAgfQorCisgICAgICAgICBmb3Ig
KCAgdG1wID0gcHJldjsgKHRtcCAhPSBudWxscHRyKQorICAgICAgICAgICAgICYmIHRtcCAh
PSBwYzsgdG1wID0gY2h1bmtfZ2V0X25leHRfbmNubG5wKHRtcCkpCisgICAgICAgICB7Cisg
ICAgICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6IHRleHQoKSBpcyAnJXMnLCB0eXBl
IGlzICVzXG4iLAorICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHRt
cC0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZSh0bXAtPnR5cGUpKTsKKyAgICAgICAgICAgIG1h
a2VfdHlwZSh0bXApOworICAgICAgICAgfQogICAgICAgfQotICAgICAgZWxzZSBpZiAoaXNf
dWNhc2Vfc3RyKGxhc3QtPnRleHQoKSwgbGFzdC0+bGVuKCkpKQorICAgfQorCisgICBpZiAo
cGMtPnR5cGUgIT0gQ1RfRlVOQ19ERUYpCisgICB7CisgICAgICBMT0dfRk1UKExGQ04sICIl
cyglZCk6ICBEZXRlY3RlZCB0eXBlICVzLCB0ZXh0KCkgaXMgJyVzJywgb24gb3JpZ19saW5l
ICV6dSwgb3JpZ19jb2wgJXp1XG4iLAorICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5F
X18sIGdldF90b2tlbl9uYW1lKHBjLT50eXBlKSwKKyAgICAgICAgICAgICAgcGMtPnRleHQo
KSwgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sKTsKKworICAgICAgdG1wID0gZmxhZ19w
YXJlbnMobmV4dCwgUENGX0lOX0ZDTl9DQUxMLCBDVF9GUEFSRU5fT1BFTiwgQ1RfRlVOQ19D
QUxMLCBmYWxzZSk7CisKKyAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfQlJB
Q0VfT1BFTikKKyAgICAgICAgICYmIGdldF9jaHVua19wYXJlbnRfdHlwZSh0bXApICE9IENU
X0RPVUJMRV9CUkFDRSkKICAgICAgIHsKLSAgICAgICAgIGRldGFpbCA9ICIgLS0gdXBwZXIg
Y2FzZSI7CisgICAgICAgICBzZXRfcGFyZW5fcGFyZW50KHRtcCwgcGMtPnR5cGUpOwogICAg
ICAgfQotICAgICAgZWxzZSBpZiAobGFuZ3VhZ2VfaXNfc2V0KExBTkdfT0MpICYmIGNodW5r
X2lzX3N0cihsYXN0LCAiaWQiLCAyKSkKKyAgICAgIHJldHVybjsKKyAgIH0KKyAgIC8qCisg
ICAgKiBXZSBoYXZlIGEgZnVuY3Rpb24gZGVmaW5pdGlvbiBvciBwcm90b3R5cGUKKyAgICAq
IExvb2sgZm9yIGEgc2VtaWNvbG9uIG9yIGEgYnJhY2Ugb3BlbiBhZnRlciB0aGUgY2xvc2Ug
cGFyZW50aGVzaXMgdG8gZmlndXJlCisgICAgKiBvdXQgd2hldGhlciB0aGlzIGlzIGEgcHJv
dG90eXBlIG9yIGRlZmluaXRpb24KKyAgICAqLworCisgICAvLyBTZWUgaWYgdGhpcyBpcyBh
IHByb3RvdHlwZSBvciBpbXBsZW1lbnRhdGlvbgorCisgICAvLyBGSVhNRTogdGhpcyBkb2Vz
bid0IHRha2UgdGhlIG9sZCBLJlIgcGFyYW1ldGVyIGRlZmluaXRpb25zIGludG8gYWNjb3Vu
dAorCisgICAvLyBTY2FuIHRva2VucyB1bnRpbCB3ZSBoaXQgYSBicmFjZSBvcGVuIChkZWYp
IG9yIHNlbWljb2xvbiAocHJvdG8pCisgICB0bXAgPSBwYXJlbl9jbG9zZTsKKworICAgd2hp
bGUgKCh0bXAgPSBjaHVua19nZXRfbmV4dF9uY25sKHRtcCkpICE9IG51bGxwdHIpCisgICB7
CisgICAgICAvLyBPbmx5IGNhcmUgYWJvdXQgYnJhY2Ugb3Igc2VtaWNvbG9uIG9uIHRoZSBz
YW1lIGxldmVsCisgICAgICBpZiAodG1wLT5sZXZlbCA8IHBjLT5sZXZlbCkKICAgICAgIHsK
LSAgICAgICAgIGRldGFpbCA9ICIgLS0gT2JqZWN0aXZlLUMgaWQiOworICAgICAgICAgLy8g
Tm8gc2VtaWNvbG9uIC0gZ3Vlc3MgdGhhdCBpdCBpcyBhIHByb3RvdHlwZQorICAgICAgICAg
Y2h1bmtfZmxhZ3NfY2xyKHBjLCBQQ0ZfVkFSXzFTVF9ERUYpOworICAgICAgICAgc2V0X2No
dW5rX3R5cGUocGMsIENUX0ZVTkNfUFJPVE8pOworICAgICAgICAgYnJlYWs7CiAgICAgICB9
Ci0gICAgICBlbHNlCisgICAgICBlbHNlIGlmICh0bXAtPmxldmVsID09IHBjLT5sZXZlbCkK
ICAgICAgIHsKLSAgICAgICAgIC8vIElmIHdlIGNhbid0IHRlbGwgZm9yIHN1cmUgd2hldGhl
ciB0aGlzIGlzIGEgY2FzdCwgZGVjaWRlIGFnYWluc3QgaXQKLSAgICAgICAgIGRldGFpbCAg
ICAgICAgPSAiIC0tIG1peGVkIGNhc2UiOwotICAgICAgICAgZG91YnRmdWxfY2FzdCA9IHRy
dWU7CisgICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4odG1wLCBDVF9CUkFDRV9PUEVOKSkK
KyAgICAgICAgIHsKKyAgICAgICAgICAgIC8vIGl0cyBhIGZ1bmN0aW9uIGRlZiBmb3Igc3Vy
ZQorICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICB9CisgICAgICAgICBlbHNlIGlmIChj
aHVua19pc19zZW1pY29sb24odG1wKSkKKyAgICAgICAgIHsKKyAgICAgICAgICAgIC8vIFNl
dCB0aGUgcGFyZW50IGZvciB0aGUgc2VtaWNvbG9uIGZvciBsYXRlcgorICAgICAgICAgICAg
c2VtaSA9IHRtcDsKKyAgICAgICAgICAgIGNodW5rX2ZsYWdzX2NscihwYywgUENGX1ZBUl8x
U1RfREVGKTsKKyAgICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DX1BST1RP
KTsKKyAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogICAyKSBNYXJrZWQgdGV4
dCgpIGlzICclcycsIGFzIEZVTkNfUFJPVE8gb24gb3JpZ19saW5lICV6dSwgb3JpZ19jb2wg
JXp1XG4iLAorICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50
ZXh0KCksIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCk7CisgICAgICAgICAgICBicmVh
azsKKyAgICAgICAgIH0KKyAgICAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9DT01NQSkpCisgICAgICAgICB7CisgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywg
Q1RfRlVOQ19DVE9SX1ZBUik7CisgICAgICAgICAgICBMT0dfRk1UKExGQ04sICIlcyglZCk6
ICAgMikgTWFya2VkIHRleHQoKSBpcyAnJXMnLCBhcyBGVU5DX0NUT1JfVkFSIG9uIG9yaWdf
bGluZSAlenUsIG9yaWdfY29sICV6dVxuIiwKKyAgICAgICAgICAgICAgICAgICAgX19mdW5j
X18sIF9fTElORV9fLCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wp
OworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICB9CiAgICAgICB9CisgICB9CisKKyAg
IC8qCisgICAgKiBDKysgc3ludGF4IGlzIHdhY2t5LiBXZSBuZWVkIHRvIGNoZWNrIHRvIHNl
ZSBpZiBhIHByb3RvdHlwZSBpcyByZWFsbHkgYQorICAgICogdmFyaWFibGUgZGVmaW5pdGlv
biB3aXRoIHBhcmFtZXRlcnMgcGFzc2VkIGludG8gdGhlIGNvbnN0cnVjdG9yLgorICAgICog
VW5mb3J0dW5hdGVseSwgd2l0aG91dCBiZWluZyBhYmxlIHRvIGFjY3VyYXRlbHkgZGV0ZXJt
aW5lIGlmIGFuCisgICAgKiBpZGVudGlmaWVyIGlzIGEgdHlwZSAod2hpY2ggd291bGQgcmVx
dWlyZSB1cyB0byBtb3JlIG9yIGxlc3MgYmUgYSBmdWxsCisgICAgKiBjb21waWxlciksIHRo
ZSBvbmx5IG1vc3RseSByZWxpYWJsZSB3YXkgdG8gZG8gc28gaXMgdG8gZ3Vlc3MgdGhhdCBp
dCBpcworICAgICogYSBjb25zdHJ1Y3RvciB2YXJpYWJsZSBpZiBpbnNpZGUgYSBmdW5jdGlv
biBib2R5IGFuZCBzY2FuIHRoZSAncGFyYW1ldGVyCisgICAgKiBsaXN0JyBmb3IgaXRlbXMg
dGhhdCBhcmUgbm90IGFsbG93ZWQgaW4gYSBwcm90b3R5cGUuIFdlIHNlYXJjaCBiYWNrd2Fy
ZHMKKyAgICAqIGFuZCBjaGVja2luZyB0aGUgcGFyZW50IG9mIHRoZSBjb250YWluaW5nIG9w
ZW4gYnJhY2VzLiBJZiB0aGUgcGFyZW50IGlzIGEKKyAgICAqIGNsYXNzIG9yIG5hbWVzcGFj
ZSwgdGhlbiBpdCBwcm9iYWJseSBpcyBhIHByb3RvdHlwZS4KKyAgICAqLworICAgaWYgKCAg
bGFuZ3VhZ2VfaXNfc2V0KExBTkdfQ1BQKQorICAgICAgJiYgY2h1bmtfaXNfdG9rZW4ocGMs
IENUX0ZVTkNfUFJPVE8pCisgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpICE9
IENUX09QRVJBVE9SKQorICAgeworICAgICAgTE9HX0ZNVChMRlBBUkFNLCAiJXMoJWQpOiIs
IF9fZnVuY19fLCBfX0xJTkVfXyk7CisgICAgICBMT0dfRk1UKExGUEFSQU0sICIgIGNoZWNr
aW5nICclcycgZm9yIGNvbnN0cnVjdG9yIHZhcmlhYmxlICVzICVzXG4iLAorICAgICAgICAg
ICAgICBwYy0+dGV4dCgpLAorICAgICAgICAgICAgICBnZXRfdG9rZW5fbmFtZShwYXJlbl9v
cGVuLT50eXBlKSwKKyAgICAgICAgICAgICAgZ2V0X3Rva2VuX25hbWUocGFyZW5fY2xvc2Ut
PnR5cGUpKTsKKwogICAgICAgLyoKLSAgICAgICAqIElmIHRoZSBuZXh0IGl0ZW0gaXMgYSAq
IG9yICYsIHRoZSBuZXh0IGl0ZW0gYWZ0ZXIgdGhhdCBjYW4ndCBiZSBhCi0gICAgICAgKiBu
dW1iZXIgb3Igc3RyaW5nLgotICAgICAgICoKLSAgICAgICAqIElmIHRoZSBuZXh0IGl0ZW0g
aXMgYSArLCB0aGUgbmV4dCBpdGVtIGhhcyB0byBiZSBhIG51bWJlci4KLSAgICAgICAqCi0g
ICAgICAgKiBJZiB0aGUgbmV4dCBpdGVtIGlzIGEgLSwgdGhlIG5leHQgaXRlbSBjYW4ndCBi
ZSBhIHN0cmluZy4KLSAgICAgICAqCi0gICAgICAgKiBGb3IgdGhpcyB0byBiZSBhIGNhc3Qs
IHRoZSBjbG9zZSBwYXJlbiBtdXN0IGJlIGZvbGxvd2VkIGJ5OgotICAgICAgICogIC0gY29u
c3RhbnQgKG51bWJlciBvciBzdHJpbmcpCi0gICAgICAgKiAgLSBwYXJlbiBvcGVuCi0gICAg
ICAgKiAgLSB3b3JkCi0gICAgICAgKgotICAgICAgICogRmluZCB0aGUgbmV4dCBub24tb3Bl
biBwYXJlbiBpdGVtLgorICAgICAgICogQ2hlY2sgdGhlIHRva2VuIGF0IHRoZSBzdGFydCBv
ZiB0aGUgc3RhdGVtZW50LiBJZiBpdCdzICdleHRlcm4nLCB3ZQorICAgICAgICogZGVmaW5p
dGVseSBoYXZlIGEgZnVuY3Rpb24gcHJvdG90eXBlLgogICAgICAgICovCi0gICAgICBwYyAg
ICA9IGNodW5rX2dldF9uZXh0X25jbmwocGFyZW5fY2xvc2UpOwotICAgICAgYWZ0ZXIgPSBw
YzsKLQotICAgICAgZG8KLSAgICAgIHsKLSAgICAgICAgIGFmdGVyID0gY2h1bmtfZ2V0X25l
eHRfbmNubChhZnRlcik7Ci0gICAgICB9IHdoaWxlIChjaHVua19pc190b2tlbihhZnRlciwg
Q1RfUEFSRU5fT1BFTikpOworICAgICAgdG1wID0gcGM7CiAKLSAgICAgIGlmIChhZnRlciA9
PSBudWxscHRyKQorICAgICAgd2hpbGUgKCAgdG1wICE9IG51bGxwdHIKKyAgICAgICAgICAg
ICYmICF0bXAtPmZsYWdzLnRlc3QoUENGX1NUTVRfU1RBUlQpKQogICAgICAgewotICAgICAg
ICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6ICAtLSBub3QgYSBjYXN0IC0gaGl0IE5VTExc
biIsCi0gICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXyk7Ci0gICAgICAgICBy
ZXR1cm47CisgICAgICAgICB0bXAgPSBjaHVua19nZXRfcHJldl9uY25sbmkodG1wKTsgICAv
LyBJc3N1ZSAjMjI3OQogICAgICAgfQotICAgICAgbm9wZSA9IGZhbHNlOworICAgICAgY29u
c3QgYm9vbCBpc19leHRlcm4gPSAodG1wICYmIHRtcC0+c3RyLmVxdWFscygiZXh0ZXJuIikp
OwogCi0gICAgICBpZiAoY2h1bmtfaXNfcHRyX29wZXJhdG9yKHBjKSkKKyAgICAgIC8qCisg
ICAgICAgKiBTY2FuIHRoZSBwYXJhbWV0ZXJzIGxvb2tpbmcgZm9yOgorICAgICAgICogIC0g
Y29uc3RhbnQgc3RyaW5ncworICAgICAgICogIC0gbnVtYmVycworICAgICAgICogIC0gbm9u
LXR5cGUgZmllbGRzCisgICAgICAgKiAgLSBmdW5jdGlvbiBjYWxscworICAgICAgICovCisg
ICAgICBjaHVua190ICpyZWYgPSBjaHVua19nZXRfbmV4dF9uY25sKHBhcmVuX29wZW4pOwor
ICAgICAgY2h1bmtfdCAqdG1wMjsKKyAgICAgIGJvb2wgICAgaXNfcGFyYW0gPSB0cnVlOwor
ICAgICAgdG1wID0gcmVmOworCisgICAgICB3aGlsZSAodG1wICE9IHBhcmVuX2Nsb3NlKQog
ICAgICAgewotICAgICAgICAgLy8gc3RhciAoKikgYW5kIGFkZHJlc3MgKCYpIGFyZSBhbWJp
Z3VvdXMKLSAgICAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKGFmdGVyLCBDVF9OVU1CRVJf
RlApCi0gICAgICAgICAgICB8fCBjaHVua19pc190b2tlbihhZnRlciwgQ1RfTlVNQkVSKQot
ICAgICAgICAgICAgfHwgY2h1bmtfaXNfdG9rZW4oYWZ0ZXIsIENUX1NUUklORykKLSAgICAg
ICAgICAgIHx8IGRvdWJ0ZnVsX2Nhc3QpCisgICAgICAgICB0bXAyID0gY2h1bmtfZ2V0X25l
eHRfbmNubCh0bXApOworCisgICAgICAgICBpZiAoICBjaHVua19pc190b2tlbih0bXAsIENU
X0NPTU1BKQorICAgICAgICAgICAgJiYgKHRtcC0+bGV2ZWwgPT0gKHBhcmVuX29wZW4tPmxl
dmVsICsgMSkpKQogICAgICAgICAgewotICAgICAgICAgICAgbm9wZSA9IHRydWU7CisgICAg
ICAgICAgICBpZiAoIWNhbl9iZV9mdWxsX3BhcmFtKHJlZiwgdG1wKSkKKyAgICAgICAgICAg
IHsKKyAgICAgICAgICAgICAgIGlzX3BhcmFtID0gZmFsc2U7CisgICAgICAgICAgICAgICBi
cmVhazsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIHJlZiA9IHRtcDI7CiAgICAgICAg
ICB9CisgICAgICAgICB0bXAgPSB0bXAyOwogICAgICAgfQotICAgICAgZWxzZSBpZiAoY2h1
bmtfaXNfdG9rZW4ocGMsIENUX01JTlVTKSkKKworICAgICAgaWYgKCAgIWlzX2V4dGVybgor
ICAgICAgICAgJiYgaXNfcGFyYW0gJiYgcmVmICE9IHRtcCkKICAgICAgIHsKLSAgICAgICAg
IC8vIChVSU5UOCktMSBvciAoZm9vKS0xIG9yIChGT08pLSdhJwotICAgICAgICAgaWYgKGNo
dW5rX2lzX3Rva2VuKGFmdGVyLCBDVF9TVFJJTkcpIHx8IGRvdWJ0ZnVsX2Nhc3QpCisgICAg
ICAgICBpZiAoIWNhbl9iZV9mdWxsX3BhcmFtKHJlZiwgdG1wKSkKICAgICAgICAgIHsKLSAg
ICAgICAgICAgIG5vcGUgPSB0cnVlOworICAgICAgICAgICAgaXNfcGFyYW0gPSBmYWxzZTsK
ICAgICAgICAgIH0KICAgICAgIH0KLSAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKHBj
LCBDVF9QTFVTKSkKKworICAgICAgaWYgKCAgIWlzX2V4dGVybgorICAgICAgICAgJiYgIWlz
X3BhcmFtKQogICAgICAgewotICAgICAgICAgLy8gKFVJTlQ4KSsxIG9yIChmb28pKzEKLSAg
ICAgICAgIGlmICggIChhZnRlci0+dHlwZSAhPSBDVF9OVU1CRVIgJiYgYWZ0ZXItPnR5cGUg
IT0gQ1RfTlVNQkVSX0ZQKQotICAgICAgICAgICAgfHwgZG91YnRmdWxfY2FzdCkKLSAgICAg
ICAgIHsKLSAgICAgICAgICAgIG5vcGUgPSB0cnVlOwotICAgICAgICAgfQorICAgICAgICAg
c2V0X2NodW5rX3R5cGUocGMsIENUX0ZVTkNfQ1RPUl9WQVIpOworICAgICAgICAgTE9HX0ZN
VChMRkNOLCAiJXMoJWQpOiAgIDMpIE1hcmtlZCB0ZXh0KCkgJyVzJyBhcyBGVU5DX0NUT1Jf
VkFSIG9uIG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dVxuIiwKKyAgICAgICAgICAgICAg
ICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5lLCBwYy0+
b3JpZ19jb2wpOwogICAgICAgfQotICAgICAgZWxzZSBpZiAoICBwYy0+dHlwZSAhPSBDVF9O
VU1CRVJfRlAKLSAgICAgICAgICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfTlVNQkVSCi0gICAg
ICAgICAgICAgICYmIHBjLT50eXBlICE9IENUX1dPUkQKLSAgICAgICAgICAgICAgJiYgcGMt
PnR5cGUgIT0gQ1RfVEhJUwotICAgICAgICAgICAgICAmJiBwYy0+dHlwZSAhPSBDVF9UWVBF
Ci0gICAgICAgICAgICAgICYmIHBjLT50eXBlICE9IENUX1BBUkVOX09QRU4KLSAgICAgICAg
ICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfU1RSSU5HCi0gICAgICAgICAgICAgICYmIHBjLT50
eXBlICE9IENUX0RFQ0xUWVBFCi0gICAgICAgICAgICAgICYmIHBjLT50eXBlICE9IENUX1NJ
WkVPRgotICAgICAgICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocGMpICE9IENU
X1NJWkVPRgotICAgICAgICAgICAgICAmJiBwYy0+dHlwZSAhPSBDVF9GVU5DX0NBTEwKLSAg
ICAgICAgICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfRlVOQ19DQUxMX1VTRVIKLSAgICAgICAg
ICAgICAgJiYgcGMtPnR5cGUgIT0gQ1RfRlVOQ1RJT04KLSAgICAgICAgICAgICAgJiYgcGMt
PnR5cGUgIT0gQ1RfQlJBQ0VfT1BFTgotICAgICAgICAgICAgICAmJiAoISggIGNodW5rX2lz
X3Rva2VuKHBjLCBDVF9TUVVBUkVfT1BFTikKLSAgICAgICAgICAgICAgICAgICAmJiBsYW5n
dWFnZV9pc19zZXQoTEFOR19PQykpKSkKKyAgICAgIGVsc2UgaWYgKHBjLT5icmFjZV9sZXZl
bCA+IDApCiAgICAgICB7Ci0gICAgICAgICBMT0dfRk1UKExDQVNUUywgIiVzKCVkKTogIC0t
IG5vdCBhIGNhc3QgLSBmb2xsb3dlZCBieSB0ZXh0KCkgJyVzJywgdHlwZSBpcyAlc1xuIiwK
LSAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+dGV4dCgpLCBnZXRf
dG9rZW5fbmFtZShwYy0+dHlwZSkpOwotICAgICAgICAgcmV0dXJuOwotICAgICAgfQorICAg
ICAgICAgY2h1bmtfdCAqYnJfb3BlbiA9IGNodW5rX2dldF9wcmV2X3R5cGUocGMsIENUX0JS
QUNFX09QRU4sIHBjLT5icmFjZV9sZXZlbCAtIDEpOwogCi0gICAgICBpZiAobm9wZSkKLSAg
ICAgIHsKLSAgICAgICAgIExPR19GTVQoTENBU1RTLCAiJXMoJWQpOiAgLS0gbm90IGEgY2Fz
dCAtIHRleHQoKSAnJXMnIGZvbGxvd2VkIGJ5IHR5cGUgJXNcbiIsCi0gICAgICAgICAgICAg
ICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPnRleHQoKSwgZ2V0X3Rva2VuX25hbWUoYWZ0
ZXItPnR5cGUpKTsKLSAgICAgICAgIHJldHVybjsKKyAgICAgICAgIGlmICggIGJyX29wZW4g
IT0gbnVsbHB0cgorICAgICAgICAgICAgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBlKGJyX29w
ZW4pICE9IENUX0VYVEVSTgorICAgICAgICAgICAgJiYgZ2V0X2NodW5rX3BhcmVudF90eXBl
KGJyX29wZW4pICE9IENUX05BTUVTUEFDRSkKKyAgICAgICAgIHsKKyAgICAgICAgICAgIC8v
IERvIGEgY2hlY2sgdG8gc2VlIGlmIHRoZSBsZXZlbCBpcyByaWdodAorICAgICAgICAgICAg
cHJldiA9IGNodW5rX2dldF9wcmV2X25jbmxuaShwYyk7ICAgLy8gSXNzdWUgIzIyNzkKKwor
ICAgICAgICAgICAgaWYgKCAgIWNodW5rX2lzX3N0cihwcmV2LCAiKiIsIDEpCisgICAgICAg
ICAgICAgICAmJiAhY2h1bmtfaXNfc3RyKHByZXYsICImIiwgMSkpCisgICAgICAgICAgICB7
CisgICAgICAgICAgICAgICBjaHVua190ICpwX29wID0gY2h1bmtfZ2V0X3ByZXZfdHlwZShw
YywgQ1RfQlJBQ0VfT1BFTiwgcGMtPmJyYWNlX2xldmVsIC0gMSk7CisKKyAgICAgICAgICAg
ICAgIGlmICggIHBfb3AgIT0gbnVsbHB0cgorICAgICAgICAgICAgICAgICAgJiYgZ2V0X2No
dW5rX3BhcmVudF90eXBlKHBfb3ApICE9IENUX0NMQVNTCisgICAgICAgICAgICAgICAgICAm
JiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocF9vcCkgIT0gQ1RfU1RSVUNUCisgICAgICAgICAg
ICAgICAgICAmJiBnZXRfY2h1bmtfcGFyZW50X3R5cGUocF9vcCkgIT0gQ1RfTkFNRVNQQUNF
KQorICAgICAgICAgICAgICAgeworICAgICAgICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUo
cGMsIENUX0ZVTkNfQ1RPUl9WQVIpOworICAgICAgICAgICAgICAgICAgTE9HX0ZNVChMRkNO
LCAiJXMoJWQpOiAgIDQpIE1hcmtlZCB0ZXh0KCkgaXMnJXMnLCBhcyBGVU5DX0NUT1JfVkFS
IG9uIG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dVxuIiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5l
LCBwYy0+b3JpZ19jb2wpOworICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgfQorICAg
ICAgICAgfQogICAgICAgfQogICAgfQotICAgLy8gaWYgdGhlICdjYXN0JyBpcyBmb2xsb3dl
ZCBieSBhIHNlbWljb2xvbiwgY29tbWEsIGJvb2wgb3IgY2xvc2UgcGFyZW50aGVzaXMsIGl0
IGlzbid0Ci0gICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGFyZW5fY2xvc2UpOwogCi0g
ICBpZiAocGMgPT0gbnVsbHB0cikKKyAgIGlmIChzZW1pICE9IG51bGxwdHIpCiAgICB7Ci0g
ICAgICByZXR1cm47CisgICAgICBzZXRfY2h1bmtfcGFyZW50KHNlbWksIHBjLT50eXBlKTsK
ICAgIH0KIAotICAgaWYgKCAgY2h1bmtfaXNfc2VtaWNvbG9uKHBjKQotICAgICAgfHwgY2h1
bmtfaXNfdG9rZW4ocGMsIENUX0NPTU1BKQotICAgICAgfHwgY2h1bmtfaXNfdG9rZW4ocGMs
IENUX0JPT0wpICAgICAgICAgICAgICAgLy8gSXNzdWUgIzIxNTEKLSAgICAgIHx8IGNodW5r
X2lzX3BhcmVuX2Nsb3NlKHBjKSkKKyAgIC8vIElzc3VlICMgMTQwMywgMjE1MgorICAgaWYg
KGNodW5rX2lzX3Rva2VuKHBhcmVuX29wZW4tPnByZXYsIENUX0ZVTkNfQ1RPUl9WQVIpKQog
ICAgewotICAgICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6ICAtLSBub3QgYSBjYXN0IC0g
Zm9sbG93ZWQgYnkgdHlwZSAlc1xuIiwKLSAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElO
RV9fLCBnZXRfdG9rZW5fbmFtZShwYy0+dHlwZSkpOwotICAgICAgcmV0dXJuOworICAgICAg
ZmxhZ19wYXJlbnMocGFyZW5fb3BlbiwgUENGX0lOX0ZDTl9DVE9SLCBDVF9GUEFSRU5fT1BF
TiwgcGMtPnR5cGUsIGZhbHNlKTsKICAgIH0KLSAgIHNldF9jaHVua19wYXJlbnQoc3RhcnQs
IENUX0NfQ0FTVCk7Ci0gICBzZXRfY2h1bmtfcGFyZW50KHBhcmVuX2Nsb3NlLCBDVF9DX0NB
U1QpOwotCi0gICBMT0dfRk1UKExDQVNUUywgIiVzKCVkKTogIC0tICVzIGMtY2FzdDogKCIs
Ci0gICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgdmVyYik7Ci0KLSAgIGZvciAocGMg
PSBmaXJzdDsKLSAgICAgICAgcGMgIT0gbnVsbHB0ciAmJiBwYyAhPSBwYXJlbl9jbG9zZTsK
LSAgICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKSkKKyAgIGVsc2UKICAgIHsK
LSAgICAgIHNldF9jaHVua19wYXJlbnQocGMsIENUX0NfQ0FTVCk7Ci0gICAgICBtYWtlX3R5
cGUocGMpOwotICAgICAgTE9HX0ZNVChMQ0FTVFMsICIgJXMiLCBwYy0+dGV4dCgpKTsKKyAg
ICAgIGZsYWdfcGFyZW5zKHBhcmVuX29wZW4sIFBDRl9JTl9GQ05fREVGLCBDVF9GUEFSRU5f
T1BFTiwgcGMtPnR5cGUsIGZhbHNlKTsKICAgIH0KKyAgIC8vZmxhZ19wYXJlbnMocGFyZW5f
b3BlbiwgUENGX0lOX0ZDTl9ERUYsIENUX0ZQQVJFTl9PUEVOLCBwYy0+dHlwZSwgdHJ1ZSk7
CiAKLSAgIExPR19GTVQoTENBU1RTLCAiICklc1xuIiwgZGV0YWlsKTsKLQotICAgLy8gTWFy
ayB0aGUgbmV4dCBpdGVtIGFzIGFuIGV4cHJlc3Npb24gc3RhcnQKLSAgIHBjID0gY2h1bmtf
Z2V0X25leHRfbmNubChwYXJlbl9jbG9zZSk7CisgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMs
IENUX0ZVTkNfQ1RPUl9WQVIpKQorICAgeworICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHBjLCBQ
Q0ZfVkFSXzFTVF9ERUYpOworICAgICAgcmV0dXJuOworICAgfQogCi0gICBpZiAocGMgIT0g
bnVsbHB0cikKKyAgIGlmIChjaHVua19pc190b2tlbihuZXh0LCBDVF9UU1FVQVJFKSkKICAg
IHsKLSAgICAgIGNodW5rX2ZsYWdzX3NldChwYywgUENGX0VYUFJfU1RBUlQpOworICAgICAg
bmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwobmV4dCk7CiAKLSAgICAgIGlmIChjaHVua19p
c19vcGVuaW5nX2JyYWNlKHBjKSkKKyAgICAgIGlmIChuZXh0ID09IG51bGxwdHIpCiAgICAg
ICB7Ci0gICAgICAgICBzZXRfcGFyZW5fcGFyZW50KHBjLCBnZXRfY2h1bmtfcGFyZW50X3R5
cGUoc3RhcnQpKTsKKyAgICAgICAgIHJldHVybjsKICAgICAgIH0KICAgIH0KLX0gLy8gZml4
X2Nhc3RzCisgICAvLyBNYXJrIHBhcmFtZXRlcnMgYW5kIHJldHVybiB0eXBlCisgICBmaXhf
ZmNuX2RlZl9wYXJhbXMobmV4dCk7CisgICBtYXJrX2Z1bmN0aW9uX3JldHVybl90eXBlKHBj
LCBjaHVua19nZXRfcHJldl9uY25sbmkocGMpLCBwYy0+dHlwZSk7ICAgLy8gSXNzdWUgIzIy
NzkKIAorICAgLyogbWFyayBDIyB3aGVyZSBjaHVuayAqLworICAgaWYgKCAgbGFuZ3VhZ2Vf
aXNfc2V0KExBTkdfQ1MpCisgICAgICAmJiAoICAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0ZV
TkNfREVGKSkKKyAgICAgICAgIHx8IChjaHVua19pc190b2tlbihwYywgQ1RfRlVOQ19QUk9U
TykpKSkKKyAgIHsKKyAgICAgIHRtcCA9IGNodW5rX2dldF9uZXh0X25jbmwocGFyZW5fY2xv
c2UpOworICAgICAgcGNmX2ZsYWdzX3QgaW5fd2hlcmVfc3BlY19mbGFncyA9IFBDRl9OT05F
OwogCi1zdGF0aWMgdm9pZCBmaXhfdHlwZV9jYXN0KGNodW5rX3QgKnN0YXJ0KQotewotICAg
TE9HX0ZVTkNfRU5UUlkoKTsKLSAgIGNodW5rX3QgKnBjOwotCi0gICBwYyA9IGNodW5rX2dl
dF9uZXh0X25jbmwoc3RhcnQpOworICAgICAgd2hpbGUgKCAgKHRtcCAhPSBudWxscHRyKQor
ICAgICAgICAgICAgJiYgKHRtcC0+dHlwZSAhPSBDVF9CUkFDRV9PUEVOKQorICAgICAgICAg
ICAgJiYgKHRtcC0+dHlwZSAhPSBDVF9TRU1JQ09MT04pKQorICAgICAgeworICAgICAgICAg
bWFya193aGVyZV9jaHVuayh0bXAsIHBjLT50eXBlLCB0bXAtPmZsYWdzIHwgaW5fd2hlcmVf
c3BlY19mbGFncyk7CisgICAgICAgICBpbl93aGVyZV9zcGVjX2ZsYWdzID0gdG1wLT5mbGFn
cyAmIFBDRl9JTl9XSEVSRV9TUEVDOwogCi0gICBpZiAocGMgPT0gbnVsbHB0ciB8fCBwYy0+
dHlwZSAhPSBDVF9BTkdMRV9PUEVOKQotICAgewotICAgICAgcmV0dXJuOworICAgICAgICAg
dG1wID0gY2h1bmtfZ2V0X25leHRfbmNubCh0bXApOworICAgICAgfQogICAgfQogCi0gICB3
aGlsZSAoICAoKHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChwYykpICE9IG51bGxwdHIpCi0g
ICAgICAgICAmJiBwYy0+bGV2ZWwgPj0gc3RhcnQtPmxldmVsKQorICAgLy8gRmluZCB0aGUg
YnJhY2UgcGFpciBhbmQgc2V0IHRoZSBwYXJlbnQKKyAgIGlmIChjaHVua19pc190b2tlbihw
YywgQ1RfRlVOQ19ERUYpKQogICAgewotICAgICAgaWYgKHBjLT5sZXZlbCA9PSBzdGFydC0+
bGV2ZWwgJiYgY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FOR0xFX0NMT1NFKSkKKyAgICAgIHRt
cCA9IGNodW5rX2dldF9uZXh0X25jbmwocGFyZW5fY2xvc2UpOworCisgICAgICB3aGlsZSAo
ICB0bXAgIT0gbnVsbHB0cgorICAgICAgICAgICAgJiYgdG1wLT50eXBlICE9IENUX0JSQUNF
X09QRU4pCiAgICAgICB7Ci0gICAgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGMp
OworICAgICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiAoMTMpIFNFVCBUTyBDVF9GVU5D
X0RFRjogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0ZXh0KCkgJyVzJ1xu
IiwKKyAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0bXAtPm9yaWdfbGlu
ZSwgdG1wLT5vcmlnX2NvbCwgdG1wLT50ZXh0KCkpOworICAgICAgICAgc2V0X2NodW5rX3Bh
cmVudCh0bXAsIENUX0ZVTkNfREVGKTsKIAotICAgICAgICAgaWYgKHBjID09IG51bGxwdHIp
CisgICAgICAgICBpZiAoIWNodW5rX2lzX3NlbWljb2xvbih0bXApKQogICAgICAgICAgewot
ICAgICAgICAgICAgcmV0dXJuOworICAgICAgICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHRtcCwg
UENGX09MRF9GQ05fUEFSQU1TKTsKICAgICAgICAgIH0KKyAgICAgICAgIHRtcCA9IGNodW5r
X2dldF9uZXh0X25jbmwodG1wKTsKKyAgICAgIH0KIAotICAgICAgICAgaWYgKGNodW5rX2lz
X3N0cihwYywgIigiLCAxKSkKKyAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX0JS
QUNFX09QRU4pKQorICAgICAgeworICAgICAgICAgTE9HX0ZNVChMRkNOLCAiJXMoJWQpOiAo
MTQpIFNFVCBUTyBDVF9GVU5DX0RFRjogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMg
JXp1LCB0ZXh0KCkgJyVzJ1xuIiwKKyAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElO
RV9fLCB0bXAtPm9yaWdfbGluZSwgdG1wLT5vcmlnX2NvbCwgdG1wLT50ZXh0KCkpOworICAg
ICAgICAgc2V0X2NodW5rX3BhcmVudCh0bXAsIENUX0ZVTkNfREVGKTsKKyAgICAgICAgIHRt
cCA9IGNodW5rX3NraXBfdG9fbWF0Y2godG1wKTsKKworICAgICAgICAgaWYgKHRtcCAhPSBu
dWxscHRyKQogICAgICAgICAgewotICAgICAgICAgICAgc2V0X3BhcmVuX3BhcmVudChwYywg
Q1RfVFlQRV9DQVNUKTsKKyAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogKDE1
KSBTRVQgVE8gQ1RfRlVOQ19ERUY6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6
dSwgdGV4dCgpICclcydcbiIsCisgICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJ
TkVfXywgdG1wLT5vcmlnX2xpbmUsIHRtcC0+b3JpZ19jb2wsIHRtcC0+dGV4dCgpKTsKKyAg
ICAgICAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBDVF9GVU5DX0RFRik7CiAgICAgICAg
ICB9Ci0gICAgICAgICByZXR1cm47CiAgICAgICB9Ci0gICAgICBtYWtlX3R5cGUocGMpOwog
ICAgfQotfQorfSAvLyBtYXJrX2Z1bmN0aW9uCiAKIAotc3RhdGljIHZvaWQgZml4X2VudW1f
c3RydWN0X3VuaW9uKGNodW5rX3QgKnBjKQorc3RhdGljIHZvaWQgbWFya19jcHBfY29uc3Ry
dWN0b3IoY2h1bmtfdCAqcGMpCiB7CiAgICBMT0dfRlVOQ19FTlRSWSgpOwotICAgY2h1bmtf
dCAgICAgKm5leHQ7Ci0gICBjaHVua190ICAgICAqcHJldiAgICAgICAgPSBudWxscHRyOwot
ICAgcGNmX2ZsYWdzX3QgZmxhZ3MgICAgICAgID0gUENGX1ZBUl8xU1RfREVGOwotICAgYXV0
byBjb25zdCAgaW5fZmNuX3BhcmVuID0gcGMtPmZsYWdzICYgUENGX0lOX0ZDTl9ERUY7Cisg
ICBjaHVua190ICpwYXJlbl9vcGVuOworICAgY2h1bmtfdCAqdG1wOworICAgY2h1bmtfdCAq
YWZ0ZXI7CisgICBjaHVua190ICp2YXI7CisgICBib29sICAgIGlzX2Rlc3RyID0gZmFsc2U7
CiAKLSAgIC8vIE1ha2Ugc3VyZSB0aGlzIHdhc24ndCBhIGNhc3QKLSAgIGlmIChnZXRfY2h1
bmtfcGFyZW50X3R5cGUocGMpID09IENUX0NfQ0FTVCkKLSAgIHsKLSAgICAgIHJldHVybjsK
LSAgIH0KLSAgIC8vIHRoZSBuZXh0IGl0ZW0gaXMgZWl0aGVyIGEgdHlwZSBvciBvcGVuIGJy
YWNlCi0gICBuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubChwYyk7CisgICB0bXAgPSBjaHVu
a19nZXRfcHJldl9uY25sbmkocGMpOyAgIC8vIElzc3VlICMyMjc5CiAKLSAgIC8vIHRoZSBl
bnVtLWtleSBtaWdodCBiZSBlbnVtLCBlbnVtIGNsYXNzIG9yIGVudW0gc3RydWN0IChUT0RP
KQotICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0VOVU1fQ0xBU1MpKQorICAgaWYg
KGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfSU5WKSB8fCBjaHVua19pc190b2tlbih0bXAsIENU
X0RFU1RSVUNUT1IpKQogICAgewotICAgICAgbmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwo
bmV4dCk7IC8vIGdldCB0aGUgbmV4dCBvbmUKKyAgICAgIHNldF9jaHVua190eXBlKHRtcCwg
Q1RfREVTVFJVQ1RPUik7CisgICAgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBDVF9ERVNUUlVD
VE9SKTsKKyAgICAgIGlzX2Rlc3RyID0gdHJ1ZTsKICAgIH0KKyAgIExPR19GTVQoTEZUT1Is
ICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgRk9VTkQgJXNT
VFJVQ1RPUiBmb3IgJyVzJ1slc10gcHJldiAnJXMnWyVzXVxuIiwKKyAgICAgICAgICAgX19m
dW5jX18sIF9fTElORV9fLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsCisgICAgICAg
ICAgIGlzX2Rlc3RyID8gIkRFIiA6ICJDT04iLAorICAgICAgICAgICBwYy0+dGV4dCgpLCBn
ZXRfdG9rZW5fbmFtZShwYy0+dHlwZSksCisgICAgICAgICAgIHRtcC0+dGV4dCgpLCBnZXRf
dG9rZW5fbmFtZSh0bXAtPnR5cGUpKTsKIAotICAgaWYgKGxhbmd1YWdlX2lzX3NldChMQU5H
X0NQUCkpCi0gICB7Ci0gICAgICBuZXh0ID0gc2tpcF9hdHRyaWJ1dGVfbmV4dChuZXh0KTsg
Ly8gZ2V0IHRoZSBuZXh0IG9uZQotICAgfQorICAgcGFyZW5fb3BlbiA9IHNraXBfdGVtcGxh
dGVfbmV4dChjaHVua19nZXRfbmV4dF9uY25sKHBjKSk7CiAKLSAgIC8vIHRoZSBuZXh0IGl0
ZW0gaXMgZWl0aGVyIGEgdHlwZSwgYW4gYXR0cmlidXRlIChUT0RPKSwgYW4gaWRlbnRpZmll
ciwgYSBjb2xvbiBvciBvcGVuIGJyYWNlCi0gICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwg
Q1RfVFlQRSkgfHwgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfV09SRCkgfHwgY2h1bmtfaXNf
dG9rZW4obmV4dCwgQ1RfQ09MT04pKQorICAgaWYgKCFjaHVua19pc19zdHIocGFyZW5fb3Bl
biwgIigiLCAxKSkKICAgIHsKLSAgICAgIC8vIGkuZS4gImVudW0geHl6IDogdW5zaWduZWQg
aW50IHsgLi4uIH07IgotICAgICAgLy8gaS5lLiAiZW51bSBjbGFzcyB4eXogOiB1bnNpZ25l
ZCBpbnQgeyAuLi4gfTsiCi0gICAgICAvLyBpLmUuICJlbnVtIDogdW5zaWduZWQgaW50IHsg
Li4uIH07IgotICAgICAgLy8geHl6IGlzIGEgdHlwZQorICAgICAgTE9HX0ZNVChMV0FSTiwg
IiVzOiV6dSBFeHBlY3RlZCAnKCcsIGdvdDogWyVzXVxuIiwKKyAgICAgICAgICAgICAgY3Bk
LmZpbGVuYW1lLmNfc3RyKCksIHBhcmVuX29wZW4tPm9yaWdfbGluZSwKKyAgICAgICAgICAg
ICAgcGFyZW5fb3Blbi0+dGV4dCgpKTsKKyAgICAgIHJldHVybjsKKyAgIH0KKyAgIC8vIE1h
cmsgcGFyYW1ldGVycworICAgZml4X2Zjbl9kZWZfcGFyYW1zKHBhcmVuX29wZW4pOworICAg
YWZ0ZXIgPSBmbGFnX3BhcmVucyhwYXJlbl9vcGVuLCBQQ0ZfSU5fRkNOX0NBTEwsIENUX0ZQ
QVJFTl9PUEVOLCBDVF9GVU5DX0NMQVNTX1BST1RPLCBmYWxzZSk7CiAKLSAgICAgIC8vIHNh
dmUgdGhlIHR5cGUgaWYgaXQgZXhpc3RzCi0gICAgICBpZiAoIWNodW5rX2lzX3Rva2VuKG5l
eHQsIENUX0NPTE9OKSkKLSAgICAgIHsKLSAgICAgICAgIHNldF9jaHVua19wYXJlbnQobmV4
dCwgcGMtPnR5cGUpOwotICAgICAgICAgcHJldiA9IG5leHQ7Ci0gICAgICAgICBuZXh0ID0g
Y2h1bmtfZ2V0X25leHRfbmNubChuZXh0KTsKLSAgICAgIH0KKyAgIExPR19GTVQoTEZUT1Is
ICIlcyglZCk6IHRleHQoKSAnJXMnXG4iLCBfX2Z1bmNfXywgX19MSU5FX18sIGFmdGVyLT50
ZXh0KCkpOwogCi0gICAgICBpZiAobmV4dCA9PSBudWxscHRyKQotICAgICAgewotICAgICAg
ICAgcmV0dXJuOwotICAgICAgfQotICAgICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBwYy0+
dHlwZSk7Ci0gICAgICBhdXRvIGNvbnN0IGlzX3N0cnVjdF9vcl9jbGFzcyA9Ci0gICAgICAg
ICAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NUUlVDVCkgfHwgY2h1bmtfaXNfdG9rZW4ocGMs
IENUX0NMQVNTKSk7CisgICAvLyBTY2FuIHVudGlsIHRoZSBicmFjZSBvcGVuLCBtYXJrIGV2
ZXJ5dGhpbmcKKyAgIHRtcCA9IHBhcmVuX29wZW47CisgICBib29sIGhpdF9jb2xvbiA9IGZh
bHNlOwogCi0gICAgICAvLyBuZXh0IHVwIGlzIGVpdGhlciBhIGNvbG9uLCBvcGVuIGJyYWNl
LCBvciBvcGVuIHBhcmVudGhlc2lzIChwYXduKQotICAgICAgaWYgKGxhbmd1YWdlX2lzX3Nl
dChMQU5HX1BBV04pICYmIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1BBUkVOX09QRU4pKQor
ICAgd2hpbGUgKCAgdG1wICE9IG51bGxwdHIKKyAgICAgICAgICYmICh0bXAtPnR5cGUgIT0g
Q1RfQlJBQ0VfT1BFTiB8fCB0bXAtPmxldmVsICE9IHBhcmVuX29wZW4tPmxldmVsKQorICAg
ICAgICAgJiYgIWNodW5rX2lzX3NlbWljb2xvbih0bXApKQorICAgeworICAgICAgTE9HX0ZN
VChMRlRPUiwgIiVzKCVkKTogdG1wIGlzICclcycsIG9yaWdfbGluZSBpcyAlenUsIG9yaWdf
Y29sIGlzICV6dVxuIiwKKyAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0bXAt
PnRleHQoKSwgdG1wLT5vcmlnX2xpbmUsIHRtcC0+b3JpZ19jb2wpOworICAgICAgY2h1bmtf
ZmxhZ3Nfc2V0KHRtcCwgUENGX0lOX0NPTlNUX0FSR1MpOworICAgICAgdG1wID0gY2h1bmtf
Z2V0X25leHRfbmNubCh0bXApOworCisgICAgICBpZiAoY2h1bmtfaXNfc3RyKHRtcCwgIjoi
LCAxKSAmJiB0bXAtPmxldmVsID09IHBhcmVuX29wZW4tPmxldmVsKQogICAgICAgewotICAg
ICAgICAgbmV4dCA9IHNldF9wYXJlbl9wYXJlbnQobmV4dCwgQ1RfRU5VTSk7CisgICAgICAg
ICBzZXRfY2h1bmtfdHlwZSh0bXAsIENUX0NPTlNUUl9DT0xPTik7CisgICAgICAgICBoaXRf
Y29sb24gPSB0cnVlOwogICAgICAgfQotICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4o
bmV4dCwgQ1RfQ09MT04pKQotICAgICAgewotICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2Vu
KHBjLCBDVF9FTlVNKSkKLSAgICAgICAgIHsKLSAgICAgICAgICAgIC8vIGVudW0gVFlQRSA6
IElOVF9UWVBFIHsgLi4uIH07Ci0gICAgICAgICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHRf
bmNubChuZXh0KTsKIAotICAgICAgICAgICAgaWYgKG5leHQgIT0gbnVsbHB0cikKLSAgICAg
ICAgICAgIHsKLSAgICAgICAgICAgICAgIG1ha2VfdHlwZShuZXh0KTsKLSAgICAgICAgICAg
ICAgIG5leHQgPSBjaHVua19nZXRfbmV4dF9uY25sKG5leHQpOworICAgICAgaWYgKCAgaGl0
X2NvbG9uCisgICAgICAgICAmJiAoY2h1bmtfaXNfcGFyZW5fb3Blbih0bXApIHx8IGNodW5r
X2lzX29wZW5pbmdfYnJhY2UodG1wKSkKKyAgICAgICAgICYmIHRtcC0+bGV2ZWwgPT0gcGFy
ZW5fb3Blbi0+bGV2ZWwpCisgICAgICB7CisgICAgICAgICB2YXIgPSBza2lwX3RlbXBsYXRl
X3ByZXYoY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHRtcCkpOyAgIC8vIElzc3VlICMyMjc5CiAK
LSAgICAgICAgICAgICAgIC8vIGVudW0gVFlQRSA6IHVuc2lnbmVkIGludCB7IC4uLiB9Owot
ICAgICAgICAgICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1RZUEUpKQotICAg
ICAgICAgICAgICAgewotICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBuZXh0IHBhcnQg
b2YgdGhlIHR5cGUKLSAgICAgICAgICAgICAgICAgIG5leHQgPSBjaHVua19nZXRfbmV4dF9u
Y25sKG5leHQpOwotICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgfQotICAgICAgICAg
fQotICAgICAgICAgZWxzZSBpZiAoaXNfc3RydWN0X29yX2NsYXNzKQorICAgICAgICAgaWYg
KGNodW5rX2lzX3Rva2VuKHZhciwgQ1RfVFlQRSkgfHwgY2h1bmtfaXNfdG9rZW4odmFyLCBD
VF9XT1JEKSkKICAgICAgICAgIHsKLSAgICAgICAgICAgIG5leHQgPSBza2lwX3BhcmVudF90
eXBlcyhuZXh0KTsKKyAgICAgICAgICAgIHNldF9jaHVua190eXBlKHZhciwgQ1RfRlVOQ19D
VE9SX1ZBUik7CisgICAgICAgICAgICBmbGFnX3BhcmVucyh0bXAsIFBDRl9JTl9GQ05fQ0FM
TCwgQ1RfRlBBUkVOX09QRU4sIENUX0ZVTkNfQ1RPUl9WQVIsIGZhbHNlKTsKICAgICAgICAg
IH0KICAgICAgIH0KLSAgICAgIGVsc2UgaWYgKGlzX3N0cnVjdF9vcl9jbGFzcyAmJiBjaHVu
a19pc190b2tlbihuZXh0LCBDVF9QQVJFTl9PUEVOKSkKKyAgIH0KKworICAgaWYgKGNodW5r
X2lzX3Rva2VuKHRtcCwgQ1RfQlJBQ0VfT1BFTikpCisgICB7CisgICAgICBzZXRfcGFyZW5f
cGFyZW50KHBhcmVuX29wZW4sIENUX0ZVTkNfQ0xBU1NfREVGKTsKKyAgICAgIHNldF9wYXJl
bl9wYXJlbnQodG1wLCBDVF9GVU5DX0NMQVNTX0RFRik7CisgICAgICBMT0dfRk1UKExGQ04s
ICIlcyglZCk6ICBNYXJrZWQgJyVzJyBhcyBGVU5DX0NMQVNTX0RFRiBvbiBvcmlnX2xpbmUg
JXp1LCBvcmlnX2NvbCAlenVcbiIsCisgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVf
XywgcGMtPnRleHQoKSwgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sKTsKKyAgIH0KKyAg
IGVsc2UKKyAgIHsKKyAgICAgIHNldF9jaHVua19wYXJlbnQodG1wLCBDVF9GVU5DX0NMQVNT
X1BST1RPKTsKKyAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DX0NMQVNTX1BST1RP
KTsKKyAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogIE1hcmtlZCAnJXMnIGFzIEZVTkNf
Q0xBU1NfUFJPVE8gb24gb3JpZ19saW5lICV6dSwgb3JpZ19jb2wgJXp1XG4iLAorICAgICAg
ICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIHBjLT5vcmlnX2xpbmUs
IHBjLT5vcmlnX2NvbCk7CisgICB9Cit9IC8vIG1hcmtfY3BwX2NvbnN0cnVjdG9yCisKKwor
c3RhdGljIHBjZl9mbGFnc190IG1hcmtfd2hlcmVfY2h1bmsoY2h1bmtfdCAqcGMsIGNfdG9r
ZW5fdCBwYXJlbnRfdHlwZSwgcGNmX2ZsYWdzX3QgZmxhZ3MpCit7CisgICAvKiBUT0RPOiBz
aG91bGQgaGF2ZSBvcHRpb25zIHRvIGNvbnRyb2wgc3BhY2luZyBhcm91bmQgdGhlICc6JyBh
cyB3ZWxsIGFzIG5ld2xpbmUgYWJpbGl0eSBmb3IgdGhlCisgICAgKiBjb25zdHJhaW50IGNs
YXVzZXMgKHNob3VsZCBpdCBicmVhayB1cCBhICd3aGVyZSBBIDogQiB3aGVyZSBDIDogRCcg
b24gdGhlIHNhbWUgbGluZT8gd3JhcD8gZXRjLikgKi8KKworICAgaWYgKGNodW5rX2lzX3Rv
a2VuKHBjLCBDVF9XSEVSRSkpCisgICB7CisgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1Rf
V0hFUkVfU1BFQyk7CisgICAgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBwYXJlbnRfdHlwZSk7
CisgICAgICBmbGFncyB8PSBQQ0ZfSU5fV0hFUkVfU1BFQzsKKyAgICAgIExPR19GTVQoTEZU
T1IsICIlczogd2hlcmUtc3BlYyBvbiBsaW5lICV6dVxuIiwKKyAgICAgICAgICAgICAgX19m
dW5jX18sIHBjLT5vcmlnX2xpbmUpOworICAgfQorICAgZWxzZSBpZiAoZmxhZ3MudGVzdChQ
Q0ZfSU5fV0hFUkVfU1BFQykpCisgICB7CisgICAgICBpZiAoY2h1bmtfaXNfc3RyKHBjLCAi
OiIsIDEpKQogICAgICAgewotICAgICAgICAgLy8gRml4ICMxMjY3IHN0cnVjdHVyZSBhdHRy
aWJ1dGVzCi0gICAgICAgICAvLyBzdHJ1Y3QgX19hdHRyaWJ1dGVfXyhhbGlnbih4KSkgc3Ry
dWN0X25hbWU7Ci0gICAgICAgICAvLyBza2lwIHRvIG1hdGNoaW5nIHBhcmVuY2xvc2UgYW5k
IG1ha2UgbmV4dCB0b2tlbiBhcyB0eXBlLgotICAgICAgICAgbmV4dCA9IGNodW5rX3NraXBf
dG9fbWF0Y2gobmV4dCk7Ci0gICAgICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubChu
ZXh0KTsKLSAgICAgICAgIHNldF9jaHVua190eXBlKG5leHQsIENUX1RZUEUpOwotICAgICAg
ICAgc2V0X2NodW5rX3BhcmVudChuZXh0LCBwYy0+dHlwZSk7CisgICAgICAgICBzZXRfY2h1
bmtfdHlwZShwYywgQ1RfV0hFUkVfQ09MT04pOworICAgICAgICAgTE9HX0ZNVChMRlRPUiwg
IiVzOiB3aGVyZS1zcGVjIGNvbG9uIG9uIGxpbmUgJXp1XG4iLAorICAgICAgICAgICAgICAg
ICBfX2Z1bmNfXywgcGMtPm9yaWdfbGluZSk7CiAgICAgICB9Ci0KLSAgICAgIGlmIChjaHVu
a19pc190b2tlbihuZXh0LCBDVF9TRU1JQ09MT04pKSAvLyBjKysgZm9yd2FyZCBkZWNsYXJh
dGlvbgorICAgICAgZWxzZSBpZiAoKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TVFJVQ1QpKSB8
fCAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0NMQVNTKSkpCiAgICAgICB7Ci0gICAgICAgICBz
ZXRfY2h1bmtfcGFyZW50KG5leHQsIHBjLT50eXBlKTsKLSAgICAgICAgIGZsYWdfc2VyaWVz
KHBjLCBwcmV2LCBQQ0ZfSU5DT01QTEVURSk7Ci0gICAgICAgICByZXR1cm47CisgICAgICAg
ICAvKiBjbGFzcy9zdHJ1Y3QgaW5zaWRlIG9mIGEgd2hlcmUtY2xhdXNlIGNvbmZ1c2VzIHBh
cnNlciBmb3IgaW5kZW50YXRpb247IHNldCBpdCBhcyBhIHdvcmQgc28gaXQgbG9va3MgbGlr
ZSB0aGUgcmVzdCAqLworICAgICAgICAgc2V0X2NodW5rX3R5cGUocGMsIENUX1dPUkQpOwog
ICAgICAgfQogICAgfQogCi0gICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfQlJBQ0Vf
T1BFTikpCisgICBpZiAoZmxhZ3MudGVzdChQQ0ZfSU5fV0hFUkVfU1BFQykpCiAgICB7Ci0g
ICAgICBhdXRvIGNvbnN0IGZsYWcgPSBbcGNdIHsKLSAgICAgICAgIHN3aXRjaCAocGMtPnR5
cGUpCi0gICAgICAgICB7Ci0gICAgICAgICBjYXNlIENUX0VOVU06Ci0gICAgICAgICAgICBy
ZXR1cm4oUENGX0lOX0VOVU0pOworICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHBjLCBQQ0ZfSU5f
V0hFUkVfU1BFQyk7CisgICB9CisgICByZXR1cm4oZmxhZ3MpOworfQogCi0gICAgICAgICBj
YXNlIENUX1NUUlVDVDoKLSAgICAgICAgICAgIHJldHVybihQQ0ZfSU5fU1RSVUNUKTsKIAot
ICAgICAgICAgY2FzZSBDVF9DTEFTUzoKLSAgICAgICAgICAgIHJldHVybihQQ0ZfSU5fQ0xB
U1MpOworc3RhdGljIHZvaWQgbWFya19jbGFzc19jdG9yKGNodW5rX3QgKnN0YXJ0KQorewor
ICAgTE9HX0ZVTkNfRU5UUlkoKTsKIAotICAgICAgICAgZGVmYXVsdDoKLSAgICAgICAgICAg
IHJldHVybihQQ0ZfTk9ORSk7Ci0gICAgICAgICB9Ci0gICAgICB9KCk7CisgICBMT0dfRk1U
KExGVE9SLCAiJXMoJWQpOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHN0
YXJ0IGlzICclcycsIHBhcmVudF90eXBlIGlzICVzXG4iLAorICAgICAgICAgICBfX2Z1bmNf
XywgX19MSU5FX18sIHN0YXJ0LT5vcmlnX2xpbmUsIHN0YXJ0LT5vcmlnX2NvbCwgc3RhcnQt
PnRleHQoKSwKKyAgICAgICAgICAgZ2V0X3Rva2VuX25hbWUoZ2V0X2NodW5rX3BhcmVudF90
eXBlKHN0YXJ0KSkpOworICAgbG9nX3BjZl9mbGFncyhMRlRPUiwgc3RhcnQtPmZsYWdzKTsK
IAotICAgICAgZmxhZ19wYXJlbnMobmV4dCwgZmxhZywgQ1RfTk9ORSwgQ1RfTk9ORSwgZmFs
c2UpOworICAgY2h1bmtfdCAqcGNsYXNzID0gY2h1bmtfZ2V0X25leHRfbmNubChzdGFydCwg
c2NvcGVfZTo6UFJFUFJPQyk7CiAKLSAgICAgIGlmICggIGNodW5rX2lzX3Rva2VuKHBjLCBD
VF9VTklPTikKLSAgICAgICAgIHx8IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9TVFJVQ1QpCi0g
ICAgICAgICB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQ0xBU1MpKQorICAgTE9HX0ZNVChM
RlRPUiwgIiVzKCVkKTogcGNsYXNzIGlzICclcydcbiIsCisgICAgICAgICAgIF9fZnVuY19f
LCBfX0xJTkVfXywgcGNsYXNzLT50ZXh0KCkpOworICAgbG9nX3BjZl9mbGFncyhMRlRPUiwg
cGNsYXNzLT5mbGFncyk7CisKKyAgIGlmIChsYW5ndWFnZV9pc19zZXQoTEFOR19DUFApKQor
ICAgeworICAgICAgcGNsYXNzID0gc2tpcF9hdHRyaWJ1dGVfbmV4dChwY2xhc3MpOworICAg
ICAgTE9HX0ZNVChMRlRPUiwgIiVzKCVkKTogcGNsYXNzIGlzICclcydcbiIsCisgICAgICAg
ICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGNsYXNzLT50ZXh0KCkpOworICAgfQorCisg
ICBpZiAoZ2V0X2NodW5rX3BhcmVudF90eXBlKHN0YXJ0KSA9PSBDVF9URU1QTEFURSkKKyAg
IHsKKyAgICAgIC8vIGxvb2sgYWZ0ZXIgdGhlIGNsYXNzIG5hbWUKKyAgICAgIGNodW5rX3Qg
Km9wZW5pbmdUZW1wbGF0ZSA9IGNodW5rX2dldF9uZXh0X25jbmwocGNsYXNzKTsKKyAgICAg
IExPR19GTVQoTEZUT1IsICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9yaWdfY29sIGlz
ICV6dSwgb3BlbmluZ1RlbXBsYXRlIGlzICclcycsIHR5cGUgaXMgJXNcbiIsCisgICAgICAg
ICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgb3BlbmluZ1RlbXBsYXRlLT5vcmlnX2xpbmUs
IG9wZW5pbmdUZW1wbGF0ZS0+b3JpZ19jb2wsCisgICAgICAgICAgICAgIG9wZW5pbmdUZW1w
bGF0ZS0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZShvcGVuaW5nVGVtcGxhdGUtPnR5cGUpKTsK
KworICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKG9wZW5pbmdUZW1wbGF0ZSwgQ1RfQU5HTEVf
T1BFTikpCiAgICAgICB7Ci0gICAgICAgICBtYXJrX3N0cnVjdF91bmlvbl9ib2R5KG5leHQp
OworICAgICAgICAgY2h1bmtfdCAqY2xvc2luZ1RlbXBsYXRlID0gY2h1bmtfc2tpcF90b19t
YXRjaChvcGVuaW5nVGVtcGxhdGUpOworICAgICAgICAgTE9HX0ZNVChMRlRPUiwgIiVzKCVk
KTogb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCBjbG9zaW5nVGVtcGxhdGUg
aXMgJyVzJywgdHlwZSBpcyAlc1xuIiwKKyAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9f
TElORV9fLCBjbG9zaW5nVGVtcGxhdGUtPm9yaWdfbGluZSwgY2xvc2luZ1RlbXBsYXRlLT5v
cmlnX2NvbCwKKyAgICAgICAgICAgICAgICAgY2xvc2luZ1RlbXBsYXRlLT50ZXh0KCksIGdl
dF90b2tlbl9uYW1lKGNsb3NpbmdUZW1wbGF0ZS0+dHlwZSkpOworICAgICAgICAgY2h1bmtf
dCAqdGhpcmRUb2tlbiA9IGNodW5rX2dldF9uZXh0X25jbmwoY2xvc2luZ1RlbXBsYXRlKTsK
KyAgICAgICAgIExPR19GTVQoTEZUT1IsICIlcyglZCk6IG9yaWdfbGluZSBpcyAlenUsIG9y
aWdfY29sIGlzICV6dSwgdGhpcmRUb2tlbiBpcyAnJXMnLCB0eXBlIGlzICVzXG4iLAorICAg
ICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHRoaXJkVG9rZW4tPm9yaWdfbGlu
ZSwgdGhpcmRUb2tlbi0+b3JpZ19jb2wsCisgICAgICAgICAgICAgICAgIHRoaXJkVG9rZW4t
PnRleHQoKSwgZ2V0X3Rva2VuX25hbWUodGhpcmRUb2tlbi0+dHlwZSkpOworCisgICAgICAg
ICBpZiAoY2h1bmtfaXNfdG9rZW4odGhpcmRUb2tlbiwgQ1RfRENfTUVNQkVSKSkKKyAgICAg
ICAgIHsKKyAgICAgICAgICAgIHBjbGFzcyA9IGNodW5rX2dldF9uZXh0X25jbmwodGhpcmRU
b2tlbik7CisgICAgICAgICAgICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiBvcmlnX2xpbmUg
aXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHBjbGFzcyBpcyAnJXMnLCB0eXBlIGlzICVzXG4i
LAorICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjbGFzcy0+b3Jp
Z19saW5lLCBwY2xhc3MtPm9yaWdfY29sLAorICAgICAgICAgICAgICAgICAgICBwY2xhc3Mt
PnRleHQoKSwgZ2V0X3Rva2VuX25hbWUocGNsYXNzLT50eXBlKSk7CisgICAgICAgICB9CiAg
ICAgICB9Ci0gICAgICAvLyBTa2lwIHRvIHRoZSBjbG9zaW5nIGJyYWNlCi0gICAgICBzZXRf
Y2h1bmtfcGFyZW50KG5leHQsIHBjLT50eXBlKTsKLSAgICAgIG5leHQgICA9IGNodW5rX2dl
dF9uZXh0X3R5cGUobmV4dCwgQ1RfQlJBQ0VfQ0xPU0UsIHBjLT5sZXZlbCk7Ci0gICAgICBm
bGFncyB8PSBQQ0ZfVkFSX0lOTElORTsKKyAgIH0KKyAgIHBjbGFzcyA9IHNraXBfYXR0cmli
dXRlX25leHQocGNsYXNzKTsKKyAgIExPR19GTVQoTEZUT1IsICIlcyglZCk6IHBjbGFzcyBp
cyAnJXMnXG4iLAorICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjbGFzcy0+dGV4
dCgpKTsKIAotICAgICAgaWYgKG5leHQgIT0gbnVsbHB0cikKKyAgIGlmIChjaHVua19pc190
b2tlbihwY2xhc3MsIENUX0RFQ0xTUEVDKSkgIC8vIElzc3VlIDEyODkKKyAgIHsKKyAgICAg
IHBjbGFzcyA9IGNodW5rX2dldF9uZXh0X25jbmwocGNsYXNzKTsKKyAgICAgIExPR19GTVQo
TEZUT1IsICIlcyglZCk6IHBjbGFzcyBpcyAnJXMnXG4iLAorICAgICAgICAgICAgICBfX2Z1
bmNfXywgX19MSU5FX18sIHBjbGFzcy0+dGV4dCgpKTsKKworICAgICAgaWYgKGNodW5rX2lz
X3Rva2VuKHBjbGFzcywgQ1RfUEFSRU5fT1BFTikpCiAgICAgICB7Ci0gICAgICAgICBzZXRf
Y2h1bmtfcGFyZW50KG5leHQsIHBjLT50eXBlKTsKLSAgICAgICAgIG5leHQgPSBjaHVua19n
ZXRfbmV4dF9uY25sKG5leHQpOworICAgICAgICAgcGNsYXNzID0gY2h1bmtfZ2V0X25leHRf
bmNubChjaHVua19za2lwX3RvX21hdGNoKHBjbGFzcykpOworICAgICAgICAgTE9HX0ZNVChM
RlRPUiwgIiVzKCVkKTogcGNsYXNzIGlzICclcydcbiIsCisgICAgICAgICAgICAgICAgIF9f
ZnVuY19fLCBfX0xJTkVfXywgcGNsYXNzLT50ZXh0KCkpOwogICAgICAgfQotICAgICAgcHJl
diA9IG51bGxwdHI7CiAgICB9Ci0gICAvLyByZXNldCB2YXIgbmFtZSBwYXJlbnQgdHlwZQot
ICAgZWxzZSBpZiAobmV4dCAmJiBwcmV2KQorCisgICBpZiAoICBwY2xhc3MgPT0gbnVsbHB0
cgorICAgICAgfHwgKHBjbGFzcy0+dHlwZSAhPSBDVF9UWVBFICYmIHBjbGFzcy0+dHlwZSAh
PSBDVF9XT1JEKSkKICAgIHsKLSAgICAgIHNldF9jaHVua19wYXJlbnQocHJldiwgQ1RfTk9O
RSk7CisgICAgICByZXR1cm47CiAgICB9CisgICBjaHVua190ICpuZXh0ID0gY2h1bmtfZ2V0
X25leHRfbmNubChwY2xhc3MsIHNjb3BlX2U6OlBSRVBST0MpOwogCi0gICBpZiAobmV4dCA9
PSBudWxscHRyIHx8IGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1BBUkVOX0NMT1NFKSkKKyAg
IHdoaWxlICggIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1RZUEUpCisgICAgICAgICB8fCBj
aHVua19pc190b2tlbihuZXh0LCBDVF9XT1JEKQorICAgICAgICAgfHwgY2h1bmtfaXNfdG9r
ZW4obmV4dCwgQ1RfRENfTUVNQkVSKSkKKyAgIHsKKyAgICAgIHBjbGFzcyA9IG5leHQ7Cisg
ICAgICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiBwY2xhc3MgaXMgJyVzJ1xuIiwKKyAgICAg
ICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwY2xhc3MtPnRleHQoKSk7CisgICAgICBu
ZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNubChuZXh0LCBzY29wZV9lOjpQUkVQUk9DKTsKKyAg
IH0KKyAgIGNodW5rX3QgKnBjICAgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjbGFzcywgc2Nv
cGVfZTo6UFJFUFJPQyk7CisgICBzaXplX3QgIGxldmVsID0gcGNsYXNzLT5icmFjZV9sZXZl
bCArIDE7CisKKyAgIGlmIChwYyA9PSBudWxscHRyKQogICAgeworICAgICAgTE9HX0ZNVChM
RlRPUiwgIiVzKCVkKTogQ2FsbGVkIG9uICVzIG9uIG9yaWdfbGluZSAlenUuIEJhaWxlZCBv
biBOVUxMXG4iLAorICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjbGFzcy0+
dGV4dCgpLCBwY2xhc3MtPm9yaWdfbGluZSk7CiAgICAgICByZXR1cm47CiAgICB9CisgICAv
LyBBZGQgdGhlIGNsYXNzIG5hbWUKKyAgIENodW5rU3RhY2sgY3M7CiAKLSAgIGlmICghY2h1
bmtfaXNfc2VtaWNvbG9uKG5leHQpKQorICAgY3MuUHVzaF9CYWNrKHBjbGFzcyk7CisKKyAg
IExPR19GTVQoTEZUT1IsICIlcyglZCk6IENhbGxlZCBvbiAlcyBvbiBvcmlnX2xpbmUgJXp1
IChuZXh0IGlzICclcycpXG4iLAorICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBj
bGFzcy0+dGV4dCgpLCBwY2xhc3MtPm9yaWdfbGluZSwgcGMtPnRleHQoKSk7CisKKyAgIC8v
IGRldGVjdCBEIHRlbXBsYXRlIGNsYXNzOiAiY2xhc3MgZm9vKHgpIHsgLi4uIH0iCisgICBp
ZiAobGFuZ3VhZ2VfaXNfc2V0KExBTkdfRCkgJiYgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1Rf
UEFSRU5fT1BFTikpICAgICAgICAgICAgICAvLyBDb3Zlcml0eSBDSUQgNzYwMDQKICAgIHsK
LSAgICAgIC8vIFBhd24gZG9lcyBub3QgcmVxdWlyZSBhIHNlbWljb2xvbiBhZnRlciBhbiBl
bnVtCi0gICAgICBpZiAobGFuZ3VhZ2VfaXNfc2V0KExBTkdfUEFXTikpCi0gICAgICB7Ci0g
ICAgICAgICByZXR1cm47Ci0gICAgICB9CisgICAgICBzZXRfY2h1bmtfcGFyZW50KG5leHQs
IENUX1RFTVBMQVRFKTsKIAotICAgICAgLyoKLSAgICAgICAqIEQgZG9lcyBub3QgcmVxdWly
ZSBhIHNlbWljb2xvbiBhZnRlciBhbiBlbnVtLCBidXQgd2UgYWRkIG9uZSB0byBtYWtlCi0g
ICAgICAgKiBvdGhlciBjb2RlIGhhcHB5LgotICAgICAgICovCi0gICAgICBpZiAobGFuZ3Vh
Z2VfaXNfc2V0KExBTkdfRCkpCisgICAgICBuZXh0ID0gZ2V0X2RfdGVtcGxhdGVfdHlwZXMo
Y3MsIG5leHQpOworCisgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfUEFSRU5f
Q0xPU0UpKQogICAgICAgewotICAgICAgICAgbmV4dCA9IHBhd25fYWRkX3ZzZW1pX2FmdGVy
KGNodW5rX2dldF9wcmV2X25jbmxuaShuZXh0KSk7ICAgLy8gSXNzdWUgIzIyNzkKKyAgICAg
ICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgQ1RfVEVNUExBVEUpOwogICAgICAgfQogICAg
fQorICAgLy8gRmluZCB0aGUgb3BlbiBicmFjZSwgYWJvcnQgb24gc2VtaWNvbG9uCisgICBw
Y2ZfZmxhZ3NfdCBmbGFncyA9IFBDRl9OT05FOwogCi0gICAvLyBXZSBhcmUgZWl0aGVyIHBv
aW50aW5nIHRvIGEgJzsnIG9yIGEgdmFyaWFibGUKLSAgIHdoaWxlICggIG5leHQgIT0gbnVs
bHB0cgotICAgICAgICAgJiYgIWNodW5rX2lzX3NlbWljb2xvbihuZXh0KQotICAgICAgICAg
JiYgbmV4dC0+dHlwZSAhPSBDVF9BU1NJR04KLSAgICAgICAgICYmICEoaW5fZmNuX3BhcmVu
IF4gKG5leHQtPmZsYWdzICYgUENGX0lOX0ZDTl9ERUYpKS50ZXN0X2FueSgpKQorICAgd2hp
bGUgKHBjICE9IG51bGxwdHIgJiYgcGMtPnR5cGUgIT0gQ1RfQlJBQ0VfT1BFTikKICAgIHsK
LSAgICAgIGlmIChuZXh0LT5sZXZlbCA9PSBwYy0+bGV2ZWwpCi0gICAgICB7Ci0gICAgICAg
ICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfV09SRCkpCi0gICAgICAgICB7Ci0gICAg
ICAgICAgICBjaHVua19mbGFnc19zZXQobmV4dCwgZmxhZ3MpOwotICAgICAgICAgICAgZmxh
Z3MgJj0gflBDRl9WQVJfMVNUOyAgIC8vIGNsZWFyIHRoZSBmaXJzdCBmbGFnIGZvciB0aGUg
bmV4dCBpdGVtcwotICAgICAgICAgICAgTE9HX0ZNVChMQ0FTVFMsICIlcyglZCk6IG9yaWdf
bGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dSwgdGV4dCgpICclcycsIHNldCBQQ0ZfVkFS
XzFTVFxuIiwKLSAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+
b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wsIHBjLT50ZXh0KCkpOwotICAgICAgICAgfQorICAg
ICAgTE9HX0ZNVChMRlRPUiwgIiBbJXNdIiwgcGMtPnRleHQoKSk7CiAKLSAgICAgICAgIGlm
ICggIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX1NUQVIpCi0gICAgICAgICAgICB8fCAobGFu
Z3VhZ2VfaXNfc2V0KExBTkdfQ1BQKSAmJiBjaHVua19pc190b2tlbihuZXh0LCBDVF9DQVJF
VCkpKQotICAgICAgICAgewotICAgICAgICAgICAgc2V0X2NodW5rX3R5cGUobmV4dCwgQ1Rf
UFRSX1RZUEUpOwotICAgICAgICAgfQorICAgICAgZmxhZ3MgPSBtYXJrX3doZXJlX2NodW5r
KHBjLCBzdGFydC0+dHlwZSwgZmxhZ3MpOwogCi0gICAgICAgICAvLyBJZiB3ZSBoaXQgYSBj
b21tYSBpbiBhIGZ1bmN0aW9uIHBhcmFtLCB3ZSBhcmUgZG9uZQotICAgICAgICAgaWYgKCAg
KGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0NPTU1BKSB8fCBjaHVua19pc190b2tlbihuZXh0
LCBDVF9GUEFSRU5fQ0xPU0UpKQotICAgICAgICAgICAgJiYgKG5leHQtPmZsYWdzLnRlc3Rf
YW55KFBDRl9JTl9GQ05fREVGIHwgUENGX0lOX0ZDTl9DQUxMKSkpCi0gICAgICAgICB7Ci0g
ICAgICAgICAgICByZXR1cm47Ci0gICAgICAgICB9CisgICAgICBpZiAoIWZsYWdzLnRlc3Qo
UENGX0lOX1dIRVJFX1NQRUMpICYmIGNodW5rX2lzX3N0cihwYywgIjoiLCAxKSkKKyAgICAg
IHsKKyAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9DTEFTU19DT0xPTik7CisgICAg
ICAgICBmbGFncyB8PSBQQ0ZfSU5fQ0xBU1NfQkFTRTsKKyAgICAgICAgIExPR19GTVQoTEZU
T1IsICIlcyglZCk6IGNsYXNzIGNvbG9uIG9uIGxpbmUgJXp1XG4iLAorICAgICAgICAgICAg
ICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUpOwogICAgICAgfQotICAg
ICAgbmV4dCA9IGNodW5rX2dldF9uZXh0X25jbmwobmV4dCk7Ci0gICB9CiAKLSAgIGlmICgg
IG5leHQgIT0gbnVsbHB0cgotICAgICAgJiYgY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1RfU0VN
SUNPTE9OKSkKLSAgIHsKLSAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgcGMtPnR5cGUp
OworICAgICAgaWYgKGNodW5rX2lzX3NlbWljb2xvbihwYykpCisgICAgICB7CisgICAgICAg
ICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiBiYWlsZWQgb24gc2VtaWNvbG9uIG9uIGxpbmUg
JXp1XG4iLAorICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5vcmln
X2xpbmUpOworICAgICAgICAgcmV0dXJuOworICAgICAgfQorICAgICAgY2h1bmtfZmxhZ3Nf
c2V0KHBjLCBmbGFncyk7CisgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGMsIHNj
b3BlX2U6OlBSRVBST0MpOwogICAgfQotfSAvLyBmaXhfZW51bV9zdHJ1Y3RfdW5pb24KLQog
Ci1zdGF0aWMgdm9pZCBmaXhfdHlwZWRlZihjaHVua190ICpzdGFydCkKLXsKLSAgIExPR19G
VU5DX0VOVFJZKCk7Ci0KLSAgIGlmIChzdGFydCA9PSBudWxscHRyKQorICAgaWYgKHBjID09
IG51bGxwdHIpCiAgICB7CisgICAgICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiBiYWlsZWQg
b24gTlVMTFxuIiwgX19mdW5jX18sIF9fTElORV9fKTsKICAgICAgIHJldHVybjsKICAgIH0K
LSAgIExPR19GTVQoTFRZUEVERUYsICIlcyglZCk6IHR5cGVkZWYgQCBvcmlnX2xpbmUgJXp1
LCBvcmlnX2NvbCAlenVcbiIsCi0gICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgc3Rh
cnQtPm9yaWdfbGluZSwgc3RhcnQtPm9yaWdfY29sKTsKKyAgIHNldF9wYXJlbl9wYXJlbnQo
cGMsIHN0YXJ0LT50eXBlKTsKKyAgIGNodW5rX2ZsYWdzX3NldChwYywgUENGX0lOX0NMQVNT
KTsKIAotICAgY2h1bmtfdCAqdGhlX3R5cGUgPSBudWxscHRyOwotICAgY2h1bmtfdCAqbGFz
dF9vcCAgPSBudWxscHRyOworICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjLCBzY29w
ZV9lOjpQUkVQUk9DKTsKKyAgIExPR19GTVQoTEZUT1IsICIlcyglZCk6IHBjbGFzcyBpcyAn
JXMnXG4iLAorICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjbGFzcy0+dGV4dCgp
KTsKIAotICAgLyoKLSAgICAqIE1hcmsgZXZlcnl0aGluZyBpbiB0aGUgdHlwZWRlZiBhbmQg
c2NhbiBmb3IgIikoIiwgd2hpY2ggbWFrZXMgaXQgYQotICAgICogZnVuY3Rpb24gdHlwZQot
ICAgICovCi0gICBmb3IgKGNodW5rX3QgKm5leHQgPSBjaHVua19nZXRfbmV4dF9uY25sKHN0
YXJ0LCBzY29wZV9lOjpQUkVQUk9DKQotICAgICAgICA7IG5leHQgIT0gbnVsbHB0ciAmJiBu
ZXh0LT5sZXZlbCA+PSBzdGFydC0+bGV2ZWwKLSAgICAgICAgOyBuZXh0ID0gY2h1bmtfZ2V0
X25leHRfbmNubChuZXh0LCBzY29wZV9lOjpQUkVQUk9DKSkKKyAgIHdoaWxlIChwYyAhPSBu
dWxscHRyKQogICAgewotICAgICAgY2h1bmtfZmxhZ3Nfc2V0KG5leHQsIFBDRl9JTl9UWVBF
REVGKTsKKyAgICAgIExPR19GTVQoTEZUT1IsICIlcyglZCk6IHBjIGlzICclcycsIG9yaWdf
bGluZSBpcyAlenUsIG9yaWdfY29sIGlzICV6dVxuIiwKKyAgICAgICAgICAgICAgX19mdW5j
X18sIF9fTElORV9fLCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5lLCBwYy0+b3JpZ19jb2wp
OworICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHBjLCBQQ0ZfSU5fQ0xBU1MpOwogCi0gICAgICBp
ZiAoc3RhcnQtPmxldmVsID09IG5leHQtPmxldmVsKQorICAgICAgaWYgKCAgcGMtPmJyYWNl
X2xldmVsID4gbGV2ZWwKKyAgICAgICAgIHx8IHBjLT5sZXZlbCA+IHBjLT5icmFjZV9sZXZl
bAorICAgICAgICAgfHwgcGMtPmZsYWdzLnRlc3QoUENGX0lOX1BSRVBST0MpKQogICAgICAg
ewotICAgICAgICAgaWYgKGNodW5rX2lzX3NlbWljb2xvbihuZXh0KSkKLSAgICAgICAgIHsK
LSAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQobmV4dCwgQ1RfVFlQRURFRik7Ci0gICAg
ICAgICAgICBicmVhazsKLSAgICAgICAgIH0KKyAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25l
eHRfbmNubChwYyk7CisgICAgICAgICBjb250aW51ZTsKKyAgICAgIH0KIAotICAgICAgICAg
aWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0FUVFJJQlVURSkpCi0gICAgICAgICB7Ci0g
ICAgICAgICAgICBicmVhazsKLSAgICAgICAgIH0KKyAgICAgIGlmIChjaHVua19pc190b2tl
bihwYywgQ1RfQlJBQ0VfQ0xPU0UpICYmIHBjLT5icmFjZV9sZXZlbCA8IGxldmVsKQorICAg
ICAgeworICAgICAgICAgTE9HX0ZNVChMRlRPUiwgIiVzKCVkKTogb3JpZ19saW5lIGlzICV6
dSwgSGl0IGJyYWNlIGNsb3NlXG4iLAorICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19M
SU5FX18sIHBjLT5vcmlnX2xpbmUpOworICAgICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9u
Y25sKHBjLCBzY29wZV9lOjpQUkVQUk9DKTsKIAotICAgICAgICAgaWYgKGxhbmd1YWdlX2lz
X3NldChMQU5HX0QpICYmIGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0FTU0lHTikpCisgICAg
ICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1NFTUlDT0xPTikpCiAgICAgICAgICB7
Ci0gICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KG5leHQsIENUX1RZUEVERUYpOwotICAg
ICAgICAgICAgYnJlYWs7CisgICAgICAgICAgICBzZXRfY2h1bmtfcGFyZW50KHBjLCBzdGFy
dC0+dHlwZSk7CiAgICAgICAgICB9Ci0gICAgICAgICBtYWtlX3R5cGUobmV4dCk7CisgICAg
ICAgICByZXR1cm47CisgICAgICB9CisgICAgICBuZXh0ID0gY2h1bmtfZ2V0X25leHRfbmNu
bChwYywgc2NvcGVfZTo6UFJFUFJPQyk7CiAKLSAgICAgICAgIGlmIChjaHVua19pc190b2tl
bihuZXh0LCBDVF9UWVBFKSkKKyAgICAgIGlmIChjaHVua3N0YWNrX21hdGNoKGNzLCBwYykp
CisgICAgICB7CisgICAgICAgICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiBwYyBpcyAnJXMn
LCBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenVcbiIsCisgICAgICAgICAgICAg
ICAgIF9fZnVuY19fLCBfX0xJTkVfXywgcGMtPnRleHQoKSwgcGMtPm9yaWdfbGluZSwgcGMt
Pm9yaWdfY29sKTsKKyAgICAgICAgIC8vIElzc3VlICMxMzMzIEZvcm1hdHRlciByZW1vdmVz
IHNlbWljb2xvbiBhZnRlciB2YXJpYWJsZSBpbml0aWFsaXplciBhdCBjbGFzcyBsZXZlbChD
IykKKyAgICAgICAgIC8vIGlmIHByZXZpb3VzIGNodW5rIGlzICduZXcnIG9wZXJhdG9yIGl0
IGlzIHZhcmlhYmxlIGluaXRpYWxpemVyIG5vdCBhIENMQVNTX0ZVTkNfREVGLgorICAgICAg
ICAgY2h1bmtfdCAqcHJldiA9IGNodW5rX2dldF9wcmV2X25jbmxuaShwYywgc2NvcGVfZTo6
UFJFUFJPQyk7ICAgLy8gSXNzdWUgIzIyNzkKKyAgICAgICAgIExPR19GTVQoTEZUT1IsICIl
cyglZCk6IHByZXYgaXMgJyVzJywgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1
LCB0eXBlIGlzICVzXG4iLAorICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18s
IHByZXYtPnRleHQoKSwgcHJldi0+b3JpZ19saW5lLCBwcmV2LT5vcmlnX2NvbCwgZ2V0X3Rv
a2VuX25hbWUocHJldi0+dHlwZSkpOworCisgICAgICAgICAvLyBJc3N1ZSAjMTAwMywgbmV4
dC0+dHlwZSBzaG91bGQgbm90IGJlIENUX0ZQQVJFTl9PUEVOCisgICAgICAgICBpZiAoICBw
cmV2ICE9IG51bGxwdHIKKyAgICAgICAgICAgICYmIChwcmV2LT50eXBlICE9IENUX05FVykp
CiAgICAgICAgICB7Ci0gICAgICAgICAgICB0aGVfdHlwZSA9IG5leHQ7CisgICAgICAgICAg
ICBib29sIGlzX2Z1bmNfY2xhc3NfZGVmID0gZmFsc2U7CisKKyAgICAgICAgICAgIGlmIChj
aHVua19pc190b2tlbihuZXh0LCBDVF9QQVJFTl9PUEVOKSkKKyAgICAgICAgICAgIHsKKyAg
ICAgICAgICAgICAgIGlzX2Z1bmNfY2xhc3NfZGVmID0gdHJ1ZTsKKyAgICAgICAgICAgIH0K
KyAgICAgICAgICAgIGVsc2UgaWYgKGNodW5rX2lzX3Rva2VuKG5leHQsIENUX0FOR0xFX09Q
RU4pKSAgICAgICAgICAvLyBJc3N1ZSAjIDE3MzcKKyAgICAgICAgICAgIHsKKyAgICAgICAg
ICAgICAgIGNodW5rX3QgKmNsb3NlQW5nbGUgICAgPSBjaHVua19za2lwX3RvX21hdGNoKG5l
eHQpOworICAgICAgICAgICAgICAgY2h1bmtfdCAqYWZ0ZXJUZW1wbGF0ZSA9IGNodW5rX2dl
dF9uZXh0KGNsb3NlQW5nbGUpOworCisgICAgICAgICAgICAgICBpZiAoY2h1bmtfaXNfdG9r
ZW4oYWZ0ZXJUZW1wbGF0ZSwgQ1RfUEFSRU5fT1BFTikpCisgICAgICAgICAgICAgICB7Cisg
ICAgICAgICAgICAgICAgICBpc19mdW5jX2NsYXNzX2RlZiA9IHRydWU7CisgICAgICAgICAg
ICAgICB9CisgICAgICAgICAgICB9CisgICAgICAgICAgICBlbHNlCisgICAgICAgICAgICB7
CisgICAgICAgICAgICAgICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiB0ZXh0KCkgaXMgJyVz
Jywgb3JpZ19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0eXBlIGlzICVzXG4iLAor
ICAgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCks
IHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgZ2V0X3Rva2VuX25hbWUocGMtPnR5cGUp
KTsKKyAgICAgICAgICAgICAgIG1ha2VfdHlwZShwYyk7CisgICAgICAgICAgICB9CisKKyAg
ICAgICAgICAgIGlmIChpc19mdW5jX2NsYXNzX2RlZikKKyAgICAgICAgICAgIHsKKyAgICAg
ICAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBDVF9GVU5DX0NMQVNTX0RFRik7CisgICAg
ICAgICAgICAgICBMT0dfRk1UKExGVE9SLCAiJXMoJWQpOiB0ZXh0KCkgaXMgJyVzJywgb3Jp
Z19saW5lIGlzICV6dSwgb3JpZ19jb2wgaXMgJXp1LCB0eXBlIGlzICVzLCBNYXJrZWQgQ1Rv
ci9EVG9yXG4iLAorICAgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18s
IHBjLT50ZXh0KCksIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgZ2V0X3Rva2VuX25h
bWUocGMtPnR5cGUpKTsKKyAgICAgICAgICAgICAgIG1hcmtfY3BwX2NvbnN0cnVjdG9yKHBj
KTsKKyAgICAgICAgICAgIH0KICAgICAgICAgIH0KLSAgICAgICAgIGNodW5rX2ZsYWdzX2Ns
cihuZXh0LCBQQ0ZfVkFSXzFTVF9ERUYpOworICAgICAgfQorICAgICAgcGMgPSBuZXh0Owor
ICAgfQorfSAvLyBtYXJrX2NsYXNzX2N0b3IKIAotICAgICAgICAgaWYgKCpuZXh0LT5zdHIu
Y19zdHIoKSA9PSAnKCcpCisKK3N0YXRpYyBjaHVua190ICpza2lwX2FsaWduKGNodW5rX3Qg
KnN0YXJ0KQoreworICAgY2h1bmtfdCAqcGMgPSBzdGFydDsKKworICAgaWYgKGNodW5rX2lz
X3Rva2VuKHBjLCBDVF9BTElHTikpCisgICB7CisgICAgICBwYyA9IGNodW5rX2dldF9uZXh0
X25jbmwocGMpOworCisgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1BBUkVOX09Q
RU4pKQorICAgICAgeworICAgICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF90eXBlKHBjLCBD
VF9QQVJFTl9DTE9TRSwgcGMtPmxldmVsKTsKKyAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25l
eHRfbmNubChwYyk7CisKKyAgICAgICAgIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfQ09M
T04pKQogICAgICAgICAgewotICAgICAgICAgICAgbGFzdF9vcCA9IG5leHQ7CisgICAgICAg
ICAgICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmwocGMpOwogICAgICAgICAgfQogICAgICAg
fQogICAgfQorICAgcmV0dXJuKHBjKTsKK30KIAotICAgLy8gYXZvaWQgaW50ZXJwcmV0aW5n
IHR5cGVkZWYgTlNfRU5VTSAoTlNJbnRlZ2VyLCBNeUVudW0pIGFzIGEgZnVuY3Rpb24gZGVm
Ci0gICBpZiAoICBsYXN0X29wICE9IG51bGxwdHIKLSAgICAgICYmICEobGFuZ3VhZ2VfaXNf
c2V0KExBTkdfT0MpICYmIGdldF9jaHVua19wYXJlbnRfdHlwZShsYXN0X29wKSA9PSBDVF9F
TlVNKSkKKworY2h1bmtfdCAqc2tpcF9wYXJlbnRfdHlwZXMoY2h1bmtfdCAqY29sb24pCit7
CisgICBhdXRvIHBjID0gY2h1bmtfZ2V0X25leHRfbmNubG5wKGNvbG9uKTsKKworICAgd2hp
bGUgKHBjKQogICAgewotICAgICAgZmxhZ19wYXJlbnMobGFzdF9vcCwgUENGX05PTkUsIENU
X0ZQQVJFTl9PUEVOLCBDVF9UWVBFREVGLCBmYWxzZSk7Ci0gICAgICBmaXhfZmNuX2RlZl9w
YXJhbXMobGFzdF9vcCk7CisgICAgICAvLyBTa2lwIGFjY2VzcyBzcGVjaWZpZXIKKyAgICAg
IGlmIChjaHVua19pc190b2tlbihwYywgQ1RfQUNDRVNTKSkKKyAgICAgIHsKKyAgICAgICAg
IHBjID0gY2h1bmtfZ2V0X25leHRfbmNubG5wKHBjKTsKKyAgICAgICAgIGNvbnRpbnVlOwor
ICAgICAgfQorCisgICAgICAvLyBDaGVjayBmb3IgYSB0eXBlIG5hbWUKKyAgICAgIGlmICgh
KGNodW5rX2lzX3Rva2VuKHBjLCBDVF9XT1JEKSB8fCBjaHVua19pc190b2tlbihwYywgQ1Rf
VFlQRSkpKQorICAgICAgeworICAgICAgICAgTE9HX0ZNVChMUENVLAorICAgICAgICAgICAg
ICAgICAiJXMgaXMgY29uZnVzZWQ7IGV4cGVjdGVkIGEgd29yZCBhdCAlenU6JXp1ICIKKyAg
ICAgICAgICAgICAgICAgImZvbGxvd2luZyB0eXBlIGxpc3QgYXQgJXp1OiV6dVxuIiwgX19m
dW5jX18sCisgICAgICAgICAgICAgICAgIGNvbG9uLT5vcmlnX2xpbmUsIGNvbG9uLT5vcmln
X2NvbCwKKyAgICAgICAgICAgICAgICAgcGMtPm9yaWdfbGluZSwgcGMtPm9yaWdfY29sKTsK
KyAgICAgICAgIHJldHVybihjb2xvbik7CisgICAgICB9CisgICAgICAvLyBHZXQgbmV4dCB0
b2tlbgorICAgICAgYXV0byBuZXh0ID0gc2tpcF90ZW1wbGF0ZV9uZXh0KGNodW5rX2dldF9u
ZXh0X25jbmxucChwYykpOworCisgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4obmV4dCwgQ1Rf
RENfTUVNQkVSKSB8fCBjaHVua19pc190b2tlbihuZXh0LCBDVF9DT01NQSkpCisgICAgICB7
CisgICAgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X25jbmxucChuZXh0KTsKKyAgICAgIH0K
KyAgICAgIGVsc2UgaWYgKG5leHQpCisgICAgICB7CisgICAgICAgICBMT0dfRk1UKExQQ1Us
ICIlcyAtPiAlenU6JXp1ICgnJXMnKVxuIiwgX19mdW5jX18sCisgICAgICAgICAgICAgICAg
IG5leHQtPm9yaWdfbGluZSwgbmV4dC0+b3JpZ19jb2wsIG5leHQtPnRleHQoKSk7CisgICAg
ICAgICByZXR1cm4obmV4dCk7CisgICAgICB9CisgICAgICBlbHNlCisgICAgICB7CisgICAg
ICAgICBicmVhazsKKyAgICAgIH0KKyAgIH0KKyAgIExPR19GTVQoTFBDVSwgIiVzOiBkaWQg
bm90IGZpbmQgZW5kIG9mIHR5cGUgbGlzdCAoc3RhcnQgd2FzICV6dTolenUpXG4iLAorICAg
ICAgICAgICBfX2Z1bmNfXywgY29sb24tPm9yaWdfbGluZSwgY29sb24tPm9yaWdfY29sKTsK
KyAgIHJldHVybihjb2xvbik7Cit9IC8vIHNraXBfcGFyZW50X3R5cGVzCiAKLSAgICAgIHRo
ZV90eXBlID0gY2h1bmtfZ2V0X3ByZXZfbmNubG5pKGxhc3Rfb3AsIHNjb3BlX2U6OlBSRVBS
T0MpOyAgIC8vIElzc3VlICMyMjc5CiAKLSAgICAgIGlmICh0aGVfdHlwZSA9PSBudWxscHRy
KQorc3RhdGljIHZvaWQgbWFya19zdHJ1Y3RfdW5pb25fYm9keShjaHVua190ICpzdGFydCkK
K3sKKyAgIExPR19GVU5DX0VOVFJZKCk7CisgICBjaHVua190ICpwYyA9IHN0YXJ0OworCisg
ICB3aGlsZSAoICBwYyAhPSBudWxscHRyCisgICAgICAgICAmJiBwYy0+bGV2ZWwgPj0gc3Rh
cnQtPmxldmVsCisgICAgICAgICAmJiAhKHBjLT5sZXZlbCA9PSBzdGFydC0+bGV2ZWwgJiYg
Y2h1bmtfaXNfdG9rZW4ocGMsIENUX0JSQUNFX0NMT1NFKSkpCisgICB7CisgICAgICBpZiAo
ICBjaHVua19pc190b2tlbihwYywgQ1RfQlJBQ0VfT1BFTikKKyAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHBjLCBDVF9CUkFDRV9DTE9TRSkKKyAgICAgICAgIHx8IGNodW5rX2lzX3Rv
a2VuKHBjLCBDVF9TRU1JQ09MT04pKQogICAgICAgewotICAgICAgICAgcmV0dXJuOworICAg
ICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsKKworICAgICAgICAgaWYgKHBj
ID09IG51bGxwdHIpCisgICAgICAgICB7CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAg
IH0KICAgICAgIH0KLSAgICAgIGNodW5rX3QgKm9wZW5fcGFyZW4gPSBudWxscHRyOwogCi0g
ICAgICBpZiAoY2h1bmtfaXNfcGFyZW5fY2xvc2UodGhlX3R5cGUpKQorICAgICAgaWYgKGNo
dW5rX2lzX3Rva2VuKHBjLCBDVF9BTElHTikpCiAgICAgICB7Ci0gICAgICAgICBvcGVuX3Bh
cmVuID0gY2h1bmtfc2tpcF90b19tYXRjaF9yZXYodGhlX3R5cGUpOwotICAgICAgICAgbWFy
a19mdW5jdGlvbl90eXBlKHRoZV90eXBlKTsKLSAgICAgICAgIHRoZV90eXBlID0gY2h1bmtf
Z2V0X3ByZXZfbmNubG5pKHRoZV90eXBlLCBzY29wZV9lOjpQUkVQUk9DKTsgICAvLyBJc3N1
ZSAjMjI3OQorICAgICAgICAgcGMgPSBza2lwX2FsaWduKHBjKTsgLy8gImFsaWduKHgpIiBv
ciAiYWxpZ24oeCk6IgogCi0gICAgICAgICBpZiAodGhlX3R5cGUgPT0gbnVsbHB0cikKKyAg
ICAgICAgIGlmIChwYyA9PSBudWxscHRyKQogICAgICAgICAgewotICAgICAgICAgICAgcmV0
dXJuOworICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICB9CiAgICAgICBl
bHNlCiAgICAgICB7Ci0gICAgICAgICAvLyBtdXN0IGJlOiAidHlwZWRlZiA8cmV0dXJuIHR5
cGU+ZnVuYyhwYXJhbXMpOyIKLSAgICAgICAgIHNldF9jaHVua190eXBlKHRoZV90eXBlLCBD
VF9GVU5DX1RZUEUpOworICAgICAgICAgcGMgPSBmaXhfdmFyaWFibGVfZGVmaW5pdGlvbihw
Yyk7CisKKyAgICAgICAgIGlmIChwYyA9PSBudWxscHRyKQorICAgICAgICAgeworICAgICAg
ICAgICAgYnJlYWs7CisgICAgICAgICB9CiAgICAgICB9Ci0gICAgICBzZXRfY2h1bmtfcGFy
ZW50KHRoZV90eXBlLCBDVF9UWVBFREVGKTsKKyAgIH0KK30gLy8gbWFya19zdHJ1Y3RfdW5p
b25fYm9keQogCi0gICAgICBMT0dfRk1UKExUWVBFREVGLCAiJXMoJWQpOiBmY24gdHlwZWRl
ZiB0ZXh0KCkgJyVzJywgb24gb3JpZ19saW5lICV6dVxuIiwKLSAgICAgICAgICAgICAgX19m
dW5jX18sIF9fTElORV9fLCB0aGVfdHlwZS0+dGV4dCgpLCB0aGVfdHlwZS0+b3JpZ19saW5l
KTsKIAotICAgICAgLy8gSWYgd2UgYXJlIGFsaWduaW5nIG9uIHRoZSBvcGVuIHBhcmVudGhl
c2lzLCBncmFiIHRoYXQgaW5zdGVhZAotICAgICAgbG9nX3J1bGVfQigiYWxpZ25fdHlwZWRl
Zl9mdW5jIik7Cit2b2lkIG1hcmtfY29tbWVudHModm9pZCkKK3sKKyAgIExPR19GVU5DX0VO
VFJZKCk7CiAKLSAgICAgIGlmIChvcGVuX3BhcmVuICE9IG51bGxwdHIgJiYgb3B0aW9uczo6
YWxpZ25fdHlwZWRlZl9mdW5jKCkgPT0gMSkKLSAgICAgIHsKLSAgICAgICAgIHRoZV90eXBl
ID0gb3Blbl9wYXJlbjsKLSAgICAgIH0KLSAgICAgIGxvZ19ydWxlX0IoImFsaWduX3R5cGVk
ZWZfZnVuYyIpOworICAgY3BkLnVuY19zdGFnZSA9IHVuY19zdGFnZV9lOjpNQVJLX0NPTU1F
TlRTOwogCi0gICAgICBpZiAob3B0aW9uczo6YWxpZ25fdHlwZWRlZl9mdW5jKCkgIT0gMCkK
LSAgICAgIHsKLSAgICAgICAgIExPR19GTVQoTFRZUEVERUYsICIlcyglZCk6ICAtLSBhbGln
biBhbmNob3Igb24gdGV4dCgpICVzLCBAIG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dVxu
IiwKLSAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCB0aGVfdHlwZS0+dGV4
dCgpLCB0aGVfdHlwZS0+b3JpZ19saW5lLCB0aGVfdHlwZS0+b3JpZ19jb2wpOwotICAgICAg
ICAgY2h1bmtfZmxhZ3Nfc2V0KHRoZV90eXBlLCBQQ0ZfQU5DSE9SKTsKLSAgICAgIH0KLSAg
ICAgIC8vIGFscmVhZHkgZGlkIGV2ZXJ5dGhpbmcgd2UgbmVlZCB0byBkbwotICAgICAgcmV0
dXJuOwotICAgfQotICAgLyoKLSAgICAqIFNraXAgb3ZlciBlbnVtL3N0cnVjdC91bmlvbiBz
dHVmZiwgYXMgd2Uga25vdyBpdCBpc24ndCBhIHJldHVybiB0eXBlCi0gICAgKiBmb3IgYSBm
dW5jdGlvbiB0eXBlCi0gICAgKi8KLSAgIGNodW5rX3QgKmFmdGVyID0gY2h1bmtfZ2V0X25l
eHRfbmNubChzdGFydCwgc2NvcGVfZTo6UFJFUFJPQyk7CisgICBib29sICAgIHByZXZfbmwg
PSB0cnVlOworICAgY2h1bmtfdCAqY3VyICAgID0gY2h1bmtfZ2V0X2hlYWQoKTsKIAotICAg
aWYgKGFmdGVyID09IG51bGxwdHIpCisgICB3aGlsZSAoY3VyICE9IG51bGxwdHIpCiAgICB7
Ci0gICAgICByZXR1cm47Ci0gICB9CisgICAgICBjaHVua190ICpuZXh0ICAgPSBjaHVua19n
ZXRfbmV4dF9udmIoY3VyKTsKKyAgICAgIGJvb2wgICAgbmV4dF9ubCA9IChuZXh0ID09IG51
bGxwdHIpIHx8IGNodW5rX2lzX25ld2xpbmUobmV4dCk7CiAKLSAgIGlmICggIGFmdGVyLT50
eXBlICE9IENUX0VOVU0KLSAgICAgICYmIGFmdGVyLT50eXBlICE9IENUX1NUUlVDVAotICAg
ICAgJiYgYWZ0ZXItPnR5cGUgIT0gQ1RfVU5JT04pCi0gICB7Ci0gICAgICBpZiAodGhlX3R5
cGUgIT0gbnVsbHB0cikKKyAgICAgIGlmIChjaHVua19pc19jb21tZW50KGN1cikpCiAgICAg
ICB7Ci0gICAgICAgICAvLyBXZSBoYXZlIGp1c3QgYSByZWd1bGFyIHR5cGVkZWYKLSAgICAg
ICAgIExPR19GTVQoTFRZUEVERUYsICIlcyglZCk6IHJlZ3VsYXIgdHlwZWRlZiB0ZXh0KCkg
JXMsIG9uIG9yaWdfbGluZSAlenVcbiIsCi0gICAgICAgICAgICAgICAgIF9fZnVuY19fLCBf
X0xJTkVfXywgdGhlX3R5cGUtPnRleHQoKSwgdGhlX3R5cGUtPm9yaWdfbGluZSk7Ci0gICAg
ICAgICBjaHVua19mbGFnc19zZXQodGhlX3R5cGUsIFBDRl9BTkNIT1IpOworICAgICAgICAg
aWYgKG5leHRfbmwgJiYgcHJldl9ubCkKKyAgICAgICAgIHsKKyAgICAgICAgICAgIHNldF9j
aHVua19wYXJlbnQoY3VyLCBDVF9DT01NRU5UX1dIT0xFKTsKKyAgICAgICAgIH0KKyAgICAg
ICAgIGVsc2UgaWYgKG5leHRfbmwpCisgICAgICAgICB7CisgICAgICAgICAgICBzZXRfY2h1
bmtfcGFyZW50KGN1ciwgQ1RfQ09NTUVOVF9FTkQpOworICAgICAgICAgfQorICAgICAgICAg
ZWxzZSBpZiAocHJldl9ubCkKKyAgICAgICAgIHsKKyAgICAgICAgICAgIHNldF9jaHVua19w
YXJlbnQoY3VyLCBDVF9DT01NRU5UX1NUQVJUKTsKKyAgICAgICAgIH0KKyAgICAgICAgIGVs
c2UKKyAgICAgICAgIHsKKyAgICAgICAgICAgIHNldF9jaHVua19wYXJlbnQoY3VyLCBDVF9D
T01NRU5UX0VNQkVEKTsKKyAgICAgICAgIH0KICAgICAgIH0KLSAgICAgIHJldHVybjsKKyAg
ICAgIHByZXZfbmwgPSBjaHVua19pc19uZXdsaW5lKGN1cik7CisgICAgICBjdXIgICAgID0g
bmV4dDsKICAgIH0KLSAgIC8vIFdlIGhhdmUgYSBzdHJ1Y3QvdW5pb24vZW51bSwgbmV4dCBz
aG91bGQgYmUgZWl0aGVyIGEgdHlwZSBvciB7Ci0gICBjaHVua190ICpuZXh0ID0gY2h1bmtf
Z2V0X25leHRfbmNubChhZnRlciwgc2NvcGVfZTo6UFJFUFJPQyk7Cit9CiAKLSAgIGlmIChu
ZXh0ID09IG51bGxwdHIpCi0gICB7Ci0gICAgICByZXR1cm47Ci0gICB9CiAKLSAgIGlmIChj
aHVua19pc190b2tlbihuZXh0LCBDVF9UWVBFKSkKLSAgIHsKLSAgICAgIG5leHQgPSBjaHVu
a19nZXRfbmV4dF9uY25sKG5leHQsIHNjb3BlX2U6OlBSRVBST0MpOworc3RhdGljIHZvaWQg
bWFya19kZWZpbmVfZXhwcmVzc2lvbnModm9pZCkKK3sKKyAgIExPR19GVU5DX0VOVFJZKCk7
CiAKLSAgICAgIGlmIChuZXh0ID09IG51bGxwdHIpCi0gICAgICB7Ci0gICAgICAgICByZXR1
cm47Ci0gICAgICB9Ci0gICB9CisgICBib29sICAgIGluX2RlZmluZSA9IGZhbHNlOworICAg
Ym9vbCAgICBmaXJzdCAgICAgPSB0cnVlOworICAgY2h1bmtfdCAqcGMgICAgICAgPSBjaHVu
a19nZXRfaGVhZCgpOworICAgY2h1bmtfdCAqcHJldiAgICAgPSBwYzsKIAotICAgaWYgKGNo
dW5rX2lzX3Rva2VuKG5leHQsIENUX0JSQUNFX09QRU4pKQorICAgd2hpbGUgKHBjICE9IG51
bGxwdHIpCiAgICB7Ci0gICAgICAvLyBTa2lwIHRvIHRoZSBjbG9zaW5nIGJyYWNlCi0gICAg
ICBjaHVua190ICpicl9jID0gY2h1bmtfZ2V0X25leHRfdHlwZShuZXh0LCBDVF9CUkFDRV9D
TE9TRSwgbmV4dC0+bGV2ZWwsIHNjb3BlX2U6OlBSRVBST0MpOwotCi0gICAgICBpZiAoYnJf
YyAhPSBudWxscHRyKQorICAgICAgaWYgKCFpbl9kZWZpbmUpCiAgICAgICB7Ci0gICAgICAg
ICBjb25zdCBjX3Rva2VuX3QgdGFnID0gYWZ0ZXItPnR5cGU7Ci0gICAgICAgICBzZXRfY2h1
bmtfcGFyZW50KG5leHQsIHRhZyk7Ci0gICAgICAgICBzZXRfY2h1bmtfcGFyZW50KGJyX2Ms
IHRhZyk7Ci0KLSAgICAgICAgIGlmICh0YWcgPT0gQ1RfRU5VTSkKKyAgICAgICAgIGlmICgg
IGNodW5rX2lzX3Rva2VuKHBjLCBDVF9QUF9ERUZJTkUpCisgICAgICAgICAgICB8fCBjaHVu
a19pc190b2tlbihwYywgQ1RfUFBfSUYpCisgICAgICAgICAgICB8fCBjaHVua19pc190b2tl
bihwYywgQ1RfUFBfRUxTRSkpCiAgICAgICAgICB7Ci0gICAgICAgICAgICBmbGFnX3Nlcmll
cyhhZnRlciwgYnJfYywgUENGX0lOX0VOVU0pOworICAgICAgICAgICAgaW5fZGVmaW5lID0g
dHJ1ZTsKKyAgICAgICAgICAgIGZpcnN0ICAgICA9IHRydWU7CiAgICAgICAgICB9Ci0gICAg
ICAgICBlbHNlIGlmICh0YWcgPT0gQ1RfU1RSVUNUKQorICAgICAgfQorICAgICAgZWxzZQor
ICAgICAgeworICAgICAgICAgaWYgKCFwYy0+ZmxhZ3MudGVzdChQQ0ZfSU5fUFJFUFJPQykg
fHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1BSRVBST0MpKQogICAgICAgICAgewotICAgICAg
ICAgICAgZmxhZ19zZXJpZXMoYWZ0ZXIsIGJyX2MsIFBDRl9JTl9TVFJVQ1QpOworICAgICAg
ICAgICAgaW5fZGVmaW5lID0gZmFsc2U7CisgICAgICAgICB9CisgICAgICAgICBlbHNlCisg
ICAgICAgICB7CisgICAgICAgICAgICBpZiAoICBwYy0+dHlwZSAhPSBDVF9NQUNSTworICAg
ICAgICAgICAgICAgJiYgKCAgZmlyc3QKKyAgICAgICAgICAgICAgICAgIHx8IGNodW5rX2lz
X3Rva2VuKHByZXYsIENUX1BBUkVOX09QRU4pCisgICAgICAgICAgICAgICAgICB8fCBjaHVu
a19pc190b2tlbihwcmV2LCBDVF9BUklUSCkKKyAgICAgICAgICAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHByZXYsIENUX0NBUkVUKQorICAgICAgICAgICAgICAgICAgfHwgY2h1bmtf
aXNfdG9rZW4ocHJldiwgQ1RfQVNTSUdOKQorICAgICAgICAgICAgICAgICAgfHwgY2h1bmtf
aXNfdG9rZW4ocHJldiwgQ1RfQ09NUEFSRSkKKyAgICAgICAgICAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHByZXYsIENUX1JFVFVSTikKKyAgICAgICAgICAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHByZXYsIENUX0dPVE8pCisgICAgICAgICAgICAgICAgICB8fCBjaHVua19p
c190b2tlbihwcmV2LCBDVF9DT05USU5VRSkKKyAgICAgICAgICAgICAgICAgIHx8IGNodW5r
X2lzX3Rva2VuKHByZXYsIENUX0ZQQVJFTl9PUEVOKQorICAgICAgICAgICAgICAgICAgfHwg
Y2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfU1BBUkVOX09QRU4pCisgICAgICAgICAgICAgICAg
ICB8fCBjaHVua19pc190b2tlbihwcmV2LCBDVF9CUkFDRV9PUEVOKQorICAgICAgICAgICAg
ICAgICAgfHwgY2h1bmtfaXNfc2VtaWNvbG9uKHByZXYpCisgICAgICAgICAgICAgICAgICB8
fCBjaHVua19pc190b2tlbihwcmV2LCBDVF9DT01NQSkKKyAgICAgICAgICAgICAgICAgIHx8
IGNodW5rX2lzX3Rva2VuKHByZXYsIENUX0NPTE9OKQorICAgICAgICAgICAgICAgICAgfHwg
Y2h1bmtfaXNfdG9rZW4ocHJldiwgQ1RfUVVFU1RJT04pKSkKKyAgICAgICAgICAgIHsKKyAg
ICAgICAgICAgICAgIGNodW5rX2ZsYWdzX3NldChwYywgUENGX0VYUFJfU1RBUlQpOworICAg
ICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKKyAgICAgICAgICAgIH0KICAgICAgICAgIH0K
ICAgICAgIH0KKyAgICAgIHByZXYgPSBwYzsKKyAgICAgIHBjICAgPSBjaHVua19nZXRfbmV4
dChwYyk7CiAgICB9Ci0KLSAgIGlmICh0aGVfdHlwZSAhPSBudWxscHRyKQotICAgewotICAg
ICAgTE9HX0ZNVChMVFlQRURFRiwgIiVzKCVkKTogJXMgdHlwZWRlZiB0ZXh0KCkgJXMsIG9u
IG9yaWdfbGluZSAlenVcbiIsCi0gICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywg
Z2V0X3Rva2VuX25hbWUoYWZ0ZXItPnR5cGUpLCB0aGVfdHlwZS0+dGV4dCgpLAotICAgICAg
ICAgICAgICB0aGVfdHlwZS0+b3JpZ19saW5lKTsKLSAgICAgIGNodW5rX2ZsYWdzX3NldCh0
aGVfdHlwZSwgUENGX0FOQ0hPUik7Ci0gICB9Ci19IC8vIGZpeF90eXBlZGVmCi0KLQotLy9z
dGF0aWMgdm9pZCBtYXJrX3ZhcmlhYmxlX3N0YWNrKENodW5rU3RhY2sgJmNzLCBsb2dfc2V2
X3Qgc2V2KQotLy97Ci0vLyAgIFVOVVNFRChzZXYpOwotLy8gICBMT0dfRlVOQ19FTlRSWSgp
OwotLy8KLS8vICAgLy8gdGhyb3cgb3V0IHRoZSBsYXN0IHdvcmQgYW5kIG1hcmsgdGhlIHJl
c3QKLS8vICAgY2h1bmtfdCAqdmFyX25hbWUgPSBjcy5Qb3BfQmFjaygpOwotLy8KLS8vICAg
aWYgKHZhcl9uYW1lICYmIHZhcl9uYW1lLT5wcmV2LT50eXBlID09IENUX0RDX01FTUJFUikK
LS8vICAgewotLy8gICAgICBjcy5QdXNoX0JhY2sodmFyX25hbWUpOwotLy8gICB9Ci0vLwot
Ly8gICBpZiAodmFyX25hbWUgIT0gbnVsbHB0cikKLS8vICAgewotLy8gICAgICBMT0dfRk1U
KExGQ05QLCAiJXMoJWQpOiBwYXJhbWV0ZXIgb24gb3JpZ19saW5lICV6dSwgb3JpZ19jb2wg
JXp1OlxuIiwKLS8vICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHZhcl9uYW1l
LT5vcmlnX2xpbmUsIHZhcl9uYW1lLT5vcmlnX2NvbCk7Ci0vLwotLy8gICAgICBzaXplX3Qg
IHdvcmRfY250ID0gMDsKLS8vICAgICAgY2h1bmtfdCAqd29yZF90eXBlOwotLy8KLS8vICAg
ICAgd2hpbGUgKCh3b3JkX3R5cGUgPSBjcy5Qb3BfQmFjaygpKSAhPSBudWxscHRyKQotLy8g
ICAgICB7Ci0vLyAgICAgICAgIGlmIChjaHVua19pc190b2tlbih3b3JkX3R5cGUsIENUX1dP
UkQpIHx8IGNodW5rX2lzX3Rva2VuKHdvcmRfdHlwZSwgQ1RfVFlQRSkpCi0vLyAgICAgICAg
IHsKLS8vICAgICAgICAgICAgTE9HX0ZNVChMRkNOUCwgIiVzKCVkKTogcGFyYW1ldGVyIG9u
IG9yaWdfbGluZSAlenUsIG9yaWdfY29sICV6dTogPCVzPiBhcyBUWVBFXG4iLAotLy8gICAg
ICAgICAgICAgICAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgdmFyX25hbWUtPm9yaWdfbGlu
ZSwgdmFyX25hbWUtPm9yaWdfY29sLCB3b3JkX3R5cGUtPnRleHQoKSk7Ci0vLyAgICAgICAg
ICAgIHNldF9jaHVua190eXBlKHdvcmRfdHlwZSwgQ1RfVFlQRSk7Ci0vLyAgICAgICAgICAg
IGNodW5rX2ZsYWdzX3NldCh3b3JkX3R5cGUsIFBDRl9WQVJfVFlQRSk7Ci0vLyAgICAgICAg
IH0KLS8vICAgICAgICAgd29yZF9jbnQrKzsKLS8vICAgICAgfQotLy8KLS8vICAgICAgaWYg
KGNodW5rX2lzX3Rva2VuKHZhcl9uYW1lLCBDVF9XT1JEKSkKLS8vICAgICAgewotLy8gICAg
ICAgICBpZiAod29yZF9jbnQgPiAwKQotLy8gICAgICAgICB7Ci0vLyAgICAgICAgICAgIExP
R19GTVQoTEZDTlAsICIlcyglZCk6IHBhcmFtZXRlciBvbiBvcmlnX2xpbmUgJXp1LCBvcmln
X2NvbCAlenU6IDwlcz4gYXMgVkFSXG4iLAotLy8gICAgICAgICAgICAgICAgICAgIF9fZnVu
Y19fLCBfX0xJTkVfXywgdmFyX25hbWUtPm9yaWdfbGluZSwgdmFyX25hbWUtPm9yaWdfY29s
LCB2YXJfbmFtZS0+dGV4dCgpKTsKLS8vICAgICAgICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHZh
cl9uYW1lLCBQQ0ZfVkFSX0RFRik7Ci0vLyAgICAgICAgIH0KLS8vICAgICAgICAgZWxzZQot
Ly8gICAgICAgICB7Ci0vLyAgICAgICAgICAgIExPR19GTVQoTEZDTlAsICIlcyglZCk6IHBh
cmFtZXRlciBvbiBvcmlnX2xpbmUgJXp1LCBvcmlnX2NvbCAlenU6IDwlcz4gYXMgVFlQRVxu
IiwKLS8vICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHZhcl9uYW1l
LT5vcmlnX2xpbmUsIHZhcl9uYW1lLT5vcmlnX2NvbCwgdmFyX25hbWUtPnRleHQoKSk7Ci0v
LyAgICAgICAgICAgIHNldF9jaHVua190eXBlKHZhcl9uYW1lLCBDVF9UWVBFKTsKLS8vICAg
ICAgICAgICAgY2h1bmtfZmxhZ3Nfc2V0KHZhcl9uYW1lLCBQQ0ZfVkFSX1RZUEUpOwotLy8g
ICAgICAgICB9Ci0vLyAgICAgIH0KLS8vICAgfQotLy99IC8vIG1hcmtfdmFyaWFibGVfc3Rh
Y2sKLQotCi0vL3N0YXRpYyB2b2lkIGZpeF9mY25fZGVmX3BhcmFtcyhjaHVua190ICpzdGFy
dCkKLS8vewotLy8gICBMT0dfRlVOQ19FTlRSWSgpOwotLy8KLS8vICAgaWYgKHN0YXJ0ID09
IG51bGxwdHIpCi0vLyAgIHsKLS8vICAgICAgcmV0dXJuOwotLy8gICB9Ci0vLyAgIExPR19G
TVQoTEZDTlAsICIlcyglZCk6IHRleHQoKSAnJXMnLCB0eXBlIGlzICVzLCBvbiBvcmlnX2xp
bmUgJXp1LCBsZXZlbCBpcyAlenVcbiIsCi0vLyAgICAgICAgICAgX19mdW5jX18sIF9fTElO
RV9fLCBzdGFydC0+dGV4dCgpLCBnZXRfdG9rZW5fbmFtZShzdGFydC0+dHlwZSksIHN0YXJ0
LT5vcmlnX2xpbmUsIHN0YXJ0LT5sZXZlbCk7Ci0vLwotLy8gICB3aGlsZSAoc3RhcnQgIT0g
bnVsbHB0ciAmJiAhY2h1bmtfaXNfcGFyZW5fb3BlbihzdGFydCkpCi0vLyAgIHsKLS8vICAg
ICAgc3RhcnQgPSBjaHVua19nZXRfbmV4dF9uY25sKHN0YXJ0KTsKLS8vICAgfQotLy8KLS8v
ICAgaWYgKHN0YXJ0ID09IG51bGxwdHIpLy8gQ292ZXJpdHkgQ0lEIDc2MDAzLCAxMTAwNzgy
Ci0vLyAgIHsKLS8vICAgICAgcmV0dXJuOwotLy8gICB9Ci0vLyAgIC8vIGVuc3VyZSBzdGFy
dCBjaHVuayBob2xkcyBhIHNpbmdsZSAnKCcgY2hhcmFjdGVyCi0vLyAgIGFzc2VydCgoc3Rh
cnQtPmxlbigpID09IDEpICYmIChzdGFydC0+c3RyWzBdID09ICcoJykpOwotLy8KLS8vICAg
Q2h1bmtTdGFjayBjczsKLS8vICAgc2l6ZV90ICAgICBsZXZlbCA9IHN0YXJ0LT5sZXZlbCAr
IDE7Ci0vLyAgIGNodW5rX3QgICAgKnBjICAgPSBzdGFydDsKLS8vCi0vLyAgIHdoaWxlICgo
cGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKSkgIT0gbnVsbHB0cikKLS8vICAgewotLy8g
ICAgICBpZiAoICAoKHN0YXJ0LT5sZW4oKSA9PSAxKSAmJiAoc3RhcnQtPnN0clswXSA9PSAn
KScpKQotLy8gICAgICAgICB8fCBwYy0+bGV2ZWwgPCBsZXZlbCkKLS8vICAgICAgewotLy8g
ICAgICAgICBMT0dfRk1UKExGQ05QLCAiJXMoJWQpOiBiYWlsZWQgb24gdGV4dCgpICclcycs
IG9uIG9yaWdfbGluZSAlenVcbiIsCi0vLyAgICAgICAgICAgICAgICAgX19mdW5jX18sIF9f
TElORV9fLCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5lKTsKLS8vICAgICAgICAgYnJlYWs7
Ci0vLyAgICAgIH0KLS8vICAgICAgTE9HX0ZNVChMRkNOUCwgIiVzKCVkKTogJXMsIHRleHQo
KSAnJXMnIG9uIG9yaWdfbGluZSAlenUsIGxldmVsICV6dVxuIiwKLS8vICAgICAgICAgICAg
ICBfX2Z1bmNfXywgX19MSU5FX18sIChwYy0+bGV2ZWwgPiBsZXZlbCkgPyAic2tpcHBpbmci
IDogImxvb2tpbmcgYXQiLAotLy8gICAgICAgICAgICAgIHBjLT50ZXh0KCksIHBjLT5vcmln
X2xpbmUsIHBjLT5sZXZlbCk7Ci0vLwotLy8gICAgICBpZiAocGMtPmxldmVsID4gbGV2ZWwp
Ci0vLyAgICAgIHsKLS8vICAgICAgICAgY29udGludWU7Ci0vLyAgICAgIH0KLS8vCi0vLyAg
ICAgIGlmIChjaHVua19pc19zdGFyKHBjKSB8fCBjaHVua19pc19tc3JlZihwYykgfHwgY2h1
bmtfaXNfbnVsbGFibGUocGMpKQotLy8gICAgICB7Ci0vLyAgICAgICAgIHNldF9jaHVua190
eXBlKHBjLCBDVF9QVFJfVFlQRSk7Ci0vLyAgICAgICAgIGNzLlB1c2hfQmFjayhwYyk7Ci0v
LyAgICAgIH0KLS8vICAgICAgZWxzZSBpZiAoICBjaHVua19pc190b2tlbihwYywgQ1RfQU1Q
KQotLy8gICAgICAgICAgICAgIHx8IChsYW5ndWFnZV9pc19zZXQoTEFOR19DUFApICYmIGNo
dW5rX2lzX3N0cihwYywgIiYmIiwgMikpKQotLy8gICAgICB7Ci0vLyAgICAgICAgIHNldF9j
aHVua190eXBlKHBjLCBDVF9CWVJFRik7Ci0vLyAgICAgICAgIGNzLlB1c2hfQmFjayhwYyk7
Ci0vLyAgICAgIH0KLS8vICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RZ
UEVfV1JBUCkpCi0vLyAgICAgIHsKLS8vICAgICAgICAgY3MuUHVzaF9CYWNrKHBjKTsKLS8v
ICAgICAgfQotLy8gICAgICBlbHNlIGlmIChjaHVua19pc190b2tlbihwYywgQ1RfV09SRCkg
fHwgY2h1bmtfaXNfdG9rZW4ocGMsIENUX1RZUEUpKQotLy8gICAgICB7Ci0vLyAgICAgICAg
IGNzLlB1c2hfQmFjayhwYyk7Ci0vLyAgICAgIH0KLS8vICAgICAgZWxzZSBpZiAoY2h1bmtf
aXNfdG9rZW4ocGMsIENUX0NPTU1BKSB8fCBjaHVua19pc190b2tlbihwYywgQ1RfQVNTSUdO
KSkKLS8vICAgICAgewotLy8gICAgICAgICBtYXJrX3ZhcmlhYmxlX3N0YWNrKGNzLCBMRkNO
UCk7Ci0vLwotLy8gICAgICAgICBpZiAoY2h1bmtfaXNfdG9rZW4ocGMsIENUX0FTU0lHTikp
Ci0vLyAgICAgICAgIHsKLS8vICAgICAgICAgICAgLy8gTWFyayBhc3NpZ25tZW50IGZvciBk
ZWZhdWx0IHBhcmFtIHNwYWNpbmcKLS8vICAgICAgICAgICAgc2V0X2NodW5rX3BhcmVudChw
YywgQ1RfRlVOQ19QUk9UTyk7Ci0vLyAgICAgICAgIH0KLS8vICAgICAgfQotLy8gICB9Ci0v
LyAgIG1hcmtfdmFyaWFibGVfc3RhY2soY3MsIExGQ05QKTsKLS8vfSAvLyBmaXhfZmNuX2Rl
Zl9wYXJhbXMKK30gLy8gbWFya19kZWZpbmVfZXhwcmVzc2lvbnMKIAogCiBzdGF0aWMgdm9p
ZCBoYW5kbGVfY3BwX3RlbXBsYXRlKGNodW5rX3QgKnBjKQpAQCAtMzQwMSw2ICs1OTI5LDQ5
IEBAIHN0YXRpYyB2b2lkIGhhbmRsZV9jcHBfbGFtYmRhKGNodW5rX3QgKnNxX28pCiB9IC8v
IGhhbmRsZV9jcHBfbGFtYmRhCiAKIAorc3RhdGljIGNodW5rX3QgKmdldF9kX3RlbXBsYXRl
X3R5cGVzKENodW5rU3RhY2sgJmNzLCBjaHVua190ICpvcGVuX3BhcmVuKQoreworICAgTE9H
X0ZVTkNfRU5UUlkoKTsKKyAgIGNodW5rX3QgKnRtcCAgICAgICA9IG9wZW5fcGFyZW47Cisg
ICBib29sICAgIG1heWJlX3R5cGUgPSB0cnVlOworCisgICB3aGlsZSAoICAoKHRtcCA9IGNo
dW5rX2dldF9uZXh0X25jbmwodG1wKSkgIT0gbnVsbHB0cikKKyAgICAgICAgICYmIHRtcC0+
bGV2ZWwgPiBvcGVuX3BhcmVuLT5sZXZlbCkKKyAgIHsKKyAgICAgIGlmIChjaHVua19pc190
b2tlbih0bXAsIENUX1RZUEUpIHx8IGNodW5rX2lzX3Rva2VuKHRtcCwgQ1RfV09SRCkpCisg
ICAgICB7CisgICAgICAgICBpZiAobWF5YmVfdHlwZSkKKyAgICAgICAgIHsKKyAgICAgICAg
ICAgIG1ha2VfdHlwZSh0bXApOworICAgICAgICAgICAgY3MuUHVzaF9CYWNrKHRtcCk7Cisg
ICAgICAgICB9CisgICAgICAgICBtYXliZV90eXBlID0gZmFsc2U7CisgICAgICB9CisgICAg
ICBlbHNlIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX0NPTU1BKSkKKyAgICAgIHsKKyAg
ICAgICAgIG1heWJlX3R5cGUgPSB0cnVlOworICAgICAgfQorICAgfQorICAgcmV0dXJuKHRt
cCk7Cit9CisKKworc3RhdGljIGJvb2wgY2h1bmtzdGFja19tYXRjaChDaHVua1N0YWNrICZj
cywgY2h1bmtfdCAqcGMpCit7CisgICBmb3IgKHNpemVfdCBpZHggPSAwOyBpZHggPCBjcy5M
ZW4oKTsgaWR4KyspCisgICB7CisgICAgICBjaHVua190ICp0bXAgPSBjcy5HZXRDaHVuayhp
ZHgpOworCisgICAgICBpZiAocGMtPnN0ci5lcXVhbHModG1wLT5zdHIpKQorICAgICAgewor
ICAgICAgICAgcmV0dXJuKHRydWUpOworICAgICAgfQorICAgfQorCisgICByZXR1cm4oZmFs
c2UpOworfQorCisKIHN0YXRpYyB2b2lkIGhhbmRsZV9kX3RlbXBsYXRlKGNodW5rX3QgKnBj
KQogewogICAgTE9HX0ZVTkNfRU5UUlkoKTsKQEAgLTM0NjQsNiArNjAzNSw5NCBAQCBzdGF0
aWMgdm9pZCBoYW5kbGVfZF90ZW1wbGF0ZShjaHVua190ICpwYykKIH0gLy8gaGFuZGxlX2Rf
dGVtcGxhdGUKIAogCitzdGF0aWMgdm9pZCBtYXJrX3RlbXBsYXRlX2Z1bmMoY2h1bmtfdCAq
cGMsIGNodW5rX3QgKnBjX25leHQpCit7CisgICBMT0dfRlVOQ19FTlRSWSgpOworCisgICAv
LyBXZSBrbm93IGFuZ2xlX2Nsb3NlIG11c3QgYmUgdGhlcmUuLi4KKyAgIGNodW5rX3QgKmFu
Z2xlX2Nsb3NlID0gY2h1bmtfZ2V0X25leHRfdHlwZShwY19uZXh0LCBDVF9BTkdMRV9DTE9T
RSwgcGMtPmxldmVsKTsKKyAgIGNodW5rX3QgKmFmdGVyICAgICAgID0gY2h1bmtfZ2V0X25l
eHRfbmNubChhbmdsZV9jbG9zZSk7CisKKyAgIGlmIChhZnRlciAhPSBudWxscHRyKQorICAg
eworICAgICAgaWYgKGNodW5rX2lzX3N0cihhZnRlciwgIigiLCAxKSkKKyAgICAgIHsKKyAg
ICAgICAgIGlmIChhbmdsZV9jbG9zZS0+ZmxhZ3MudGVzdChQQ0ZfSU5fRkNOX0NBTEwpKQor
ICAgICAgICAgeworICAgICAgICAgICAgTE9HX0ZNVChMVEVNUEZVTkMsICIlcyglZCk6IG1h
cmtpbmcgJyVzJyBpbiBsaW5lICV6dSBhcyBhIEZVTkNfQ0FMTFxuIiwKKyAgICAgICAgICAg
ICAgICAgICAgX19mdW5jX18sIF9fTElORV9fLCBwYy0+dGV4dCgpLCBwYy0+b3JpZ19saW5l
KTsKKyAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVzKCVkKTogKDE2KSBTRVQgVE8gQ1Rf
RlVOQ19DQUxMOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmlnX2NvbCBpcyAlenUsIHRleHQoKSAn
JXMnXG4iLAorICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgX19MSU5FX18sIHBjLT5v
cmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQoKSk7CisgICAgICAgICAgICBzZXRf
Y2h1bmtfdHlwZShwYywgQ1RfRlVOQ19DQUxMKTsKKyAgICAgICAgICAgIGZsYWdfcGFyZW5z
KGFmdGVyLCBQQ0ZfSU5fRkNOX0NBTEwsIENUX0ZQQVJFTl9PUEVOLCBDVF9GVU5DX0NBTEws
IGZhbHNlKTsKKyAgICAgICAgIH0KKyAgICAgICAgIGVsc2UKKyAgICAgICAgIHsKKyAgICAg
ICAgICAgIC8qCisgICAgICAgICAgICAgKiBNaWdodCBiZSBhIGZ1bmN0aW9uIGRlZi4gTXVz
dCBjaGVjayB3aGF0IGlzIGJlZm9yZSB0aGUgdGVtcGxhdGU6CisgICAgICAgICAgICAgKiBG
dW5jIGNhbGw6CisgICAgICAgICAgICAgKiAgIEJUcmVlLkluc2VydChzdGQ6OnBhaXI8aW50
LCBkb3VibGU+KCppdCwgZG91YmxlKCppdCkgKyAxLjApKTsKKyAgICAgICAgICAgICAqICAg
YSA9IFRlc3Q8aW50PihqKTsKKyAgICAgICAgICAgICAqICAgc3RkOjpwYWlyPGludCwgZG91
YmxlPigqaXQsIGRvdWJsZSgqaXQpICsgMS4wKSk7CisgICAgICAgICAgICAgKi8KKworICAg
ICAgICAgICAgTE9HX0ZNVChMVEVNUEZVTkMsICIlcyglZCk6IG1hcmtpbmcgJyVzJyBpbiBs
aW5lICV6dSBhcyBhIEZVTkNfQ0FMTCAyXG4iLAorICAgICAgICAgICAgICAgICAgICBfX2Z1
bmNfXywgX19MSU5FX18sIHBjLT50ZXh0KCksIHBjLT5vcmlnX2xpbmUpOworICAgICAgICAg
ICAgLy8gaXRzIGEgZnVuY3Rpb24hISEKKyAgICAgICAgICAgIExPR19GTVQoTEZDTiwgIiVz
KCVkKTogKDE3KSBTRVQgVE8gQ1RfRlVOQ19DQUxMOiBvcmlnX2xpbmUgaXMgJXp1LCBvcmln
X2NvbCBpcyAlenUsIHRleHQoKSAnJXMnXG4iLAorICAgICAgICAgICAgICAgICAgICBfX2Z1
bmNfXywgX19MSU5FX18sIHBjLT5vcmlnX2xpbmUsIHBjLT5vcmlnX2NvbCwgcGMtPnRleHQo
KSk7CisgICAgICAgICAgICBzZXRfY2h1bmtfdHlwZShwYywgQ1RfRlVOQ19DQUxMKTsKKyAg
ICAgICAgICAgIG1hcmtfZnVuY3Rpb24ocGMpOworICAgICAgICAgfQorICAgICAgfQorICAg
ICAgZWxzZSBpZiAoY2h1bmtfaXNfdG9rZW4oYWZ0ZXIsIENUX1dPUkQpKQorICAgICAgewor
ICAgICAgICAgLy8gaXRzIGEgdHlwZSEKKyAgICAgICAgIHNldF9jaHVua190eXBlKHBjLCBD
VF9UWVBFKTsKKyAgICAgICAgIGNodW5rX2ZsYWdzX3NldChwYywgUENGX1ZBUl9UWVBFKTsK
KyAgICAgICAgIGNodW5rX2ZsYWdzX3NldChhZnRlciwgUENGX1ZBUl9ERUYpOworICAgICAg
fQorICAgfQorfSAvLyBtYXJrX3RlbXBsYXRlX2Z1bmMKKworCitzdGF0aWMgdm9pZCBtYXJr
X2V4ZWNfc3FsKGNodW5rX3QgKnBjKQoreworICAgTE9HX0ZVTkNfRU5UUlkoKTsKKyAgIGNo
dW5rX3QgKnRtcDsKKworICAgLy8gQ2hhbmdlIENUX1dPUkQgdG8gQ1RfU1FMX1dPUkQKKyAg
IGZvciAodG1wID0gY2h1bmtfZ2V0X25leHQocGMpOyB0bXAgIT0gbnVsbHB0cjsgdG1wID0g
Y2h1bmtfZ2V0X25leHQodG1wKSkKKyAgIHsKKyAgICAgIHNldF9jaHVua19wYXJlbnQodG1w
LCBwYy0+dHlwZSk7CisKKyAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX1dPUkQp
KQorICAgICAgeworICAgICAgICAgc2V0X2NodW5rX3R5cGUodG1wLCBDVF9TUUxfV09SRCk7
CisgICAgICB9CisKKyAgICAgIGlmIChjaHVua19pc190b2tlbih0bXAsIENUX1NFTUlDT0xP
TikpCisgICAgICB7CisgICAgICAgICBicmVhazsKKyAgICAgIH0KKyAgIH0KKworICAgaWYg
KCAgcGMtPnR5cGUgIT0gQ1RfU1FMX0JFR0lOCisgICAgICB8fCB0bXAgPT0gbnVsbHB0cgor
ICAgICAgfHwgdG1wLT50eXBlICE9IENUX1NFTUlDT0xPTikKKyAgIHsKKyAgICAgIHJldHVy
bjsKKyAgIH0KKworICAgZm9yICh0bXAgPSBjaHVua19nZXRfbmV4dCh0bXApOworICAgICAg
ICB0bXAgIT0gbnVsbHB0ciAmJiB0bXAtPnR5cGUgIT0gQ1RfU1FMX0VORDsKKyAgICAgICAg
dG1wID0gY2h1bmtfZ2V0X25leHQodG1wKSkKKyAgIHsKKyAgICAgIHRtcC0+bGV2ZWwrKzsK
KyAgIH0KK30KKworCiBjaHVua190ICpza2lwX3RlbXBsYXRlX25leHQoY2h1bmtfdCAqYW5n
X29wZW4pCiB7CiAgICBpZiAoY2h1bmtfaXNfdG9rZW4oYW5nX29wZW4sIENUX0FOR0xFX09Q
RU4pKQpAQCAtMzQ3NSw2ICs2MTM0LDY2IEBAIGNodW5rX3QgKnNraXBfdGVtcGxhdGVfbmV4
dChjaHVua190ICphbmdfb3BlbikKIH0KIAogCitjaHVua190ICpza2lwX3RlbXBsYXRlX3By
ZXYoY2h1bmtfdCAqYW5nX2Nsb3NlKQoreworICAgaWYgKGNodW5rX2lzX3Rva2VuKGFuZ19j
bG9zZSwgQ1RfQU5HTEVfQ0xPU0UpKQorICAgeworICAgICAgY2h1bmtfdCAqcGMgPSBjaHVu
a19nZXRfcHJldl90eXBlKGFuZ19jbG9zZSwgQ1RfQU5HTEVfT1BFTiwgYW5nX2Nsb3NlLT5s
ZXZlbCk7CisgICAgICByZXR1cm4oY2h1bmtfZ2V0X3ByZXZfbmNubG5pKHBjKSk7ICAgLy8g
SXNzdWUgIzIyNzkKKyAgIH0KKyAgIHJldHVybihhbmdfY2xvc2UpOworfQorCisKK2NodW5r
X3QgKnNraXBfdHNxdWFyZV9uZXh0KGNodW5rX3QgKmFyeV9kZWYpCit7CisgICBpZiAoY2h1
bmtfaXNfdG9rZW4oYXJ5X2RlZiwgQ1RfU1FVQVJFX09QRU4pIHx8IGNodW5rX2lzX3Rva2Vu
KGFyeV9kZWYsIENUX1RTUVVBUkUpKQorICAgeworICAgICAgcmV0dXJuKGNodW5rX2dldF9u
ZXh0X25pc3EoYXJ5X2RlZikpOworICAgfQorICAgcmV0dXJuKGFyeV9kZWYpOworfQorCisK
K2NodW5rX3QgKnNraXBfYXR0cmlidXRlX25leHQoY2h1bmtfdCAqYXR0cikKK3sKKyAgIGNo
dW5rX3QgKnBjID0gYXR0cjsKKworICAgd2hpbGUgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9B
VFRSSUJVVEUpKQorICAgeworICAgICAgcGMgPSBjaHVua19nZXRfbmV4dF9uY25sKHBjKTsK
KworICAgICAgaWYgKGNodW5rX2lzX3Rva2VuKHBjLCBDVF9GUEFSRU5fT1BFTikpCisgICAg
ICB7CisgICAgICAgICBwYyA9IGNodW5rX2dldF9uZXh0X3R5cGUocGMsIENUX0ZQQVJFTl9D
TE9TRSwgcGMtPmxldmVsKTsKKyAgICAgICAgIHBjID0gY2h1bmtfZ2V0X25leHRfbmNubChw
Yyk7CisgICAgICB9CisgICB9CisgICByZXR1cm4ocGMpOworfQorCisKK2NodW5rX3QgKnNr
aXBfYXR0cmlidXRlX3ByZXYoY2h1bmtfdCAqZnBfY2xvc2UpCit7CisgICBjaHVua190ICpw
YyA9IGZwX2Nsb3NlOworCisgICB3aGlsZSAodHJ1ZSkKKyAgIHsKKyAgICAgIGlmICggIGNo
dW5rX2lzX3Rva2VuKHBjLCBDVF9GUEFSRU5fQ0xPU0UpCisgICAgICAgICAmJiBnZXRfY2h1
bmtfcGFyZW50X3R5cGUocGMpID09IENUX0FUVFJJQlVURSkKKyAgICAgIHsKKyAgICAgICAg
IHBjID0gY2h1bmtfZ2V0X3ByZXZfdHlwZShwYywgQ1RfQVRUUklCVVRFLCBwYy0+bGV2ZWwp
OworICAgICAgfQorICAgICAgZWxzZSBpZiAoY2h1bmtfaXNfbm90X3Rva2VuKHBjLCBDVF9B
VFRSSUJVVEUpKQorICAgICAgeworICAgICAgICAgYnJlYWs7CisgICAgICB9CisgICAgICBw
YyA9IGNodW5rX2dldF9wcmV2X25jbmxuaShwYyk7ICAgLy8gSXNzdWUgIzIyNzkKKyAgIH0K
KyAgIHJldHVybihwYyk7Cit9CisKKwogc3RhdGljIHZvaWQgaGFuZGxlX29jX2NsYXNzKGNo
dW5rX3QgKnBjKQogewogICAgZW51bSBjbGFzcyBhbmdsZV9zdGF0ZV9lIDogdW5zaWduZWQg
aW50Cg==
--------------E0C971C11DC220B22925FC86--
