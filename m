From: Daniel White <daniel@whitehouse.id.au>
Subject: [StGit PATCH] Fixes for auto-generation of man pages
Date: Tue, 9 Sep 2008 17:17:21 +1000
Message-ID: <20080909171721.2c7974a1@whitehouse.id.au>
References: <20080908210302.1957.44280.stgit@yoghurt>
	<20080908210811.1957.16419.stgit@yoghurt>
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Cc: Catalin Marinas <catalin.marinas@gmail.com>, git@vger.kernel.org
To: Karl =?UTF-8?B?SGFzc2Vsc3Ryw7Zt?= <kha@treskal.com>
X-From: git-owner@vger.kernel.org Tue Sep 09 09:34:18 2008
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git-2@gmane.org
Received: from vger.kernel.org ([209.132.176.167])
	by lo.gmane.org with esmtp (Exim 4.50)
	id 1Kcxjf-0007co-5M
	for gcvg-git-2@gmane.org; Tue, 09 Sep 2008 09:34:03 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1754093AbYIIHcu (ORCPT <rfc822;gcvg-git-2@m.gmane.org>);
	Tue, 9 Sep 2008 03:32:50 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1754116AbYIIHcu
	(ORCPT <rfc822;git-outgoing>); Tue, 9 Sep 2008 03:32:50 -0400
Received: from mx252n.mysite4now.com ([216.10.248.252]:1157 "EHLO
	mx252n.mysite4now.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1753540AbYIIHct (ORCPT <rfc822;git@vger.kernel.org>);
	Tue, 9 Sep 2008 03:32:49 -0400
X-Greylist: delayed 903 seconds by postgrey-1.27 at vger.kernel.org; Tue, 09 Sep 2008 03:32:49 EDT
Received: from ppp118-208-76-25.lns1.bne4.internode.on.net [118.208.76.25] by mx252n.mysite4now.com with SMTP;
   Tue, 9 Sep 2008 00:17:22 -0700
In-Reply-To: <20080908210811.1957.16419.stgit@yoghurt>
X-Mailer: Claws Mail 3.5.0 (GTK+ 2.12.11; x86_64-pc-linux-gnu)
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/95346>

stg.txt is the only man page not generated by stg-build --commands.
Provide this page explicitly instead of including all other
commands twice.

stg-cmd-list.txt is only a template for inclusion in other man 
pages, so rename to stop it being built along with other stg-* 
files.

Signed-off-by: Daniel White <daniel@whitehouse.id.au>
---
 Documentation/.gitignore |    1 +
 Documentation/Makefile   |    6 +++---
 Documentation/stg.txt    |    2 +-
 3 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/Documentation/.gitignore b/Documentation/.gitignore
index 32dd09d..c72f35c 100644
--- a/Documentation/.gitignore
+++ b/Documentation/.gitignore
@@ -3,3 +3,4 @@
 *.[1-9]
 stg-*.txt
 doc.dep
+command-list.txt
diff --git a/Documentation/Makefile b/Documentation/Makefile
index 85e9600..165e222 100644
--- a/Documentation/Makefile
+++ b/Documentation/Makefile
@@ -1,7 +1,7 @@
 COMMANDS = $(shell ../stg-build --commands)
 COMMANDS_TXT = $(patsubst %,stg-%.txt,$(COMMANDS))
 
-MAN1_TXT=$(wildcard stg*.txt) $(COMMANDS_TXT)
+MAN1_TXT= stg.txt $(COMMANDS_TXT)
 
 DOC_HTML=$(patsubst %.txt,%.html,$(MAN1_TXT))
 
@@ -60,14 +60,14 @@ doc.dep : $(wildcard *.txt) build-docdep.perl
 -include doc.dep
 
 clean:
-	rm -f *.xml *.html *.pdf *.1 doc.dep $(COMMANDS_TXT) stg-cmd-list.txt
+	rm -f *.xml *.html *.pdf *.1 doc.dep $(COMMANDS_TXT) command-list.txt
 
 ALL_PY = $(shell find ../stgit -name '*.py')
 
 $(COMMANDS_TXT): $(ALL_PY)
 	../stg-build --asciidoc $(basename $(subst stg-,,$@)) > $@
 
-stg-cmd-list.txt: $(ALL_PY)
+command-list.txt: $(ALL_PY)
 	../stg-build --cmd-list > $@
 
 %.html : %.txt
diff --git a/Documentation/stg.txt b/Documentation/stg.txt
index b4184b2..d8f7d01 100644
--- a/Documentation/stg.txt
+++ b/Documentation/stg.txt
@@ -105,7 +105,7 @@ description is available in individual command manpages.  Those
 manpages are named 'stg-<command>(1)'.
 endif::backend-docbook[]
 
-include::stg-cmd-list.txt[]
+include::command-list.txt[]
 
 CONFIGURATION MECHANISM
 -----------------------
-- 
1.6.0.1.220.g80d1
