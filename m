From: Eric Sunshine <sunshine@sunshineco.com>
Subject: Re: [PATCH 03/13] Makefile: introduce make-var helper function
Date: Thu, 6 Feb 2014 03:55:23 -0500
Message-ID: <CAPig+cTPUHJ6wDPWL_v=_7Zq6O=r2g2Hz02TQHZO+0gq60Fbnw@mail.gmail.com>
References: <20140205174823.GA15070@sigill.intra.peff.net>
	<20140205175002.GC15218@sigill.intra.peff.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Cc: Git List <git@vger.kernel.org>
To: Jeff King <peff@peff.net>
X-From: git-owner@vger.kernel.org Thu Feb 06 09:55:30 2014
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git-2@plane.gmane.org
Received: from vger.kernel.org ([209.132.180.67])
	by plane.gmane.org with esmtp (Exim 4.69)
	(envelope-from <git-owner@vger.kernel.org>)
	id 1WBKk5-0004k2-Nc
	for gcvg-git-2@plane.gmane.org; Thu, 06 Feb 2014 09:55:30 +0100
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1755499AbaBFIzZ (ORCPT <rfc822;gcvg-git-2@m.gmane.org>);
	Thu, 6 Feb 2014 03:55:25 -0500
Received: from mail-lb0-f170.google.com ([209.85.217.170]:39498 "EHLO
	mail-lb0-f170.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1754961AbaBFIzY (ORCPT <rfc822;git@vger.kernel.org>);
	Thu, 6 Feb 2014 03:55:24 -0500
Received: by mail-lb0-f170.google.com with SMTP id u14so1215274lbd.15
        for <git@vger.kernel.org>; Thu, 06 Feb 2014 00:55:23 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20120113;
        h=mime-version:sender:in-reply-to:references:date:message-id:subject
         :from:to:cc:content-type;
        bh=Q5DUknNaz21xrjVFXyPMQb/KPNHhs6y6OSKEKPJlpZQ=;
        b=FVwRRhSISjtiBznPl4s++kkh6YQEkkla+Vh8Uqg4/aGH7oIaESxAMQSIBbiyUElDcI
         3ct3uDyi1FHOth1aaicS9wrTbdHFvwcKtKv5y/s4B7lR9Ptpst2uJ2w8eDluRLIYLBgS
         5Oun/nxiEPAaeaZ7SFGYAzwevavudU3ogm7UGFoTOiwKobjqmAKM7ZzhhgQarNp+eZ7T
         LX4q6ighfBbdxFgxkoIMK7u3hLv42bQoXxAtZVUU6ZPZbxx0CAkkk1FKmzw3UpR+sypI
         6awCcZYH/vMQiuGH/5CM2MFzQQG2u3hz0rmPkzjnmEk1z4iMhKMHUFg91FSoWeFCRnB/
         yuFg==
X-Received: by 10.112.172.8 with SMTP id ay8mr760883lbc.41.1391676923187; Thu,
 06 Feb 2014 00:55:23 -0800 (PST)
Received: by 10.114.181.228 with HTTP; Thu, 6 Feb 2014 00:55:23 -0800 (PST)
In-Reply-To: <20140205175002.GC15218@sigill.intra.peff.net>
X-Google-Sender-Auth: iLcI_SoEHvwVewaVq29s2O5CTwk
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/241683>

On Wed, Feb 5, 2014 at 12:50 PM, Jeff King <peff@peff.net> wrote:
> It's a common pattern in our Makefile to echo some make
> variables into a file, but only if they are different from a
> previous run. This sentinel file can then be used as a
> dependency to trigger rebuilds when the make variable
> changes.
>
> The code to do this is a bit ugly and repetetive; let's

s/repetetive/repetitive/

> factor it out into a reusable function.
>
> Note that this relies on the "call" and "eval" functions of
> GNU make. We previously avoided using "call", as explained
> in 39c015c (Fixes for ancient versions of GNU make,
> 2006-02-18). However, it has been 8 years since then, so
> perhaps its use is acceptable now.
>
> The "call" function dates back to GNU make 3.77.90
> (1997-07-21). The "eval" function dates back to 3.80
> (2002-07-08).
>
> If it's still a problem to use these functions, we can
> do similar meta-programming with something like:
>
>         include magic.mak
>         magic.mak:
>                 ./generate-magic-rules >$@+
>                 mv $@+ $@
>
> where the rules are generated by a shell (or other) script.
>
> Signed-off-by: Jeff King <peff@peff.net>
