From: Brad Roberts <braddr@puremagic.com>
Subject: Re: Darcs-git: a few notes for Git hackers
Date: Sun, 15 May 2005 02:11:41 -0700 (PDT)
Message-ID: <Pine.LNX.4.44.0505150208020.2136-200000@bellevue.puremagic.com>
References: <Pine.LNX.4.44.0505141851340.2136-200000@bellevue.puremagic.com>
Mime-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-1110348602-1249053733-1116148301=:2136"
Cc: Juliusz Chroboczek <Juliusz.Chroboczek@pps.jussieu.fr>
X-From: git-owner@vger.kernel.org Sun May 15 11:16:54 2005
Return-path: <git-owner@vger.kernel.org>
Received: from vger.kernel.org ([12.107.209.244])
	by ciao.gmane.org with esmtp (Exim 4.43)
	id 1DXFEj-0003zp-Jj
	for gcvg-git@gmane.org; Sun, 15 May 2005 11:16:38 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261570AbVEOJQq (ORCPT <rfc822;gcvg-git@m.gmane.org>);
	Sun, 15 May 2005 05:16:46 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261573AbVEOJQq
	(ORCPT <rfc822;git-outgoing>); Sun, 15 May 2005 05:16:46 -0400
Received: from bellevue.puremagic.com ([209.189.198.108]:57253 "EHLO
	bellevue.puremagic.com") by vger.kernel.org with ESMTP
	id S261570AbVEOJMY (ORCPT <rfc822;git@vger.kernel.org>);
	Sun, 15 May 2005 05:12:24 -0400
Received: from bellevue.puremagic.com (localhost [127.0.0.1])
	by bellevue.puremagic.com (8.13.4/8.13.4/Debian-1) with ESMTP id j4F9Bg3o017879
	(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=NOT);
	Sun, 15 May 2005 02:11:42 -0700
Received: from localhost (braddr@localhost)
	by bellevue.puremagic.com (8.13.4/8.13.4/Submit) with ESMTP id j4F9BfHD017875;
	Sun, 15 May 2005 02:11:41 -0700
X-Authentication-Warning: bellevue.puremagic.com: braddr owned process doing -bs
To: git@vger.kernel.org, Petr Baudis <pasky@ucw.cz>
In-Reply-To: <Pine.LNX.4.44.0505141851340.2136-200000@bellevue.puremagic.com>
X-Virus-Scanned: by amavisd-new
Sender: git-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List: git@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---1110348602-1249053733-1116148301=:2136
Content-Type: TEXT/PLAIN; charset=US-ASCII

Resending, I left off the mailing list on the to list last time.

> > I wasn't able to finish redoing these against linus tip, but I got most of
> > it done (patches 1-14 of the original 19):
> >
> >   http://gameboy2.puremagic.com:8090/
> >   rsync://gameboy2.puremagic.com/git/
> >
> > The second, third, and forth to last changes need a careful review,
> > they're direct applications of the original patches which were lightly
> > tested during the first round and nothing other than compile tested in
> > this round.
> >
> > I suspect the remaining parts of the original patch series will go in
> > fairly smoothly.  If no one gets to them before tonight I'll finish
> > it up after work.
> >
> > Later,
> > Brad
>
> I've completed the re-merge, and moved to tip of git-pb.git rather than
> tip of git.git.  Unfortunatly that merge was also somewhat intrusive and
> my individual diffs along the way are somewhat useless now.  The entire
> history is available about the above locations still.  Attached is the
> full diff vs git-pb @ 902b92e00e491a60d55c4b2bce122903b8347f34.
>
> The unit tests that are being added are a wonderful thing, thanks so much
> for doing them Junio.
>
> These changes feel rough to me still.  Some areas to discuss / think
> about:
>
> 1) The hunks that change the merge routines from pointer based to index
> based could have been left much less intruded upon by adding a
> get_cache_entry_array(cache) api.
>
> 2) Should the index changing areas be constructing a new index instead of
> shuffling bits within the current index?
>
> 3) The vocabulary and code is inconsistent between cache and index.
>
> 4) read-cache.c does much more than reading.
>
> 5) Like before, cleaning up memory for the cache is a rarity, preferring
> to let the end of the process garbage collect everything.
>
>  cache.h          |   52 ++++++-------
>  check-files.c    |   12 +--
>  checkout-cache.c |   26 +++---
>  diff-cache.c     |   60 ++++++++-------
>  diff-files.c     |   31 ++++---
>  diff-helper.c    |    6 -
>  diff-tree.c      |   50 ++++++------
>  diff.c           |   36 +++++----
>  diff.h           |   11 +-
>  fsck-cache.c     |    6 -
>  local-pull.c     |    2
>  ls-files.c       |   47 ++++++-----
>  merge-cache.c    |   29 +++----
>  read-cache.c     |  217 ++++++++++++++++++++++++++++++++++---------------------
>  read-tree.c      |   65 +++++++++-------
>  sha1_file.c      |    4 -
>  tree.c           |   15 ++-
>  update-cache.c   |   45 +++++------
>  write-tree.c     |   29 ++++---
>  19 files changed, 416 insertions(+), 327 deletions(-)
>
> Signed-off-by: Brad Roberts <braddr@puremagic.com>
>
>


---1110348602-1249053733-1116148301=:2136
Content-Type: TEXT/PLAIN; charset=US-ASCII; name=diff-vs-git-pb
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.44.0505150211410.2136@bellevue.puremagic.com>
Content-Description: diff-vs-git-pb
Content-Disposition: attachment; filename=diff-vs-git-pb

SW5kZXg6IGNhY2hlLmgNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBj
OGM3N2Y2N2VhODVlZTY1YTBmMDU1ZjJjYjc2ZTYwNTllYWEwNzc2L2NhY2hl
LmggIChtb2RlOjEwMDY0NCkNCisrKyB1bmNvbW1pdHRlZC9jYWNoZS5oICAo
bW9kZToxMDA2NDQpDQpAQCAtNDAsMTkgKzQwLDggQEANCiANCiAvKg0KICAq
IEJhc2ljIGRhdGEgc3RydWN0dXJlcyBmb3IgdGhlIGRpcmVjdG9yeSBjYWNo
ZQ0KLSAqDQotICogTk9URSBOT1RFIE5PVEUhIFRoaXMgaXMgYWxsIGluIHRo
ZSBuYXRpdmUgQ1BVIGJ5dGUgZm9ybWF0LiBJdCdzDQotICogbm90IGV2ZW4g
dHJ5aW5nIHRvIGJlIHBvcnRhYmxlLiBJdCdzIHRyeWluZyB0byBiZSBlZmZp
Y2llbnQuIEl0J3MNCi0gKiBqdXN0IGEgY2FjaGUsIGFmdGVyIGFsbC4NCiAg
Ki8NCiANCi0jZGVmaW5lIENBQ0hFX1NJR05BVFVSRSAweDQ0NDk1MjQzCS8q
ICJESVJDIiAqLw0KLXN0cnVjdCBjYWNoZV9oZWFkZXIgew0KLQl1bnNpZ25l
ZCBpbnQgaGRyX3NpZ25hdHVyZTsNCi0JdW5zaWduZWQgaW50IGhkcl92ZXJz
aW9uOw0KLQl1bnNpZ25lZCBpbnQgaGRyX2VudHJpZXM7DQotfTsNCi0NCiAv
Kg0KICAqIFRoZSAiY2FjaGVfdGltZSIgaXMganVzdCB0aGUgbG93IDMyIGJp
dHMgb2YgdGhlDQogICogdGltZS4gSXQgZG9lc24ndCBtYXR0ZXIgaWYgaXQg
b3ZlcmZsb3dzIC0gd2Ugb25seQ0KQEAgLTg5LDYgKzc4LDkgQEANCiAjZGVm
aW5lIENFX1NUQUdFTUFTSyAoMHgzMDAwKQ0KICNkZWZpbmUgQ0VfU1RBR0VT
SElGVCAxMg0KIA0KK2V4dGVybiBpbnQgY2VfbWF0Y2hfc3RhdChzdHJ1Y3Qg
Y2FjaGVfZW50cnkgKmNlLCBzdHJ1Y3Qgc3RhdCAqc3QpOw0KK2V4dGVybiBp
bnQgY2Vfc2FtZV9uYW1lKHN0cnVjdCBjYWNoZV9lbnRyeSAqYSwgc3RydWN0
IGNhY2hlX2VudHJ5ICpiKTsNCisNCiAjZGVmaW5lIGNyZWF0ZV9jZV9mbGFn
cyhsZW4sIHN0YWdlKSBodG9ucygobGVuKSB8ICgoc3RhZ2UpIDw8IENFX1NU
QUdFU0hJRlQpKQ0KICNkZWZpbmUgY2VfbmFtZWxlbihjZSkgKENFX05BTUVN
QVNLICYgbnRvaHMoKGNlKS0+Y2VfZmxhZ3MpKQ0KICNkZWZpbmUgY2Vfc2l6
ZShjZSkgY2FjaGVfZW50cnlfc2l6ZShjZV9uYW1lbGVuKGNlKSkNCkBAIC0x
MDQsOSArOTYsNiBAQA0KIA0KICNkZWZpbmUgY2FjaGVfZW50cnlfc2l6ZShs
ZW4pICgob2Zmc2V0b2Yoc3RydWN0IGNhY2hlX2VudHJ5LG5hbWUpICsgKGxl
bikgKyA4KSAmIH43KQ0KIA0KLWV4dGVybiBzdHJ1Y3QgY2FjaGVfZW50cnkg
KiphY3RpdmVfY2FjaGU7DQotZXh0ZXJuIHVuc2lnbmVkIGludCBhY3RpdmVf
bnIsIGFjdGl2ZV9hbGxvYywgYWN0aXZlX2NhY2hlX2NoYW5nZWQ7DQotDQog
I2RlZmluZSBHSVRfRElSX0VOVklST05NRU5UICJHSVRfRElSIg0KICNkZWZp
bmUgREVGQVVMVF9HSVRfRElSX0VOVklST05NRU5UICIuZ2l0Ig0KICNkZWZp
bmUgREJfRU5WSVJPTk1FTlQgIkdJVF9PQkpFQ1RfRElSRUNUT1JZIg0KQEAg
LTEyMCwxNyArMTA5LDE5IEBADQogI2RlZmluZSBhbGxvY19ucih4KSAoKCh4
KSsxNikqMy8yKQ0KIA0KIC8qIEluaXRpYWxpemUgYW5kIHVzZSB0aGUgY2Fj
aGUgaW5mb3JtYXRpb24gKi8NCi1leHRlcm4gaW50IHJlYWRfY2FjaGUodm9p
ZCk7DQotZXh0ZXJuIGludCB3cml0ZV9jYWNoZShpbnQgbmV3ZmQsIHN0cnVj
dCBjYWNoZV9lbnRyeSAqKmNhY2hlLCBpbnQgZW50cmllcyk7DQotZXh0ZXJu
IGludCBjYWNoZV9uYW1lX3Bvcyhjb25zdCBjaGFyICpuYW1lLCBpbnQgbmFt
ZWxlbik7DQorZXh0ZXJuIHN0cnVjdCBjYWNoZSAqbmV3X2NhY2hlKHZvaWQp
Ow0KK2V4dGVybiBzdHJ1Y3QgY2FjaGUgKnJlYWRfY2FjaGUodm9pZCk7DQor
ZXh0ZXJuIGludCB3cml0ZV9jYWNoZShzdHJ1Y3QgY2FjaGUgKmNhY2hlLCBp
bnQgbmV3ZmQpOw0KK2V4dGVybiB2b2lkIGZyZWVfY2FjaGUoc3RydWN0IGNh
Y2hlICpjYWNoZSk7DQorZXh0ZXJuIGludCBjYWNoZV9uYW1lX3BvcyhzdHJ1
Y3QgY2FjaGUgKmNhY2hlLCBjb25zdCBjaGFyICpuYW1lLCBpbnQgbmFtZWxl
bik7DQogI2RlZmluZSBBRERfQ0FDSEVfT0tfVE9fQUREIDEJCS8qIE9rIHRv
IGFkZCAqLw0KICNkZWZpbmUgQUREX0NBQ0hFX09LX1RPX1JFUExBQ0UgMgkv
KiBPayB0byByZXBsYWNlIGZpbGUvZGlyZWN0b3J5ICovDQotZXh0ZXJuIGlu
dCBhZGRfY2FjaGVfZW50cnkoc3RydWN0IGNhY2hlX2VudHJ5ICpjZSwgaW50
IG9wdGlvbik7DQotZXh0ZXJuIGludCByZW1vdmVfZW50cnlfYXQoaW50IHBv
cyk7DQotZXh0ZXJuIGludCByZW1vdmVfZmlsZV9mcm9tX2NhY2hlKGNoYXIg
KnBhdGgpOw0KLWV4dGVybiBpbnQgc2FtZV9uYW1lKHN0cnVjdCBjYWNoZV9l
bnRyeSAqYSwgc3RydWN0IGNhY2hlX2VudHJ5ICpiKTsNCi1leHRlcm4gaW50
IGNhY2hlX21hdGNoX3N0YXQoc3RydWN0IGNhY2hlX2VudHJ5ICpjZSwgc3Ry
dWN0IHN0YXQgKnN0KTsNCi1leHRlcm4gaW50IGluZGV4X2ZkKHVuc2lnbmVk
IGNoYXIgKnNoYTEsIGludCBmZCwgc3RydWN0IHN0YXQgKnN0KTsNCitleHRl
cm4gaW50IGFkZF9jYWNoZV9lbnRyeShzdHJ1Y3QgY2FjaGUgKmNhY2hlLCBz
dHJ1Y3QgY2FjaGVfZW50cnkgKmNlLCBpbnQgb3B0aW9uKTsNCitleHRlcm4g
aW50IHJlbW92ZV9maWxlX2Zyb21fY2FjaGUoc3RydWN0IGNhY2hlICpjYWNo
ZSwgY2hhciAqcGF0aCk7DQorZXh0ZXJuIGludCBnZXRfbnVtX2NhY2hlX2Vu
dHJpZXMoc3RydWN0IGNhY2hlICpjYWNoZSk7DQorZXh0ZXJuIHN0cnVjdCBj
YWNoZV9lbnRyeSAqZ2V0X2NhY2hlX2VudHJ5KHN0cnVjdCBjYWNoZSAqY2Fj
aGUsIGludCBwb3MpOw0KK2V4dGVybiB2b2lkIHNldF9jYWNoZV9lbnRyeShz
dHJ1Y3QgY2FjaGUgKmNhY2hlLCBzdHJ1Y3QgY2FjaGVfZW50cnkgKmNlLCBp
bnQgcG9zKTsNCitleHRlcm4gaW50IHJlbW92ZV9jYWNoZV9lbnRyeV9hdChz
dHJ1Y3QgY2FjaGUgKmNhY2hlLCBpbnQgcG9zKTsNCiANCiAjZGVmaW5lIE1U
SU1FX0NIQU5HRUQJMHgwMDAxDQogI2RlZmluZSBDVElNRV9DSEFOR0VECTB4
MDAwMg0KQEAgLTE0OCwxMSArMTM5LDEyIEBADQogZXh0ZXJuIHZvaWQgKiB1
bnBhY2tfc2hhMV9maWxlKHZvaWQgKm1hcCwgdW5zaWduZWQgbG9uZyBtYXBz
aXplLCBjaGFyICp0eXBlLCB1bnNpZ25lZCBsb25nICpzaXplKTsNCiBleHRl
cm4gdm9pZCAqIHJlYWRfc2hhMV9maWxlKGNvbnN0IHVuc2lnbmVkIGNoYXIg
KnNoYTEsIGNoYXIgKnR5cGUsIHVuc2lnbmVkIGxvbmcgKnNpemUpOw0KIGV4
dGVybiBpbnQgd3JpdGVfc2hhMV9maWxlKGNoYXIgKmJ1ZiwgdW5zaWduZWQg
bG9uZyBsZW4sIGNvbnN0IGNoYXIgKnR5cGUsIHVuc2lnbmVkIGNoYXIgKnJl
dHVybl9zaGExKTsNCitleHRlcm4gaW50IGluZGV4X2ZkKHVuc2lnbmVkIGNo
YXIgKnNoYTEsIGludCBmZCwgc3RydWN0IHN0YXQgKnN0KTsNCiANCiBleHRl
cm4gaW50IGNoZWNrX3NoYTFfc2lnbmF0dXJlKHVuc2lnbmVkIGNoYXIgKnNo
YTEsIHZvaWQgKmJ1ZiwgdW5zaWduZWQgbG9uZyBzaXplLCBjb25zdCBjaGFy
ICp0eXBlKTsNCiANCiAvKiBSZWFkIGEgdHJlZSBpbnRvIHRoZSBjYWNoZSAq
Lw0KLWV4dGVybiBpbnQgcmVhZF90cmVlKHZvaWQgKmJ1ZmZlciwgdW5zaWdu
ZWQgbG9uZyBzaXplLCBpbnQgc3RhZ2UpOw0KK2V4dGVybiBpbnQgcmVhZF90
cmVlKHN0cnVjdCBjYWNoZSAqY2FjaGUsIHZvaWQgKmJ1ZmZlciwgdW5zaWdu
ZWQgbG9uZyBzaXplLCBpbnQgc3RhZ2UpOw0KIA0KIGV4dGVybiBpbnQgd3Jp
dGVfc2hhMV9mcm9tX2ZkKGNvbnN0IHVuc2lnbmVkIGNoYXIgKnNoYTEsIGlu
dCBmZCk7DQogDQpAQCAtMTc5LDcgKzE3MSw3IEBADQogdm9pZCBwYXJzZV9k
YXRlKGNoYXIgKmRhdGUsIGNoYXIgKmJ1ZiwgaW50IGJ1ZnNpemUpOw0KIHZv
aWQgZGF0ZXN0YW1wKGNoYXIgKmJ1ZiwgaW50IGJ1ZnNpemUpOw0KIA0KLXN0
YXRpYyBpbmxpbmUgdm9pZCAqeG1hbGxvYyhpbnQgc2l6ZSkNCitzdGF0aWMg
aW5saW5lIHZvaWQgKnhtYWxsb2Moc2l6ZV90IHNpemUpDQogew0KIAl2b2lk
ICpyZXQgPSBtYWxsb2Moc2l6ZSk7DQogCWlmICghcmV0KQ0KQEAgLTE4Nyw3
ICsxNzksNyBAQA0KIAlyZXR1cm4gcmV0Ow0KIH0NCiANCi1zdGF0aWMgaW5s
aW5lIHZvaWQgKnhyZWFsbG9jKHZvaWQgKnB0ciwgaW50IHNpemUpDQorc3Rh
dGljIGlubGluZSB2b2lkICp4cmVhbGxvYyh2b2lkICpwdHIsIHNpemVfdCBz
aXplKQ0KIHsNCiAJdm9pZCAqcmV0ID0gcmVhbGxvYyhwdHIsIHNpemUpOw0K
IAlpZiAoIXJldCkNCkBAIC0xOTUsNCArMTg3LDEyIEBADQogCXJldHVybiBy
ZXQ7DQogfQ0KIA0KK3N0YXRpYyBpbmxpbmUgdm9pZCAqeGNhbGxvYyhzaXpl
X3Qgbm1lbWIsIHNpemVfdCBzaXplKQ0KK3sNCisJdm9pZCAqcmV0ID0gY2Fs
bG9jKG5tZW1iLCBzaXplKTsNCisJaWYgKCFyZXQpDQorCQlkaWUoIk91dCBv
ZiBtZW1vcnksIGNhbGxvYyBmYWlsZWQiKTsNCisJcmV0dXJuIHJldDsNCit9
DQorDQogI2VuZGlmIC8qIENBQ0hFX0ggKi8NCkluZGV4OiBjaGVjay1maWxl
cy5jDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gYzhjNzdmNjdlYTg1
ZWU2NWEwZjA1NWYyY2I3NmU2MDU5ZWFhMDc3Ni9jaGVjay1maWxlcy5jICAo
bW9kZToxMDA2NDQpDQorKysgdW5jb21taXR0ZWQvY2hlY2stZmlsZXMuYyAg
KG1vZGU6MTAwNjQ0KQ0KQEAgLTgsNyArOCw3IEBADQogICovDQogI2luY2x1
ZGUgImNhY2hlLmgiDQogDQotc3RhdGljIHZvaWQgY2hlY2tfZmlsZShjb25z
dCBjaGFyICpwYXRoKQ0KK3N0YXRpYyB2b2lkIGNoZWNrX2ZpbGUoc3RydWN0
IGNhY2hlICpjYWNoZSwgY29uc3QgY2hhciAqcGF0aCkNCiB7DQogCWludCBm
ZCA9IG9wZW4ocGF0aCwgT19SRE9OTFkpOw0KIAlzdHJ1Y3QgY2FjaGVfZW50
cnkgKmNlOw0KQEAgLTIzLDE1ICsyMywxNSBAQA0KIAl9DQogDQogCS8qIEV4
aXN0cyBidXQgaXMgbm90IGluIHRoZSBjYWNoZSBpcyBub3QgZmluZSAqLw0K
LQlwb3MgPSBjYWNoZV9uYW1lX3BvcyhwYXRoLCBzdHJsZW4ocGF0aCkpOw0K
Kwlwb3MgPSBjYWNoZV9uYW1lX3BvcyhjYWNoZSwgcGF0aCwgc3RybGVuKHBh
dGgpKTsNCiAJaWYgKHBvcyA8IDApDQogCQlkaWUoInByZXBhcmluZyB0byB1
cGRhdGUgZXhpc3RpbmcgZmlsZSAnJXMnIG5vdCBpbiBjYWNoZSIsIHBhdGgp
Ow0KLQljZSA9IGFjdGl2ZV9jYWNoZVtwb3NdOw0KKwljZSA9IGdldF9jYWNo
ZV9lbnRyeShjYWNoZSwgcG9zKTsNCiANCiAJaWYgKGxzdGF0KHBhdGgsICZz
dCkgPCAwKQ0KIAkJZGllKCJsc3RhdCglcyk6ICVzIiwgcGF0aCwgc3RyZXJy
b3IoZXJybm8pKTsNCiANCi0JY2hhbmdlZCA9IGNhY2hlX21hdGNoX3N0YXQo
Y2UsICZzdCk7DQorCWNoYW5nZWQgPSBjZV9tYXRjaF9zdGF0KGNlLCAmc3Qp
Ow0KIAlpZiAoY2hhbmdlZCkNCiAJCWRpZSgicHJlcGFyaW5nIHRvIHVwZGF0
ZSBmaWxlICclcycgbm90IHVwdG9kYXRlIGluIGNhY2hlIiwgcGF0aCk7DQog
fQ0KQEAgLTM5LDkgKzM5LDkgQEANCiBpbnQgbWFpbihpbnQgYXJnYywgY2hh
ciAqKmFyZ3YpDQogew0KIAlpbnQgaTsNCisJc3RydWN0IGNhY2hlICpjYWNo
ZSA9IHJlYWRfY2FjaGUoKTsNCiANCi0JcmVhZF9jYWNoZSgpOw0KIAlmb3Ig
KGkgPSAxOyBpIDwgYXJnYyA7IGkrKykNCi0JCWNoZWNrX2ZpbGUoYXJndltp
XSk7DQorCQljaGVja19maWxlKGNhY2hlLCBhcmd2W2ldKTsNCiAJcmV0dXJu
IDA7DQogfQ0KSW5kZXg6IGNoZWNrb3V0LWNhY2hlLmMNCj09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT0NCi0tLSBjOGM3N2Y2N2VhODVlZTY1YTBmMDU1ZjJjYjc2
ZTYwNTllYWEwNzc2L2NoZWNrb3V0LWNhY2hlLmMgIChtb2RlOjEwMDY0NCkN
CisrKyB1bmNvbW1pdHRlZC9jaGVja291dC1jYWNoZS5jICAobW9kZToxMDA2
NDQpDQpAQCAtMTY3LDcgKzE2Nyw3IEBADQogCXN0cmNweShwYXRoICsgbGVu
LCBjZS0+bmFtZSk7DQogDQogCWlmICghbHN0YXQocGF0aCwgJnN0KSkgew0K
LQkJdW5zaWduZWQgY2hhbmdlZCA9IGNhY2hlX21hdGNoX3N0YXQoY2UsICZz
dCk7DQorCQl1bnNpZ25lZCBjaGFuZ2VkID0gY2VfbWF0Y2hfc3RhdChjZSwg
JnN0KTsNCiAJCWlmICghY2hhbmdlZCkNCiAJCQlyZXR1cm4gMDsNCiAJCWlm
ICghZm9yY2UpIHsNCkBAIC0xODgsMzAgKzE4OCwzMCBAQA0KIAlyZXR1cm4g
d3JpdGVfZW50cnkoY2UsIHBhdGgpOw0KIH0NCiANCi1zdGF0aWMgaW50IGNo
ZWNrb3V0X2ZpbGUoY29uc3QgY2hhciAqbmFtZSwgY29uc3QgY2hhciAqYmFz
ZV9kaXIpDQorc3RhdGljIGludCBjaGVja291dF9maWxlKHN0cnVjdCBjYWNo
ZSAqY2FjaGUsIGNvbnN0IGNoYXIgKm5hbWUsIGNvbnN0IGNoYXIgKmJhc2Vf
ZGlyKQ0KIHsNCi0JaW50IHBvcyA9IGNhY2hlX25hbWVfcG9zKG5hbWUsIHN0
cmxlbihuYW1lKSk7DQorCWludCBwb3MgPSBjYWNoZV9uYW1lX3BvcyhjYWNo
ZSwgbmFtZSwgc3RybGVuKG5hbWUpKTsNCiAJaWYgKHBvcyA8IDApIHsNCiAJ
CWlmICghcXVpZXQpIHsNCiAJCQlwb3MgPSAtcG9zIC0gMTsNCiAJCQlmcHJp
bnRmKHN0ZGVyciwNCiAJCQkJImNoZWNrb3V0LWNhY2hlOiAlcyBpcyAlcy5c
biIsDQogCQkJCW5hbWUsDQotCQkJCShwb3MgPCBhY3RpdmVfbnIgJiYNCi0J
CQkJICFzdHJjbXAoYWN0aXZlX2NhY2hlW3Bvc10tPm5hbWUsIG5hbWUpKSA/
DQorCQkJCShwb3MgPCBnZXRfbnVtX2NhY2hlX2VudHJpZXMoY2FjaGUpICYm
DQorCQkJCSAhc3RyY21wKGdldF9jYWNoZV9lbnRyeShjYWNoZSwgcG9zKS0+
bmFtZSwgbmFtZSkpID8NCiAJCQkJInVubWVyZ2VkIiA6ICJub3QgaW4gdGhl
IGNhY2hlIik7DQogCQl9DQogCQlyZXR1cm4gLTE7DQogCX0NCi0JcmV0dXJu
IGNoZWNrb3V0X2VudHJ5KGFjdGl2ZV9jYWNoZVtwb3NdLCBiYXNlX2Rpcik7
DQorCXJldHVybiBjaGVja291dF9lbnRyeShnZXRfY2FjaGVfZW50cnkoY2Fj
aGUsIHBvcyksIGJhc2VfZGlyKTsNCiB9DQogDQotc3RhdGljIGludCBjaGVj
a291dF9hbGwoY29uc3QgY2hhciAqYmFzZV9kaXIpDQorc3RhdGljIGludCBj
aGVja291dF9hbGwoc3RydWN0IGNhY2hlICpjYWNoZSwgY29uc3QgY2hhciAq
YmFzZV9kaXIpDQogew0KIAlpbnQgaTsNCiANCi0JZm9yIChpID0gMDsgaSA8
IGFjdGl2ZV9uciA7IGkrKykgew0KLQkJc3RydWN0IGNhY2hlX2VudHJ5ICpj
ZSA9IGFjdGl2ZV9jYWNoZVtpXTsNCisJZm9yIChpID0gMDsgaSA8IGdldF9u
dW1fY2FjaGVfZW50cmllcyhjYWNoZSkgOyBpKyspIHsNCisJCXN0cnVjdCBj
YWNoZV9lbnRyeSAqY2UgPSBnZXRfY2FjaGVfZW50cnkoY2FjaGUsIGkpOw0K
IAkJaWYgKGNlX3N0YWdlKGNlKSkNCiAJCQljb250aW51ZTsNCiAJCWlmIChj
aGVja291dF9lbnRyeShjZSwgYmFzZV9kaXIpIDwgMCkNCkBAIC0yMjUsMTUg
KzIyNSwxNSBAQA0KIAlpbnQgaSwgZm9yY2VfZmlsZW5hbWUgPSAwOw0KIAlj
b25zdCBjaGFyICpiYXNlX2RpciA9ICIiOw0KIA0KLQlpZiAocmVhZF9jYWNo
ZSgpIDwgMCkgew0KKwlzdHJ1Y3QgY2FjaGUgKmNhY2hlID0gcmVhZF9jYWNo
ZSgpOw0KKwlpZiAoIWNhY2hlKSANCiAJCWRpZSgiaW52YWxpZCBjYWNoZSIp
Ow0KLQl9DQogDQogCWZvciAoaSA9IDE7IGkgPCBhcmdjOyBpKyspIHsNCiAJ
CWNvbnN0IGNoYXIgKmFyZyA9IGFyZ3ZbaV07DQogCQlpZiAoIWZvcmNlX2Zp
bGVuYW1lKSB7DQogCQkJaWYgKCFzdHJjbXAoYXJnLCAiLWEiKSkgew0KLQkJ
CQljaGVja291dF9hbGwoYmFzZV9kaXIpOw0KKwkJCQljaGVja291dF9hbGwo
Y2FjaGUsIGJhc2VfZGlyKTsNCiAJCQkJY29udGludWU7DQogCQkJfQ0KIAkJ
CWlmICghc3RyY21wKGFyZywgIi0tIikpIHsNCkBAIC0yNTcsNyArMjU3LDcg
QEANCiAJCQkJY29udGludWU7DQogCQkJfQ0KIAkJfQ0KLQkJY2hlY2tvdXRf
ZmlsZShhcmcsIGJhc2VfZGlyKTsNCisJCWNoZWNrb3V0X2ZpbGUoY2FjaGUs
IGFyZywgYmFzZV9kaXIpOw0KIAl9DQogCXJldHVybiAwOw0KIH0NCkluZGV4
OiBkaWZmLWNhY2hlLmMNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBj
OGM3N2Y2N2VhODVlZTY1YTBmMDU1ZjJjYjc2ZTYwNTllYWEwNzc2L2RpZmYt
Y2FjaGUuYyAgKG1vZGU6MTAwNjQ0KQ0KKysrIHVuY29tbWl0dGVkL2RpZmYt
Y2FjaGUuYyAgKG1vZGU6MTAwNjQ0KQ0KQEAgLTcsMTAgKzcsMTAgQEANCiBz
dGF0aWMgaW50IGxpbmVfdGVybWluYXRpb24gPSAnXG4nOw0KIA0KIC8qIEEg
ZmlsZSBlbnRyeSB3ZW50IGF3YXkgb3IgYXBwZWFyZWQgKi8NCi1zdGF0aWMg
dm9pZCBzaG93X2ZpbGUoY29uc3QgY2hhciAqcHJlZml4LCBzdHJ1Y3QgY2Fj
aGVfZW50cnkgKmNlLCB1bnNpZ25lZCBjaGFyICpzaGExLCB1bnNpZ25lZCBp
bnQgbW9kZSkNCitzdGF0aWMgdm9pZCBzaG93X2ZpbGUoc3RydWN0IGNhY2hl
ICpjYWNoZSwgY29uc3QgY2hhciAqcHJlZml4LCBzdHJ1Y3QgY2FjaGVfZW50
cnkgKmNlLCB1bnNpZ25lZCBjaGFyICpzaGExLCB1bnNpZ25lZCBpbnQgbW9k
ZSkNCiB7DQogCWlmIChnZW5lcmF0ZV9wYXRjaCkNCi0JCWRpZmZfYWRkcmVt
b3ZlKHByZWZpeFswXSwgbnRvaGwobW9kZSksIHNoYTEsIGNlLT5uYW1lLCBO
VUxMKTsNCisJCWRpZmZfYWRkcmVtb3ZlKGNhY2hlLCBwcmVmaXhbMF0sIG50
b2hsKG1vZGUpLCBzaGExLCBjZS0+bmFtZSwgTlVMTCk7DQogCWVsc2UNCiAJ
CXByaW50ZigiJXMlMDZvXHRibG9iXHQlc1x0JXMlYyIsIHByZWZpeCwgbnRv
aGwobW9kZSksDQogCQkgICAgICAgc2hhMV90b19oZXgoc2hhMSksIGNlLT5u
YW1lLCBsaW5lX3Rlcm1pbmF0aW9uKTsNCkBAIC0zMyw3ICszMyw3IEBADQog
CQkJfQ0KIAkJCXJldHVybiAtMTsNCiAJCX0NCi0JCWNoYW5nZWQgPSBjYWNo
ZV9tYXRjaF9zdGF0KGNlLCAmc3QpOw0KKwkJY2hhbmdlZCA9IGNlX21hdGNo
X3N0YXQoY2UsICZzdCk7DQogCQlpZiAoY2hhbmdlZCkgew0KIAkJCW1vZGUg
PSBjcmVhdGVfY2VfbW9kZShzdC5zdF9tb2RlKTsNCiAJCQlzaGExID0gbm9f
c2hhMTsNCkBAIC00NSw3ICs0NSw3IEBADQogCXJldHVybiAwOw0KIH0NCiAN
Ci1zdGF0aWMgdm9pZCBzaG93X25ld19maWxlKHN0cnVjdCBjYWNoZV9lbnRy
eSAqbmV3KQ0KK3N0YXRpYyB2b2lkIHNob3dfbmV3X2ZpbGUoc3RydWN0IGNh
Y2hlICpjYWNoZSwgc3RydWN0IGNhY2hlX2VudHJ5ICpuZXcpDQogew0KIAl1
bnNpZ25lZCBjaGFyICpzaGExOw0KIAl1bnNpZ25lZCBpbnQgbW9kZTsNCkBA
IC01NCwxMCArNTQsMTEgQEANCiAJaWYgKGdldF9zdGF0X2RhdGEobmV3LCAm
c2hhMSwgJm1vZGUpIDwgMCkNCiAJCXJldHVybjsNCiANCi0Jc2hvd19maWxl
KCIrIiwgbmV3LCBzaGExLCBtb2RlKTsNCisJc2hvd19maWxlKGNhY2hlLCAi
KyIsIG5ldywgc2hhMSwgbW9kZSk7DQogfQ0KIA0KLXN0YXRpYyBpbnQgc2hv
d19tb2RpZmllZChzdHJ1Y3QgY2FjaGVfZW50cnkgKm9sZCwNCitzdGF0aWMg
aW50IHNob3dfbW9kaWZpZWQoc3RydWN0IGNhY2hlICpjYWNoZSwNCisJCQkg
c3RydWN0IGNhY2hlX2VudHJ5ICpvbGQsDQogCQkJIHN0cnVjdCBjYWNoZV9l
bnRyeSAqbmV3LA0KIAkJCSBpbnQgcmVwb3J0X21pc3NpbmcpDQogew0KQEAg
LTY3LDcgKzY4LDcgQEANCiANCiAJaWYgKGdldF9zdGF0X2RhdGEobmV3LCAm
c2hhMSwgJm1vZGUpIDwgMCkgew0KIAkJaWYgKHJlcG9ydF9taXNzaW5nKQ0K
LQkJCXNob3dfZmlsZSgiLSIsIG9sZCwgb2xkLT5zaGExLCBvbGQtPmNlX21v
ZGUpOw0KKwkJCXNob3dfZmlsZShjYWNoZSwgIi0iLCBvbGQsIG9sZC0+c2hh
MSwgb2xkLT5jZV9tb2RlKTsNCiAJCXJldHVybiAtMTsNCiAJfQ0KIA0KQEAg
LTc5LDcgKzgwLDcgQEANCiAJb2xkbW9kZSA9IG50b2hsKG9sZG1vZGUpOw0K
IA0KIAlpZiAoZ2VuZXJhdGVfcGF0Y2gpDQotCQlkaWZmX2NoYW5nZShvbGRt
b2RlLCBtb2RlLA0KKwkJZGlmZl9jaGFuZ2UoY2FjaGUsIG9sZG1vZGUsIG1v
ZGUsDQogCQkJICAgIG9sZC0+c2hhMSwgc2hhMSwgb2xkLT5uYW1lLCBOVUxM
KTsNCiAJZWxzZSB7DQogCQlzdHJjcHkob2xkX3NoYTFfaGV4LCBzaGExX3Rv
X2hleChvbGQtPnNoYTEpKTsNCkBAIC05MCwzMCArOTEsMzQgQEANCiAJcmV0
dXJuIDA7DQogfQ0KIA0KLXN0YXRpYyBpbnQgZGlmZl9jYWNoZShzdHJ1Y3Qg
Y2FjaGVfZW50cnkgKiphYywgaW50IGVudHJpZXMpDQorc3RhdGljIGludCBk
aWZmX2NhY2hlKHN0cnVjdCBjYWNoZSAqY2FjaGUpDQogew0KLQl3aGlsZSAo
ZW50cmllcykgew0KLQkJc3RydWN0IGNhY2hlX2VudHJ5ICpjZSA9ICphYzsN
Ci0JCWludCBzYW1lID0gKGVudHJpZXMgPiAxKSAmJiBzYW1lX25hbWUoY2Us
IGFjWzFdKTsNCisJaW50IHBvcyA9IDAsIG51bSA9IGdldF9udW1fY2FjaGVf
ZW50cmllcyhjYWNoZSk7DQorDQorCXdoaWxlIChwb3MgPCBudW0pIHsNCisJ
CXN0cnVjdCBjYWNoZV9lbnRyeSAqY2UgPSBnZXRfY2FjaGVfZW50cnkoY2Fj
aGUsIHBvcyk7DQorCQlzdHJ1Y3QgY2FjaGVfZW50cnkgKmNlX25leHQgPSAo
KHBvcysxKSA8IG51bSkgPw0KKwkJCWdldF9jYWNoZV9lbnRyeShjYWNoZSwg
cG9zKzEpIDogTlVMTDsNCisJCWludCBzYW1lID0gY2VfbmV4dCAmJiBjZV9z
YW1lX25hbWUoY2UsIGNlX25leHQpOw0KIA0KIAkJc3dpdGNoIChjZV9zdGFn
ZShjZSkpIHsNCiAJCWNhc2UgMDoNCiAJCQkvKiBObyBzdGFnZSAxIGVudHJ5
PyBUaGF0IG1lYW5zIGl0J3MgYSBuZXcgZmlsZSAqLw0KIAkJCWlmICghc2Ft
ZSkgew0KLQkJCQlzaG93X25ld19maWxlKGNlKTsNCisJCQkJc2hvd19uZXdf
ZmlsZShjYWNoZSwgY2UpOw0KIAkJCQlicmVhazsNCiAJCQl9DQogCQkJLyog
U2hvdyBkaWZmZXJlbmNlIGJldHdlZW4gb2xkIGFuZCBuZXcgKi8NCi0JCQlz
aG93X21vZGlmaWVkKGFjWzFdLCBjZSwgMSk7DQorCQkJc2hvd19tb2RpZmll
ZChjYWNoZSwgY2VfbmV4dCwgY2UsIDEpOw0KIAkJCWJyZWFrOw0KIAkJY2Fz
ZSAxOg0KIAkJCS8qIE5vIHN0YWdlIDMgKG1lcmdlKSBlbnRyeT8gVGhhdCBt
ZWFucyBpdCdzIGJlZW4gZGVsZXRlZCAqLw0KIAkJCWlmICghc2FtZSkgew0K
LQkJCQlzaG93X2ZpbGUoIi0iLCBjZSwgY2UtPnNoYTEsIGNlLT5jZV9tb2Rl
KTsNCisJCQkJc2hvd19maWxlKGNhY2hlLCAiLSIsIGNlLCBjZS0+c2hhMSwg
Y2UtPmNlX21vZGUpOw0KIAkJCQlicmVhazsNCiAJCQl9DQogCQkJLyogV2Ug
Y29tZSBoZXJlIHdpdGggY2UgcG9pbnRpbmcgYXQgc3RhZ2UgMQ0KLQkJCSAq
IChvcmlnaW5hbCB0cmVlKSBhbmQgYWNbMV0gcG9pbnRpbmcgYXQgc3RhZ2UN
CisJCQkgKiAob3JpZ2luYWwgdHJlZSkgYW5kIGNlX25leHQgcG9pbnRpbmcg
YXQgc3RhZ2UNCiAJCQkgKiAzICh1bm1lcmdlZCkuICBzaG93LW1vZGlmaWVk
IHdpdGgNCiAJCQkgKiByZXBvcnQtbWlzaW5nIHNldCB0byBmYWxzZSBkb2Vz
IG5vdCBzYXkgdGhlDQogCQkJICogZmlsZSBpcyBkZWxldGVkIGJ1dCByZXBv
cnRzIHRydWUgaWYgd29yaw0KQEAgLTEyMiwxMiArMTI3LDEyIEBADQogCQkJ
ICogT3RoZXJ3aXNlLCB3ZSBzaG93IHRoZSBkaWZmZXJlbmNlcyBiZXR3ZWVu
DQogCQkJICogdGhlIG9yaWdpbmFsIHRyZWUgYW5kIHRoZSB3b3JrIHRyZWUu
DQogCQkJICovDQotCQkJaWYgKCFjYWNoZWRfb25seSAmJiAhc2hvd19tb2Rp
ZmllZChjZSwgYWNbMV0sIDApKQ0KKwkJCWlmICghY2FjaGVkX29ubHkgJiYg
IXNob3dfbW9kaWZpZWQoY2FjaGUsIGNlLCBjZV9uZXh0LCAwKSkNCiAJCQkJ
YnJlYWs7DQogCQkJLyogZmFsbHRocnUgKi8NCiAJCWNhc2UgMzoNCiAJCQlp
ZiAoZ2VuZXJhdGVfcGF0Y2gpDQotCQkJCWRpZmZfdW5tZXJnZShjZS0+bmFt
ZSk7DQorCQkJCWRpZmZfdW5tZXJnZShjYWNoZSwgY2UtPm5hbWUpOw0KIAkJ
CWVsc2UNCiAJCQkJcHJpbnRmKCJVICVzJWMiLCBjZS0+bmFtZSwgbGluZV90
ZXJtaW5hdGlvbik7DQogCQkJYnJlYWs7DQpAQCAtMTQxLDkgKzE0Niw4IEBA
DQogCQkgKiB3ZSd2ZSBoYW5kbGVkIHRoZSByZWxldmFudCBjYXNlcyBub3cu
DQogCQkgKi8NCiAJCWRvIHsNCi0JCQlhYysrOw0KLQkJCWVudHJpZXMtLTsN
Ci0JCX0gd2hpbGUgKGVudHJpZXMgJiYgc2FtZV9uYW1lKGNlLCBhY1swXSkp
Ow0KKwkJCXBvcysrOw0KKwkJfSB3aGlsZSAocG9zIDwgbnVtICYmIGNlX3Nh
bWVfbmFtZShjZSwgZ2V0X2NhY2hlX2VudHJ5KGNhY2hlLCBwb3MpKSk7DQog
CX0NCiAJcmV0dXJuIDA7DQogfQ0KQEAgLTE1MywxMSArMTU3LDExIEBADQog
ICogd2hlbiB3ZSByZWFkIGluIHRoZSBuZXcgdHJlZSAoaW50byAic3RhZ2Ug
MSIpLCB3ZSB3b24ndCBsb3NlIHNpZ2h0DQogICogb2YgdGhlIGZhY3QgdGhh
dCB3ZSBoYWQgdW5tZXJnZWQgZW50cmllcy4NCiAgKi8NCi1zdGF0aWMgdm9p
ZCBtYXJrX21lcmdlX2VudHJpZXModm9pZCkNCitzdGF0aWMgdm9pZCBtYXJr
X21lcmdlX2VudHJpZXMoc3RydWN0IGNhY2hlICpjYWNoZSkNCiB7DQogCWlu
dCBpOw0KLQlmb3IgKGkgPSAwOyBpIDwgYWN0aXZlX25yOyBpKyspIHsNCi0J
CXN0cnVjdCBjYWNoZV9lbnRyeSAqY2UgPSBhY3RpdmVfY2FjaGVbaV07DQor
CWZvciAoaSA9IDA7IGkgPCBnZXRfbnVtX2NhY2hlX2VudHJpZXMoY2FjaGUp
OyBpKyspIHsNCisJCXN0cnVjdCBjYWNoZV9lbnRyeSAqY2UgPSBnZXRfY2Fj
aGVfZW50cnkoY2FjaGUsIGkpOw0KIAkJaWYgKCFjZV9zdGFnZShjZSkpDQog
CQkJY29udGludWU7DQogCQljZS0+Y2VfZmxhZ3MgfD0gaHRvbnMoQ0VfU1RB
R0VNQVNLKTsNCkBAIC0xNzIsOCArMTc2LDggQEANCiAJdW5zaWduZWQgY2hh
ciB0cmVlX3NoYTFbMjBdOw0KIAl2b2lkICp0cmVlOw0KIAl1bnNpZ25lZCBs
b25nIHNpemU7DQorCXN0cnVjdCBjYWNoZSAqIGNhY2hlID0gcmVhZF9jYWNo
ZSgpOw0KIA0KLQlyZWFkX2NhY2hlKCk7DQogCXdoaWxlIChhcmdjID4gMikg
ew0KIAkJY2hhciAqYXJnID0gYXJndlsxXTsNCiAJCWFyZ3YrKzsNCkBAIC0y
MDQsMTMgKzIwOCwxMyBAQA0KIAlpZiAoYXJnYyAhPSAyIHx8IGdldF9zaGEx
KGFyZ3ZbMV0sIHRyZWVfc2hhMSkpDQogCQl1c2FnZShkaWZmX2NhY2hlX3Vz
YWdlKTsNCiANCi0JbWFya19tZXJnZV9lbnRyaWVzKCk7DQorCW1hcmtfbWVy
Z2VfZW50cmllcyhjYWNoZSk7DQogDQogCXRyZWUgPSByZWFkX29iamVjdF93
aXRoX3JlZmVyZW5jZSh0cmVlX3NoYTEsICJ0cmVlIiwgJnNpemUsIDApOw0K
IAlpZiAoIXRyZWUpDQogCQlkaWUoImJhZCB0cmVlIG9iamVjdCAlcyIsIGFy
Z3ZbMV0pOw0KLQlpZiAocmVhZF90cmVlKHRyZWUsIHNpemUsIDEpKQ0KKwlp
ZiAocmVhZF90cmVlKGNhY2hlLCB0cmVlLCBzaXplLCAxKSkNCiAJCWRpZSgi
dW5hYmxlIHRvIHJlYWQgdHJlZSBvYmplY3QgJXMiLCBhcmd2WzFdKTsNCiAN
Ci0JcmV0dXJuIGRpZmZfY2FjaGUoYWN0aXZlX2NhY2hlLCBhY3RpdmVfbnIp
Ow0KKwlyZXR1cm4gZGlmZl9jYWNoZShjYWNoZSk7DQogfQ0KSW5kZXg6IGRp
ZmYtZmlsZXMuYw0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0tIGM4Yzc3
ZjY3ZWE4NWVlNjVhMGYwNTVmMmNiNzZlNjA1OWVhYTA3NzYvZGlmZi1maWxl
cy5jICAobW9kZToxMDA2NDQpDQorKysgdW5jb21taXR0ZWQvZGlmZi1maWxl
cy5jICAobW9kZToxMDA2NDQpDQpAQCAtMjgsMTggKzI4LDE4IEBADQogCXJl
dHVybiAwOw0KIH0NCiANCi1zdGF0aWMgdm9pZCBzaG93X3VubWVyZ2UoY29u
c3QgY2hhciAqcGF0aCkNCitzdGF0aWMgdm9pZCBzaG93X3VubWVyZ2Uoc3Ry
dWN0IGNhY2hlICpjYWNoZSwgY29uc3QgY2hhciAqcGF0aCkNCiB7DQogCWlm
IChnZW5lcmF0ZV9wYXRjaCkNCi0JCWRpZmZfdW5tZXJnZShwYXRoKTsNCisJ
CWRpZmZfdW5tZXJnZShjYWNoZSwgcGF0aCk7DQogCWVsc2UNCiAJCXByaW50
ZigiVSAlcyVjIiwgcGF0aCwgbGluZV90ZXJtaW5hdGlvbik7DQogfQ0KIA0K
LXN0YXRpYyB2b2lkIHNob3dfZmlsZShpbnQgcGZ4LCBzdHJ1Y3QgY2FjaGVf
ZW50cnkgKmNlKQ0KK3N0YXRpYyB2b2lkIHNob3dfZmlsZShzdHJ1Y3QgY2Fj
aGUgKmNhY2hlLCBpbnQgcGZ4LCBzdHJ1Y3QgY2FjaGVfZW50cnkgKmNlKQ0K
IHsNCiAJaWYgKGdlbmVyYXRlX3BhdGNoKQ0KLQkJZGlmZl9hZGRyZW1vdmUo
cGZ4LCBudG9obChjZS0+Y2VfbW9kZSksIGNlLT5zaGExLA0KKwkJZGlmZl9h
ZGRyZW1vdmUoY2FjaGUsIHBmeCwgbnRvaGwoY2UtPmNlX21vZGUpLCBjZS0+
c2hhMSwNCiAJCQkgICAgICAgY2UtPm5hbWUsIE5VTEwpOw0KIAllbHNlDQog
CQlwcmludGYoIiVjJTA2b1x0JXNcdCVzXHQlcyVjIiwNCkBAIC00Nyw3ICs0
Nyw3IEBADQogCQkgICAgICAgc2hhMV90b19oZXgoY2UtPnNoYTEpLCBjZS0+
bmFtZSwgbGluZV90ZXJtaW5hdGlvbik7DQogfQ0KIA0KLXN0YXRpYyB2b2lk
IHNob3dfbW9kaWZpZWQoaW50IG9sZG1vZGUsIGludCBtb2RlLA0KK3N0YXRp
YyB2b2lkIHNob3dfbW9kaWZpZWQoc3RydWN0IGNhY2hlICpjYWNoZSwgaW50
IG9sZG1vZGUsIGludCBtb2RlLA0KIAkJCSAgY29uc3QgY2hhciAqb2xkX3No
YTEsIGNvbnN0IGNoYXIgKnNoYTEsDQogCQkJICBjaGFyICpwYXRoKQ0KIHsN
CkBAIC01NSw3ICs1NSw3IEBADQogCXN0cmNweShvbGRfc2hhMV9oZXgsIHNo
YTFfdG9faGV4KG9sZF9zaGExKSk7DQogDQogCWlmIChnZW5lcmF0ZV9wYXRj
aCkNCi0JCWRpZmZfY2hhbmdlKG9sZG1vZGUsIG1vZGUsIG9sZF9zaGExLCBz
aGExLCBwYXRoLCBOVUxMKTsNCisJCWRpZmZfY2hhbmdlKGNhY2hlLCBvbGRt
b2RlLCBtb2RlLCBvbGRfc2hhMSwgc2hhMSwgcGF0aCwgTlVMTCk7DQogCWVs
c2UNCiAJCXByaW50ZigiKiUwNm8tPiUwNm9cdGJsb2JcdCVzLT4lc1x0JXMl
YyIsDQogCQkgICAgICAgb2xkbW9kZSwgbW9kZSwgb2xkX3NoYTFfaGV4LCBz
aGExX3RvX2hleChzaGExKSwgcGF0aCwNCkBAIC02NSw3ICs2NSw4IEBADQog
aW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKiphcmd2KQ0KIHsNCiAJc3RhdGlj
IGNvbnN0IGNoYXIgbnVsbF9zaGExWzIwXSA9IHsgMCwgfTsNCi0JaW50IGVu
dHJpZXMgPSByZWFkX2NhY2hlKCk7DQorCXN0cnVjdCBjYWNoZSAqY2FjaGUg
PSByZWFkX2NhY2hlKCk7DQorCWludCBlbnRyaWVzOw0KIAlpbnQgaTsNCiAN
CiAJd2hpbGUgKDEgPCBhcmdjICYmIGFyZ3ZbMV1bMF0gPT0gJy0nKSB7DQpA
QCAtODcsMTUgKzg4LDE3IEBADQogCS8qIEF0IHRoaXMgcG9pbnQsIGlmIGFy
Z2MgPT0gMSwgdGhlbiB3ZSBhcmUgZG9pbmcgZXZlcnl0aGluZy4NCiAJICog
T3RoZXJ3aXNlIGFyZ3ZbMV0gLi4gYXJndlthcmdjLTFdIGhhdmUgdGhlIGV4
cGxpY2l0IHBhdGhzLg0KIAkgKi8NCi0JaWYgKGVudHJpZXMgPCAwKSB7DQor
CWlmICghY2FjaGUpIHsNCiAJCXBlcnJvcigicmVhZF9jYWNoZSIpOw0KIAkJ
ZXhpdCgxKTsNCiAJfQ0KIA0KKwllbnRyaWVzID0gZ2V0X251bV9jYWNoZV9l
bnRyaWVzKGNhY2hlKTsNCisNCiAJZm9yIChpID0gMDsgaSA8IGVudHJpZXM7
IGkrKykgew0KIAkJc3RydWN0IHN0YXQgc3Q7DQogCQl1bnNpZ25lZCBpbnQg
b2xkbW9kZSwgbW9kZTsNCi0JCXN0cnVjdCBjYWNoZV9lbnRyeSAqY2UgPSBh
Y3RpdmVfY2FjaGVbaV07DQorCQlzdHJ1Y3QgY2FjaGVfZW50cnkgKmNlID0g
Z2V0X2NhY2hlX2VudHJ5KGNhY2hlLCBpKTsNCiAJCWludCBjaGFuZ2VkOw0K
IA0KIAkJaWYgKDEgPCBhcmdjICYmDQpAQCAtMTAzLDkgKzEwNiw5IEBADQog
CQkJY29udGludWU7DQogDQogCQlpZiAoY2Vfc3RhZ2UoY2UpKSB7DQotCQkJ
c2hvd191bm1lcmdlKGNlLT5uYW1lKTsNCisJCQlzaG93X3VubWVyZ2UoY2Fj
aGUsIGNlLT5uYW1lKTsNCiAJCQl3aGlsZSAoaSA8IGVudHJpZXMgJiYNCi0J
CQkgICAgICAgIXN0cmNtcChjZS0+bmFtZSwgYWN0aXZlX2NhY2hlW2ldLT5u
YW1lKSkNCisJCQkgICAgICAgIXN0cmNtcChjZS0+bmFtZSwgZ2V0X2NhY2hl
X2VudHJ5KGNhY2hlLCBpKS0+bmFtZSkpDQogCQkJCWkrKzsNCiAJCQlpLS07
IC8qIGNvbXBlbnNhdGUgZm9yIGxvb3AgY29udHJvbCBpbmNyZW1lbnRzICov
DQogCQkJY29udGludWU7DQpAQCAtMTE4LDEwICsxMjEsMTAgQEANCiAJCQl9
CQ0KIAkJCWlmIChzaWxlbnQpDQogCQkJCWNvbnRpbnVlOw0KLQkJCXNob3df
ZmlsZSgnLScsIGNlKTsNCisJCQlzaG93X2ZpbGUoY2FjaGUsICctJywgY2Up
Ow0KIAkJCWNvbnRpbnVlOw0KIAkJfQ0KLQkJY2hhbmdlZCA9IGNhY2hlX21h
dGNoX3N0YXQoY2UsICZzdCk7DQorCQljaGFuZ2VkID0gY2VfbWF0Y2hfc3Rh
dChjZSwgJnN0KTsNCiAJCWlmICghY2hhbmdlZCkNCiAJCQljb250aW51ZTsN
CiANCkBAIC0xMjksNyArMTMyLDcgQEANCiAJCW1vZGUgPSAoU19JU0xOSyhz
dC5zdF9tb2RlKSA/IFNfSUZMTksgOg0KIAkJCVNfSUZSRUcgfCBjZV9wZXJt
aXNzaW9ucyhzdC5zdF9tb2RlKSk7DQogDQotCQlzaG93X21vZGlmaWVkKG9s
ZG1vZGUsIG1vZGUsIGNlLT5zaGExLCBudWxsX3NoYTEsDQorCQlzaG93X21v
ZGlmaWVkKGNhY2hlLCBvbGRtb2RlLCBtb2RlLCBjZS0+c2hhMSwgbnVsbF9z
aGExLA0KIAkJCSAgICAgIGNlLT5uYW1lKTsNCiAJfQ0KIAlyZXR1cm4gMDsN
CkluZGV4OiBkaWZmLWhlbHBlci5jDQo9PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
DQotLS0gYzhjNzdmNjdlYTg1ZWU2NWEwZjA1NWYyY2I3NmU2MDU5ZWFhMDc3
Ni9kaWZmLWhlbHBlci5jICAobW9kZToxMDA2NDQpDQorKysgdW5jb21taXR0
ZWQvZGlmZi1oZWxwZXIuYyAgKG1vZGU6MTAwNjQ0KQ0KQEAgLTU2LDcgKzU2
LDcgQEANCiAJc3dpdGNoICgqY3ArKykgew0KIAljYXNlICdVJzoNCiAJCWlm
ICghY250IHx8IG1hdGNoZXNfcGF0aHNwZWMoY3AgKyAxLCBzcGVjLCBjbnQp
KQ0KLQkJCWRpZmZfdW5tZXJnZShjcCArIDEpOw0KKwkJCWRpZmZfdW5tZXJn
ZShOVUxMLCBjcCArIDEpOw0KIAkJcmV0dXJuIDA7DQogCWNhc2UgJysnOg0K
IAkJb2xkLmZpbGVfdmFsaWQgPSAwOw0KQEAgLTEwMiw5ICsxMDIsOSBAQA0K
IAl9DQogCWlmICghY250IHx8IG1hdGNoZXNfcGF0aHNwZWMocGF0aCwgc3Bl
YywgY250KSkgew0KIAkJaWYgKHJldmVyc2UpDQotCQkJcnVuX2V4dGVybmFs
X2RpZmYocGF0aCwgJm5ldywgJm9sZCk7DQorCQkJcnVuX2V4dGVybmFsX2Rp
ZmYoTlVMTCwgcGF0aCwgJm5ldywgJm9sZCk7DQogCQllbHNlDQotCQkJcnVu
X2V4dGVybmFsX2RpZmYocGF0aCwgJm9sZCwgJm5ldyk7DQorCQkJcnVuX2V4
dGVybmFsX2RpZmYoTlVMTCwgcGF0aCwgJm9sZCwgJm5ldyk7DQogCX0NCiAJ
cmV0dXJuIDA7DQogfQ0KSW5kZXg6IGRpZmYtdHJlZS5jDQo9PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09DQotLS0gYzhjNzdmNjdlYTg1ZWU2NWEwZjA1NWYyY2I3
NmU2MDU5ZWFhMDc3Ni9kaWZmLXRyZWUuYyAgKG1vZGU6MTAwNjQ0KQ0KKysr
IHVuY29tbWl0dGVkL2RpZmYtdHJlZS5jICAobW9kZToxMDA2NDQpDQpAQCAt
MTcsNyArMTcsNyBAQA0KIHN0YXRpYyBjaGFyICoqcGF0aHMgPSBOVUxMOw0K
IHN0YXRpYyBpbnQgKnBhdGhsZW5zID0gTlVMTDsNCiANCi1zdGF0aWMgaW50
IGRpZmZfdHJlZV9zaGExKGNvbnN0IHVuc2lnbmVkIGNoYXIgKm9sZCwgY29u
c3QgdW5zaWduZWQgY2hhciAqbmV3LCBjb25zdCBjaGFyICpiYXNlKTsNCitz
dGF0aWMgaW50IGRpZmZfdHJlZV9zaGExKHN0cnVjdCBjYWNoZSAqY2FjaGUs
IGNvbnN0IHVuc2lnbmVkIGNoYXIgKm9sZCwgY29uc3QgdW5zaWduZWQgY2hh
ciAqbmV3LCBjb25zdCBjaGFyICpiYXNlKTsNCiANCiBzdGF0aWMgdm9pZCB1
cGRhdGVfdHJlZV9lbnRyeSh2b2lkICoqYnVmcCwgdW5zaWduZWQgbG9uZyAq
c2l6ZXApDQogew0KQEAgLTUzLDE5ICs1MywxOSBAQA0KIAlyZXR1cm4gbmV3
YmFzZTsNCiB9DQogDQotc3RhdGljIHZvaWQgc2hvd19maWxlKGNvbnN0IGNo
YXIgKnByZWZpeCwgdm9pZCAqdHJlZSwgdW5zaWduZWQgbG9uZyBzaXplLCBj
b25zdCBjaGFyICpiYXNlKTsNCitzdGF0aWMgdm9pZCBzaG93X2ZpbGUoc3Ry
dWN0IGNhY2hlICpjYWNoZSwgY29uc3QgY2hhciAqcHJlZml4LCB2b2lkICp0
cmVlLCB1bnNpZ25lZCBsb25nIHNpemUsIGNvbnN0IGNoYXIgKmJhc2UpOw0K
IA0KIC8qIEEgd2hvbGUgc3ViLXRyZWUgd2VudCBhd2F5IG9yIGFwcGVhcmVk
ICovDQotc3RhdGljIHZvaWQgc2hvd190cmVlKGNvbnN0IGNoYXIgKnByZWZp
eCwgdm9pZCAqdHJlZSwgdW5zaWduZWQgbG9uZyBzaXplLCBjb25zdCBjaGFy
ICpiYXNlKQ0KK3N0YXRpYyB2b2lkIHNob3dfdHJlZShzdHJ1Y3QgY2FjaGUg
KmNhY2hlLCBjb25zdCBjaGFyICpwcmVmaXgsIHZvaWQgKnRyZWUsIHVuc2ln
bmVkIGxvbmcgc2l6ZSwgY29uc3QgY2hhciAqYmFzZSkNCiB7DQogCXdoaWxl
IChzaXplKSB7DQotCQlzaG93X2ZpbGUocHJlZml4LCB0cmVlLCBzaXplLCBi
YXNlKTsNCisJCXNob3dfZmlsZShjYWNoZSwgcHJlZml4LCB0cmVlLCBzaXpl
LCBiYXNlKTsNCiAJCXVwZGF0ZV90cmVlX2VudHJ5KCZ0cmVlLCAmc2l6ZSk7
DQogCX0NCiB9DQogDQogLyogQSBmaWxlIGVudHJ5IHdlbnQgYXdheSBvciBh
cHBlYXJlZCAqLw0KLXN0YXRpYyB2b2lkIHNob3dfZmlsZShjb25zdCBjaGFy
ICpwcmVmaXgsIHZvaWQgKnRyZWUsIHVuc2lnbmVkIGxvbmcgc2l6ZSwgY29u
c3QgY2hhciAqYmFzZSkNCitzdGF0aWMgdm9pZCBzaG93X2ZpbGUoc3RydWN0
IGNhY2hlICpjYWNoZSwgY29uc3QgY2hhciAqcHJlZml4LCB2b2lkICp0cmVl
LCB1bnNpZ25lZCBsb25nIHNpemUsIGNvbnN0IGNoYXIgKmJhc2UpDQogew0K
IAl1bnNpZ25lZCBtb2RlOw0KIAljb25zdCBjaGFyICpwYXRoOw0KQEAgLTg5
LDcgKzg5LDcgQEANCiAJCWlmICghdHJlZSB8fCBzdHJjbXAodHlwZSwgInRy
ZWUiKSkNCiAJCQlkaWUoImNvcnJ1cHQgdHJlZSBzaGEgJXMiLCBzaGExX3Rv
X2hleChzaGExKSk7DQogDQotCQlzaG93X3RyZWUocHJlZml4LCB0cmVlLCBz
aXplLCBuZXdiYXNlKTsNCisJCXNob3dfdHJlZShjYWNoZSwgcHJlZml4LCB0
cmVlLCBzaXplLCBuZXdiYXNlKTsNCiAJCQ0KIAkJZnJlZSh0cmVlKTsNCiAJ
CWZyZWUobmV3YmFzZSk7DQpAQCAtOTgsNyArOTgsNyBAQA0KIA0KIAlpZiAo
Z2VuZXJhdGVfcGF0Y2gpIHsNCiAJCWlmICghU19JU0RJUihtb2RlKSkNCi0J
CQlkaWZmX2FkZHJlbW92ZShwcmVmaXhbMF0sIG1vZGUsIHNoYTEsIGJhc2Us
IHBhdGgpOw0KKwkJCWRpZmZfYWRkcmVtb3ZlKGNhY2hlLCBwcmVmaXhbMF0s
IG1vZGUsIHNoYTEsIGJhc2UsIHBhdGgpOw0KIAl9DQogCWVsc2UNCiAJCXBy
aW50ZigiJXMlMDZvXHQlc1x0JXNcdCVzJXMlYyIsIHByZWZpeCwgbW9kZSwN
CkBAIC0xMDcsNyArMTA3LDcgQEANCiAJCSAgICAgICBsaW5lX3Rlcm1pbmF0
aW9uKTsNCiB9DQogDQotc3RhdGljIGludCBjb21wYXJlX3RyZWVfZW50cnko
dm9pZCAqdHJlZTEsIHVuc2lnbmVkIGxvbmcgc2l6ZTEsIHZvaWQgKnRyZWUy
LCB1bnNpZ25lZCBsb25nIHNpemUyLCBjb25zdCBjaGFyICpiYXNlKQ0KK3N0
YXRpYyBpbnQgY29tcGFyZV90cmVlX2VudHJ5KHN0cnVjdCBjYWNoZSAqY2Fj
aGUsIHZvaWQgKnRyZWUxLCB1bnNpZ25lZCBsb25nIHNpemUxLCB2b2lkICp0
cmVlMiwgdW5zaWduZWQgbG9uZyBzaXplMiwgY29uc3QgY2hhciAqYmFzZSkN
CiB7DQogCXVuc2lnbmVkIG1vZGUxLCBtb2RlMjsNCiAJY29uc3QgY2hhciAq
cGF0aDEsICpwYXRoMjsNCkBAIC0xMjIsMTEgKzEyMiwxMSBAQA0KIAlwYXRo
bGVuMiA9IHN0cmxlbihwYXRoMik7DQogCWNtcCA9IGNhY2hlX25hbWVfY29t
cGFyZShwYXRoMSwgcGF0aGxlbjEsIHBhdGgyLCBwYXRobGVuMik7DQogCWlm
IChjbXAgPCAwKSB7DQotCQlzaG93X2ZpbGUoIi0iLCB0cmVlMSwgc2l6ZTEs
IGJhc2UpOw0KKwkJc2hvd19maWxlKGNhY2hlLCAiLSIsIHRyZWUxLCBzaXpl
MSwgYmFzZSk7DQogCQlyZXR1cm4gLTE7DQogCX0NCiAJaWYgKGNtcCA+IDAp
IHsNCi0JCXNob3dfZmlsZSgiKyIsIHRyZWUyLCBzaXplMiwgYmFzZSk7DQor
CQlzaG93X2ZpbGUoY2FjaGUsICIrIiwgdHJlZTIsIHNpemUyLCBiYXNlKTsN
CiAJCXJldHVybiAxOw0KIAl9DQogCWlmICghbWVtY21wKHNoYTEsIHNoYTIs
IDIwKSAmJiBtb2RlMSA9PSBtb2RlMikNCkBAIC0xMzcsMTUgKzEzNywxNSBA
QA0KIAkgKiBmaWxlLCB3ZSBuZWVkIHRvIGNvbnNpZGVyIGl0IGEgcmVtb3Zl
IGFuZCBhbiBhZGQuDQogCSAqLw0KIAlpZiAoU19JU0RJUihtb2RlMSkgIT0g
U19JU0RJUihtb2RlMikpIHsNCi0JCXNob3dfZmlsZSgiLSIsIHRyZWUxLCBz
aXplMSwgYmFzZSk7DQotCQlzaG93X2ZpbGUoIisiLCB0cmVlMiwgc2l6ZTIs
IGJhc2UpOw0KKwkJc2hvd19maWxlKGNhY2hlLCAiLSIsIHRyZWUxLCBzaXpl
MSwgYmFzZSk7DQorCQlzaG93X2ZpbGUoY2FjaGUsICIrIiwgdHJlZTIsIHNp
emUyLCBiYXNlKTsNCiAJCXJldHVybiAwOw0KIAl9DQogDQogCWlmIChyZWN1
cnNpdmUgJiYgU19JU0RJUihtb2RlMSkpIHsNCiAJCWludCByZXR2YWw7DQog
CQljaGFyICpuZXdiYXNlID0gbWFsbG9jX2Jhc2UoYmFzZSwgcGF0aDEsIHBh
dGhsZW4xKTsNCi0JCXJldHZhbCA9IGRpZmZfdHJlZV9zaGExKHNoYTEsIHNo
YTIsIG5ld2Jhc2UpOw0KKwkJcmV0dmFsID0gZGlmZl90cmVlX3NoYTEoY2Fj
aGUsIHNoYTEsIHNoYTIsIG5ld2Jhc2UpOw0KIAkJZnJlZShuZXdiYXNlKTsN
CiAJCXJldHVybiByZXR2YWw7DQogCX0NCkBAIC0xNTksNyArMTU5LDcgQEAN
CiANCiAJaWYgKGdlbmVyYXRlX3BhdGNoKSB7DQogCQlpZiAoIVNfSVNESVIo
bW9kZTEpKQ0KLQkJCWRpZmZfY2hhbmdlKG1vZGUxLCBtb2RlMiwgc2hhMSwg
c2hhMiwgYmFzZSwgcGF0aDEpOw0KKwkJCWRpZmZfY2hhbmdlKGNhY2hlLCBt
b2RlMSwgbW9kZTIsIHNoYTEsIHNoYTIsIGJhc2UsIHBhdGgxKTsNCiAJfQ0K
IAllbHNlIHsNCiAJCXN0cmNweShvbGRfc2hhMV9oZXgsIHNoYTFfdG9faGV4
KHNoYTEpKTsNCkBAIC0yMTcsNyArMjE3LDcgQEANCiAJcmV0dXJuIDA7IC8q
IE5vIG1hdGNoZXMgKi8NCiB9DQogDQotc3RhdGljIGludCBkaWZmX3RyZWUo
dm9pZCAqdHJlZTEsIHVuc2lnbmVkIGxvbmcgc2l6ZTEsIHZvaWQgKnRyZWUy
LCB1bnNpZ25lZCBsb25nIHNpemUyLCBjb25zdCBjaGFyICpiYXNlKQ0KK3N0
YXRpYyBpbnQgZGlmZl90cmVlKHN0cnVjdCBjYWNoZSAqY2FjaGUsIHZvaWQg
KnRyZWUxLCB1bnNpZ25lZCBsb25nIHNpemUxLCB2b2lkICp0cmVlMiwgdW5z
aWduZWQgbG9uZyBzaXplMiwgY29uc3QgY2hhciAqYmFzZSkNCiB7DQogCXdo
aWxlIChzaXplMSB8IHNpemUyKSB7DQogCQlpZiAobnJfcGF0aHMgJiYgc2l6
ZTEgJiYgIWludGVyZXN0aW5nKHRyZWUxLCBzaXplMSwgYmFzZSkpIHsNCkBA
IC0yMjksMTYgKzIyOSwxNiBAQA0KIAkJCWNvbnRpbnVlOw0KIAkJfQ0KIAkJ
aWYgKCFzaXplMSkgew0KLQkJCXNob3dfZmlsZSgiKyIsIHRyZWUyLCBzaXpl
MiwgYmFzZSk7DQorCQkJc2hvd19maWxlKGNhY2hlLCAiKyIsIHRyZWUyLCBz
aXplMiwgYmFzZSk7DQogCQkJdXBkYXRlX3RyZWVfZW50cnkoJnRyZWUyLCAm
c2l6ZTIpOw0KIAkJCWNvbnRpbnVlOw0KIAkJfQ0KIAkJaWYgKCFzaXplMikg
ew0KLQkJCXNob3dfZmlsZSgiLSIsIHRyZWUxLCBzaXplMSwgYmFzZSk7DQor
CQkJc2hvd19maWxlKGNhY2hlLCAiLSIsIHRyZWUxLCBzaXplMSwgYmFzZSk7
DQogCQkJdXBkYXRlX3RyZWVfZW50cnkoJnRyZWUxLCAmc2l6ZTEpOw0KIAkJ
CWNvbnRpbnVlOw0KIAkJfQ0KLQkJc3dpdGNoIChjb21wYXJlX3RyZWVfZW50
cnkodHJlZTEsIHNpemUxLCB0cmVlMiwgc2l6ZTIsIGJhc2UpKSB7DQorCQlz
d2l0Y2ggKGNvbXBhcmVfdHJlZV9lbnRyeShjYWNoZSwgdHJlZTEsIHNpemUx
LCB0cmVlMiwgc2l6ZTIsIGJhc2UpKSB7DQogCQljYXNlIC0xOg0KIAkJCXVw
ZGF0ZV90cmVlX2VudHJ5KCZ0cmVlMSwgJnNpemUxKTsNCiAJCQljb250aW51
ZTsNCkBAIC0yNTQsNyArMjU0LDcgQEANCiAJcmV0dXJuIDA7DQogfQ0KIA0K
LXN0YXRpYyBpbnQgZGlmZl90cmVlX3NoYTEoY29uc3QgdW5zaWduZWQgY2hh
ciAqb2xkLCBjb25zdCB1bnNpZ25lZCBjaGFyICpuZXcsIGNvbnN0IGNoYXIg
KmJhc2UpDQorc3RhdGljIGludCBkaWZmX3RyZWVfc2hhMShzdHJ1Y3QgY2Fj
aGUgKmNhY2hlLCBjb25zdCB1bnNpZ25lZCBjaGFyICpvbGQsIGNvbnN0IHVu
c2lnbmVkIGNoYXIgKm5ldywgY29uc3QgY2hhciAqYmFzZSkNCiB7DQogCXZv
aWQgKnRyZWUxLCAqdHJlZTI7DQogCXVuc2lnbmVkIGxvbmcgc2l6ZTEsIHNp
emUyOw0KQEAgLTI2Niw3ICsyNjYsNyBAQA0KIAl0cmVlMiA9IHJlYWRfb2Jq
ZWN0X3dpdGhfcmVmZXJlbmNlKG5ldywgInRyZWUiLCAmc2l6ZTIsIDApOw0K
IAlpZiAoIXRyZWUyKQ0KIAkJZGllKCJ1bmFibGUgdG8gcmVhZCBkZXN0aW5h
dGlvbiB0cmVlICglcykiLCBzaGExX3RvX2hleChuZXcpKTsNCi0JcmV0dmFs
ID0gZGlmZl90cmVlKHRyZWUxLCBzaXplMSwgdHJlZTIsIHNpemUyLCBiYXNl
KTsNCisJcmV0dmFsID0gZGlmZl90cmVlKGNhY2hlLCB0cmVlMSwgc2l6ZTEs
IHRyZWUyLCBzaXplMiwgYmFzZSk7DQogCWZyZWUodHJlZTEpOw0KIAlmcmVl
KHRyZWUyKTsNCiAJcmV0dXJuIHJldHZhbDsNCkBAIC0zNDIsNyArMzQyLDcg
QEANCiAJcmV0dXJuIHRoaXNfaGVhZGVyOw0KIH0NCiANCi1zdGF0aWMgaW50
IGRpZmZfdHJlZV9zdGRpbihjaGFyICpsaW5lKQ0KK3N0YXRpYyBpbnQgZGlm
Zl90cmVlX3N0ZGluKHN0cnVjdCBjYWNoZSAqY2FjaGUsIGNoYXIgKmxpbmUp
DQogew0KIAlpbnQgbGVuID0gc3RybGVuKGxpbmUpOw0KIAl1bnNpZ25lZCBj
aGFyIGNvbW1pdFsyMF0sIHBhcmVudFsyMF07DQpAQCAtMzYwLDcgKzM2MCw3
IEBADQogCQlsaW5lWzgxXSA9IDA7DQogCQlzcHJpbnRmKHRoaXNfaGVhZGVy
LCAiJXMgKGZyb20gJXMpXG4iLCBsaW5lLCBsaW5lKzQxKTsNCiAJCWhlYWRl
ciA9IHRoaXNfaGVhZGVyOw0KLQkJcmV0dXJuIGRpZmZfdHJlZV9zaGExKHBh
cmVudCwgY29tbWl0LCAiIik7DQorCQlyZXR1cm4gZGlmZl90cmVlX3NoYTEo
Y2FjaGUsIHBhcmVudCwgY29tbWl0LCAiIik7DQogCX0NCiAJYnVmID0gcmVh
ZF9vYmplY3Rfd2l0aF9yZWZlcmVuY2UoY29tbWl0LCAiY29tbWl0IiwgJnNp
emUsIE5VTEwpOw0KIAlpZiAoIWJ1ZikNCkBAIC0zNzgsNyArMzc4LDcgQEAN
CiAJCWlmIChnZXRfc2hhMV9oZXgoYnVmICsgb2Zmc2V0ICsgNywgcGFyZW50
KSkNCiAJCQlyZXR1cm4gLTE7DQogCQloZWFkZXIgPSBnZW5lcmF0ZV9oZWFk
ZXIobGluZSwgc2hhMV90b19oZXgocGFyZW50KSwgYnVmLCBzaXplKTsNCi0J
CWRpZmZfdHJlZV9zaGExKHBhcmVudCwgY29tbWl0LCAiIik7DQorCQlkaWZm
X3RyZWVfc2hhMShjYWNoZSwgcGFyZW50LCBjb21taXQsICIiKTsNCiAJCWlm
ICghaGVhZGVyICYmIHZlcmJvc2VfaGVhZGVyKQ0KIAkJCWhlYWRlcl9wcmVm
aXggPSAiXG5kaWZmLXRyZWUgIjsNCiAJCW9mZnNldCArPSA0ODsNCkBAIC00
NTgsMTAgKzQ1OCwxMCBAQA0KIAl9DQogDQogCWlmICghcmVhZF9zdGRpbikN
Ci0JCXJldHVybiBkaWZmX3RyZWVfc2hhMShvbGQsIG5ldywgIiIpOw0KKwkJ
cmV0dXJuIGRpZmZfdHJlZV9zaGExKE5VTEwsIG9sZCwgbmV3LCAiIik7DQog
DQogCXdoaWxlIChmZ2V0cyhsaW5lLCBzaXplb2YobGluZSksIHN0ZGluKSkN
Ci0JCWRpZmZfdHJlZV9zdGRpbihsaW5lKTsNCisJCWRpZmZfdHJlZV9zdGRp
bihOVUxMLCBsaW5lKTsNCiANCiAJcmV0dXJuIDA7DQogfQ0KSW5kZXg6IGRp
ZmYuYw0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0tIGM4Yzc3ZjY3ZWE4
NWVlNjVhMGYwNTVmMmNiNzZlNjA1OWVhYTA3NzYvZGlmZi5jICAobW9kZTox
MDA2NDQpDQorKysgdW5jb21taXR0ZWQvZGlmZi5jICAobW9kZToxMDA2NDQp
DQpAQCAtMTQ3LDcgKzE0Nyw3IEBADQogICogdGhlIHdvcmsgdHJlZSBoYXMg
dGhhdCBvYmplY3QgY29udGVudHMsIHJldHVybiB0cnVlLCBzbyB0aGF0DQog
ICogcHJlcGFyZV90ZW1wX2ZpbGUoKSBkb2VzIG5vdCBoYXZlIHRvIGluZmxh
dGUgYW5kIGV4dHJhY3QuDQogICovDQotc3RhdGljIGludCB3b3JrX3RyZWVf
bWF0Y2hlcyhjb25zdCBjaGFyICpuYW1lLCBjb25zdCB1bnNpZ25lZCBjaGFy
ICpzaGExKQ0KK3N0YXRpYyBpbnQgd29ya190cmVlX21hdGNoZXMoc3RydWN0
IGNhY2hlICpjYWNoZSwgY29uc3QgY2hhciAqbmFtZSwgY29uc3QgdW5zaWdu
ZWQgY2hhciAqc2hhMSkNCiB7DQogCXN0cnVjdCBjYWNoZV9lbnRyeSAqY2U7
DQogCXN0cnVjdCBzdGF0IHN0Ow0KQEAgLTE2NSwxNyArMTY1LDE3IEBADQog
CSAqIGJ5IGRpZmYtY2FjaGUgLS1jYWNoZWQsIHdoaWNoIGRvZXMgcmVhZCB0
aGUgY2FjaGUgYmVmb3JlDQogCSAqIGNhbGxpbmcgdXMuDQogCSAqLyANCi0J
aWYgKCFhY3RpdmVfY2FjaGUpDQorCWlmICghZ2V0X251bV9jYWNoZV9lbnRy
aWVzKGNhY2hlKSkNCiAJCXJldHVybiAwOw0KIA0KIAlsZW4gPSBzdHJsZW4o
bmFtZSk7DQotCXBvcyA9IGNhY2hlX25hbWVfcG9zKG5hbWUsIGxlbik7DQor
CXBvcyA9IGNhY2hlX25hbWVfcG9zKGNhY2hlLCBuYW1lLCBsZW4pOw0KIAlp
ZiAocG9zIDwgMCkNCiAJCXJldHVybiAwOw0KLQljZSA9IGFjdGl2ZV9jYWNo
ZVtwb3NdOw0KKwljZSA9IGdldF9jYWNoZV9lbnRyeShjYWNoZSwgcG9zKTsN
CiAJaWYgKChsc3RhdChuYW1lLCAmc3QpIDwgMCkgfHwNCiAJICAgICFTX0lT
UkVHKHN0LnN0X21vZGUpIHx8DQotCSAgICBjYWNoZV9tYXRjaF9zdGF0KGNl
LCAmc3QpIHx8DQorCSAgICBjZV9tYXRjaF9zdGF0KGNlLCAmc3QpIHx8DQog
CSAgICBtZW1jbXAoc2hhMSwgY2UtPnNoYTEsIDIwKSkNCiAJCXJldHVybiAw
Ow0KIAlyZXR1cm4gMTsNCkBAIC0yMDIsNyArMjAyLDggQEANCiAJc3ByaW50
Zih0ZW1wLT5tb2RlLCAiJTA2byIsIG1vZGUpOw0KIH0NCiANCi1zdGF0aWMg
dm9pZCBwcmVwYXJlX3RlbXBfZmlsZShjb25zdCBjaGFyICpuYW1lLA0KK3N0
YXRpYyB2b2lkIHByZXBhcmVfdGVtcF9maWxlKHN0cnVjdCBjYWNoZSAqY2Fj
aGUsDQorCQkJICAgICAgY29uc3QgY2hhciAqbmFtZSwNCiAJCQkgICAgICBz
dHJ1Y3QgZGlmZl90ZW1wZmlsZSAqdGVtcCwNCiAJCQkgICAgICBzdHJ1Y3Qg
ZGlmZl9zcGVjICpvbmUpDQogew0KQEAgLTIyMiw3ICsyMjMsNyBAQA0KIA0K
IAlpZiAob25lLT5zaGExX3ZhbGlkICYmDQogCSAgICAoIW1lbWNtcChvbmUt
PmJsb2Jfc2hhMSwgbnVsbF9zaGExLCBzaXplb2YobnVsbF9zaGExKSkgfHwN
Ci0JICAgICB3b3JrX3RyZWVfbWF0Y2hlcyhuYW1lLCBvbmUtPmJsb2Jfc2hh
MSkpKQ0KKwkgICAgIHdvcmtfdHJlZV9tYXRjaGVzKGNhY2hlLCBuYW1lLCBv
bmUtPmJsb2Jfc2hhMSkpKQ0KIAkJdXNlX3dvcmtfdHJlZSA9IDE7DQogDQog
CWlmICghb25lLT5zaGExX3ZhbGlkIHx8IHVzZV93b3JrX3RyZWUpIHsNCkBA
IC0yOTMsNyArMjk0LDggQEANCiAgKiAgICAgICAgICAgICAgIGluZmlsZTIg
aW5maWxlMi1zaGExIGluZmlsZTItbW9kZS4NCiAgKg0KICAqLw0KLXZvaWQg
cnVuX2V4dGVybmFsX2RpZmYoY29uc3QgY2hhciAqbmFtZSwNCit2b2lkIHJ1
bl9leHRlcm5hbF9kaWZmKHN0cnVjdCBjYWNoZSAqY2FjaGUsDQorCQkgICAg
ICAgY29uc3QgY2hhciAqbmFtZSwNCiAJCSAgICAgICBzdHJ1Y3QgZGlmZl9z
cGVjICpvbmUsDQogCQkgICAgICAgc3RydWN0IGRpZmZfc3BlYyAqdHdvKQ0K
IHsNCkBAIC0zMDMsOCArMzA1LDggQEANCiAJc3RhdGljIGludCBhdGV4aXRf
YXNrZWQgPSAwOw0KIA0KIAlpZiAob25lICYmIHR3bykgew0KLQkJcHJlcGFy
ZV90ZW1wX2ZpbGUobmFtZSwgJnRlbXBbMF0sIG9uZSk7DQotCQlwcmVwYXJl
X3RlbXBfZmlsZShuYW1lLCAmdGVtcFsxXSwgdHdvKTsNCisJCXByZXBhcmVf
dGVtcF9maWxlKGNhY2hlLCBuYW1lLCAmdGVtcFswXSwgb25lKTsNCisJCXBy
ZXBhcmVfdGVtcF9maWxlKGNhY2hlLCBuYW1lLCAmdGVtcFsxXSwgdHdvKTsN
CiAJCWlmICghIGF0ZXhpdF9hc2tlZCAmJg0KIAkJICAgICh0ZW1wWzBdLm5h
bWUgPT0gdGVtcFswXS50bXBfcGF0aCB8fA0KIAkJICAgICB0ZW1wWzFdLm5h
bWUgPT0gdGVtcFsxXS50bXBfcGF0aCkpIHsNCkBAIC0zNTcsNyArMzU5LDgg
QEANCiAJcmVtb3ZlX3RlbXBmaWxlKCk7DQogfQ0KIA0KLXZvaWQgZGlmZl9h
ZGRyZW1vdmUoaW50IGFkZHJlbW92ZSwgdW5zaWduZWQgbW9kZSwNCit2b2lk
IGRpZmZfYWRkcmVtb3ZlKHN0cnVjdCBjYWNoZSAqY2FjaGUsDQorCQkgICAg
aW50IGFkZHJlbW92ZSwgdW5zaWduZWQgbW9kZSwNCiAJCSAgICBjb25zdCB1
bnNpZ25lZCBjaGFyICpzaGExLA0KIAkJICAgIGNvbnN0IGNoYXIgKmJhc2Us
IGNvbnN0IGNoYXIgKnBhdGgpDQogew0KQEAgLTM3OSwxMCArMzgyLDExIEBA
DQogCQlzdHJjcHkoY29uY2F0cGF0aCwgYmFzZSk7DQogCQlzdHJjYXQoY29u
Y2F0cGF0aCwgcGF0aCk7DQogCX0NCi0JcnVuX2V4dGVybmFsX2RpZmYocGF0
aCA/IGNvbmNhdHBhdGggOiBiYXNlLCBvbmUsIHR3byk7DQorCXJ1bl9leHRl
cm5hbF9kaWZmKGNhY2hlLCBwYXRoID8gY29uY2F0cGF0aCA6IGJhc2UsIG9u
ZSwgdHdvKTsNCiB9DQogDQotdm9pZCBkaWZmX2NoYW5nZSh1bnNpZ25lZCBv
bGRfbW9kZSwgdW5zaWduZWQgbmV3X21vZGUsDQordm9pZCBkaWZmX2NoYW5n
ZShzdHJ1Y3QgY2FjaGUgKmNhY2hlLA0KKwkJIHVuc2lnbmVkIG9sZF9tb2Rl
LCB1bnNpZ25lZCBuZXdfbW9kZSwNCiAJCSBjb25zdCB1bnNpZ25lZCBjaGFy
ICpvbGRfc2hhMSwNCiAJCSBjb25zdCB1bnNpZ25lZCBjaGFyICpuZXdfc2hh
MSwNCiAJCSBjb25zdCBjaGFyICpiYXNlLCBjb25zdCBjaGFyICpwYXRoKSB7
DQpAQCAtNDAwLDEwICs0MDQsMTAgQEANCiAJCXN0cmNweShjb25jYXRwYXRo
LCBiYXNlKTsNCiAJCXN0cmNhdChjb25jYXRwYXRoLCBwYXRoKTsNCiAJfQ0K
LQlydW5fZXh0ZXJuYWxfZGlmZihwYXRoID8gY29uY2F0cGF0aCA6IGJhc2Us
ICZzcGVjWzBdLCAmc3BlY1sxXSk7DQorCXJ1bl9leHRlcm5hbF9kaWZmKGNh
Y2hlLCBwYXRoID8gY29uY2F0cGF0aCA6IGJhc2UsICZzcGVjWzBdLCAmc3Bl
Y1sxXSk7DQogfQ0KIA0KLXZvaWQgZGlmZl91bm1lcmdlKGNvbnN0IGNoYXIg
KnBhdGgpDQordm9pZCBkaWZmX3VubWVyZ2Uoc3RydWN0IGNhY2hlICpjYWNo
ZSwgY29uc3QgY2hhciAqcGF0aCkNCiB7DQotCXJ1bl9leHRlcm5hbF9kaWZm
KHBhdGgsIE5VTEwsIE5VTEwpOw0KKwlydW5fZXh0ZXJuYWxfZGlmZihjYWNo
ZSwgcGF0aCwgTlVMTCwgTlVMTCk7DQogfQ0KSW5kZXg6IGRpZmYuaA0KPT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PQ0KLS0tIGM4Yzc3ZjY3ZWE4NWVlNjVhMGYw
NTVmMmNiNzZlNjA1OWVhYTA3NzYvZGlmZi5oICAobW9kZToxMDA2NDQpDQor
KysgdW5jb21taXR0ZWQvZGlmZi5oICAobW9kZToxMDA2NDQpDQpAQCAtNCwx
OCArNCwyMCBAQA0KICNpZm5kZWYgRElGRl9IDQogI2RlZmluZSBESUZGX0gN
CiANCi1leHRlcm4gdm9pZCBkaWZmX2FkZHJlbW92ZShpbnQgYWRkcmVtb3Zl
LA0KK2V4dGVybiB2b2lkIGRpZmZfYWRkcmVtb3ZlKHN0cnVjdCBjYWNoZSAq
Y2FjaGUsDQorCQkJICAgaW50IGFkZHJlbW92ZSwNCiAJCQkgICB1bnNpZ25l
ZCBtb2RlLA0KIAkJCSAgIGNvbnN0IHVuc2lnbmVkIGNoYXIgKnNoYTEsDQog
CQkJICAgY29uc3QgY2hhciAqYmFzZSwNCiAJCQkgICBjb25zdCBjaGFyICpw
YXRoKTsNCiANCi1leHRlcm4gdm9pZCBkaWZmX2NoYW5nZSh1bnNpZ25lZCBt
b2RlMSwgdW5zaWduZWQgbW9kZTIsDQorZXh0ZXJuIHZvaWQgZGlmZl9jaGFu
Z2Uoc3RydWN0IGNhY2hlICpjYWNoZSwNCisJCQkgICAgIHVuc2lnbmVkIG1v
ZGUxLCB1bnNpZ25lZCBtb2RlMiwNCiAJCQkgICAgIGNvbnN0IHVuc2lnbmVk
IGNoYXIgKnNoYTEsDQogCQkJICAgICBjb25zdCB1bnNpZ25lZCBjaGFyICpz
aGEyLA0KIAkJCSAgICAgY29uc3QgY2hhciAqYmFzZSwgY29uc3QgY2hhciAq
cGF0aCk7DQogDQotZXh0ZXJuIHZvaWQgZGlmZl91bm1lcmdlKGNvbnN0IGNo
YXIgKnBhdGgpOw0KK2V4dGVybiB2b2lkIGRpZmZfdW5tZXJnZShzdHJ1Y3Qg
Y2FjaGUgKmNhY2hlLCBjb25zdCBjaGFyICpwYXRoKTsNCiANCiAvKiBUaGVz
ZSBhcmUgZm9yIGRpZmYtaGVscGVyICovDQogDQpAQCAtMzEsNyArMzMsOCBA
QA0KIAl1bnNpZ25lZCBmaWxlX3ZhbGlkIDogMTsgLyogaWYgZmFsc2UgdGhl
IGZpbGUgZG9lcyBub3QgZXZlbiBleGlzdCAqLw0KIH07DQogDQotZXh0ZXJu
IHZvaWQgcnVuX2V4dGVybmFsX2RpZmYoY29uc3QgY2hhciAqbmFtZSwNCitl
eHRlcm4gdm9pZCBydW5fZXh0ZXJuYWxfZGlmZihzdHJ1Y3QgY2FjaGUgKmNh
Y2hlLA0KKwkJCSAgICAgIGNvbnN0IGNoYXIgKm5hbWUsDQogCQkJICAgICAg
c3RydWN0IGRpZmZfc3BlYyAqLCBzdHJ1Y3QgZGlmZl9zcGVjICopOw0KIA0K
ICNlbmRpZiAvKiBESUZGX0ggKi8NCkluZGV4OiBmc2NrLWNhY2hlLmMNCj09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT0NCi0tLSBjOGM3N2Y2N2VhODVlZTY1YTBm
MDU1ZjJjYjc2ZTYwNTllYWEwNzc2L2ZzY2stY2FjaGUuYyAgKG1vZGU6MTAw
NjQ0KQ0KKysrIHVuY29tbWl0dGVkL2ZzY2stY2FjaGUuYyAgKG1vZGU6MTAw
NjQ0KQ0KQEAgLTM1Niw5ICszNTYsOSBAQA0KIA0KIAlpZiAoa2VlcF9jYWNo
ZV9vYmplY3RzKSB7DQogCQlpbnQgaTsNCi0JCXJlYWRfY2FjaGUoKTsNCi0J
CWZvciAoaSA9IDA7IGkgPCBhY3RpdmVfbnI7IGkrKykgew0KLQkJCXN0cnVj
dCBibG9iICpibG9iID0gbG9va3VwX2Jsb2IoYWN0aXZlX2NhY2hlW2ldLT5z
aGExKTsNCisJCXN0cnVjdCBjYWNoZSAqY2FjaGUgPSByZWFkX2NhY2hlKCk7
DQorCQlmb3IgKGkgPSAwOyBpIDwgZ2V0X251bV9jYWNoZV9lbnRyaWVzKGNh
Y2hlKTsgaSsrKSB7DQorCQkJc3RydWN0IGJsb2IgKmJsb2IgPSBsb29rdXBf
YmxvYihnZXRfY2FjaGVfZW50cnkoY2FjaGUsIGkpLT5zaGExKTsNCiAJCQlz
dHJ1Y3Qgb2JqZWN0ICpvYmo7DQogCQkJaWYgKCFibG9iKQ0KIAkJCQljb250
aW51ZTsNCkluZGV4OiBsb2NhbC1wdWxsLmMNCj09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT0NCi0tLSBjOGM3N2Y2N2VhODVlZTY1YTBmMDU1ZjJjYjc2ZTYwNTll
YWEwNzc2L2xvY2FsLXB1bGwuYyAgKG1vZGU6MTAwNjQ0KQ0KKysrIHVuY29t
bWl0dGVkL2xvY2FsLXB1bGwuYyAgKG1vZGU6MTAwNjQ0KQ0KQEAgLTYxLDcg
KzYxLDcgQEANCiAJCX0NCiAJCW1hcCA9IG1tYXAoTlVMTCwgc3Quc3Rfc2l6
ZSwgUFJPVF9SRUFELCBNQVBfUFJJVkFURSwgaWZkLCAwKTsNCiAJCWNsb3Nl
KGlmZCk7DQotCQlpZiAoLTEgPT0gKGludCkobG9uZyltYXApIHsNCisJCWlm
IChNQVBfRkFJTEVEID09IG1hcCkgew0KIAkJCWZwcmludGYoc3RkZXJyLCAi
Y2Fubm90IG1tYXAgJXNcbiIsIGZpbGVuYW1lKTsNCiAJCQlyZXR1cm4gLTE7
DQogCQl9DQpJbmRleDogbHMtZmlsZXMuYw0KPT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PQ0KLS0tIGM4Yzc3ZjY3ZWE4NWVlNjVhMGYwNTVmMmNiNzZlNjA1OWVh
YTA3NzYvbHMtZmlsZXMuYyAgKG1vZGU6MTAwNjQ0KQ0KKysrIHVuY29tbWl0
dGVkL2xzLWZpbGVzLmMgIChtb2RlOjEwMDY0NCkNCkBAIC05OCwxMSArOTgs
MTEgQEANCiBzdGF0aWMgaW50IG5yX2RpcjsNCiBzdGF0aWMgaW50IGRpcl9h
bGxvYzsNCiANCi1zdGF0aWMgdm9pZCBhZGRfbmFtZShjb25zdCBjaGFyICpw
YXRobmFtZSwgaW50IGxlbikNCitzdGF0aWMgdm9pZCBhZGRfbmFtZShzdHJ1
Y3QgY2FjaGUgKmNhY2hlLCBjb25zdCBjaGFyICpwYXRobmFtZSwgaW50IGxl
bikNCiB7DQogCXN0cnVjdCBub25kX29uX2ZzICplbnQ7DQogDQotCWlmIChj
YWNoZV9uYW1lX3BvcyhwYXRobmFtZSwgbGVuKSA+PSAwKQ0KKwlpZiAoY2Fj
aGVfbmFtZV9wb3MoY2FjaGUsIHBhdGhuYW1lLCBsZW4pID49IDApDQogCQly
ZXR1cm47DQogDQogCWlmIChucl9kaXIgPT0gZGlyX2FsbG9jKSB7DQpAQCAt
MTI0LDcgKzEyNCw3IEBADQogICogQWxzbywgd2UgY3VycmVudGx5IGlnbm9y
ZSBhbGwgbmFtZXMgc3RhcnRpbmcgd2l0aCBhIGRvdC4NCiAgKiBUaGF0IGxp
a2VseSB3aWxsIG5vdCBjaGFuZ2UuDQogICovDQotc3RhdGljIHZvaWQgcmVh
ZF9kaXJlY3RvcnkoY29uc3QgY2hhciAqcGF0aCwgY29uc3QgY2hhciAqYmFz
ZSwgaW50IGJhc2VsZW4pDQorc3RhdGljIHZvaWQgcmVhZF9kaXJlY3Rvcnko
c3RydWN0IGNhY2hlICpjYWNoZSwgY29uc3QgY2hhciAqcGF0aCwgY29uc3Qg
Y2hhciAqYmFzZSwgaW50IGJhc2VsZW4pDQogew0KIAlESVIgKmRpciA9IG9w
ZW5kaXIocGF0aCk7DQogDQpAQCAtMTU3LDE0ICsxNTcsMTQgQEANCiAJCQkJ
LyogZmFsbHRocm91Z2ggKi8NCiAJCQljYXNlIERUX0RJUjoNCiAJCQkJbWVt
Y3B5KGZ1bGxuYW1lICsgYmFzZWxlbiArIGxlbiwgIi8iLCAyKTsNCi0JCQkJ
cmVhZF9kaXJlY3RvcnkoZnVsbG5hbWUsIGZ1bGxuYW1lLA0KKwkJCQlyZWFk
X2RpcmVjdG9yeShjYWNoZSwgZnVsbG5hbWUsIGZ1bGxuYW1lLA0KIAkJCQkJ
ICAgICAgIGJhc2VsZW4gKyBsZW4gKyAxKTsNCiAJCQkJY29udGludWU7DQog
CQkJY2FzZSBEVF9SRUc6DQogCQkJY2FzZSBEVF9MTks6DQogCQkJCWJyZWFr
Ow0KIAkJCX0NCi0JCQlhZGRfbmFtZShmdWxsbmFtZSwgYmFzZWxlbiArIGxl
bik7DQorCQkJYWRkX25hbWUoY2FjaGUsIGZ1bGxuYW1lLCBiYXNlbGVuICsg
bGVuKTsNCiAJCX0NCiAJCWNsb3NlZGlyKGRpcik7DQogCX0NCkBAIC0xNzks
NyArMTc5LDcgQEANCiAJCQkJICBlMi0+bmFtZSwgZTItPmxlbik7DQogfQ0K
IA0KLXN0YXRpYyB2b2lkIHNob3dfa2lsbGVkX2ZpbGVzKCkNCitzdGF0aWMg
dm9pZCBzaG93X2tpbGxlZF9maWxlcyhzdHJ1Y3QgY2FjaGUgKmNhY2hlKQ0K
IHsNCiAJaW50IGk7DQogCWZvciAoaSA9IDA7IGkgPCBucl9kaXI7IGkrKykg
ew0KQEAgLTE5MywyOCArMTkzLDI4IEBADQogCQkJCS8qIElmIGVudC0+bmFt
ZSBpcyBwcmVmaXggb2YgYW4gZW50cnkgaW4gdGhlDQogCQkJCSAqIGNhY2hl
LCBpdCB3aWxsIGJlIGtpbGxlZC4NCiAJCQkJICovDQotCQkJCXBvcyA9IGNh
Y2hlX25hbWVfcG9zKGVudC0+bmFtZSwgZW50LT5sZW4pOw0KKwkJCQlwb3Mg
PSBjYWNoZV9uYW1lX3BvcyhjYWNoZSwgZW50LT5uYW1lLCBlbnQtPmxlbik7
DQogCQkJCWlmICgwIDw9IHBvcykNCiAJCQkJCWRpZSgiYnVnIGluIHNob3ct
a2lsbGVkLWZpbGVzIik7DQogCQkJCXBvcyA9IC1wb3MgLSAxOw0KLQkJCQl3
aGlsZSAocG9zIDwgYWN0aXZlX25yICYmDQotCQkJCSAgICAgICBjZV9zdGFn
ZShhY3RpdmVfY2FjaGVbcG9zXSkpDQorCQkJCXdoaWxlIChwb3MgPCBnZXRf
bnVtX2NhY2hlX2VudHJpZXMoY2FjaGUpICYmDQorCQkJCSAgICAgICBjZV9z
dGFnZShnZXRfY2FjaGVfZW50cnkoY2FjaGUsIHBvcykpKQ0KIAkJCQkJcG9z
Kys7IC8qIHNraXAgdW5tZXJnZWQgKi8NCi0JCQkJaWYgKGFjdGl2ZV9uciA8
PSBwb3MpDQorCQkJCWlmIChnZXRfbnVtX2NhY2hlX2VudHJpZXMoY2FjaGUp
IDw9IHBvcykNCiAJCQkJCWJyZWFrOw0KIAkJCQkvKiBwb3MgcG9pbnRzIGF0
IGEgbmFtZSBpbW1lZGlhdGVseSBhZnRlcg0KIAkJCQkgKiBlbnQtPm5hbWUg
aW4gdGhlIGNhY2hlLiAgRG9lcyBpdCBleHBlY3QNCiAJCQkJICogZW50LT5u
YW1lIHRvIGJlIGEgZGlyZWN0b3J5Pw0KIAkJCQkgKi8NCi0JCQkJbGVuID0g
Y2VfbmFtZWxlbihhY3RpdmVfY2FjaGVbcG9zXSk7DQorCQkJCWxlbiA9IGNl
X25hbWVsZW4oZ2V0X2NhY2hlX2VudHJ5KGNhY2hlLCBwb3MpKTsNCiAJCQkJ
aWYgKChlbnQtPmxlbiA8IGxlbikgJiYNCi0JCQkJICAgICFzdHJuY21wKGFj
dGl2ZV9jYWNoZVtwb3NdLT5uYW1lLA0KKwkJCQkgICAgIXN0cm5jbXAoZ2V0
X2NhY2hlX2VudHJ5KGNhY2hlLCBwb3MpLT5uYW1lLA0KIAkJCQkJICAgICBl
bnQtPm5hbWUsIGVudC0+bGVuKSAmJg0KLQkJCQkgICAgYWN0aXZlX2NhY2hl
W3Bvc10tPm5hbWVbZW50LT5sZW5dID09ICcvJykNCisJCQkJICAgIGdldF9j
YWNoZV9lbnRyeShjYWNoZSwgcG9zKS0+bmFtZVtlbnQtPmxlbl0gPT0gJy8n
KQ0KIAkJCQkJa2lsbGVkID0gMTsNCiAJCQkJYnJlYWs7DQogCQkJfQ0KLQkJ
CWlmICgwIDw9IGNhY2hlX25hbWVfcG9zKGVudC0+bmFtZSwgc3AgLSBlbnQt
Pm5hbWUpKSB7DQorCQkJaWYgKDAgPD0gY2FjaGVfbmFtZV9wb3MoY2FjaGUs
IGVudC0+bmFtZSwgc3AgLSBlbnQtPm5hbWUpKSB7DQogCQkJCS8qIElmIGFu
eSBvZiB0aGUgbGVhZGluZyBkaXJlY3RvcmllcyBpbg0KIAkJCQkgKiBlbnQt
Pm5hbWUgaXMgcmVnaXN0ZXJlZCBpbiB0aGUgY2FjaGUsDQogCQkJCSAqIGVu
dC0+bmFtZSB3aWxsIGJlIGtpbGxlZC4NCkBAIC0yMzAsMTMgKzIzMCwxMyBA
QA0KIAl9DQogfQ0KIA0KLXN0YXRpYyB2b2lkIHNob3dfZmlsZXModm9pZCkN
CitzdGF0aWMgdm9pZCBzaG93X2ZpbGVzKHN0cnVjdCBjYWNoZSAqY2FjaGUp
DQogew0KIAlpbnQgaTsNCiANCiAJLyogRm9yIGNhY2hlZC9kZWxldGVkIGZp
bGVzIHdlIGRvbid0IG5lZWQgdG8gZXZlbiBkbyB0aGUgcmVhZGRpciAqLw0K
IAlpZiAoc2hvd19vdGhlcnMgfHwgc2hvd19raWxsZWQpIHsNCi0JCXJlYWRf
ZGlyZWN0b3J5KCIuIiwgIiIsIDApOw0KKwkJcmVhZF9kaXJlY3RvcnkoY2Fj
aGUsICIuIiwgIiIsIDApOw0KIAkJcXNvcnQoZGlyLCBucl9kaXIsIHNpemVv
ZihzdHJ1Y3Qgbm9uZF9vbl9mcyAqKSwgY21wX25hbWUpOw0KIAkJaWYgKHNo
b3dfb3RoZXJzKQ0KIAkJCWZvciAoaSA9IDA7IGkgPCBucl9kaXI7IGkrKykN
CkBAIC0yNDQsMTEgKzI0NCwxMSBAQA0KIAkJCQkgICAgICAgZGlyW2ldLT5s
ZW4sIGRpcltpXS0+bmFtZSwNCiAJCQkJICAgICAgIGxpbmVfdGVybWluYXRv
cik7DQogCQlpZiAoc2hvd19raWxsZWQpDQotCQkJc2hvd19raWxsZWRfZmls
ZXMoKTsNCisJCQlzaG93X2tpbGxlZF9maWxlcyhjYWNoZSk7DQogCX0NCiAJ
aWYgKHNob3dfY2FjaGVkIHwgc2hvd19zdGFnZSkgew0KLQkJZm9yIChpID0g
MDsgaSA8IGFjdGl2ZV9ucjsgaSsrKSB7DQotCQkJc3RydWN0IGNhY2hlX2Vu
dHJ5ICpjZSA9IGFjdGl2ZV9jYWNoZVtpXTsNCisJCWZvciAoaSA9IDA7IGkg
PCBnZXRfbnVtX2NhY2hlX2VudHJpZXMoY2FjaGUpOyBpKyspIHsNCisJCQlz
dHJ1Y3QgY2FjaGVfZW50cnkgKmNlID0gZ2V0X2NhY2hlX2VudHJ5KGNhY2hl
LCBpKTsNCiAJCQlpZiAoZXhjbHVkZWQoY2UtPm5hbWUpICE9IHNob3dfaWdu
b3JlZCkNCiAJCQkJY29udGludWU7DQogCQkJaWYgKHNob3dfdW5tZXJnZWQg
JiYgIWNlX3N0YWdlKGNlKSkNCkBAIC0yNjksOCArMjY5LDggQEANCiAJCX0N
CiAJfQ0KIAlpZiAoc2hvd19kZWxldGVkKSB7DQotCQlmb3IgKGkgPSAwOyBp
IDwgYWN0aXZlX25yOyBpKyspIHsNCi0JCQlzdHJ1Y3QgY2FjaGVfZW50cnkg
KmNlID0gYWN0aXZlX2NhY2hlW2ldOw0KKwkJZm9yIChpID0gMDsgaSA8IGdl
dF9udW1fY2FjaGVfZW50cmllcyhjYWNoZSk7IGkrKykgew0KKwkJCXN0cnVj
dCBjYWNoZV9lbnRyeSAqY2UgPSBnZXRfY2FjaGVfZW50cnkoY2FjaGUsIGkp
Ow0KIAkJCXN0cnVjdCBzdGF0IHN0Ow0KIAkJCWlmIChleGNsdWRlZChjZS0+
bmFtZSkgIT0gc2hvd19pZ25vcmVkKQ0KIAkJCQljb250aW51ZTsNCkBAIC0y
ODksNiArMjg5LDcgQEANCiBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqKmFy
Z3YpDQogew0KIAlpbnQgaTsNCisJc3RydWN0IGNhY2hlICpjYWNoZTsNCiAN
CiAJZm9yIChpID0gMTsgaSA8IGFyZ2M7IGkrKykgew0KIAkJY2hhciAqYXJn
ID0gYXJndltpXTsNCkBAIC0zNDEsNyArMzQyLDcgQEANCiAJaWYgKCEoc2hv
d19zdGFnZSB8IHNob3dfZGVsZXRlZCB8IHNob3dfb3RoZXJzIHwgc2hvd191
bm1lcmdlZCB8IHNob3dfa2lsbGVkKSkNCiAJCXNob3dfY2FjaGVkID0gMTsN
CiANCi0JcmVhZF9jYWNoZSgpOw0KLQlzaG93X2ZpbGVzKCk7DQorCWNhY2hl
ID0gcmVhZF9jYWNoZSgpOw0KKwlzaG93X2ZpbGVzKGNhY2hlKTsNCiAJcmV0
dXJuIDA7DQogfQ0KSW5kZXg6IG1lcmdlLWNhY2hlLmMNCj09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT0NCi0tLSBjOGM3N2Y2N2VhODVlZTY1YTBmMDU1ZjJjYjc2
ZTYwNTllYWEwNzc2L21lcmdlLWNhY2hlLmMgIChtb2RlOjEwMDY0NCkNCisr
KyB1bmNvbW1pdHRlZC9tZXJnZS1jYWNoZS5jICAobW9kZToxMDA2NDQpDQpA
QCAtMzQsMTEgKzM0LDExIEBADQogCX0NCiB9DQogDQotc3RhdGljIGludCBt
ZXJnZV9lbnRyeShpbnQgcG9zLCBjb25zdCBjaGFyICpwYXRoKQ0KK3N0YXRp
YyBpbnQgbWVyZ2VfZW50cnkoc3RydWN0IGNhY2hlICpjYWNoZSwgaW50IHBv
cywgY29uc3QgY2hhciAqcGF0aCkNCiB7DQogCWludCBmb3VuZDsNCiAJDQot
CWlmIChwb3MgPj0gYWN0aXZlX25yKQ0KKwlpZiAocG9zID49IGdldF9udW1f
Y2FjaGVfZW50cmllcyhjYWNoZSkpDQogCQlkaWUoIm1lcmdlLWNhY2hlOiAl
cyBub3QgaW4gdGhlIGNhY2hlIiwgcGF0aCk7DQogCWFyZ3VtZW50c1swXSA9
IHBnbTsNCiAJYXJndW1lbnRzWzFdID0gIiI7DQpAQCAtNTIsNyArNTIsNyBA
QA0KIAlkbyB7DQogCQlzdGF0aWMgY2hhciBoZXhidWZbNF1bNjBdOw0KIAkJ
c3RhdGljIGNoYXIgb3duYnVmWzRdWzYwXTsNCi0JCXN0cnVjdCBjYWNoZV9l
bnRyeSAqY2UgPSBhY3RpdmVfY2FjaGVbcG9zXTsNCisJCXN0cnVjdCBjYWNo
ZV9lbnRyeSAqY2UgPSBnZXRfY2FjaGVfZW50cnkoY2FjaGUsIHBvcyk7DQog
CQlpbnQgc3RhZ2UgPSBjZV9zdGFnZShjZSk7DQogDQogCQlpZiAoc3RyY21w
KGNlLT5uYW1lLCBwYXRoKSkNCkBAIC02Miw0NCArNjIsNDUgQEANCiAJCXNw
cmludGYob3duYnVmW3N0YWdlXSwgIiVvIiwgbnRvaGwoY2UtPmNlX21vZGUp
ICYgKH5TX0lGTVQpKTsNCiAJCWFyZ3VtZW50c1tzdGFnZV0gPSBoZXhidWZb
c3RhZ2VdOw0KIAkJYXJndW1lbnRzW3N0YWdlICsgNF0gPSBvd25idWZbc3Rh
Z2VdOw0KLQl9IHdoaWxlICgrK3BvcyA8IGFjdGl2ZV9ucik7DQorCX0gd2hp
bGUgKCsrcG9zIDwgZ2V0X251bV9jYWNoZV9lbnRyaWVzKGNhY2hlKSk7DQog
CWlmICghZm91bmQpDQogCQlkaWUoIm1lcmdlLWNhY2hlOiAlcyBub3QgaW4g
dGhlIGNhY2hlIiwgcGF0aCk7DQogCXJ1bl9wcm9ncmFtKCk7DQogCXJldHVy
biBmb3VuZDsNCiB9DQogDQotc3RhdGljIHZvaWQgbWVyZ2VfZmlsZShjb25z
dCBjaGFyICpwYXRoKQ0KK3N0YXRpYyB2b2lkIG1lcmdlX2ZpbGUoc3RydWN0
IGNhY2hlICpjYWNoZSwgY29uc3QgY2hhciAqcGF0aCkNCiB7DQotCWludCBw
b3MgPSBjYWNoZV9uYW1lX3BvcyhwYXRoLCBzdHJsZW4ocGF0aCkpOw0KKwlp
bnQgcG9zID0gY2FjaGVfbmFtZV9wb3MoY2FjaGUsIHBhdGgsIHN0cmxlbihw
YXRoKSk7DQogDQogCS8qDQogCSAqIElmIGl0IGFscmVhZHkgZXhpc3RzIGlu
IHRoZSBjYWNoZSBhcyBzdGFnZTAsIGl0J3MNCiAJICogYWxyZWFkeSBtZXJn
ZWQgYW5kIHRoZXJlIGlzIG5vdGhpbmcgdG8gZG8uDQogCSAqLw0KIAlpZiAo
cG9zIDwgMCkNCi0JCW1lcmdlX2VudHJ5KC1wb3MtMSwgcGF0aCk7DQorCQlt
ZXJnZV9lbnRyeShjYWNoZSwgLXBvcy0xLCBwYXRoKTsNCiB9DQogDQotc3Rh
dGljIHZvaWQgbWVyZ2VfYWxsKHZvaWQpDQorc3RhdGljIHZvaWQgbWVyZ2Vf
YWxsKHN0cnVjdCBjYWNoZSAqY2FjaGUpDQogew0KIAlpbnQgaTsNCi0JZm9y
IChpID0gMDsgaSA8IGFjdGl2ZV9ucjsgaSsrKSB7DQotCQlzdHJ1Y3QgY2Fj
aGVfZW50cnkgKmNlID0gYWN0aXZlX2NhY2hlW2ldOw0KKwlmb3IgKGkgPSAw
OyBpIDwgZ2V0X251bV9jYWNoZV9lbnRyaWVzKGNhY2hlKTsgaSsrKSB7DQor
CQlzdHJ1Y3QgY2FjaGVfZW50cnkgKmNlID0gZ2V0X2NhY2hlX2VudHJ5KGNh
Y2hlLCBpKTsNCiAJCWlmICghY2Vfc3RhZ2UoY2UpKQ0KIAkJCWNvbnRpbnVl
Ow0KLQkJaSArPSBtZXJnZV9lbnRyeShpLCBjZS0+bmFtZSktMTsNCisJCWkg
Kz0gbWVyZ2VfZW50cnkoY2FjaGUsIGksIGNlLT5uYW1lKS0xOw0KIAl9DQog
fQ0KIA0KIGludCBtYWluKGludCBhcmdjLCBjaGFyICoqYXJndikNCiB7DQog
CWludCBpLCBmb3JjZV9maWxlID0gMDsNCisJc3RydWN0IGNhY2hlICpjYWNo
ZTsNCiANCiAJaWYgKGFyZ2MgPCAzKQ0KIAkJdXNhZ2UoIm1lcmdlLWNhY2hl
IFstb10gPG1lcmdlLXByb2dyYW0+ICgtYSB8IDxmaWxlbmFtZT4qKSIpOw0K
IA0KLQlyZWFkX2NhY2hlKCk7DQorCWNhY2hlID0gcmVhZF9jYWNoZSgpOw0K
IA0KIAlpID0gMTsNCiAJaWYgKCFzdHJjbXAoYXJndlsxXSwgIi1vIikpIHsN
CkBAIC0xMTUsMTIgKzExNiwxMiBAQA0KIAkJCQljb250aW51ZTsNCiAJCQl9
DQogCQkJaWYgKCFzdHJjbXAoYXJnLCAiLWEiKSkgew0KLQkJCQltZXJnZV9h
bGwoKTsNCisJCQkJbWVyZ2VfYWxsKGNhY2hlKTsNCiAJCQkJY29udGludWU7
DQogCQkJfQ0KIAkJCWRpZSgibWVyZ2UtY2FjaGU6IHVua25vd24gb3B0aW9u
ICVzIiwgYXJnKTsNCiAJCX0NCi0JCW1lcmdlX2ZpbGUoYXJnKTsNCisJCW1l
cmdlX2ZpbGUoY2FjaGUsIGFyZyk7DQogCX0NCiAJaWYgKGVycikNCiAJCWRp
ZSgibWVyZ2UgcHJvZ3JhbSBmYWlsZWQiKTsNCkluZGV4OiByZWFkLWNhY2hl
LmMNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBjOGM3N2Y2N2VhODVl
ZTY1YTBmMDU1ZjJjYjc2ZTYwNTllYWEwNzc2L3JlYWQtY2FjaGUuYyAgKG1v
ZGU6MTAwNjQ0KQ0KKysrIHVuY29tbWl0dGVkL3JlYWQtY2FjaGUuYyAgKG1v
ZGU6MTAwNjQ0KQ0KQEAgLTYsMTAgKzYsNDkgQEANCiAjaW5jbHVkZSA8c3Rk
YXJnLmg+DQogI2luY2x1ZGUgImNhY2hlLmgiDQogDQotc3RydWN0IGNhY2hl
X2VudHJ5ICoqYWN0aXZlX2NhY2hlID0gTlVMTDsNCi11bnNpZ25lZCBpbnQg
YWN0aXZlX25yID0gMCwgYWN0aXZlX2FsbG9jID0gMCwgYWN0aXZlX2NhY2hl
X2NoYW5nZWQgPSAwOw0KKy8qDQorICogQmFzaWMgZGF0YSBzdHJ1Y3R1cmVz
IGZvciB0aGUgZGlyZWN0b3J5IGNhY2hlDQorICovDQorDQorI2RlZmluZSBD
QUNIRV9TSUdOQVRVUkUgMHg0NDQ5NTI0MwkvKiAiRElSQyIgKi8NCitzdHJ1
Y3QgY2FjaGVfaGVhZGVyIHsNCisJdW5zaWduZWQgaW50IGhkcl9zaWduYXR1
cmU7DQorCXVuc2lnbmVkIGludCBoZHJfdmVyc2lvbjsNCisJdW5zaWduZWQg
aW50IGhkcl9lbnRyaWVzOw0KK307DQorDQorc3RydWN0IG1tYXBfaG9sZGVy
IHsNCisJdm9pZCAqIHB0cjsNCisJc2l6ZV90IHNpemU7DQorfTsNCisNCitz
dHJ1Y3QgY2FjaGUgew0KKwlzdHJ1Y3QgbW1hcF9ob2xkZXIgICBtYXA7DQor
CXN0cnVjdCBjYWNoZV9oZWFkZXIgKmhlYWRlcjsNCisJc3RydWN0IGNhY2hl
X2VudHJ5ICoqZW50cmllczsNCisJdW5zaWduZWQgaW50IG51bV9lbnRyaWVz
Ow0KKwl1bnNpZ25lZCBpbnQgYWxsb2NhdGVkX2VudHJpZXM7DQorCXVuc2ln
bmVkIGludCBhY3RpdmVfY2FjaGVfY2hhbmdlZDsNCit9Ow0KKw0KK3N0cnVj
dCBjYWNoZSAqIG5ld19jYWNoZSgpDQorew0KKwlzdHJ1Y3QgY2FjaGUgKmNh
Y2hlID0geGNhbGxvYygxLCBzaXplb2Yoc3RydWN0IGNhY2hlKSk7DQorDQor
CWNhY2hlLT5tYXAucHRyID0gTUFQX0ZBSUxFRDsNCisNCisJcmV0dXJuIGNh
Y2hlOw0KK30NCisNCit2b2lkIGZyZWVfY2FjaGUoc3RydWN0IGNhY2hlICpj
YWNoZSkNCit7DQorCWlmIChjYWNoZS0+bWFwLnB0ciAhPSBNQVBfRkFJTEVE
KQ0KKwkJbXVubWFwKGNhY2hlLT5tYXAucHRyLCBjYWNoZS0+bWFwLnNpemUp
Ow0KKw0KKwlmcmVlKGNhY2hlKTsNCit9DQogDQotaW50IGNhY2hlX21hdGNo
X3N0YXQoc3RydWN0IGNhY2hlX2VudHJ5ICpjZSwgc3RydWN0IHN0YXQgKnN0
KQ0KK2ludCBjZV9tYXRjaF9zdGF0KHN0cnVjdCBjYWNoZV9lbnRyeSAqY2Us
IHN0cnVjdCBzdGF0ICpzdCkNCiB7DQogCXVuc2lnbmVkIGludCBjaGFuZ2Vk
ID0gMDsNCiANCkBAIC03NSwxNSArMTE0LDE1IEBADQogCXJldHVybiAwOw0K
IH0NCiANCi1pbnQgY2FjaGVfbmFtZV9wb3MoY29uc3QgY2hhciAqbmFtZSwg
aW50IG5hbWVsZW4pDQoraW50IGNhY2hlX25hbWVfcG9zKHN0cnVjdCBjYWNo
ZSAqY2FjaGUsIGNvbnN0IGNoYXIgKm5hbWUsIGludCBuYW1lbGVuKQ0KIHsN
CiAJaW50IGZpcnN0LCBsYXN0Ow0KIA0KIAlmaXJzdCA9IDA7DQotCWxhc3Qg
PSBhY3RpdmVfbnI7DQorCWxhc3QgPSBjYWNoZS0+bnVtX2VudHJpZXM7DQog
CXdoaWxlIChsYXN0ID4gZmlyc3QpIHsNCiAJCWludCBuZXh0ID0gKGxhc3Qg
KyBmaXJzdCkgPj4gMTsNCi0JCXN0cnVjdCBjYWNoZV9lbnRyeSAqY2UgPSBh
Y3RpdmVfY2FjaGVbbmV4dF07DQorCQlzdHJ1Y3QgY2FjaGVfZW50cnkgKmNl
ID0gZ2V0X2NhY2hlX2VudHJ5KGNhY2hlLCBuZXh0KTsNCiAJCWludCBjbXAg
PSBjYWNoZV9uYW1lX2NvbXBhcmUobmFtZSwgbmFtZWxlbiwgY2UtPm5hbWUs
IGh0b25zKGNlLT5jZV9mbGFncykpOw0KIAkJaWYgKCFjbXApDQogCQkJcmV0
dXJuIG5leHQ7DQpAQCAtOTcsMjcgKzEzNiwyNyBAQA0KIH0NCiANCiAvKiBS
ZW1vdmUgZW50cnksIHJldHVybiB0cnVlIGlmIHRoZXJlIGFyZSBtb3JlIGVu
dHJpZXMgdG8gZ28uLiAqLw0KLWludCByZW1vdmVfZW50cnlfYXQoaW50IHBv
cykNCitpbnQgcmVtb3ZlX2NhY2hlX2VudHJ5X2F0KHN0cnVjdCBjYWNoZSAq
Y2FjaGUsIGludCBwb3MpDQogew0KLQlhY3RpdmVfY2FjaGVfY2hhbmdlZCA9
IDE7DQotCWFjdGl2ZV9uci0tOw0KLQlpZiAocG9zID49IGFjdGl2ZV9ucikN
CisJY2FjaGUtPmFjdGl2ZV9jYWNoZV9jaGFuZ2VkID0gMTsNCisJY2FjaGUt
Pm51bV9lbnRyaWVzLS07DQorCWlmIChwb3MgPj0gY2FjaGUtPm51bV9lbnRy
aWVzKQ0KIAkJcmV0dXJuIDA7DQotCW1lbW1vdmUoYWN0aXZlX2NhY2hlICsg
cG9zLCBhY3RpdmVfY2FjaGUgKyBwb3MgKyAxLCAoYWN0aXZlX25yIC0gcG9z
KSAqIHNpemVvZihzdHJ1Y3QgY2FjaGVfZW50cnkgKikpOw0KKwltZW1tb3Zl
KGNhY2hlLT5lbnRyaWVzICsgcG9zLCBjYWNoZS0+ZW50cmllcyArIHBvcyAr
IDEsIChjYWNoZS0+bnVtX2VudHJpZXMgLSBwb3MpICogc2l6ZW9mKHN0cnVj
dCBjYWNoZV9lbnRyeSAqKSk7DQogCXJldHVybiAxOw0KIH0NCiANCi1pbnQg
cmVtb3ZlX2ZpbGVfZnJvbV9jYWNoZShjaGFyICpwYXRoKQ0KK2ludCByZW1v
dmVfZmlsZV9mcm9tX2NhY2hlKHN0cnVjdCBjYWNoZSAqY2FjaGUsIGNoYXIg
KnBhdGgpDQogew0KLQlpbnQgcG9zID0gY2FjaGVfbmFtZV9wb3MocGF0aCwg
c3RybGVuKHBhdGgpKTsNCisJaW50IHBvcyA9IGNhY2hlX25hbWVfcG9zKGNh
Y2hlLCBwYXRoLCBzdHJsZW4ocGF0aCkpOw0KIAlpZiAocG9zIDwgMCkNCiAJ
CXBvcyA9IC1wb3MtMTsNCi0Jd2hpbGUgKHBvcyA8IGFjdGl2ZV9uciAmJiAh
c3RyY21wKGFjdGl2ZV9jYWNoZVtwb3NdLT5uYW1lLCBwYXRoKSkNCi0JCXJl
bW92ZV9lbnRyeV9hdChwb3MpOw0KKwl3aGlsZSAocG9zIDwgZ2V0X251bV9j
YWNoZV9lbnRyaWVzKGNhY2hlKSAmJiAhc3RyY21wKGdldF9jYWNoZV9lbnRy
eShjYWNoZSwgcG9zKS0+bmFtZSwgcGF0aCkpDQorCQlyZW1vdmVfY2FjaGVf
ZW50cnlfYXQoY2FjaGUsIHBvcyk7DQogCXJldHVybiAwOw0KIH0NCiANCi1p
bnQgc2FtZV9uYW1lKHN0cnVjdCBjYWNoZV9lbnRyeSAqYSwgc3RydWN0IGNh
Y2hlX2VudHJ5ICpiKQ0KK2ludCBjZV9zYW1lX25hbWUoc3RydWN0IGNhY2hl
X2VudHJ5ICphLCBzdHJ1Y3QgY2FjaGVfZW50cnkgKmIpDQogew0KIAlpbnQg
bGVuID0gY2VfbmFtZWxlbihhKTsNCiAJcmV0dXJuIGNlX25hbWVsZW4oYikg
PT0gbGVuICYmICFtZW1jbXAoYS0+bmFtZSwgYi0+bmFtZSwgbGVuKTsNCkBA
IC0xMzIsNyArMTcxLDggQEANCiAgKiBmcm9tIHRoZSBjYWNoZSBzbyB0aGUg
Y2FsbGVyIHNob3VsZCByZWNvbXB1dGUgdGhlIGluc2VydCBwb3NpdGlvbi4N
CiAgKiBXaGVuIHRoaXMgaGFwcGVucywgd2UgcmV0dXJuIG5vbi16ZXJvLg0K
ICAqLw0KLXN0YXRpYyBpbnQgY2hlY2tfZmlsZV9kaXJlY3RvcnlfY29uZmxp
Y3QoY29uc3Qgc3RydWN0IGNhY2hlX2VudHJ5ICpjZSwNCitzdGF0aWMgaW50
IGNoZWNrX2ZpbGVfZGlyZWN0b3J5X2NvbmZsaWN0KHN0cnVjdCBjYWNoZSAq
Y2FjaGUsDQorCQkJCQkgY29uc3Qgc3RydWN0IGNhY2hlX2VudHJ5ICpjZSwN
CiAJCQkJCSBpbnQgb2tfdG9fcmVwbGFjZSkNCiB7DQogCWludCBwb3MsIHJl
cGxhY2VkID0gMDsNCkBAIC0xNTUsNyArMTk1LDcgQEANCiAJCWlmICghZXAp
DQogCQkJYnJlYWs7DQogCQkqZXAgPSAwOyAgICAvKiBmaXJzdCBjdXQgaXQg
YXQgc2xhc2ggKi8NCi0JCXBvcyA9IGNhY2hlX25hbWVfcG9zKHBhdGhidWYs
DQorCQlwb3MgPSBjYWNoZV9uYW1lX3BvcyhjYWNoZSwgcGF0aGJ1ZiwNCiAJ
CQkJICAgICBodG9ucyhjcmVhdGVfY2VfZmxhZ3MoZXAtY3AsIHN0YWdlKSkp
Ow0KIAkJaWYgKDAgPD0gcG9zKSB7DQogCQkJLyogT3VyIGxlYWRpbmcgcGF0
aCBjb21wb25lbnQgaXMgcmVnaXN0ZXJlZCBhcyBhIGZpbGUsDQpAQCAtMTY3
LDcgKzIwNyw3IEBADQogCQkJCXJldHVybiAtMTsNCiAJCQl9DQogCQkJZnBy
aW50ZihzdGRlcnIsICJyZW1vdmluZyBmaWxlICclcycgdG8gcmVwbGFjZSBp
dCB3aXRoIGEgZGlyZWN0b3J5IHRvIGNyZWF0ZSAnJXMnLlxuIiwgcGF0aGJ1
ZiwgcGF0aCk7DQotCQkJcmVtb3ZlX2VudHJ5X2F0KHBvcyk7DQorCQkJcmVt
b3ZlX2NhY2hlX2VudHJ5X2F0KGNhY2hlLCBwb3MpOw0KIAkJCXJlcGxhY2Vk
ID0gMTsNCiAJCX0NCiAJCSplcCA9ICcvJzsgIC8qIHRoZW4gcmVzdG9yZSBp
dCBhbmQgZ28gZG93bndhcmRzICovDQpAQCAtMTc5LDcgKzIxOSw3IEBADQog
CSAqIG9mIGl0PyAgVGhhdCBpcywgYXJlIHdlIGNyZWF0aW5nIGEgZmlsZSB3
aGVyZSB0aGV5IGFscmVhZHkgZXhwZWN0DQogCSAqIGEgZGlyZWN0b3J5IHRo
ZXJlPw0KIAkgKi8NCi0JcG9zID0gY2FjaGVfbmFtZV9wb3MocGF0aCwNCisJ
cG9zID0gY2FjaGVfbmFtZV9wb3MoY2FjaGUsIHBhdGgsDQogCQkJICAgICBo
dG9ucyhjcmVhdGVfY2VfZmxhZ3MobmFtZWxlbiwgc3RhZ2UpKSk7DQogDQog
CS8qICgwIDw9IHBvcykgY2Fubm90IGhhcHBlbiBiZWNhdXNlIGFkZF9jYWNo
ZV9lbnRyeSgpDQpAQCAtMjA2LDggKzI0Niw4IEBADQogCSAqIHBhdGggb2Yg
YW4gZXhpc3RpbmcgZW50cnkgYW55bW9yZS4NCiAJICovDQogDQotCXdoaWxl
IChwb3MgPCBhY3RpdmVfbnIpIHsNCi0JCXN0cnVjdCBjYWNoZV9lbnRyeSAq
b3RoZXIgPSBhY3RpdmVfY2FjaGVbcG9zXTsNCisJd2hpbGUgKHBvcyA8IGdl
dF9udW1fY2FjaGVfZW50cmllcyhjYWNoZSkpIHsNCisJCXN0cnVjdCBjYWNo
ZV9lbnRyeSAqb3RoZXIgPSBnZXRfY2FjaGVfZW50cnkoY2FjaGUsIHBvcyk7
DQogCQlpZiAoc3RybmNtcChvdGhlci0+bmFtZSwgcGF0aCwgbmFtZWxlbikp
DQogCQkJYnJlYWs7IC8qIGl0IGlzIG5vdCBvdXIgInN1YmRpcmVjdG9yeSIg
YW55bW9yZSAqLw0KIAkJaWYgKChjZV9zdGFnZShvdGhlcikgPT0gc3RhZ2Up
ICYmDQpAQCAtMjE1LDcgKzI1NSw3IEBADQogCQkJaWYgKCFva190b19yZXBs
YWNlKQ0KIAkJCQlyZXR1cm4gLTE7DQogCQkJZnByaW50ZihzdGRlcnIsICJy
ZW1vdmluZyBmaWxlICclcycgdW5kZXIgJyVzJyB0byBiZSByZXBsYWNlZCB3
aXRoIGEgZmlsZVxuIiwgb3RoZXItPm5hbWUsIHBhdGgpOw0KLQkJCXJlbW92
ZV9lbnRyeV9hdChwb3MpOw0KKwkJCXJlbW92ZV9jYWNoZV9lbnRyeV9hdChj
YWNoZSwgcG9zKTsNCiAJCQlyZXBsYWNlZCA9IDE7DQogCQkJY29udGludWU7
IC8qIGN5Y2xlIHdpdGhvdXQgdXBkYXRpbmcgcG9zICovDQogCQl9DQpAQCAt
MjI0LDE3ICsyNjQsMzUgQEANCiAJcmV0dXJuIHJlcGxhY2VkOw0KIH0NCiAN
Ci1pbnQgYWRkX2NhY2hlX2VudHJ5KHN0cnVjdCBjYWNoZV9lbnRyeSAqY2Us
IGludCBvcHRpb24pDQordm9pZCBzZXRfY2FjaGVfZW50cnkoc3RydWN0IGNh
Y2hlICpjYWNoZSwgc3RydWN0IGNhY2hlX2VudHJ5ICpjZSwgaW50IHBvcykN
Cit7DQorCWNhY2hlLT5hY3RpdmVfY2FjaGVfY2hhbmdlZCA9IDE7DQorCWNh
Y2hlLT5lbnRyaWVzW3Bvc10gPSBjZTsNCit9DQorDQoraW50IGdldF9udW1f
Y2FjaGVfZW50cmllcyhzdHJ1Y3QgY2FjaGUgKmNhY2hlKQ0KK3sNCisJcmV0
dXJuIGNhY2hlLT5udW1fZW50cmllczsNCit9DQorDQorc3RydWN0IGNhY2hl
X2VudHJ5ICpnZXRfY2FjaGVfZW50cnkoc3RydWN0IGNhY2hlICpjYWNoZSwg
aW50IHBvcykNCit7DQorIAkvKiBZb3UgY2FuIE5PVCBqdXN0IGZyZWUgY2Fj
aGUtPmVudHJpZXNbcG9zXSBoZXJlLCBzaW5jZSBpdA0KKyAgCSAqIG1pZ2h0
IG5vdCBiZSBuZWNlc3NhcmlseSBtYWxsb2MoKWVkIGJ1dCBjYW4gYWxzbyBj
b21lDQorICAJICogZnJvbSBtbWFwKCkuICovDQorCXJldHVybiBjYWNoZS0+
ZW50cmllc1twb3NdOw0KK30NCisNCitpbnQgYWRkX2NhY2hlX2VudHJ5KHN0
cnVjdCBjYWNoZSAqY2FjaGUsIHN0cnVjdCBjYWNoZV9lbnRyeSAqY2UsIGlu
dCBvcHRpb24pDQogew0KIAlpbnQgcG9zOw0KIAlpbnQgb2tfdG9fYWRkID0g
b3B0aW9uICYgQUREX0NBQ0hFX09LX1RPX0FERDsNCiAJaW50IG9rX3RvX3Jl
cGxhY2UgPSBvcHRpb24gJiBBRERfQ0FDSEVfT0tfVE9fUkVQTEFDRTsNCi0J
cG9zID0gY2FjaGVfbmFtZV9wb3MoY2UtPm5hbWUsIGh0b25zKGNlLT5jZV9m
bGFncykpOw0KKwlwb3MgPSBjYWNoZV9uYW1lX3BvcyhjYWNoZSwgY2UtPm5h
bWUsIGh0b25zKGNlLT5jZV9mbGFncykpOw0KIA0KIAkvKiBleGlzdGluZyBt
YXRjaD8gSnVzdCByZXBsYWNlIGl0ICovDQogCWlmIChwb3MgPj0gMCkgew0K
LQkJYWN0aXZlX2NhY2hlX2NoYW5nZWQgPSAxOw0KLQkJYWN0aXZlX2NhY2hl
W3Bvc10gPSBjZTsNCisJCXNldF9jYWNoZV9lbnRyeShjYWNoZSwgY2UsIHBv
cyk7DQogCQlyZXR1cm4gMDsNCiAJfQ0KIAlwb3MgPSAtcG9zLTE7DQpAQCAt
MjQzLDEwICszMDEsMTAgQEANCiAJICogSW5zZXJ0aW5nIGEgbWVyZ2VkIGVu
dHJ5ICgic3RhZ2UgMCIpIGludG8gdGhlIGluZGV4DQogCSAqIHdpbGwgYWx3
YXlzIHJlcGxhY2UgYWxsIG5vbi1tZXJnZWQgZW50cmllcy4uDQogCSAqLw0K
LQlpZiAocG9zIDwgYWN0aXZlX25yICYmIGNlX3N0YWdlKGNlKSA9PSAwKSB7
DQotCQl3aGlsZSAoc2FtZV9uYW1lKGFjdGl2ZV9jYWNoZVtwb3NdLCBjZSkp
IHsNCisJaWYgKHBvcyA8IGdldF9udW1fY2FjaGVfZW50cmllcyhjYWNoZSkg
JiYgY2Vfc3RhZ2UoY2UpID09IDApIHsNCisJCXdoaWxlIChjZV9zYW1lX25h
bWUoZ2V0X2NhY2hlX2VudHJ5KGNhY2hlLCBwb3MpLCBjZSkpIHsNCiAJCQlv
a190b19hZGQgPSAxOw0KLQkJCWlmICghcmVtb3ZlX2VudHJ5X2F0KHBvcykp
DQorCQkJaWYgKCFyZW1vdmVfY2FjaGVfZW50cnlfYXQoY2FjaGUsIHBvcykp
DQogCQkJCWJyZWFrOw0KIAkJfQ0KIAl9DQpAQCAtMjU0LDI1ICszMTIsMjQg
QEANCiAJaWYgKCFva190b19hZGQpDQogCQlyZXR1cm4gLTE7DQogDQotCWlm
IChjaGVja19maWxlX2RpcmVjdG9yeV9jb25mbGljdChjZSwgb2tfdG9fcmVw
bGFjZSkpIHsNCisJaWYgKGNoZWNrX2ZpbGVfZGlyZWN0b3J5X2NvbmZsaWN0
KGNhY2hlLCBjZSwgb2tfdG9fcmVwbGFjZSkpIHsNCiAJCWlmICghb2tfdG9f
cmVwbGFjZSkNCiAJCQlyZXR1cm4gLTE7DQotCQlwb3MgPSBjYWNoZV9uYW1l
X3BvcyhjZS0+bmFtZSwgaHRvbnMoY2UtPmNlX2ZsYWdzKSk7DQorCQlwb3Mg
PSBjYWNoZV9uYW1lX3BvcyhjYWNoZSwgY2UtPm5hbWUsIGh0b25zKGNlLT5j
ZV9mbGFncykpOw0KIAkJcG9zID0gLXBvcy0xOw0KIAl9DQogDQogCS8qIE1h
a2Ugc3VyZSB0aGUgYXJyYXkgaXMgYmlnIGVub3VnaCAuLiAqLw0KLQlpZiAo
YWN0aXZlX25yID09IGFjdGl2ZV9hbGxvYykgew0KLQkJYWN0aXZlX2FsbG9j
ID0gYWxsb2NfbnIoYWN0aXZlX2FsbG9jKTsNCi0JCWFjdGl2ZV9jYWNoZSA9
IHhyZWFsbG9jKGFjdGl2ZV9jYWNoZSwgYWN0aXZlX2FsbG9jICogc2l6ZW9m
KHN0cnVjdCBjYWNoZV9lbnRyeSAqKSk7DQorCWlmIChjYWNoZS0+bnVtX2Vu
dHJpZXMgPT0gY2FjaGUtPmFsbG9jYXRlZF9lbnRyaWVzKSB7DQorCQljYWNo
ZS0+YWxsb2NhdGVkX2VudHJpZXMgPSBhbGxvY19ucihjYWNoZS0+YWxsb2Nh
dGVkX2VudHJpZXMpOw0KKwkJY2FjaGUtPmVudHJpZXMgPSB4cmVhbGxvYyhj
YWNoZS0+ZW50cmllcywgY2FjaGUtPmFsbG9jYXRlZF9lbnRyaWVzICogc2l6
ZW9mKHN0cnVjdCBjYWNoZV9lbnRyeSAqKSk7DQogCX0NCiANCiAJLyogQWRk
IGl0IGluLi4gKi8NCi0JYWN0aXZlX25yKys7DQotCWlmIChhY3RpdmVfbnIg
PiBwb3MpDQotCQltZW1tb3ZlKGFjdGl2ZV9jYWNoZSArIHBvcyArIDEsIGFj
dGl2ZV9jYWNoZSArIHBvcywgKGFjdGl2ZV9uciAtIHBvcyAtIDEpICogc2l6
ZW9mKGNlKSk7DQotCWFjdGl2ZV9jYWNoZVtwb3NdID0gY2U7DQotCWFjdGl2
ZV9jYWNoZV9jaGFuZ2VkID0gMTsNCisJY2FjaGUtPm51bV9lbnRyaWVzKys7
DQorCWlmIChjYWNoZS0+bnVtX2VudHJpZXMgPiBwb3MpDQorCQltZW1tb3Zl
KGNhY2hlLT5lbnRyaWVzICsgcG9zICsgMSwgY2FjaGUtPmVudHJpZXMgKyBw
b3MsIChjYWNoZS0+bnVtX2VudHJpZXMgLSBwb3MgLSAxKSAqIHNpemVvZihj
ZSkpOw0KKwlzZXRfY2FjaGVfZW50cnkoY2FjaGUsIGNlLCBwb3MpOw0KIAly
ZXR1cm4gMDsNCiB9DQogDQpAQCAtMjkzLDU0ICszNTAsNTYgQEANCiAJcmV0
dXJuIDA7DQogfQ0KIA0KLWludCByZWFkX2NhY2hlKHZvaWQpDQorc3RydWN0
IGNhY2hlICpyZWFkX2NhY2hlKHZvaWQpDQogew0KIAlpbnQgZmQsIGk7DQog
CXN0cnVjdCBzdGF0IHN0Ow0KLQl1bnNpZ25lZCBsb25nIHNpemUsIG9mZnNl
dDsNCi0Jdm9pZCAqbWFwOw0KLQlzdHJ1Y3QgY2FjaGVfaGVhZGVyICpoZHI7
DQotDQotCWVycm5vID0gRUJVU1k7DQotCWlmIChhY3RpdmVfY2FjaGUpDQot
CQlyZXR1cm4gZXJyb3IoIm1vcmUgdGhhbiBvbmUgY2FjaGVmaWxlIik7DQor
CXVuc2lnbmVkIGxvbmcgb2Zmc2V0Ow0KKwlzdHJ1Y3QgY2FjaGUgKmNhY2hl
ID0gbmV3X2NhY2hlKCk7DQorDQogCWVycm5vID0gRU5PRU5UOw0KIAlmZCA9
IG9wZW4oZ2V0X2luZGV4X2ZpbGUoKSwgT19SRE9OTFkpOw0KLQlpZiAoZmQg
PCAwKQ0KLQkJcmV0dXJuIChlcnJubyA9PSBFTk9FTlQpID8gMCA6IGVycm9y
KCJvcGVuIGZhaWxlZCIpOw0KKwlpZiAoZmQgPCAwKSB7DQorCQlpZiAoZXJy
bm8gPT0gRU5PRU5UKQ0KKwkJCXJldHVybiBjYWNoZTsNCisJCWVsc2Ugew0K
KwkJCWZyZWVfY2FjaGUoY2FjaGUpOw0KKwkJCXJldHVybiBOVUxMOw0KKwkJ
fQ0KKwl9DQogDQotCXNpemUgPSAwOyAvLyBhdm9pZCBnY2Mgd2FybmluZw0K
LQltYXAgPSAodm9pZCAqKS0xOw0KIAlpZiAoIWZzdGF0KGZkLCAmc3QpKSB7
DQotCQlzaXplID0gc3Quc3Rfc2l6ZTsNCisJCWNhY2hlLT5tYXAuc2l6ZSA9
IHN0LnN0X3NpemU7DQogCQllcnJubyA9IEVJTlZBTDsNCi0JCWlmIChzaXpl
ID49IHNpemVvZihzdHJ1Y3QgY2FjaGVfaGVhZGVyKSArIDIwKQ0KLQkJCW1h
cCA9IG1tYXAoTlVMTCwgc2l6ZSwgUFJPVF9SRUFEIHwgUFJPVF9XUklURSwg
TUFQX1BSSVZBVEUsIGZkLCAwKTsNCisJCWlmIChjYWNoZS0+bWFwLnNpemUg
Pj0gc2l6ZW9mKHN0cnVjdCBjYWNoZV9oZWFkZXIpICsgMjApDQorCQkJY2Fj
aGUtPm1hcC5wdHIgPSBtbWFwKE5VTEwsIGNhY2hlLT5tYXAuc2l6ZSwgUFJP
VF9SRUFEIHwgUFJPVF9XUklURSwgTUFQX1BSSVZBVEUsIGZkLCAwKTsNCiAJ
fQ0KIAljbG9zZShmZCk7DQotCWlmICgtMSA9PSAoaW50KShsb25nKW1hcCkN
Ci0JCXJldHVybiBlcnJvcigibW1hcCBmYWlsZWQiKTsNCisJaWYgKE1BUF9G
QUlMRUQgPT0gY2FjaGUtPm1hcC5wdHIpIHsNCisJCWVycm9yKCJtbWFwIGZh
aWxlZCIpOw0KKwkJZnJlZV9jYWNoZShjYWNoZSk7DQorCQlyZXR1cm4gTlVM
TDsNCisJfQ0KIA0KLQloZHIgPSBtYXA7DQotCWlmICh2ZXJpZnlfaGRyKGhk
ciwgc2l6ZSkgPCAwKQ0KLQkJZ290byB1bm1hcDsNCi0NCi0JYWN0aXZlX25y
ID0gbnRvaGwoaGRyLT5oZHJfZW50cmllcyk7DQotCWFjdGl2ZV9hbGxvYyA9
IGFsbG9jX25yKGFjdGl2ZV9ucik7DQotCWFjdGl2ZV9jYWNoZSA9IGNhbGxv
YyhhY3RpdmVfYWxsb2MsIHNpemVvZihzdHJ1Y3QgY2FjaGVfZW50cnkgKikp
Ow0KLQ0KLQlvZmZzZXQgPSBzaXplb2YoKmhkcik7DQotCWZvciAoaSA9IDA7
IGkgPCBhY3RpdmVfbnI7IGkrKykgew0KLQkJc3RydWN0IGNhY2hlX2VudHJ5
ICpjZSA9IG1hcCArIG9mZnNldDsNCi0JCW9mZnNldCA9IG9mZnNldCArIGNl
X3NpemUoY2UpOw0KLQkJYWN0aXZlX2NhY2hlW2ldID0gY2U7DQorCWNhY2hl
LT5oZWFkZXIgPSBjYWNoZS0+bWFwLnB0cjsNCisJaWYgKHZlcmlmeV9oZHIo
Y2FjaGUtPmhlYWRlciwgY2FjaGUtPm1hcC5zaXplKSA8IDApIHsNCisJCWZy
ZWVfY2FjaGUoY2FjaGUpOw0KKwkJZXJybm8gPSBFSU5WQUw7DQorCQllcnJv
cigidmVyaWZ5IGhlYWRlciBmYWlsZWQiKTsNCisJCXJldHVybiBOVUxMOw0K
IAl9DQotCXJldHVybiBhY3RpdmVfbnI7DQogDQotdW5tYXA6DQotCW11bm1h
cChtYXAsIHNpemUpOw0KLQllcnJubyA9IEVJTlZBTDsNCi0JcmV0dXJuIGVy
cm9yKCJ2ZXJpZnkgaGVhZGVyIGZhaWxlZCIpOw0KKwljYWNoZS0+bnVtX2Vu
dHJpZXMgPSBudG9obChjYWNoZS0+aGVhZGVyLT5oZHJfZW50cmllcyk7DQor
CWNhY2hlLT5hbGxvY2F0ZWRfZW50cmllcyA9IGFsbG9jX25yKGNhY2hlLT5u
dW1fZW50cmllcyk7DQorCWNhY2hlLT5lbnRyaWVzID0geGNhbGxvYyhjYWNo
ZS0+YWxsb2NhdGVkX2VudHJpZXMsIHNpemVvZihzdHJ1Y3QgY2FjaGVfZW50
cnkgKikpOw0KKw0KKwlvZmZzZXQgPSBzaXplb2YoKmNhY2hlLT5oZWFkZXIp
Ow0KKwlmb3IgKGkgPSAwOyBpIDwgY2FjaGUtPm51bV9lbnRyaWVzOyBpKysp
IHsNCisJCXN0cnVjdCBjYWNoZV9lbnRyeSAqY2UgPSBjYWNoZS0+bWFwLnB0
ciArIG9mZnNldDsNCisJCW9mZnNldCA9IG9mZnNldCArIGNlX3NpemUoY2Up
Ow0KKwkJY2FjaGUtPmVudHJpZXNbaV0gPSBjZTsNCisJfQ0KKwlyZXR1cm4g
Y2FjaGU7DQogfQ0KIA0KICNkZWZpbmUgV1JJVEVfQlVGRkVSX1NJWkUgODE5
Mg0KQEAgLTM4Niw3ICs0NDUsNyBAQA0KIAlyZXR1cm4gMDsNCiB9DQogDQot
aW50IHdyaXRlX2NhY2hlKGludCBuZXdmZCwgc3RydWN0IGNhY2hlX2VudHJ5
ICoqY2FjaGUsIGludCBlbnRyaWVzKQ0KK2ludCB3cml0ZV9jYWNoZShzdHJ1
Y3QgY2FjaGUgKmNhY2hlLCBpbnQgbmV3ZmQpDQogew0KIAlTSEFfQ1RYIGM7
DQogCXN0cnVjdCBjYWNoZV9oZWFkZXIgaGRyOw0KQEAgLTM5NCwxNCArNDUz
LDE0IEBADQogDQogCWhkci5oZHJfc2lnbmF0dXJlID0gaHRvbmwoQ0FDSEVf
U0lHTkFUVVJFKTsNCiAJaGRyLmhkcl92ZXJzaW9uID0gaHRvbmwoMik7DQot
CWhkci5oZHJfZW50cmllcyA9IGh0b25sKGVudHJpZXMpOw0KKwloZHIuaGRy
X2VudHJpZXMgPSBodG9ubChnZXRfbnVtX2NhY2hlX2VudHJpZXMoY2FjaGUp
KTsNCiANCiAJU0hBMV9Jbml0KCZjKTsNCiAJaWYgKGNlX3dyaXRlKCZjLCBu
ZXdmZCwgJmhkciwgc2l6ZW9mKGhkcikpIDwgMCkNCiAJCXJldHVybiAtMTsN
CiANCi0JZm9yIChpID0gMDsgaSA8IGVudHJpZXM7IGkrKykgew0KLQkJc3Ry
dWN0IGNhY2hlX2VudHJ5ICpjZSA9IGNhY2hlW2ldOw0KKwlmb3IgKGkgPSAw
OyBpIDwgZ2V0X251bV9jYWNoZV9lbnRyaWVzKGNhY2hlKTsgaSsrKSB7DQor
CQlzdHJ1Y3QgY2FjaGVfZW50cnkgKmNlID0gZ2V0X2NhY2hlX2VudHJ5KGNh
Y2hlLCBpKTsNCiAJCWlmIChjZV93cml0ZSgmYywgbmV3ZmQsIGNlLCBjZV9z
aXplKGNlKSkgPCAwKQ0KIAkJCXJldHVybiAtMTsNCiAJfQ0KSW5kZXg6IHJl
YWQtdHJlZS5jDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gYzhjNzdm
NjdlYTg1ZWU2NWEwZjA1NWYyY2I3NmU2MDU5ZWFhMDc3Ni9yZWFkLXRyZWUu
YyAgKG1vZGU6MTAwNjQ0KQ0KKysrIHVuY29tbWl0dGVkL3JlYWQtdHJlZS5j
ICAobW9kZToxMDA2NDQpDQpAQCAtNyw3ICs3LDcgQEANCiANCiBzdGF0aWMg
aW50IHN0YWdlID0gMDsNCiANCi1zdGF0aWMgaW50IHVucGFja190cmVlKHVu
c2lnbmVkIGNoYXIgKnNoYTEpDQorc3RhdGljIGludCB1bnBhY2tfdHJlZShz
dHJ1Y3QgY2FjaGUgKmNhY2hlLCB1bnNpZ25lZCBjaGFyICpzaGExKQ0KIHsN
CiAJdm9pZCAqYnVmZmVyOw0KIAl1bnNpZ25lZCBsb25nIHNpemU7DQpAQCAt
MTYsNyArMTYsNyBAQA0KIAlidWZmZXIgPSByZWFkX29iamVjdF93aXRoX3Jl
ZmVyZW5jZShzaGExLCAidHJlZSIsICZzaXplLCAwKTsNCiAJaWYgKCFidWZm
ZXIpDQogCQlyZXR1cm4gLTE7DQotCXJldCA9IHJlYWRfdHJlZShidWZmZXIs
IHNpemUsIHN0YWdlKTsNCisJcmV0ID0gcmVhZF90cmVlKGNhY2hlLCBidWZm
ZXIsIHNpemUsIHN0YWdlKTsNCiAJZnJlZShidWZmZXIpOw0KIAlyZXR1cm4g
cmV0Ow0KIH0NCkBAIC05MywyNiArOTMsMzAgQEANCiAJcmV0dXJuIE5VTEw7
DQogfQ0KIA0KLXN0YXRpYyB2b2lkIHRyaXZpYWxseV9tZXJnZV9jYWNoZShz
dHJ1Y3QgY2FjaGVfZW50cnkgKipzcmMsIGludCBucikNCisvKiByYXRoZXIg
dGhhbiBkb2luZyB0aGUgJ3JpZ2h0JyB0aGluZyBvZiBkZWxldGluZyBlbnRy
aWVzIGFzIHdlIG1lcmdlLA0KKyAqIHdhbGsgZHN0IHRocm91Z2ggdGhlIGNh
Y2hlLCBvdmVyd3JpdGluZyBlbnRyaWVzIGFzIHdlIGdvIGFuZCBhdCB0aGUN
CisgKiBlbmQgdHJ1bmNhdGUgdGhlIHNpemUgb2YgdGhlIGNhY2hlICovDQor
c3RhdGljIHZvaWQgdHJpdmlhbGx5X21lcmdlX2NhY2hlKHN0cnVjdCBjYWNo
ZSAqY2FjaGUpDQogew0KIAlzdGF0aWMgc3RydWN0IGNhY2hlX2VudHJ5IG51
bGxfZW50cnk7DQotCXN0cnVjdCBjYWNoZV9lbnRyeSAqKmRzdCA9IHNyYzsN
CiAJc3RydWN0IGNhY2hlX2VudHJ5ICpvbGQgPSAmbnVsbF9lbnRyeTsNCisJ
aW50IHNyYyA9IDAsIGRzdCA9IDAsIG5yID0gZ2V0X251bV9jYWNoZV9lbnRy
aWVzKGNhY2hlKTsNCiANCi0Jd2hpbGUgKG5yKSB7DQorCXdoaWxlIChzcmMg
PCBucikgew0KIAkJc3RydWN0IGNhY2hlX2VudHJ5ICpjZSwgKnJlc3VsdDsN
CiANCi0JCWNlID0gc3JjWzBdOw0KKwkJY2UgPSBnZXRfY2FjaGVfZW50cnko
Y2FjaGUsIHNyYyk7DQogDQogCQkvKiBXZSB0aHJvdyBhd2F5IG9yaWdpbmFs
IGNhY2hlIGVudHJpZXMgZXhjZXB0IGZvciB0aGUgc3RhdCBpbmZvcm1hdGlv
biAqLw0KIAkJaWYgKCFjZV9zdGFnZShjZSkpIHsNCiAJCQlvbGQgPSBjZTsN
CiAJCQlzcmMrKzsNCi0JCQluci0tOw0KLQkJCWFjdGl2ZV9uci0tOw0KIAkJ
CWNvbnRpbnVlOw0KIAkJfQ0KLQkJaWYgKG5yID4gMiAmJiAocmVzdWx0ID0g
bWVyZ2VfZW50cmllcyhjZSwgc3JjWzFdLCBzcmNbMl0pKSAhPSBOVUxMKSB7
DQorCQlpZiAoKHNyYyA8IChuciAtIDIpKSAmJg0KKwkJICAgIChyZXN1bHQg
PSBtZXJnZV9lbnRyaWVzKGNlLA0KKwkJCQkJICAgIGdldF9jYWNoZV9lbnRy
eShjYWNoZSwgc3JjICsgMSksDQorCQkJCQkgICAgZ2V0X2NhY2hlX2VudHJ5
KGNhY2hlLCBzcmMgKyAyKSkpICE9IE5VTEwpIHsNCiAJCQkvKg0KIAkJCSAq
IFNlZSBpZiB3ZSBjYW4gcmUtdXNlIHRoZSBvbGQgQ0UgZGlyZWN0bHk/DQog
CQkJICogVGhhdCB3YXkgd2UgZ2V0IHRoZSB1cHRvZGF0ZSBzdGF0IGluZm8u
DQpAQCAtMTIyLDQwICsxMjYsNDYgQEANCiAJCQljZSA9IHJlc3VsdDsNCiAJ
CQljZS0+Y2VfZmxhZ3MgJj0gfmh0b25zKENFX1NUQUdFTUFTSyk7DQogCQkJ
c3JjICs9IDI7DQotCQkJbnIgLT0gMjsNCi0JCQlhY3RpdmVfbnIgLT0gMjsN
CiAJCX0NCi0JCSpkc3QrKyA9IGNlOw0KKwkJc2V0X2NhY2hlX2VudHJ5KGNh
Y2hlLCBjZSwgZHN0KTsNCisJCWRzdCsrOw0KIAkJc3JjKys7DQorCX0NCisJ
LyogdGhpcyBjb3VsZCBiZSByZXBsYWNlZCBieSBhIHRydW5jYXRlIGFwaSAq
Lw0KKwl3aGlsZSAobnIgPiBkc3QpIHsNCiAJCW5yLS07DQorCQlyZW1vdmVf
Y2FjaGVfZW50cnlfYXQoY2FjaGUsIG5yKTsNCiAJfQ0KIH0NCiANCi1zdGF0
aWMgdm9pZCBtZXJnZV9zdGF0X2luZm8oc3RydWN0IGNhY2hlX2VudHJ5ICoq
c3JjLCBpbnQgbnIpDQorc3RhdGljIHZvaWQgbWVyZ2Vfc3RhdF9pbmZvKHN0
cnVjdCBjYWNoZSAqY2FjaGUpDQogew0KIAlzdGF0aWMgc3RydWN0IGNhY2hl
X2VudHJ5IG51bGxfZW50cnk7DQotCXN0cnVjdCBjYWNoZV9lbnRyeSAqKmRz
dCA9IHNyYzsNCiAJc3RydWN0IGNhY2hlX2VudHJ5ICpvbGQgPSAmbnVsbF9l
bnRyeTsNCisJaW50IHNyYyA9IDAsIGRzdCA9IDAsIG5yID0gZ2V0X251bV9j
YWNoZV9lbnRyaWVzKGNhY2hlKTsNCiANCi0Jd2hpbGUgKG5yKSB7DQorCXdo
aWxlIChzcmMgPCBucikgew0KIAkJc3RydWN0IGNhY2hlX2VudHJ5ICpjZTsN
CiANCi0JCWNlID0gc3JjWzBdOw0KKwkJY2UgPSBnZXRfY2FjaGVfZW50cnko
Y2FjaGUsIHNyYyk7DQogDQogCQkvKiBXZSB0aHJvdyBhd2F5IG9yaWdpbmFs
IGNhY2hlIGVudHJpZXMgZXhjZXB0IGZvciB0aGUgc3RhdCBpbmZvcm1hdGlv
biAqLw0KIAkJaWYgKCFjZV9zdGFnZShjZSkpIHsNCiAJCQlvbGQgPSBjZTsN
CiAJCQlzcmMrKzsNCi0JCQluci0tOw0KLQkJCWFjdGl2ZV9uci0tOw0KIAkJ
CWNvbnRpbnVlOw0KIAkJfQ0KIAkJaWYgKHBhdGhfbWF0Y2hlcyhjZSwgb2xk
KSAmJiBzYW1lKGNlLCBvbGQpKQ0KIAkJCSpjZSA9ICpvbGQ7DQogCQljZS0+
Y2VfZmxhZ3MgJj0gfmh0b25zKENFX1NUQUdFTUFTSyk7DQotCQkqZHN0Kysg
PSBjZTsNCisJCXNldF9jYWNoZV9lbnRyeShjYWNoZSwgY2UsIGRzdCk7DQor
CQlkc3QrKzsNCiAJCXNyYysrOw0KKwl9DQorCS8qIHRoaXMgY291bGQgYmUg
cmVwbGFjZWQgYnkgYSB0cnVuY2F0ZSBhcGkgKi8NCisJd2hpbGUgKG5yID4g
ZHN0KSB7DQogCQluci0tOw0KKwkJcmVtb3ZlX2NhY2hlX2VudHJ5X2F0KGNh
Y2hlLCBucik7DQogCX0NCiB9DQogDQpAQCAtMTY3LDYgKzE3Nyw3IEBADQog
CXVuc2lnbmVkIGNoYXIgc2hhMVsyMF07DQogCXN0YXRpYyBjaGFyIGxvY2tm
aWxlW01BWFBBVEhMRU4rMV07DQogCWNvbnN0IGNoYXIgKmluZGV4ZmlsZSA9
IGdldF9pbmRleF9maWxlKCk7DQorCXN0cnVjdCBjYWNoZSAqY2FjaGUgPSBO
VUxMOw0KIA0KIAlzbnByaW50Zihsb2NrZmlsZSwgc2l6ZW9mKGxvY2tmaWxl
KSwgIiVzLmxvY2siLCBpbmRleGZpbGUpOw0KIA0KQEAgLTE4NSw5ICsxOTYs
OSBAQA0KIAkJCWludCBpOw0KIAkJCWlmIChzdGFnZSkNCiAJCQkJZGllKCIt
bSBuZWVkcyB0byBjb21lIGZpcnN0Iik7DQotCQkJcmVhZF9jYWNoZSgpOw0K
LQkJCWZvciAoaSA9IDA7IGkgPCBhY3RpdmVfbnI7IGkrKykgew0KLQkJCQlp
ZiAoY2Vfc3RhZ2UoYWN0aXZlX2NhY2hlW2ldKSkNCisJCQljYWNoZSA9IHJl
YWRfY2FjaGUoKTsNCisJCQlmb3IgKGkgPSAwOyBpIDwgZ2V0X251bV9jYWNo
ZV9lbnRyaWVzKGNhY2hlKTsgaSsrKSB7DQorCQkJCWlmIChjZV9zdGFnZShn
ZXRfY2FjaGVfZW50cnkoY2FjaGUsIGkpKSkNCiAJCQkJCWRpZSgieW91IG5l
ZWQgdG8gcmVzb2x2ZSB5b3VyIGN1cnJlbnQgaW5kZXggZmlyc3QiKTsNCiAJ
CQl9DQogCQkJc3RhZ2UgPSAxOw0KQEAgLTE5OCwyMyArMjA5LDI1IEBADQog
CQkJdXNhZ2UocmVhZF90cmVlX3VzYWdlKTsNCiAJCWlmIChzdGFnZSA+IDMp
DQogCQkJdXNhZ2UocmVhZF90cmVlX3VzYWdlKTsNCi0JCWlmICh1bnBhY2tf
dHJlZShzaGExKSA8IDApDQorCQlpZiAoIWNhY2hlKQ0KKwkJCWNhY2hlID0g
bmV3X2NhY2hlKCk7DQorCQlpZiAodW5wYWNrX3RyZWUoY2FjaGUsIHNoYTEp
IDwgMCkNCiAJCQlkaWUoImZhaWxlZCB0byB1bnBhY2sgdHJlZSBvYmplY3Qg
JXMiLCBhcmcpOw0KIAkJc3RhZ2UrKzsNCiAJfQ0KIAlpZiAobWVyZ2UpIHsN
CiAJCXN3aXRjaCAoc3RhZ2UpIHsNCiAJCWNhc2UgNDoJLyogVGhyZWUtd2F5
IG1lcmdlICovDQotCQkJdHJpdmlhbGx5X21lcmdlX2NhY2hlKGFjdGl2ZV9j
YWNoZSwgYWN0aXZlX25yKTsNCisJCQl0cml2aWFsbHlfbWVyZ2VfY2FjaGUo
Y2FjaGUpOw0KIAkJCWJyZWFrOw0KIAkJY2FzZSAyOgkvKiBKdXN0IHJlYWQg
YSB0cmVlLCBtZXJnZSB3aXRoIG9sZCBjYWNoZSBjb250ZW50cyAqLw0KLQkJ
CW1lcmdlX3N0YXRfaW5mbyhhY3RpdmVfY2FjaGUsIGFjdGl2ZV9ucik7DQor
CQkJbWVyZ2Vfc3RhdF9pbmZvKGNhY2hlKTsNCiAJCQlicmVhazsNCiAJCWRl
ZmF1bHQ6DQogCQkJZGllKCJqdXN0IGhvdyBkbyB5b3UgZXhwZWN0IG1lIHRv
IG1lcmdlICVkIHRyZWVzPyIsIHN0YWdlLTEpOw0KIAkJfQ0KIAl9DQotCWlm
ICh3cml0ZV9jYWNoZShuZXdmZCwgYWN0aXZlX2NhY2hlLCBhY3RpdmVfbnIp
IHx8IHJlbmFtZShsb2NrZmlsZSwgaW5kZXhmaWxlKSkNCisJaWYgKHdyaXRl
X2NhY2hlKGNhY2hlLCBuZXdmZCkgfHwgcmVuYW1lKGxvY2tmaWxlLCBpbmRl
eGZpbGUpKQ0KIAkJZGllKCJ1bmFibGUgdG8gd3JpdGUgbmV3IGluZGV4IGZp
bGUiKTsNCiAJbG9ja2ZpbGVfbmFtZSA9IE5VTEw7DQogCXJldHVybiAwOw0K
SW5kZXg6IHNoYTFfZmlsZS5jDQo9PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQot
LS0gYzhjNzdmNjdlYTg1ZWU2NWEwZjA1NWYyY2I3NmU2MDU5ZWFhMDc3Ni9z
aGExX2ZpbGUuYyAgKG1vZGU6MTAwNjQ0KQ0KKysrIHVuY29tbWl0dGVkL3No
YTFfZmlsZS5jICAobW9kZToxMDA2NDQpDQpAQCAtMzAyLDcgKzMwMiw3IEBA
DQogCX0NCiAJbWFwID0gbW1hcChOVUxMLCBzdC5zdF9zaXplLCBQUk9UX1JF
QUQsIE1BUF9QUklWQVRFLCBmZCwgMCk7DQogCWNsb3NlKGZkKTsNCi0JaWYg
KC0xID09IChpbnQpKGxvbmcpbWFwKQ0KKwlpZiAoTUFQX0ZBSUxFRCA9PSBt
YXApDQogCQlyZXR1cm4gTlVMTDsNCiAJKnNpemUgPSBzdC5zdF9zaXplOw0K
IAlyZXR1cm4gbWFwOw0KQEAgLTU4Nyw3ICs1ODcsNyBAQA0KIAlpZiAoc2l6
ZSkNCiAJCWJ1ZiA9IG1tYXAoTlVMTCwgc2l6ZSwgUFJPVF9SRUFELCBNQVBf
UFJJVkFURSwgZmQsIDApOw0KIAljbG9zZShmZCk7DQotCWlmICgoaW50KShs
b25nKWJ1ZiA9PSAtMSkNCisJaWYgKGJ1ZiA9PSBNQVBfRkFJTEVEKQ0KIAkJ
cmV0dXJuIC0xOw0KIA0KIAlyZXQgPSB3cml0ZV9zaGExX2ZpbGUoYnVmLCBz
aXplLCAiYmxvYiIsIHNoYTEpOw0KSW5kZXg6IHRyZWUuYw0KPT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PQ0KLS0tIGM4Yzc3ZjY3ZWE4NWVlNjVhMGYwNTVmMmNi
NzZlNjA1OWVhYTA3NzYvdHJlZS5jICAobW9kZToxMDA2NDQpDQorKysgdW5j
b21taXR0ZWQvdHJlZS5jICAobW9kZToxMDA2NDQpDQpAQCAtNSw3ICs1LDgg
QEANCiANCiBjb25zdCBjaGFyICp0cmVlX3R5cGUgPSAidHJlZSI7DQogDQot
c3RhdGljIGludCByZWFkX29uZV9lbnRyeSh1bnNpZ25lZCBjaGFyICpzaGEx
LCBjb25zdCBjaGFyICpiYXNlLCBpbnQgYmFzZWxlbiwgY29uc3QgY2hhciAq
cGF0aG5hbWUsIHVuc2lnbmVkIG1vZGUsIGludCBzdGFnZSkNCitzdGF0aWMg
aW50IHJlYWRfb25lX2VudHJ5KHN0cnVjdCBjYWNoZSAqY2FjaGUsIHVuc2ln
bmVkIGNoYXIgKnNoYTEsIGNvbnN0IGNoYXIgKmJhc2UsDQorCQkgICAgICAg
ICAgaW50IGJhc2VsZW4sIGNvbnN0IGNoYXIgKnBhdGhuYW1lLCB1bnNpZ25l
ZCBtb2RlLCBpbnQgc3RhZ2UpDQogew0KIAlpbnQgbGVuID0gc3RybGVuKHBh
dGhuYW1lKTsNCiAJdW5zaWduZWQgaW50IHNpemUgPSBjYWNoZV9lbnRyeV9z
aXplKGJhc2VsZW4gKyBsZW4pOw0KQEAgLTE4LDEwICsxOSwxMCBAQA0KIAlt
ZW1jcHkoY2UtPm5hbWUsIGJhc2UsIGJhc2VsZW4pOw0KIAltZW1jcHkoY2Ut
Pm5hbWUgKyBiYXNlbGVuLCBwYXRobmFtZSwgbGVuKzEpOw0KIAltZW1jcHko
Y2UtPnNoYTEsIHNoYTEsIDIwKTsNCi0JcmV0dXJuIGFkZF9jYWNoZV9lbnRy
eShjZSwgQUREX0NBQ0hFX09LX1RPX0FERCk7DQorCXJldHVybiBhZGRfY2Fj
aGVfZW50cnkoY2FjaGUsIGNlLCBBRERfQ0FDSEVfT0tfVE9fQUREKTsNCiB9
DQogDQotc3RhdGljIGludCByZWFkX3RyZWVfcmVjdXJzaXZlKHZvaWQgKmJ1
ZmZlciwgdW5zaWduZWQgbG9uZyBzaXplLA0KK3N0YXRpYyBpbnQgcmVhZF90
cmVlX3JlY3Vyc2l2ZShzdHJ1Y3QgY2FjaGUqIGNhY2hlLCB2b2lkICpidWZm
ZXIsIHVuc2lnbmVkIGxvbmcgc2l6ZSwNCiAJCQkgICAgICAgY29uc3QgY2hh
ciAqYmFzZSwgaW50IGJhc2VsZW4sIGludCBzdGFnZSkNCiB7DQogCXdoaWxl
IChzaXplKSB7DQpAQCAtNTMsNyArNTQsNyBAQA0KIAkJCW1lbWNweShuZXdi
YXNlLCBiYXNlLCBiYXNlbGVuKTsNCiAJCQltZW1jcHkobmV3YmFzZSArIGJh
c2VsZW4sIHBhdGgsIHBhdGhsZW4pOw0KIAkJCW5ld2Jhc2VbYmFzZWxlbiAr
IHBhdGhsZW5dID0gJy8nOw0KLQkJCXJldHZhbCA9IHJlYWRfdHJlZV9yZWN1
cnNpdmUoZWx0YnVmLCBlbHRzaXplLA0KKwkJCXJldHZhbCA9IHJlYWRfdHJl
ZV9yZWN1cnNpdmUoY2FjaGUsIGVsdGJ1ZiwgZWx0c2l6ZSwNCiAJCQkJCQkg
ICAgIG5ld2Jhc2UsDQogCQkJCQkJICAgICBiYXNlbGVuICsgcGF0aGxlbiAr
IDEsIHN0YWdlKTsNCiAJCQlmcmVlKGVsdGJ1Zik7DQpAQCAtNjIsMTUgKzYz
LDE1IEBADQogCQkJCXJldHVybiAtMTsNCiAJCQljb250aW51ZTsNCiAJCX0N
Ci0JCWlmIChyZWFkX29uZV9lbnRyeShzaGExLCBiYXNlLCBiYXNlbGVuLCBw
YXRoLCBtb2RlLCBzdGFnZSkgPCAwKQ0KKwkJaWYgKHJlYWRfb25lX2VudHJ5
KGNhY2hlLCBzaGExLCBiYXNlLCBiYXNlbGVuLCBwYXRoLCBtb2RlLCBzdGFn
ZSkgPCAwKQ0KIAkJCXJldHVybiAtMTsNCiAJfQ0KIAlyZXR1cm4gMDsNCiB9
DQogDQotaW50IHJlYWRfdHJlZSh2b2lkICpidWZmZXIsIHVuc2lnbmVkIGxv
bmcgc2l6ZSwgaW50IHN0YWdlKQ0KK2ludCByZWFkX3RyZWUoc3RydWN0IGNh
Y2hlICpjYWNoZSwgdm9pZCAqYnVmZmVyLCB1bnNpZ25lZCBsb25nIHNpemUs
IGludCBzdGFnZSkNCiB7DQotCXJldHVybiByZWFkX3RyZWVfcmVjdXJzaXZl
KGJ1ZmZlciwgc2l6ZSwgIiIsIDAsIHN0YWdlKTsNCisJcmV0dXJuIHJlYWRf
dHJlZV9yZWN1cnNpdmUoY2FjaGUsIGJ1ZmZlciwgc2l6ZSwgIiIsIDAsIHN0
YWdlKTsNCiB9DQogDQogc3RydWN0IHRyZWUgKmxvb2t1cF90cmVlKHVuc2ln
bmVkIGNoYXIgKnNoYTEpDQpJbmRleDogdXBkYXRlLWNhY2hlLmMNCj09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT0NCi0tLSBjOGM3N2Y2N2VhODVlZTY1YTBmMDU1
ZjJjYjc2ZTYwNTllYWEwNzc2L3VwZGF0ZS1jYWNoZS5jICAobW9kZToxMDA2
NDQpDQorKysgdW5jb21taXR0ZWQvdXBkYXRlLWNhY2hlLmMgIChtb2RlOjEw
MDY0NCkNCkBAIC01MSw3ICs1MSw3IEBADQogCWNlLT5jZV9zaXplID0gaHRv
bmwoc3QtPnN0X3NpemUpOw0KIH0NCiANCi1zdGF0aWMgaW50IGFkZF9maWxl
X3RvX2NhY2hlKGNoYXIgKnBhdGgpDQorc3RhdGljIGludCBhZGRfZmlsZV90
b19jYWNoZShzdHJ1Y3QgY2FjaGUgKmNhY2hlLCBjaGFyICpwYXRoKQ0KIHsN
CiAJaW50IHNpemUsIG5hbWVsZW4sIG9wdGlvbiwgc3RhdHVzOw0KIAlzdHJ1
Y3QgY2FjaGVfZW50cnkgKmNlOw0KQEAgLTcxLDcgKzcxLDcgQEANCiAJCSAq
Lw0KIAkJaWYgKHN0YXR1cyA9PSAwIHx8IChlcnJubyA9PSBFTk9FTlQgfHwg
ZXJybm8gPT0gRU5PVERJUikpIHsNCiAJCQlpZiAoYWxsb3dfcmVtb3ZlKQ0K
LQkJCQlyZXR1cm4gcmVtb3ZlX2ZpbGVfZnJvbV9jYWNoZShwYXRoKTsNCisJ
CQkJcmV0dXJuIHJlbW92ZV9maWxlX2Zyb21fY2FjaGUoY2FjaGUsIHBhdGgp
Ow0KIAkJfQ0KIAkJcmV0dXJuIGVycm9yKCJvcGVuKFwiJXNcIik6ICVzIiwg
cGF0aCwgc3RyZXJyb3IoZXJybm8pKTsNCiAJfQ0KQEAgLTEwNiw3ICsxMDYs
NyBAQA0KIAl9DQogCW9wdGlvbiA9IGFsbG93X2FkZCA/IEFERF9DQUNIRV9P
S19UT19BREQgOiAwOw0KIAlvcHRpb24gfD0gYWxsb3dfcmVwbGFjZSA/IEFE
RF9DQUNIRV9PS19UT19SRVBMQUNFIDogMDsNCi0JcmV0dXJuIGFkZF9jYWNo
ZV9lbnRyeShjZSwgb3B0aW9uKTsNCisJcmV0dXJuIGFkZF9jYWNoZV9lbnRy
eShjYWNoZSwgY2UsIG9wdGlvbik7DQogfQ0KIA0KIHN0YXRpYyBpbnQgbWF0
Y2hfZGF0YShpbnQgZmQsIHZvaWQgKmJ1ZmZlciwgdW5zaWduZWQgbG9uZyBz
aXplKQ0KQEAgLTE5MSw3ICsxOTEsNyBAQA0KIAlpZiAobHN0YXQoY2UtPm5h
bWUsICZzdCkgPCAwKQ0KIAkJcmV0dXJuIEVSUl9QVFIoLWVycm5vKTsNCiAN
Ci0JY2hhbmdlZCA9IGNhY2hlX21hdGNoX3N0YXQoY2UsICZzdCk7DQorCWNo
YW5nZWQgPSBjZV9tYXRjaF9zdGF0KGNlLCAmc3QpOw0KIAlpZiAoIWNoYW5n
ZWQpDQogCQlyZXR1cm4gY2U7DQogDQpAQCAtMjIyLDE5ICsyMjIsMTkgQEAN
CiAJcmV0dXJuIHVwZGF0ZWQ7DQogfQ0KIA0KLXN0YXRpYyBpbnQgcmVmcmVz
aF9jYWNoZSh2b2lkKQ0KK3N0YXRpYyBpbnQgcmVmcmVzaF9jYWNoZShzdHJ1
Y3QgY2FjaGUgKmNhY2hlKQ0KIHsNCiAJaW50IGk7DQogCWludCBoYXNfZXJy
b3JzID0gMDsNCiANCi0JZm9yIChpID0gMDsgaSA8IGFjdGl2ZV9ucjsgaSsr
KSB7DQorCWZvciAoaSA9IDA7IGkgPCBnZXRfbnVtX2NhY2hlX2VudHJpZXMo
Y2FjaGUpOyBpKyspIHsNCiAJCXN0cnVjdCBjYWNoZV9lbnRyeSAqY2UsICpu
ZXc7DQotCQljZSA9IGFjdGl2ZV9jYWNoZVtpXTsNCisJCWNlID0gZ2V0X2Nh
Y2hlX2VudHJ5KGNhY2hlLCBpKTsNCiAJCWlmIChjZV9zdGFnZShjZSkpIHsN
CiAJCQlwcmludGYoIiVzOiBuZWVkcyBtZXJnZVxuIiwgY2UtPm5hbWUpOw0K
IAkJCWhhc19lcnJvcnMgPSAxOw0KLQkJCXdoaWxlICgoaSA8IGFjdGl2ZV9u
cikgJiYNCi0JCQkgICAgICAgISBzdHJjbXAoYWN0aXZlX2NhY2hlW2ldLT5u
YW1lLCBjZS0+bmFtZSkpDQorCQkJd2hpbGUgKChpIDwgZ2V0X251bV9jYWNo
ZV9lbnRyaWVzKGNhY2hlKSkgJiYNCisJCQkgICAgICAgISBzdHJjbXAoZ2V0
X2NhY2hlX2VudHJ5KGNhY2hlLCBpKS0+bmFtZSwgY2UtPm5hbWUpKQ0KIAkJ
CQlpKys7DQogCQkJaS0tOw0KIAkJCWNvbnRpbnVlOw0KQEAgLTI0OCwxMSAr
MjQ4LDcgQEANCiAJCQl9DQogCQkJY29udGludWU7DQogCQl9DQotCQlhY3Rp
dmVfY2FjaGVfY2hhbmdlZCA9IDE7DQotCQkvKiBZb3UgY2FuIE5PVCBqdXN0
IGZyZWUgYWN0aXZlX2NhY2hlW2ldIGhlcmUsIHNpbmNlIGl0DQotCQkgKiBt
aWdodCBub3QgYmUgbmVjZXNzYXJpbHkgbWFsbG9jKCllZCBidXQgY2FuIGFs
c28gY29tZQ0KLQkJICogZnJvbSBtbWFwKCkuICovDQotCQlhY3RpdmVfY2Fj
aGVbaV0gPSBuZXc7DQorCQlzZXRfY2FjaGVfZW50cnkoY2FjaGUsIG5ldywg
aSk7DQogCX0NCiAJcmV0dXJuIGhhc19lcnJvcnM7DQogfQ0KQEAgLTI4NSw3
ICsyODEsNyBAQA0KIAl9DQogfQ0KIA0KLXN0YXRpYyBpbnQgYWRkX2NhY2hl
aW5mbyhjaGFyICphcmcxLCBjaGFyICphcmcyLCBjaGFyICphcmczKQ0KK3N0
YXRpYyBpbnQgYWRkX2NhY2hlaW5mbyhzdHJ1Y3QgY2FjaGUgKmNhY2hlLCBj
aGFyICphcmcxLCBjaGFyICphcmcyLCBjaGFyICphcmczKQ0KIHsNCiAJaW50
IHNpemUsIGxlbiwgb3B0aW9uOw0KIAl1bnNpZ25lZCBpbnQgbW9kZTsNCkBA
IC0zMTAsNyArMzA2LDcgQEANCiAJY2UtPmNlX21vZGUgPSBjcmVhdGVfY2Vf
bW9kZShtb2RlKTsNCiAJb3B0aW9uID0gYWxsb3dfYWRkID8gQUREX0NBQ0hF
X09LX1RPX0FERCA6IDA7DQogCW9wdGlvbiB8PSBhbGxvd19yZXBsYWNlID8g
QUREX0NBQ0hFX09LX1RPX1JFUExBQ0UgOiAwOw0KLQlyZXR1cm4gYWRkX2Nh
Y2hlX2VudHJ5KGNlLCBvcHRpb24pOw0KKwlyZXR1cm4gYWRkX2NhY2hlX2Vu
dHJ5KGNhY2hlLCBjZSwgb3B0aW9uKTsNCiB9DQogDQogc3RhdGljIGNvbnN0
IGNoYXIgKmxvY2tmaWxlX25hbWUgPSBOVUxMOw0KQEAgLTMyOCwxMCArMzI0
LDExIEBADQogDQogaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKiphcmd2KQ0K
IHsNCi0JaW50IGksIG5ld2ZkLCBlbnRyaWVzLCBoYXNfZXJyb3JzID0gMDsN
CisJaW50IGksIG5ld2ZkLCBoYXNfZXJyb3JzID0gMDsNCiAJaW50IGFsbG93
X29wdGlvbnMgPSAxOw0KIAlzdGF0aWMgY2hhciBsb2NrZmlsZVtNQVhQQVRI
TEVOKzFdOw0KIAljb25zdCBjaGFyICppbmRleGZpbGUgPSBnZXRfaW5kZXhf
ZmlsZSgpOw0KKwlzdHJ1Y3QgY2FjaGUgKmNhY2hlID0gTlVMTDsNCiANCiAJ
c25wcmludGYobG9ja2ZpbGUsIHNpemVvZihsb2NrZmlsZSksICIlcy5sb2Nr
IiwgaW5kZXhmaWxlKTsNCiANCkBAIC0zNDMsOCArMzQwLDggQEANCiAJYXRl
eGl0KHJlbW92ZV9sb2NrX2ZpbGUpOw0KIAlsb2NrZmlsZV9uYW1lID0gbG9j
a2ZpbGU7DQogDQotCWVudHJpZXMgPSByZWFkX2NhY2hlKCk7DQotCWlmIChl
bnRyaWVzIDwgMCkNCisJY2FjaGUgPSByZWFkX2NhY2hlKCk7DQorCWlmICgh
Y2FjaGUpDQogCQlkaWUoImNhY2hlIGNvcnJ1cHRlZCIpOw0KIA0KIAlmb3Ig
KGkgPSAxIDsgaSA8IGFyZ2M7IGkrKykgew0KQEAgLTM2OCwxMyArMzY1LDEz
IEBADQogCQkJCWNvbnRpbnVlOw0KIAkJCX0NCiAJCQlpZiAoIXN0cmNtcChw
YXRoLCAiLS1yZWZyZXNoIikpIHsNCi0JCQkJaGFzX2Vycm9ycyB8PSByZWZy
ZXNoX2NhY2hlKCk7DQorCQkJCWhhc19lcnJvcnMgfD0gcmVmcmVzaF9jYWNo
ZShjYWNoZSk7DQogCQkJCWNvbnRpbnVlOw0KIAkJCX0NCiAJCQlpZiAoIXN0
cmNtcChwYXRoLCAiLS1jYWNoZWluZm8iKSkgew0KIAkJCQlpZiAoaSszID49
IGFyZ2MpDQogCQkJCQlkaWUoInVwZGF0ZS1jYWNoZTogLS1jYWNoZWluZm8g
PG1vZGU+IDxzaGExPiA8cGF0aD4iKTsNCi0JCQkJaWYgKGFkZF9jYWNoZWlu
Zm8oYXJndltpKzFdLCBhcmd2W2krMl0sIGFyZ3ZbaSszXSkpDQorCQkJCWlm
IChhZGRfY2FjaGVpbmZvKGNhY2hlLCBhcmd2W2krMV0sIGFyZ3ZbaSsyXSwg
YXJndltpKzNdKSkNCiAJCQkJCWRpZSgidXBkYXRlLWNhY2hlOiAtLWNhY2hl
aW5mbyBjYW5ub3QgYWRkICVzIiwgYXJndltpKzNdKTsNCiAJCQkJaSArPSAz
Ow0KIAkJCQljb250aW51ZTsNCkBAIC0zODIsNyArMzc5LDcgQEANCiAJCQlp
ZiAoIXN0cmNtcChwYXRoLCAiLS1mb3JjZS1yZW1vdmUiKSkgew0KIAkJCQlp
ZiAoYXJnYyA8PSBpICsgMSkNCiAJCQkJCWRpZSgidXBkYXRlLWNhY2hlOiAt
LWZvcmNlLXJlbW92ZSA8cGF0aD4iKTsNCi0JCQkJaWYgKHJlbW92ZV9maWxl
X2Zyb21fY2FjaGUoYXJndltpKzFdKSkNCisJCQkJaWYgKHJlbW92ZV9maWxl
X2Zyb21fY2FjaGUoY2FjaGUsIGFyZ3ZbaSsxXSkpDQogCQkJCQlkaWUoInVw
ZGF0ZS1jYWNoZTogLS1mb3JjZS1yZW1vdmUgY2Fubm90IHJlbW92ZSAlcyIs
IGFyZ3ZbaSsxXSk7DQogCQkJCWkrKzsNCiAJCQkJY29udGludWU7DQpAQCAt
Mzk4LDEwICszOTUsMTAgQEANCiAJCQlmcHJpbnRmKHN0ZGVyciwgIklnbm9y
aW5nIHBhdGggJXNcbiIsIGFyZ3ZbaV0pOw0KIAkJCWNvbnRpbnVlOw0KIAkJ
fQ0KLQkJaWYgKGFkZF9maWxlX3RvX2NhY2hlKHBhdGgpKQ0KKwkJaWYgKGFk
ZF9maWxlX3RvX2NhY2hlKGNhY2hlLCBwYXRoKSkNCiAJCQlkaWUoIlVuYWJs
ZSB0byBhZGQgJXMgdG8gZGF0YWJhc2UiLCBwYXRoKTsNCiAJfQ0KLQlpZiAo
d3JpdGVfY2FjaGUobmV3ZmQsIGFjdGl2ZV9jYWNoZSwgYWN0aXZlX25yKSB8
fCByZW5hbWUobG9ja2ZpbGUsIGluZGV4ZmlsZSkpDQorCWlmICh3cml0ZV9j
YWNoZShjYWNoZSwgbmV3ZmQpIHx8IHJlbmFtZShsb2NrZmlsZSwgaW5kZXhm
aWxlKSkNCiAJCWRpZSgiVW5hYmxlIHRvIHdyaXRlIG5ldyBjYWNoZWZpbGUi
KTsNCiANCiAJbG9ja2ZpbGVfbmFtZSA9IE5VTEw7DQpJbmRleDogd3JpdGUt
dHJlZS5jDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gYzhjNzdmNjdl
YTg1ZWU2NWEwZjA1NWYyY2I3NmU2MDU5ZWFhMDc3Ni93cml0ZS10cmVlLmMg
IChtb2RlOjEwMDY0NCkNCisrKyB1bmNvbW1pdHRlZC93cml0ZS10cmVlLmMg
IChtb2RlOjEwMDY0NCkNCkBAIC0xNyw3ICsxNyw3IEBADQogCXJldHVybiBy
ZXQ7DQogfQ0KIA0KLXN0YXRpYyBpbnQgd3JpdGVfdHJlZShzdHJ1Y3QgY2Fj
aGVfZW50cnkgKipjYWNoZXAsIGludCBtYXhlbnRyaWVzLCBjb25zdCBjaGFy
ICpiYXNlLCBpbnQgYmFzZWxlbiwgdW5zaWduZWQgY2hhciAqcmV0dXJuc2hh
MSkNCitzdGF0aWMgaW50IHdyaXRlX3RyZWUoc3RydWN0IGNhY2hlICpjYWNo
ZSwgaW50IHN0YXJ0X3BvcywgY29uc3QgY2hhciAqYmFzZSwgaW50IGJhc2Vs
ZW4sIHVuc2lnbmVkIGNoYXIgKnJldHVybnNoYTEpDQogew0KIAl1bnNpZ25l
ZCBjaGFyIHN1YmRpcl9zaGExWzIwXTsNCiAJdW5zaWduZWQgbG9uZyBzaXpl
LCBvZmZzZXQ7DQpAQCAtMzAsOCArMzAsOCBAQA0KIAlvZmZzZXQgPSAwOw0K
IA0KIAluciA9IDA7DQotCXdoaWxlIChuciA8IG1heGVudHJpZXMpIHsNCi0J
CXN0cnVjdCBjYWNoZV9lbnRyeSAqY2UgPSBjYWNoZXBbbnJdOw0KKwl3aGls
ZSAoKHN0YXJ0X3BvcyArIG5yKSA8IGdldF9udW1fY2FjaGVfZW50cmllcyhj
YWNoZSkpIHsNCisJCXN0cnVjdCBjYWNoZV9lbnRyeSAqY2UgPSBnZXRfY2Fj
aGVfZW50cnkoY2FjaGUsIHN0YXJ0X3BvcyArIG5yKTsNCiAJCWNvbnN0IGNo
YXIgKnBhdGhuYW1lID0gY2UtPm5hbWUsICpmaWxlbmFtZSwgKmRpcm5hbWU7
DQogCQlpbnQgcGF0aGxlbiA9IGNlX25hbWVsZW4oY2UpLCBlbnRyeWxlbjsN
CiAJCXVuc2lnbmVkIGNoYXIgKnNoYTE7DQpAQCAtNDEsMTYgKzQxLDEzIEBA
DQogCQlpZiAoYmFzZWxlbiA+PSBwYXRobGVuIHx8IG1lbWNtcChiYXNlLCBw
YXRobmFtZSwgYmFzZWxlbikpDQogCQkJYnJlYWs7DQogDQotCQlzaGExID0g
Y2UtPnNoYTE7DQotCQltb2RlID0gbnRvaGwoY2UtPmNlX21vZGUpOw0KLQ0K
IAkJLyogRG8gd2UgaGF2ZSBfZnVydGhlcl8gc3ViZGlyZWN0b3JpZXM/ICov
DQogCQlmaWxlbmFtZSA9IHBhdGhuYW1lICsgYmFzZWxlbjsNCiAJCWRpcm5h
bWUgPSBzdHJjaHIoZmlsZW5hbWUsICcvJyk7DQogCQlpZiAoZGlybmFtZSkg
ew0KIAkJCWludCBzdWJkaXJfd3JpdHRlbjsNCiANCi0JCQlzdWJkaXJfd3Jp
dHRlbiA9IHdyaXRlX3RyZWUoY2FjaGVwICsgbnIsIG1heGVudHJpZXMgLSBu
ciwgcGF0aG5hbWUsIGRpcm5hbWUtcGF0aG5hbWUrMSwgc3ViZGlyX3NoYTEp
Ow0KKwkJCXN1YmRpcl93cml0dGVuID0gd3JpdGVfdHJlZShjYWNoZSwgc3Rh
cnRfcG9zICsgbnIsIHBhdGhuYW1lLCBkaXJuYW1lLXBhdGhuYW1lKzEsIHN1
YmRpcl9zaGExKTsNCiAJCQluciArPSBzdWJkaXJfd3JpdHRlbjsNCiANCiAJ
CQkvKiBOb3cgd2UgbmVlZCB0byB3cml0ZSBvdXQgdGhlIGRpcmVjdG9yeSBl
bnRyeSBpbnRvIHRoaXMgdHJlZS4uICovDQpAQCAtNjAsNiArNTcsOSBAQA0K
IAkJCS8qIC4uYnV0IHRoZSBkaXJlY3RvcnkgZW50cnkgZG9lc24ndCBjb3Vu
dCB0b3dhcmRzIHRoZSB0b3RhbCBjb3VudCAqLw0KIAkJCW5yLS07DQogCQkJ
c2hhMSA9IHN1YmRpcl9zaGExOw0KKwkJfSBlbHNlIHsNCisJCQlzaGExID0g
Y2UtPnNoYTE7DQorCQkJbW9kZSA9IG50b2hsKGNlLT5jZV9tb2RlKTsNCiAJ
CX0NCiANCiAJCWlmIChjaGVja192YWxpZF9zaGExKHNoYTEpIDwgMCkNCkBA
IC04NSwxNiArODUsMTkgQEANCiBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAq
KmFyZ3YpDQogew0KIAlpbnQgaSwgZnVubnk7DQotCWludCBlbnRyaWVzID0g
cmVhZF9jYWNoZSgpOw0KKwlzdHJ1Y3QgY2FjaGUgKmNhY2hlID0gcmVhZF9j
YWNoZSgpOw0KKwlpbnQgZW50cmllczsNCiAJdW5zaWduZWQgY2hhciBzaGEx
WzIwXTsNCiANCi0JaWYgKGVudHJpZXMgPCAwKQ0KKwlpZiAoIWNhY2hlKQ0K
IAkJZGllKCJ3cml0ZS10cmVlOiBlcnJvciByZWFkaW5nIGNhY2hlIik7DQog
DQorCWVudHJpZXMgPSBnZXRfbnVtX2NhY2hlX2VudHJpZXMoY2FjaGUpOw0K
Kw0KIAkvKiBWZXJpZnkgdGhhdCB0aGUgdHJlZSBpcyBtZXJnZWQgKi8NCiAJ
ZnVubnkgPSAwOw0KIAlmb3IgKGkgPSAwOyBpIDwgZW50cmllczsgaSsrKSB7
DQotCQlzdHJ1Y3QgY2FjaGVfZW50cnkgKmNlID0gYWN0aXZlX2NhY2hlW2ld
Ow0KKwkJc3RydWN0IGNhY2hlX2VudHJ5ICpjZSA9IGdldF9jYWNoZV9lbnRy
eShjYWNoZSwgaSk7DQogCQlpZiAobnRvaHMoY2UtPmNlX2ZsYWdzKSAmIH5D
RV9OQU1FTUFTSykgew0KIAkJCWlmICgxMCA8ICsrZnVubnkpIHsNCiAJCQkJ
ZnByaW50ZihzdGRlcnIsICIuLi5cbiIpOw0KQEAgLTExNiw4ICsxMTksOCBA
QA0KIAkJICogdGhlIGNhY2hlIGlzIHNvcnRlZC4gIEFsc28gcGF0aCBjYW4g
YXBwZWFyIG9ubHkgb25jZSwNCiAJCSAqIHdoaWNoIG1lYW5zIGNvbmZsaWN0
aW5nIG9uZSB3b3VsZCBpbW1lZGlhdGVseSBmb2xsb3cuDQogCQkgKi8NCi0J
CWNvbnN0IGNoYXIgKnRoaXNfbmFtZSA9IGFjdGl2ZV9jYWNoZVtpXS0+bmFt
ZTsNCi0JCWNvbnN0IGNoYXIgKm5leHRfbmFtZSA9IGFjdGl2ZV9jYWNoZVtp
KzFdLT5uYW1lOw0KKwkJY29uc3QgY2hhciAqdGhpc19uYW1lID0gZ2V0X2Nh
Y2hlX2VudHJ5KGNhY2hlLCBpKS0+bmFtZTsNCisJCWNvbnN0IGNoYXIgKm5l
eHRfbmFtZSA9IGdldF9jYWNoZV9lbnRyeShjYWNoZSwgaSsxKS0+bmFtZTsN
CiAJCWludCB0aGlzX2xlbiA9IHN0cmxlbih0aGlzX25hbWUpOw0KIAkJaWYg
KHRoaXNfbGVuIDwgc3RybGVuKG5leHRfbmFtZSkgJiYNCiAJCSAgICBzdHJu
Y21wKHRoaXNfbmFtZSwgbmV4dF9uYW1lLCB0aGlzX2xlbikgPT0gMCAmJg0K
QEAgLTEzNCw3ICsxMzcsNyBAQA0KIAkJZGllKCJ3cml0ZS10cmVlOiBub3Qg
YWJsZSB0byB3cml0ZSB0cmVlIik7DQogDQogCS8qIE9rLCB3cml0ZSBpdCBv
dXQgKi8NCi0JaWYgKHdyaXRlX3RyZWUoYWN0aXZlX2NhY2hlLCBlbnRyaWVz
LCAiIiwgMCwgc2hhMSkgIT0gZW50cmllcykNCisJaWYgKHdyaXRlX3RyZWUo
Y2FjaGUsIDAsICIiLCAwLCBzaGExKSAhPSBlbnRyaWVzKQ0KIAkJZGllKCJ3
cml0ZS10cmVlOiBpbnRlcm5hbCBlcnJvciIpOw0KIAlwcmludGYoIiVzXG4i
LCBzaGExX3RvX2hleChzaGExKSk7DQogCXJldHVybiAwOw0K
---1110348602-1249053733-1116148301=:2136--
