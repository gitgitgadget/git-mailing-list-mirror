Return-Path: <git-owner@kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-10.3 required=3.0 tests=BAYES_00,
	HEADER_FROM_DIFFERENT_DOMAINS,INCLUDES_PATCH,MAILING_LIST_MULTI,SPF_HELO_NONE,
	SPF_PASS,USER_AGENT_SANE_1 autolearn=ham autolearn_force=no version=3.4.0
Received: from mail.kernel.org (mail.kernel.org [198.145.29.99])
	by smtp.lore.kernel.org (Postfix) with ESMTP id BE7CFC433F5
	for <git@archiver.kernel.org>; Wed, 22 Sep 2021 17:42:30 +0000 (UTC)
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.kernel.org (Postfix) with ESMTP id A17CD611C9
	for <git@archiver.kernel.org>; Wed, 22 Sep 2021 17:42:30 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S236836AbhIVRoA (ORCPT <rfc822;git@archiver.kernel.org>);
        Wed, 22 Sep 2021 13:44:00 -0400
Received: from lug-owl.de ([188.68.32.151]:54850 "EHLO lug-owl.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S236893AbhIVRn7 (ORCPT <rfc822;git@vger.kernel.org>);
        Wed, 22 Sep 2021 13:43:59 -0400
Received: by lug-owl.de (Postfix, from userid 1001)
        id 1B98F41EF6; Wed, 22 Sep 2021 19:42:28 +0200 (CEST)
Date:   Wed, 22 Sep 2021 19:42:28 +0200
From:   Jan-Benedict Glaw <jbglaw@lug-owl.de>
To:     git@vger.kernel.org
Cc:     Junio C Hamano <gitster@pobox.com>
Subject: *ping* [PATCH RFC] gitweb: Handle non-ASCII email addresses
Message-ID: <20210922174228.2i2bz2fx3ap45s75@lug-owl.de>
References: <20210915192647.6fnk7ktwldz7uubf@lug-owl.de>
MIME-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
        protocol="application/pgp-signature"; boundary="ngimggxpzpwdokft"
Content-Disposition: inline
In-Reply-To: <20210915192647.6fnk7ktwldz7uubf@lug-owl.de>
X-Operating-System: Linux chamaeleon 5.8.0-0.bpo.2-amd64
X-gpg-fingerprint: 250D 3BCF 7127 0D8C A444  A961 1DBD 5E75 8399 E1BB
X-gpg-key: wwwkeys.de.pgp.net
X-Echelon-Enable: howto poison arsenous mail psychological biological nuclear
 warfare test the bombastical terror of flooding the spy listeners explosion
 sex drugs and rock'n'roll
X-TKUeV: howto poison arsenous mail psychological biological nuclear warfare
 test the bombastical terror of flooding the spy listeners explosion sex
 drugs and rock'n'roll
X-message-flag: Please send plain text messages only. Do not send HTML
 emails. Thank you.
User-Agent: NeoMutt/20170113 (1.7.2)
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org


--ngimggxpzpwdokft
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

Hi!

On Wed, 2021-09-15 21:26:47 +0200, Jan-Benedict Glaw <jbglaw@lug-owl.de> wr=
ote:
> I accidentally had a bad user.email setting ("jbglaw@=C5=82ug-owl.de"
> instead of "jbglaw@lug-owl.de") and this leads to incomplete HTML
> being generated by gitweb, along with an error message:
>=20
> index.cgi: Wide character in subroutine entry at /usr/share/gitweb/index.=
cgi line 2208.
>=20
> This patch may fix it, but I'm NOT a Perl guy:
>=20
> --- a/gitweb/gitweb.perl	2021-09-15 20:23:13.788195846 +0200
> +++ b/gitweb/gitweb.perl	2021-09-15 20:24:19.911806868 +0200
> @@ -2193,7 +2193,7 @@
>  	my $size =3D shift;
>  	$avatar_cache{$email} ||=3D
>  		"//www.gravatar.com/avatar/" .
> -			md5_hex($email) . "?s=3D";
> +			md5_hex(utf8::is_utf8($email)? Encode::encode_utf8($email): $email) .=
 "?s=3D";
>  	return $avatar_cache{$email} . $size;
>  }
>=20
>=20
> Comments?

I'd like to get some comment on this, maybe for anybody to merge it?

Thanks,
  Jan-Benedict

--=20

--ngimggxpzpwdokft
Content-Type: application/pgp-signature; name="signature.asc"

-----BEGIN PGP SIGNATURE-----

iF0EABECAB0WIQQlDTvPcScNjKREqWEdvV51g5nhuwUCYUtrAAAKCRAdvV51g5nh
uzePAJ9wJsDQzgdjhjkqld7+e8LR6bUBOgCfZzHESRgyeCr23BF/jtV76lY9H5I=
=MGJT
-----END PGP SIGNATURE-----

--ngimggxpzpwdokft--
