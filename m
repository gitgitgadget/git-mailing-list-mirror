From: Carl Worth <cworth@cworth.org>
Subject: Should update-server-info be on by default?
Date: Mon, 15 Jan 2007 14:48:03 -0800
Message-ID: <87vej7x5y4.wl%cworth@cworth.org>
Mime-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: multipart/signed;
 boundary="pgp-sign-Multipart_Mon_Jan_15_14:47:57_2007-1"; micalg=pgp-sha1;
 protocol="application/pgp-signature"
Content-Transfer-Encoding: 7bit
X-From: git-owner@vger.kernel.org Mon Jan 15 23:48:33 2007
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git@gmane.org
Received: from vger.kernel.org ([209.132.176.167])
	by lo.gmane.org with esmtp (Exim 4.50)
	id 1H6acr-0004kY-41
	for gcvg-git@gmane.org; Mon, 15 Jan 2007 23:48:25 +0100
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1751018AbXAOWsT (ORCPT <rfc822;gcvg-git@m.gmane.org>);
	Mon, 15 Jan 2007 17:48:19 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S932077AbXAOWsT
	(ORCPT <rfc822;git-outgoing>); Mon, 15 Jan 2007 17:48:19 -0500
Received: from mx1.redhat.com ([66.187.233.31]:35130 "EHLO mx1.redhat.com"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S1751018AbXAOWsS (ORCPT <rfc822;git@vger.kernel.org>);
	Mon, 15 Jan 2007 17:48:18 -0500
Received: from int-mx1.corp.redhat.com (int-mx1.corp.redhat.com [172.16.52.254])
	by mx1.redhat.com (8.12.11.20060308/8.12.11) with ESMTP id l0FMmHLh007118
	for <git@vger.kernel.org>; Mon, 15 Jan 2007 17:48:18 -0500
Received: from mail.boston.redhat.com (mail.boston.redhat.com [172.16.76.12])
	by int-mx1.corp.redhat.com (8.13.1/8.13.1) with ESMTP id l0FMmHEk014601
	for <git@vger.kernel.org>; Mon, 15 Jan 2007 17:48:17 -0500
Received: from raht.cworth.org (sebastian-int.corp.redhat.com [172.16.52.221])
	by mail.boston.redhat.com (8.12.11.20060308/8.12.11) with ESMTP id l0FMmEZ4006948
	for <git@vger.kernel.org>; Mon, 15 Jan 2007 17:48:16 -0500
To: git@vger.kernel.org
User-Agent: Wanderlust/2.14.0 (Africa) Emacs/21.4 Mule/5.0 (SAKAKI)
Sender: git-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/36900>

--pgp-sign-Multipart_Mon_Jan_15_14:47:57_2007-1
Content-Type: text/plain; charset=US-ASCII

Somebody recently handed me an http:// URL for a git repository.
I cloned it and it seemed to work, (got the annoying got/walk spew).
Later I tried to pull down recent changes, but I didn't appear to get
anything new.

Confused, I did a new clone, and found that there were new
changes. And looking closer, I got the following when I did a
git-fetch right after the initial clone:

	Fetching refs/heads/master from	http://www.blaubeermuffin.de/ccc.git using http
	* refs/remotes/origin/master: forcing update to non-fast forward
	branch 'master' of http://www.blaubeermuffin.de/ccc
	  old...new: f5abfee...855b7fa

Here the 'old' was the correct, current contents of the remote
refs/heads/master, but the 'new' was actually the initial commit in
the repository, which is obviously the wrong thing in every way.

And it was easy enough to see that git though that that was the
correct remote head value:

	git ls-remote --heads http://www.blaubeermuffin.de/ccc.git
	855b7fa88a44468754329e795547c968e5d15c7f        refs/heads/master

Now, I'd never actually hit this problem before, but I had heard
rumor of it, so I was able to point the maintainer to the default
.git/hooks/post-update script, and things appear to be working with
that enabled.

My question is, why do we require a hook before a git repository will
function correctly over http protocol? Is whatever this hook does so
expensive that we really shouldn't just do it unconditionally and
avoid all the broken-by-default behavior for dumb protocols?

And if keeping this off by default is really the right thing, can we
detect the problem and actually inform the user about it? Such as, not
let an http: clone function at all until things are setup properly?

-Carl

--pgp-sign-Multipart_Mon_Jan_15_14:47:57_2007-1
Content-Type: application/pgp-signature
Content-Transfer-Encoding: 7bit

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (GNU/Linux)

iD8DBQBFrASj6JDdNq8qSWgRAqiuAKCcp0+q/7HEX8FhP99408fc5kfVYACgpp9R
3R4qN1zQNzg6tXVRplQW9GI=
=CeA7
-----END PGP SIGNATURE-----

--pgp-sign-Multipart_Mon_Jan_15_14:47:57_2007-1--
