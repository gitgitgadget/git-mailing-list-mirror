From: Kalle Olavi Niemitalo <kon@iki.fi>
Subject: Re: reflogs generated by git-cvsimport
Date: Fri, 31 Jul 2009 23:15:14 +0300
Message-ID: <87bpn0a9t9.fsf@Astalo.kon.iki.fi>
References: <87fxccagvx.fsf@Astalo.kon.iki.fi>
	<20090731191334.GA12132@coredump.intra.peff.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
To: git@vger.kernel.org
X-From: git-owner@vger.kernel.org Fri Jul 31 22:15:27 2009
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git-2@gmane.org
Received: from vger.kernel.org ([209.132.176.167])
	by lo.gmane.org with esmtp (Exim 4.50)
	id 1MWyVi-0000NG-Fm
	for gcvg-git-2@gmane.org; Fri, 31 Jul 2009 22:15:27 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1751923AbZGaUPR (ORCPT <rfc822;gcvg-git-2@m.gmane.org>);
	Fri, 31 Jul 2009 16:15:17 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1751917AbZGaUPR
	(ORCPT <rfc822;git-outgoing>); Fri, 31 Jul 2009 16:15:17 -0400
Received: from sinikuusama.dnainternet.net ([83.102.40.134]:56182 "EHLO
	sinikuusama.dnainternet.net" rhost-flags-OK-OK-OK-OK)
	by vger.kernel.org with ESMTP id S1751849AbZGaUPP (ORCPT
	<rfc822;git@vger.kernel.org>); Fri, 31 Jul 2009 16:15:15 -0400
Received: from localhost (localhost [127.0.0.1])
	by sinikuusama.dnainternet.net (Postfix) with ESMTP id 0444A2C928
	for <git@vger.kernel.org>; Fri, 31 Jul 2009 23:15:15 +0300 (EEST)
X-Virus-Scanned: Debian amavisd-new at !change-mydomain-variable!.example.com
X-Spam-Flag: NO
X-Spam-Score: -2.312
X-Spam-Level: 
X-Spam-Status: No, score=-2.312 tagged_above=-9999 required=7
	tests=[BAYES_00=-2.312]
Received: from sinikuusama.dnainternet.net ([83.102.40.134])
	by localhost (sinikuusama.dnainternet.net [127.0.0.1]) (amavisd-new, port 10041)
	with ESMTP id p9TK5PgTVK1D for <git@vger.kernel.org>;
	Fri, 31 Jul 2009 23:15:14 +0300 (EEST)
Received: from oliivipuu.dnainternet.net (oliivipuu.dnainternet.net [83.102.40.215])
	by sinikuusama.dnainternet.net (Postfix) with ESMTP id B94972C926
	for <git@vger.kernel.org>; Fri, 31 Jul 2009 23:15:14 +0300 (EEST)
Received: from Astalo.kon.iki.fi (85-23-32-64-Rajakyla-TR1.suomi.net [85.23.32.64])
	(using TLSv1 with cipher AES256-SHA (256/256 bits))
	(No client certificate requested)
	by oliivipuu.dnainternet.net (Postfix) with ESMTPS id AE0F52BAD3
	for <git@vger.kernel.org>; Fri, 31 Jul 2009 23:15:14 +0300 (EEST)
Received: from Kalle by Astalo.kon.iki.fi with local (Exim 4.69)
	(envelope-from <kon@iki.fi>)
	id 1MWyVW-0006lw-Ca; Fri, 31 Jul 2009 23:15:14 +0300
In-Reply-To: <20090731191334.GA12132@coredump.intra.peff.net> (Jeff King's
	message of "Fri, 31 Jul 2009 15:13:34 -0400")
User-Agent: Gnus/5.110007 (No Gnus v0.7) Emacs/23.0.51 (gnu/linux)
X-Accept-Language: fi;q=1.0, en;q=0.9, sv;q=0.5, de;q=0.1
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/124596>

Jeff King <peff@peff.net> writes:

> Yeah, it probably should not munge the reflog with the CVS committer
> information. I suspect it would be as easy as the following (totally
> untested, not even syntax checked) patch:

That patch does not work because the $commit_read and
$commit_write file handles fall out of scope too early.
Those and $pid could be returned from the do {...} as
a list, but I think it's easier to remove the "do", declare
the variables above the block, and assign them in the block.

Also, there's $ENV{'TZ'}="UTC" at the beginning of the script
and it affects the reflogs too.  This is the annoying part.
The script runs numerous subprocesses and it is not clear to
me which of those need TZ=UTC and which ones should use the
original TZ:

- git config: doesn't matter?
- cvs: UTC?
- rsh: UTC?
- git rev-parse --verify: depends on whether $name looks in reflog
- git-init: doesn't matter?
- git-read-tree: doesn't matter
- git-symbolic-ref: original if this can write to reflog
- git-rev-parse --verify HEAD: doesn't matter
- git-for-each-ref: doesn't matter
- cvsps: UTC?
- git-update-index: doesn't matter
- git-write-tree: doesn't matter
- git-commit-tree: doesn't matter because GIT_COMMITTER_DATE and
  GIT_COMMITTER_DATE already specify "+0000".  (Might be nice to
  have author-specific time zones there though.)
- git-update-ref: original.  (Also, -m cvsimport could be added.)
- git-tag: doesn't matter because cvsimport never uses git tag -a.
- git update-ref: original
- git-hash-object: doesn't matter
- git repack: doesn't matter?
- git-count-objects: doesn't matter
- git-merge: original
- git checkout: doesn't matter?
