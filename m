From: Krzysztof Mazur <krzysiek@podlesie.net>
Subject: Re: Failure to extra stable@vger.kernel.org addresses
Date: Wed, 21 Nov 2012 00:09:55 +0100
Message-ID: <20121120230955.GA9686@shrek.podlesie.net>
References: <CAMP44s0f0zYa1FVf9RhNuwYJbkQ7zPwgJ6=ty3c5knjo5a2TNw@mail.gmail.com>
 <7vlidxuowf.fsf@alter.siamese.dyndns.org>
 <20121120073100.GB7206@shrek.podlesie.net>
 <20121120075628.GA7159@shrek.podlesie.net>
 <CAMP44s38gTB_3Ao1rFZgMo2EAuiNb+h88-qRFcQPRMJNxo3CAQ@mail.gmail.com>
 <20121120115942.GA6132@shrek.podlesie.net>
 <m2lidw11yb.fsf@igel.home>
 <20121120212126.GA12656@shrek.podlesie.net>
 <CAMP44s3+vnKfhhh=qqU2vuKvWwhii4CQ7=YAuhFiceX1EDaVKQ@mail.gmail.com>
 <7vhaojrjpx.fsf@alter.siamese.dyndns.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: Felipe Contreras <felipe.contreras@gmail.com>,
	Andreas Schwab <schwab@linux-m68k.org>,
	Felipe Balbi <balbi@ti.com>, git@vger.kernel.org,
	Tomi Valkeinen <tomi.valkeinen@ti.com>
To: Junio C Hamano <gitster@pobox.com>
X-From: git-owner@vger.kernel.org Wed Nov 21 00:11:54 2012
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git-2@plane.gmane.org
Received: from vger.kernel.org ([209.132.180.67])
	by plane.gmane.org with esmtp (Exim 4.69)
	(envelope-from <git-owner@vger.kernel.org>)
	id 1Tawyt-00035e-AJ
	for gcvg-git-2@plane.gmane.org; Wed, 21 Nov 2012 00:11:51 +0100
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1753484Ab2KTXJ7 (ORCPT <rfc822;gcvg-git-2@m.gmane.org>);
	Tue, 20 Nov 2012 18:09:59 -0500
Received: from [93.179.225.50] ([93.179.225.50]:33793 "EHLO shrek.podlesie.net"
	rhost-flags-FAIL-FAIL-OK-OK) by vger.kernel.org with ESMTP
	id S1753329Ab2KTXJ6 (ORCPT <rfc822;git@vger.kernel.org>);
	Tue, 20 Nov 2012 18:09:58 -0500
Received: by shrek.podlesie.net (Postfix, from userid 603)
	id BCA3350F; Wed, 21 Nov 2012 00:09:55 +0100 (CET)
Content-Disposition: inline
In-Reply-To: <7vhaojrjpx.fsf@alter.siamese.dyndns.org>
User-Agent: Mutt/1.5.21 (2010-09-15)
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/210121>

On Tue, Nov 20, 2012 at 02:30:02PM -0800, Junio C Hamano wrote:
> Felipe Contreras <felipe.contreras@gmail.com> writes:
> 
> > On Tue, Nov 20, 2012 at 10:21 PM, Krzysztof Mazur <krzysiek@podlesie.net> wrote:
> >
> >> --- a/git-send-email.perl
> >> +++ b/git-send-email.perl
> >> @@ -924,6 +924,10 @@ sub quote_subject {
> >>  # use the simplest quoting being able to handle the recipient
> >>  sub sanitize_address {
> >>         my ($recipient) = @_;
> >> +
> >> +       # remove garbage after email address
> >> +       $recipient =~ s/(.*?<[^>]*>).*$/$1/;
> >
> > That won't work for 'foo@bar.com # test'. I think we should abandon
> > hopes of properly parsing an email address and just do:
> >
> > $recipient =~ s/(.*?) #.*$/$1/;
> 
> We should probably fix the tools that generate these bogus
> non-addresses first.  What's wrong with
> 
> 	Cc: stable kernel (v3.5 v3.6 v3.7) <stable@vger.kernel.org>
> 
> which should be OK?
> 
> Also I suspect that this should be also deemed valid:
> 
> 	Cc: stable@vger.kernel.org (Stable kernel - v3.5 v3.6 v3.7)

So maybe we should just use the original regex:

$recipient =~ s/(.*>).*$/$1/

which does not add regression for valid addresses, and just fails
in some rare cases when '>' is used in garbage. It was sufficient
for original issue reported by, and tested by Felipe.

The problem with '>' would be fixed in separate patch. The same
problem exits for invalid address generated by --cc-cmd
(see [PATCH] git-send-email: don't return undefined value in
extract_valid_address()). We would report an error in both cases,
as suggested by Junio.

Krzysiek
