From: Jess Austin <jess.austin@gmail.com>
Subject: Re: [PATCH] git-prompt.sh: Omit prompt for ignored directories
Date: Thu, 9 Oct 2014 05:27:16 -0500
Message-ID: <CANp8Xb_kdpzYjWZxoWFtT+UWwMPpFD0znkoEKVpdukGf61Preg@mail.gmail.com>
References: <1412795040-19267-1-git-send-email-jess.austin@gmail.com>
	<5435A8A7.2030008@bbn.com>
	<CANp8Xb8ETG-ZFCqrOk=f-RbxtRxehBmAR1O5ozLH80zimWq_Gw@mail.gmail.com>
	<CANp8Xb9MUbQCVZRNYibFBibzTFF=56BqNFFC1G2iTF7WGBNi7g@mail.gmail.com>
	<54361F30.8020603@bbn.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Cc: git@vger.kernel.org, szeder@ira.uka.de
To: Richard Hansen <rhansen@bbn.com>
X-From: git-owner@vger.kernel.org Thu Oct 09 12:27:22 2014
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git-2@plane.gmane.org
Received: from vger.kernel.org ([209.132.180.67])
	by plane.gmane.org with esmtp (Exim 4.69)
	(envelope-from <git-owner@vger.kernel.org>)
	id 1XcAwM-0007mw-Bh
	for gcvg-git-2@plane.gmane.org; Thu, 09 Oct 2014 12:27:22 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1751555AbaJIK1T (ORCPT <rfc822;gcvg-git-2@m.gmane.org>);
	Thu, 9 Oct 2014 06:27:19 -0400
Received: from mail-lb0-f169.google.com ([209.85.217.169]:35833 "EHLO
	mail-lb0-f169.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1752332AbaJIK1S (ORCPT <rfc822;git@vger.kernel.org>);
	Thu, 9 Oct 2014 06:27:18 -0400
Received: by mail-lb0-f169.google.com with SMTP id 10so842670lbg.14
        for <git@vger.kernel.org>; Thu, 09 Oct 2014 03:27:16 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20120113;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :cc:content-type;
        bh=SZiK6BaUNDjBNGuM4+qmgZE751W4Qmdcf0eyCI6XzXE=;
        b=uIf6RAK40y4DEy+V7FHKF02vW5YHn+yCtGEeRCMK8+c2wIgKST2YE7yeVShyerE2DY
         dW61KK0XNuGnetka1ew5wc14N6ZBSAFdkigEtO7qfhPZQGZUk7oW7pT6wpsIzHievXP+
         71WpbVenSIicgPkHaEwtdzB8hCQdJBc7Gf518icKgB5Fv0ImydF4eLPbeqPrQkxdCWXG
         v9S+4fqpY2GJP63WJLuljv0/QwbfOyjG3d5os7aCVJCYTmkyjEvvqD2FtHbpITmIDidg
         DtwrqflFGnEqEWCyA1t7LievGHbvo5hbQ5QJcqgVP3ZdOhfEJMgeSYVw5DmKLRGKD8Gq
         fvag==
X-Received: by 10.152.5.130 with SMTP id s2mr16065171las.0.1412850436449; Thu,
 09 Oct 2014 03:27:16 -0700 (PDT)
Received: by 10.25.15.164 with HTTP; Thu, 9 Oct 2014 03:27:16 -0700 (PDT)
In-Reply-To: <54361F30.8020603@bbn.com>
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

On Thu, Oct 9, 2014 at 12:37 AM, Richard Hansen <rhansen@bbn.com> wrote:
> On 2014-10-08 17:37, Jess Austin wrote:
>> On Wed, Oct 8, 2014 at 4:12 PM, Richard Hansen <rhansen@bbn.com> wrote:
>>> On 2014-10-08 15:04, Jess Austin wrote:
>>>> Introduce a new environmental variable, GIT_PS1_OMITIGNORED, which
>>>> tells __git_ps1 to display nothing when the current directory is
>>>> set (e.g. via .gitignore) to be ignored by git. In the absence of
>>>> GIT_PS1_OMITIGNORED this change has no effect.
>>>>
>>>> Many people manage e.g. dotfiles in their home directory with git.
>>>> This causes the prompt generated by __git_ps1 to refer to that "top
>>>> level" repo while working in any descendant directory. That can be
>>>> distracting, so this patch helps one shut off that noise.
>>>
>>> Interesting idea, though I would prefer this to be configurable on a
>>> per-repository basis.  (I wouldn't want to hide the prompt in any
>>> repository besides my home repository.)
>>
>> Sorry my description was unclear. Let's say you have a repo in "~",
>> and another in "~/projects/foo". Also, the file "~/.gitignore" has the line
>> "projects/" in it. In this case, you'd see repo info in your prompt while
>> in "~" or in "~/projects/foo", but not if you were in "~/projects". In that
>> sense, the prompt is not distracting you with the status of the top-level
>> repo when you're not looking at anything in that repo.
>
> I understand; I was concerned about this case:
>
> $ PS1='\n\w$(__git_ps1 " (%s)")\n\$ '
>
> /home/rhansen/projects (dotfiles)
> $ GIT_PS1_OMITIGNORED=y
>
> /home/rhansen/projects              <-- Git prompt goes away as desired
> $ cd foo
>
> /home/rhansen/projects/foo (master) <-- Git prompt back as expected
> $ echo ignored/ >>.gitignore && mkdir -p ignored && cd ignored
>
> /home/rhansen/projects/foo/ignored  <-- I want the Git prompt here
> $
>
> In other words:  If I were to use this feature, I'd want to be able to
> hide the prompt when I'm in an ignored directory in my dotfiles work
> tree, but show the prompt when I'm in an ignored directory in any other
> work tree.

Would you want this configured in each repo (i.e. via a line in ".git/config"),
or would you prefer something global so that it only need be set in one
place? I'm not sure how the latter technique would work, so if that seems
better please advise on how to go about that.

cheers,
Jess
