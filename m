Return-Path: <git-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on dcvr.yhbt.net
X-Spam-Level: 
X-Spam-ASN: AS31976 209.132.180.0/23
X-Spam-Status: No, score=-3.1 required=3.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FORGED_FROMDOMAIN,FREEMAIL_FROM,
	HEADER_FROM_DIFFERENT_DOMAINS,RCVD_IN_DNSWL_HI,T_RP_MATCHES_RCVD
	shortcircuit=no autolearn=ham autolearn_force=no version=3.4.0
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by dcvr.yhbt.net (Postfix) with ESMTP id 0DE101F404
	for <e@80x24.org>; Mon, 22 Jan 2018 12:32:06 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1751143AbeAVMcD (ORCPT <rfc822;e@80x24.org>);
        Mon, 22 Jan 2018 07:32:03 -0500
Received: from mail-pf0-f194.google.com ([209.85.192.194]:39894 "EHLO
        mail-pf0-f194.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1750970AbeAVMcC (ORCPT <rfc822;git@vger.kernel.org>);
        Mon, 22 Jan 2018 07:32:02 -0500
Received: by mail-pf0-f194.google.com with SMTP id e11so6979850pff.6
        for <git@vger.kernel.org>; Mon, 22 Jan 2018 04:32:02 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=from:to:cc:subject:date:message-id:mime-version
         :content-transfer-encoding;
        bh=KMBluBxNZIXFtR2Cb+sbZMwPAB0PVvyF7DXAxmeqyMM=;
        b=JxBqndAfso+02aKmsS0a7thqn/57fYEHXYaRDBpgz9oDZNbgILg9XLTb+hntn2jsgM
         9PpP8DEALlsYKhrX88ziEUAY6DLIXal4nPY133UA/Foz5GYY8W+Us8DZgT7A2RRGuMWT
         Y+tt9mCeOdM2TVDz3Opuii9WR+hln22dUMmrnt/JQKJuh4J+GnmS8MbW7FuAfnhx6OXG
         MbML3X3mrIRMDxU7RXyUDkFnZA+u01IZYk9/P3iuSFA9Q0BRneDpBWrpjLXKd/fXn8VP
         nCIoVTyfUJGyzWa9He8j4e4f2XXzita0QYc0JSooLbD7DkKVxSQa+pQqwVrXUobYPAJ5
         InKA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
         :content-transfer-encoding;
        bh=KMBluBxNZIXFtR2Cb+sbZMwPAB0PVvyF7DXAxmeqyMM=;
        b=BFpH5bbUtJtxza96zJlRLmuvtUjgIU1WmJo0jBnDuFB3LReQg/emG/WUaXtBYt+qKF
         mGiFzdQ1IPWe9SMtbqX50O879T8ICxur12cnTekfqEtuqT86RgvtyEL2188t2HS+1K2S
         K5HS1wMEus97g2BQaHD7qfwDc/+PXNm1uupC9lWmF4BkQxGR2z+gLdD1YSaiuMM9z18F
         WcbvvgfidY/jD7UnLt0JasZGkPVj/cvtwtl6nlk2F9/Snrhgv6kSIOrWNwVnP6RilPm0
         bFAwg2+CZbaAC0avFax0dnmarHxVghaq7FcabfsnK4lFh4JfSGF9+Zim09WHceVlOMUC
         Eisg==
X-Gm-Message-State: AKwxytebFe57Uhg4bgm5EvxnvM3Q94T41fuIr6BFoc2glrUh6lZ4BYJt
        Qu5rfDvvhx8Db8nUqXKLOoZjng==
X-Google-Smtp-Source: AH8x224Ybw9gK7b9CNh+5N2jf5AVDyvW0CSA1y6WtuZPJEnoqoq1kgphR2SYKMOLz9ECibRbrp44vA==
X-Received: by 10.101.77.68 with SMTP id j4mr7446379pgt.222.1516624321722;
        Mon, 22 Jan 2018 04:32:01 -0800 (PST)
Received: from ash ([171.233.110.59])
        by smtp.gmail.com with ESMTPSA id p72sm612654pfa.99.2018.01.22.04.31.59
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Mon, 22 Jan 2018 04:32:01 -0800 (PST)
Received: by ash (sSMTP sendmail emulation); Mon, 22 Jan 2018 19:31:55 +0700
From:   =?UTF-8?q?Nguy=E1=BB=85n=20Th=C3=A1i=20Ng=E1=BB=8Dc=20Duy?= 
        <pclouds@gmail.com>
To:     git@vger.kernel.org
Cc:     =?UTF-8?q?Nguy=E1=BB=85n=20Th=C3=A1i=20Ng=E1=BB=8Dc=20Duy?= 
        <pclouds@gmail.com>
Subject: [PATCH] format-patch: set diffstat width to 70 instead of default 80
Date:   Mon, 22 Jan 2018 19:31:54 +0700
Message-Id: <20180122123154.8301-1-pclouds@gmail.com>
X-Mailer: git-send-email 2.16.0.47.g3d9b0fac3a
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

Patches or cover letters generated by format-patch are meant to be
exchanged as emails, most of the time. And since it's generally agreed
that text in mails should be wrapped around 70 columns or so, make sure
these diffstat follow the convention.

I noticed this when I quoted a diffstat line [1]. Should we do something
like this? diffstat is rarely quoted though so perhaps the stat width
should be something like 75.

t4052 fails but I don't think it's worth fixing until it's clear if it's
worth doing this.

[1] https://public-inbox.org/git/20180122121426.GD5980@ash/T/#u

Signed-off-by: Nguyễn Thái Ngọc Duy <pclouds@gmail.com>
---
 builtin/log.c | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/builtin/log.c b/builtin/log.c
index 14fdf39165..6be79656c5 100644
--- a/builtin/log.c
+++ b/builtin/log.c
@@ -1061,6 +1061,7 @@ static void make_cover_letter(struct rev_info *rev, int use_stdout,
 
 	memcpy(&opts, &rev->diffopt, sizeof(opts));
 	opts.output_format = DIFF_FORMAT_SUMMARY | DIFF_FORMAT_DIFFSTAT;
+	opts.diffopt.stat_width = 70;
 
 	diff_setup_done(&opts);
 
@@ -1611,9 +1612,12 @@ int cmd_format_patch(int argc, const char **argv, const char *prefix)
 		die(_("--check does not make sense"));
 
 	if (!use_patch_format &&
-		(!rev.diffopt.output_format ||
-		 rev.diffopt.output_format == DIFF_FORMAT_PATCH))
+	    (!rev.diffopt.output_format ||
+	     rev.diffopt.output_format == DIFF_FORMAT_PATCH)) {
 		rev.diffopt.output_format = DIFF_FORMAT_DIFFSTAT | DIFF_FORMAT_SUMMARY;
+		if (!rev.diffopt.stat_width)
+			rev.diffopt.stat_width = 70;
+	}
 
 	/* Always generate a patch */
 	rev.diffopt.output_format |= DIFF_FORMAT_PATCH;
-- 
2.16.0.47.g3d9b0fac3a

