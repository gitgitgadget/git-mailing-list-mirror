Return-Path: <SRS0=fhRL=6M=vger.kernel.org=git-owner@kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.3 required=3.0 tests=DKIM_SIGNED,DKIM_VALID,
	HEADER_FROM_DIFFERENT_DOMAINS,MAILING_LIST_MULTI,MENTIONS_GIT_HOSTING,
	SPF_HELO_NONE,SPF_PASS,USER_AGENT_SANE_1 autolearn=ham autolearn_force=no
	version=3.4.0
Received: from mail.kernel.org (mail.kernel.org [198.145.29.99])
	by smtp.lore.kernel.org (Postfix) with ESMTP id DB027C83001
	for <git@archiver.kernel.org>; Tue, 28 Apr 2020 00:28:30 +0000 (UTC)
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.kernel.org (Postfix) with ESMTP id A8DD42072A
	for <git@archiver.kernel.org>; Tue, 28 Apr 2020 00:28:30 +0000 (UTC)
Authentication-Results: mail.kernel.org;
	dkim=pass (2048-bit key) header.d=gemtalksystems-com.20150623.gappssmtp.com header.i=@gemtalksystems-com.20150623.gappssmtp.com header.b="h0WMEEaP"
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726337AbgD1A23 (ORCPT <rfc822;git@archiver.kernel.org>);
        Mon, 27 Apr 2020 20:28:29 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:43464 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-FAIL-OK-FAIL)
        by vger.kernel.org with ESMTP id S1726016AbgD1A23 (ORCPT
        <rfc822;git@vger.kernel.org>); Mon, 27 Apr 2020 20:28:29 -0400
Received: from mail-pl1-x632.google.com (mail-pl1-x632.google.com [IPv6:2607:f8b0:4864:20::632])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 512D3C0610D5
        for <git@vger.kernel.org>; Mon, 27 Apr 2020 17:28:29 -0700 (PDT)
Received: by mail-pl1-x632.google.com with SMTP id s10so7653309plr.1
        for <git@vger.kernel.org>; Mon, 27 Apr 2020 17:28:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gemtalksystems-com.20150623.gappssmtp.com; s=20150623;
        h=to:from:subject:cc:message-id:date:user-agent:mime-version
         :content-transfer-encoding:content-language;
        bh=U8dKgjCVkcUn22BhcqSZeqZtB79VlJBou25JdmTV6Ws=;
        b=h0WMEEaP4C3ky/4nWtx1+H4ygBop3dprUIA4fVGs5tVEHWqZ7G+/oOLWJEeOZ6LX45
         3K5mFaNH7E+6p2zE3Bv5jByoGMzSXZsL8yyf3deVbxLHQO7Lw5XvAMWVzfJH9T0gZsev
         Oc257xS3W4RoceNnQYt5BrBzvXY22eMD7uGYO1wC/nFilUCyUwCK1KxUjcJsz1oAHDGt
         nJB+kei1B9QzvyabQmAdd3nWVthoBeBkNOpwA287UaTOqJNiQ6ImhnoYdiDIkn0qWxXG
         FKcAQApJ27nBhJK1Y9VvJkH8bN8Y90FZSINOHbtSgebjglaxJc55odwXjvOowsi/suhe
         TdXw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:to:from:subject:cc:message-id:date:user-agent
         :mime-version:content-transfer-encoding:content-language;
        bh=U8dKgjCVkcUn22BhcqSZeqZtB79VlJBou25JdmTV6Ws=;
        b=rcLIIBni91Cho5Kv5HVlmvQEoRvXic0xulQyuFEfbvhIT+L7HWOGUn2DdJ93eo8k1u
         Pga5cO5u3V/2Oqy6WbRBDHeWk+zSpDQyPg6SZut1KWD+CaEYMVWw6RGXJAWvtEW2KDzR
         X75QBLveAFvySWzgNMUiiO5nlOu8As3maaF00TGezhUhaKUn92j3HeHleho+JoZci545
         VpA3EdfmmrCcnThGK0rXvTNyrzkbRABXzYtGCeK8x41HVGe5Vw7pIje5rO64Zw9fxeR+
         GRLJzJFHoDvHO9Vad0z3/36dHai/HV7Ob3odbFt5429n5FlU316+LDpQAbd/5mpgbArM
         9t9Q==
X-Gm-Message-State: AGi0PubpvRYblEXCsB37nGFW74bs7qS7s7kKlXSlDqdmc6IjNTTFySfX
        3ZJuIkZvWhnVdWTU+Q56dexDAA==
X-Google-Smtp-Source: APiQypIomVFt4Dmfo5bTNOO3gAIxfK/pdwN6se1y0DsJUrou/Ti/wRsiv6wiknxqEziNZ67hjP4T+A==
X-Received: by 2002:a17:90a:343:: with SMTP id 3mr1658964pjf.178.1588033708562;
        Mon, 27 Apr 2020 17:28:28 -0700 (PDT)
Received: from [10.94.156.50] (gateway.gemtalksystems.com. [50.234.234.161])
        by smtp.gmail.com with ESMTPSA id n23sm399457pjq.18.2020.04.27.17.28.27
        (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
        Mon, 27 Apr 2020 17:28:28 -0700 (PDT)
To:     git@vger.kernel.org
From:   Dale Henrichs <dale.henrichs@gemtalksystems.com>
Subject: all memory consuming `git diff-tree` bug
Cc:     Kurt Kilpela <kurt.kilpela@gemtalksystems.com>
Message-ID: <5e00fe77-3f72-0729-2b30-9f4f98a28b1c@gemtalksystems.com>
Date:   Mon, 27 Apr 2020 17:28:26 -0700
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101
 Thunderbird/68.7.0
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8; format=flowed
Content-Transfer-Encoding: 7bit
Content-Language: en-US
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

When I execute the follow set of commands, the `git diff-tree` command 
will go on to consume all 30G of ram and then 30G of swap on a system 
running Ubuntu 18.04.

git clone git@github.com:GemTalk/Rowan.git
cd Rowan
git checkout c70f69b50dc90c0a6207a5aa36705b71b59b92b3
git diff-tree -r -p --textconv --submodule -C --cc --no-commit-id -U3 
--root c70f69b50dc90c0a6207a5aa36705b71b59b92b3

I'm running git 2.26.2 (built from source). The git command line was 
generated by gitk. It originally showed up in 2.17.1, but reproduced in 
the latest version of git.

Clicking nearby commits (ccffec29f977f9324e8120bf550c745189e76f70 and 
8b08cec96bbb74b54046abbdb49a5bbd2f82fc3b finish almost immediately, so 
there seems to be something special about that particular commit.

Dale



