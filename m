Return-Path: <git-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on dcvr.yhbt.net
X-Spam-Level: 
X-Spam-ASN: AS31976 209.132.180.0/23
X-Spam-Status: No, score=-2.8 required=3.0 tests=AWL,BAYES_00,
	FREEMAIL_FORGED_FROMDOMAIN,FREEMAIL_FROM,HEADER_FROM_DIFFERENT_DOMAINS,
	RCVD_IN_DNSWL_HI,T_RP_MATCHES_RCVD shortcircuit=no autolearn=no
	autolearn_force=no version=3.4.0
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by dcvr.yhbt.net (Postfix) with ESMTP id C66A51F406
	for <e@80x24.org>; Mon, 15 Jan 2018 17:11:30 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S965699AbeAORKn (ORCPT <rfc822;e@80x24.org>);
        Mon, 15 Jan 2018 12:10:43 -0500
Received: from mout.web.de ([217.72.192.78]:52994 "EHLO mout.web.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S965797AbeAORKk (ORCPT <rfc822;git@vger.kernel.org>);
        Mon, 15 Jan 2018 12:10:40 -0500
Received: from [192.168.178.36] ([91.20.48.24]) by smtp.web.de (mrweb102
 [213.165.67.124]) with ESMTPSA (Nemesis) id 0MS290-1eQaiR1ALq-00TFSJ; Mon, 15
 Jan 2018 18:10:33 +0100
X-Mozilla-News-Host: news://news.public-inbox.org:119
To:     Git List <git@vger.kernel.org>
Cc:     Junio C Hamano <gitster@pobox.com>,
        Stefan Beller <sbeller@google.com>
From:   =?UTF-8?Q?Ren=c3=a9_Scharfe?= <l.s.r@web.de>
Subject: [PATCH] describe: use strbuf_add_unique_abbrev() for adding short
 hashes
Message-ID: <422ae05b-6541-38f3-7638-4bee1b766d91@web.de>
Date:   Mon, 15 Jan 2018 18:10:32 +0100
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0) Gecko/20100101
 Thunderbird/52.5.2
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
Content-Transfer-Encoding: 7bit
X-Provags-ID: V03:K0:T+1iIwtgcO3kbd/GWYzZ8owp/1oSsTaBxbktocBIRLbm0tacySL
 gREdjj5hgQT34DfNZgZeQ25w1zpp1WEbaId3/pStO9vhAeu49CLPen7LCkmlfjh1Id++iN4
 cOPDqwzZF/NAHv431Ud61vqeFhphoqVOqsGQQQJBzWeyFoGxtLHPQta7oS2dD6AqW66XeEI
 +RJb8aI7Ma7/15I8C21CA==
X-UI-Out-Filterresults: notjunk:1;V01:K0:zTJfciEG9Kg=:+3AFEt98aGVLhix9zHMSED
 MhT+Q0PYv6tyzaBf5OFGqawAOfyFuVzD1Gb7f/TgbK8ruzRxHnYQxq+n8h5f7oNbp1SqRIIyV
 dE8dBzsZaXlXQJsNy15tji35hhcEwIjB6fal6tqHrnjlD5lVRe8x3kHfo3zUW1rQZ7vVIu7Jj
 2RDCN0qXJY0gMpSdMFbQsdPISQZtnIaYuCI1zWPuUw4pBoLCjKgUgIJYAJH7Mourhp0R/m4iJ
 6zXBQ7LQFQnNFc7Jb3bsYGo3Ce1MLaLXnwf35n7D9wko0N0IXMxn/fc1Ct4KWyZn39h5ZRGSf
 NQZ9Lx0pVTF6RpJHwZ6jq7iJOknQ0WYohyOt+GoKhAMYkaWchpbqz9Gd78BKPsDj8rAMDCCom
 BY0bdvnfjXjasRPdglC2SdrPYiWuvC7XfflYkGWZwZm/yLssQm4s5RpN1lly/iFufVHEVhywX
 Man6JH3wrLxcNyhi1VwYE5FBeGyVZ2CbK4vNgyctbFwxVRz5G/XHd8mVHwCOTDWT8bTbGu5sK
 LJzA3k3D8oHhQj1vMCGE7sChhlXbpYYL9jqNQOqA4f0ZHzGuXuomVF11NIEC/xOSZGIF+k32q
 qCjVHa0PC8DUZVjZOD6Ln2hkgnkAICz8KWfS9a46z8Szc7oUTQQybxl4CdxNkW4w7e36tvMUL
 zmoaeXDWIM8kNQiHpAuVs9Z+yL9OhpUJ3sf2ugB0V3SEE0cMPv0ETSAD/QLYV0HQ3zTNKCPct
 lRlsnPKiIqeZgwE+6GXP/iX7VcmXEDTN2iKDUJoAf0Mx8qGoU+RN7Il419O5ZQ+hVOH4vpxit
 quLHsu8olAUNXB2fLt9wZ10w6dvrSPDozMu0bYkNnJ9AIWT7qk=
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

Call strbuf_add_unique_abbrev() to add an abbreviated hash to a strbuf
instead of taking a detour through find_unique_abbrev() and its static
buffer.  This is shorter and a bit more efficient.

Patch generated by Coccinelle (and contrib/coccinelle/strbuf.cocci).

Signed-off-by: Rene Scharfe <l.s.r@web.de>
---
The changed line was added by 4dbc59a4cc (builtin/describe.c: factor
out describe_commit).

"make coccicheck" doesn't propose any other changes for current master.

 builtin/describe.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/builtin/describe.c b/builtin/describe.c
index 3b0b204b1e..21e37f5dae 100644
--- a/builtin/describe.c
+++ b/builtin/describe.c
@@ -380,7 +380,7 @@ static void describe_commit(struct object_id *oid, struct strbuf *dst)
 	if (!match_cnt) {
 		struct object_id *cmit_oid = &cmit->object.oid;
 		if (always) {
-			strbuf_addstr(dst, find_unique_abbrev(cmit_oid->hash, abbrev));
+			strbuf_add_unique_abbrev(dst, cmit_oid->hash, abbrev);
 			if (suffix)
 				strbuf_addstr(dst, suffix);
 			return;
-- 
2.15.1
