From: Carl Worth <cworth@cworth.org>
Subject: Re: Merging commits together into a super-commit
Date: Thu, 10 May 2007 11:30:37 -0700
Message-ID: <87vef0350y.wl%cworth@cworth.org>
References: <1178794261.5806.98.camel@murta.transitives.com>
	<4643049C.3D5F30D8@eudaptics.com>
	<alpine.LFD.0.98.0705100857450.3986@woody.linux-foundation.org>
	<87wszg39cp.wl%cworth@cworth.org>
	<20070510171457.GK13719@fieldses.org>
Mime-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: multipart/signed;
 boundary="pgp-sign-Multipart_Thu_May_10_11:30:30_2007-1"; micalg=pgp-sha1;
 protocol="application/pgp-signature"
Content-Transfer-Encoding: 7bit
Cc: Linus Torvalds <torvalds@linux-foundation.org>,
	Johannes Sixt <J.Sixt@eudaptics.com>, git@vger.kernel.org
To: "J. Bruce Fields" <bfields@fieldses.org>
X-From: git-owner@vger.kernel.org Thu May 10 20:30:56 2007
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git@gmane.org
Received: from vger.kernel.org ([209.132.176.167])
	by lo.gmane.org with esmtp (Exim 4.50)
	id 1HmDPk-0000H7-AL
	for gcvg-git@gmane.org; Thu, 10 May 2007 20:30:56 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1756697AbXEJSaw (ORCPT <rfc822;gcvg-git@m.gmane.org>);
	Thu, 10 May 2007 14:30:52 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1751042AbXEJSav
	(ORCPT <rfc822;git-outgoing>); Thu, 10 May 2007 14:30:51 -0400
Received: from theworths.org ([217.160.253.102]:41843 "EHLO theworths.org"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S1755318AbXEJSav (ORCPT <rfc822;git@vger.kernel.org>);
	Thu, 10 May 2007 14:30:51 -0400
Received: (qmail 23421 invoked from network); 10 May 2007 14:30:37 -0400
Received: from localhost (HELO raht.cworth.org) (127.0.0.1)
  by localhost with SMTP; 10 May 2007 14:30:37 -0400
In-Reply-To: <20070510171457.GK13719@fieldses.org>
User-Agent: Wanderlust/2.14.0 (Africa) Emacs/21.4 Mule/5.0 (SAKAKI)
Sender: git-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/46885>

--pgp-sign-Multipart_Thu_May_10_11:30:30_2007-1
Content-Type: text/plain; charset=US-ASCII

On Thu, 10 May 2007 13:14:57 -0400, "J. Bruce Fields" wrote:
> I use it all the time to fix up old commits with
>
> 	git checkout sha1-of-bad-commit
> 	...edit, test,...
> 	git commit -a ---amend
> 	git rebase --onto HEAD sha1-of-bad-commit original-branch

Excellent. Thanks for the description.

Fixing up some broken (unpublished) commit in the past is a useful
thing to support[*]. Of course, "commit --amend" takes care of this for
the case where it's the most recent commit. For an older commit, here
is exactly what I'd like to do, (showing that my suggestion of
cherry-pick with a range would cover exactly this scenario):

	git tag tainted		# Could be "git branch tainted" just as well

	git reset --hard bad-commit
	...edit, test...
	git commit --amend
	git cherry-pick bad-commit..tainted

	git tag -d tainted

So, compared to the rebase usage, this does add two commands for
bookkeeping the original state and cleaning it up. But the syntax for
the cherry-pick part is quite a bit simpler than the original rebase
at least.

Also, "reset --hard" isn't actually what I want in this case. I'd like
this recipe to use something that would move the current branch to
some other point, but in a safe way, (that is, not destroy any
uncommitted changes that might exist at the beginning). I don't have
any proposal for what that would be.

-Carl

[*] I've also experimented with using other "non-core git" ways of
addressing this same problem. Here are a couple that I haven't found
satisfactory for this particular use case:

stg - This probably works great if you're using it as a primary
      interface. But trying to use it as a quick one-off when
      generally using core git does not work well at all. Instead of
      the two "git tag" commands in my recipe above, an stg recipe
      would involve a lot of additional bookkeeping with stg init, stg
      uncommit [N times for fixing a commit N steps back in the
      history], stg goto, stg push, etc.

cg-admin-rewritehist - This is a powerful tool, but its interface
      isn't geared toward interactively fixing things up, (instead
      requiring a filter to be executed at all steps). So, while it's
      great for changing history, (as its name suggests), such as
      performing a sed operation on the commit messages, or
      eliminating a file, it doesn't help much with the "fix up one
      broken commit in the past".

      It is worth noting that quite unlike rebase,
      cg-admin-rewritehist can deal quite nicely with history that
      involves branching and merging.


--pgp-sign-Multipart_Thu_May_10_11:30:30_2007-1
Content-Type: application/pgp-signature
Content-Transfer-Encoding: 7bit

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQBGQ2TN6JDdNq8qSWgRAnGUAJ4liwYAVSsUy5lxCW0uPuGBlgEnFwCeITZ4
nj+3ioORG4QtEZmUmJoRlsg=
=iby5
-----END PGP SIGNATURE-----

--pgp-sign-Multipart_Thu_May_10_11:30:30_2007-1--
