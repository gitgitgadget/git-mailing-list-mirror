Return-Path: <git-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by smtp.lore.kernel.org (Postfix) with ESMTP id 4BF81CD8CAE
	for <git@archiver.kernel.org>; Tue, 10 Oct 2023 17:49:36 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S233489AbjJJRtf convert rfc822-to-8bit (ORCPT
        <rfc822;git@archiver.kernel.org>); Tue, 10 Oct 2023 13:49:35 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:54856 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S231130AbjJJRte (ORCPT <rfc822;git@vger.kernel.org>);
        Tue, 10 Oct 2023 13:49:34 -0400
Received: from mail-qv1-f44.google.com (mail-qv1-f44.google.com [209.85.219.44])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id AD17B99
        for <git@vger.kernel.org>; Tue, 10 Oct 2023 10:49:32 -0700 (PDT)
Received: by mail-qv1-f44.google.com with SMTP id 6a1803df08f44-65b0c9fb673so31772246d6.1
        for <git@vger.kernel.org>; Tue, 10 Oct 2023 10:49:32 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1696960172; x=1697564972;
        h=content-transfer-encoding:cc:to:subject:message-id:date:from
         :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
         :subject:date:message-id:reply-to;
        bh=Txc5VTQ7EtPqvmYXfHF+/0LkoW+uuxnenJR+xgP3N/s=;
        b=dThfcu/HsgZqIUo6JsyS0kX4+9rw8idCEQJ3UTYPETAwJSY5iaWxfcNBzoTiZCc9GJ
         vdCGOYT+Bmh+ouvGxU6M5CjSQXgxAAeCuFthM4mmjtp6L7GpLa4FiU1WfROVyitvuLt1
         f3VmmrZX1s+vysDs7EOncULHWhayfzs6uJWKDCnmDP806LxBpwzDtdPzkKDTuGrlJ9YE
         EniuC8vShMer+D/k2/tExoT6f4J7XWwXUGGjYkVS2eQ28Z/++YFUR27dPWFBPg4ZbYgO
         UXR0wJmBqMMBtxpppcdVJujfVgfDRvdFqT4VesijYDRTYv5VmwfQhw21q3+h/Ic1ZUQK
         DAcg==
X-Gm-Message-State: AOJu0YxkzFYe2xLYhALTDbhXhTaWQ0dWeQoH9JQA2WOL8xg/BfnU7BcF
        +Unes2fA//nehTMG78fEqaP4tloMrp2nUrGSbME43S2KvNE=
X-Google-Smtp-Source: AGHT+IEhhEf7Wq8U39Jl3NOa8XVlJo11VVpFuIKgmJvAFc5iDOunTxA9AJx5JhMzshno+J/BssjEK836PJYDm1Ik+RU=
X-Received: by 2002:ad4:4527:0:b0:65a:f67e:13a5 with SMTP id
 l7-20020ad44527000000b0065af67e13a5mr17980679qvu.59.1696960171756; Tue, 10
 Oct 2023 10:49:31 -0700 (PDT)
MIME-Version: 1.0
References: <985ac850eb6e60ae76601acc8bfbcd56f99348b4.1696935657.git.ps@pks.im>
In-Reply-To: <985ac850eb6e60ae76601acc8bfbcd56f99348b4.1696935657.git.ps@pks.im>
From:   Eric Sunshine <sunshine@sunshineco.com>
Date:   Tue, 10 Oct 2023 13:49:20 -0400
Message-ID: <CAPig+cTK4=w0+DnS025WbBDmV_wX-v3UkpcmEPhgSq6+-iaqJg@mail.gmail.com>
Subject: Re: [PATCH] doc/git-worktree: mention "refs/rewritten" as
 per-worktree refs
To:     Patrick Steinhardt <ps@pks.im>
Cc:     git@vger.kernel.org,
        Johannes Schindelin <Johannes.Schindelin@gmx.de>
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8BIT
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

On Tue, Oct 10, 2023 at 7:01â€¯AM Patrick Steinhardt <ps@pks.im> wrote:
> Some references are special in the context of worktrees as they are
> considered to be per-worktree instead of shared across all of the
> worktrees. Most importantly, this includes "refs/worktree/" that have
> explicitly been designed such that users can create per-woorktree refs.

s/woorktree/worktree/

> But there are also special references that have an associated meaning
> like "refs/bisect/", which is used to track state of git-bisect(1).
>
> These special per-worktree references are documented in git-worktree(1),
> but one instance is missing. In a9be29c9817 (sequencer: make refs
> generated by the `label` command worktree-local, 2018-04-25), we have
> converted "refs/rewritten/" to be a per-worktree reference as well.
> These references are used by our sequencer infrastructure to generate
> labels for rebased commits. So in order to allow for multiple concurrent
> rebases to happen in different worktrees, these references need to be
> tracked per worktree.
>
> We forgot to update our documentation to mention these new per-worktree
> references, which is fixed by this patch.
>
> Signed-off-by: Patrick Steinhardt <ps@pks.im>
> ---
> diff --git a/Documentation/git-worktree.txt b/Documentation/git-worktree.txt
> @@ -286,7 +286,8 @@ rules and how to access refs of one worktree from another.
>  In general, all pseudo refs are per-worktree and all refs starting with
>  `refs/` are shared. Pseudo refs are ones like `HEAD` which are directly
>  under `$GIT_DIR` instead of inside `$GIT_DIR/refs`. There are exceptions,
> -however: refs inside `refs/bisect` and `refs/worktree` are not shared.
> +however: refs inside `refs/bisect`, `refs/worktree` and `refs/rewritten` are
> +not shared.

To simplify future maintenance, eventually we might want to turn this
into a bulleted list, but that doesn't necessarily have to be done by
this patch, which is fine as-is.

> @@ -363,8 +364,8 @@ linked worktree `git rev-parse --git-path HEAD` returns
>  `$GIT_COMMON_DIR` and returns `/path/main/.git/refs/heads/master`,
> -since refs are shared across all worktrees, except `refs/bisect` and
> -`refs/worktree`.
> +since refs are shared across all worktrees, except `refs/bisect`,
> +`refs/worktree` and `refs/rewritten`.

Ditto.
