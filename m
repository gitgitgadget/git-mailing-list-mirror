From: Junio C Hamano <gitster@pobox.com>
Subject: Re: Shell script cleanups/style changes?
Date: Thu, 02 Aug 2007 13:37:10 -0700
Message-ID: <7vlkctvfk9.fsf@assigned-by-dhcp.cox.net>
References: <86bqdqkygp.fsf@lola.quinscape.zz>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: git@vger.kernel.org
To: David Kastrup <dak@gnu.org>
X-From: git-owner@vger.kernel.org Thu Aug 02 22:37:19 2007
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git@gmane.org
Received: from vger.kernel.org ([209.132.176.167])
	by lo.gmane.org with esmtp (Exim 4.50)
	id 1IGhQ6-0004k7-9i
	for gcvg-git@gmane.org; Thu, 02 Aug 2007 22:37:19 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1751525AbXHBUhP (ORCPT <rfc822;gcvg-git@m.gmane.org>);
	Thu, 2 Aug 2007 16:37:15 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1751456AbXHBUhP
	(ORCPT <rfc822;git-outgoing>); Thu, 2 Aug 2007 16:37:15 -0400
Received: from fed1rmmtao106.cox.net ([68.230.241.40]:63867 "EHLO
	fed1rmmtao106.cox.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1751433AbXHBUhO (ORCPT <rfc822;git@vger.kernel.org>);
	Thu, 2 Aug 2007 16:37:14 -0400
Received: from fed1rmimpo01.cox.net ([70.169.32.71])
          by fed1rmmtao106.cox.net
          (InterMail vM.7.08.02.01 201-2186-121-102-20070209) with ESMTP
          id <20070802203711.TXRW11888.fed1rmmtao106.cox.net@fed1rmimpo01.cox.net>;
          Thu, 2 Aug 2007 16:37:11 -0400
Received: from assigned-by-dhcp.cox.net ([68.5.247.80])
	by fed1rmimpo01.cox.net with bizsmtp
	id X8dA1X00L1kojtg0000000; Thu, 02 Aug 2007 16:37:11 -0400
In-Reply-To: <86bqdqkygp.fsf@lola.quinscape.zz> (David Kastrup's message of
	"Thu, 02 Aug 2007 12:44:22 +0200")
User-Agent: Gnus/5.110006 (No Gnus v0.6) Emacs/21.4 (gnu/linux)
Sender: git-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/54603>

David Kastrup <dak@gnu.org> writes:

> Hi, I wanted to ask what the general stance towards shell script
> cleanups and simplifications would be.  For example, I find the expr
> usage quite inscrutable in commit, and there is no necessity of
> putting "shift" in every case branch instead of once behind it, and a
> lot of conditionals and other manipulations can be made much easier on
> the eye by using parameter expansion patterns that are, as far as I
> can see, available with every reasonable Bourne Shell and clones.

The shift in parameter parsing case arms were originally
generated by an automated tool.  If it bothers you, feel free to
move them at the end, I would not mind.  In fact, handcrafted
parameter parser in other scripts do use shift-at-the-end.

As to Bourne-ness of the shell script, please realize that your
maintainer is very old fashioned ;-), but is willing to be
taught new tricks within reason.

We try to limit ourselves to -, =, ?, + (and their colon "if
empty" variants when it really make sense) in parameter
expansion of shell variables.  We also use % and # (and their
"match largest" variants).

Non POSIX substitions such as ${parameter/pattern/string} and
${parameter:offset} are not to be used.  We do not want to
depend on bash.

We try to avoid [ ] and instead spell "test" explicitly; this is
just a personal taste, and not about portability but more about
readability.

After 1.5.3 git-commit.sh will hopefully become built-in, so I
would rather not touch the script.  Certainly, the kind of
change that is "intended to be style-only but somebody needs to
make sure it does not introduce regression to everybody's shell"
is very unwelcome at this point.
