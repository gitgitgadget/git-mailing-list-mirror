From: Lars Hjemli <hjemli@gmail.com>
Subject: Re: git clone http://git.savannah.gnu.org/cgit/xboard.git segfaults
Date: Mon, 17 Aug 2009 16:40:45 +0200
Message-ID: <8c5c35580908170740j388befferef61113460fe1e74@mail.gmail.com>
References: <20090817135651.GA4570@harikalardiyari>
Mime-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit
Cc: git@vger.kernel.org
To: Ali Polatel <polatel@gmail.com>
X-From: git-owner@vger.kernel.org Mon Aug 17 16:41:09 2009
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git-2@lo.gmane.org
Received: from vger.kernel.org ([209.132.176.167])
	by lo.gmane.org with esmtp (Exim 4.50)
	id 1Md3OI-0002Qo-0t
	for gcvg-git-2@lo.gmane.org; Mon, 17 Aug 2009 16:40:54 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1755142AbZHQOkp (ORCPT <rfc822;gcvg-git-2@m.gmane.org>);
	Mon, 17 Aug 2009 10:40:45 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1754868AbZHQOkp
	(ORCPT <rfc822;git-outgoing>); Mon, 17 Aug 2009 10:40:45 -0400
Received: from mail-yx0-f175.google.com ([209.85.210.175]:64640 "EHLO
	mail-yx0-f175.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1754862AbZHQOko (ORCPT <rfc822;git@vger.kernel.org>);
	Mon, 17 Aug 2009 10:40:44 -0400
Received: by yxe5 with SMTP id 5so3634189yxe.33
        for <git@vger.kernel.org>; Mon, 17 Aug 2009 07:40:45 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:cc:content-type
         :content-transfer-encoding;
        bh=iDYsTMJ2crubIYwn18cFbv56nifFiq/vZoF7uoj5q2A=;
        b=wFAGr18l4779i8KZIDs+0KC6sE74bLFyThZAWpFZYi+u8UY8w8Gj6HaBNf4YYkMCAl
         aYXBxRXX0V41FEpZMrz7lJsQWRDC8KSWSSg9vpI/rhX4IVV9CkWa1V5fh4GDQlTA6Wyz
         lQNBYLlGQUNYZPheWdVBJo8vdKpsfAb5OsWJc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :cc:content-type:content-transfer-encoding;
        b=Kj0YgzHdGxeXLYPs1YDbAe+2+nZ/mbOiMe8qawjRZO5tZDsrBbNKjuJlzPyt57VVan
         N4KUwWPOjER0PF7a3EOm/woCL7b2gH2L2n2trmipPMT1eHsz92BY/a2U66tBuDX2JUUi
         8mmvkxFeZxaDGdbvV6wprdPLWgToXiuDXKaVM=
Received: by 10.150.2.2 with SMTP id 2mr5676752ybb.16.1250520045623; Mon, 17 
	Aug 2009 07:40:45 -0700 (PDT)
In-Reply-To: <20090817135651.GA4570@harikalardiyari>
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/126188>

On Mon, Aug 17, 2009 at 15:56, Ali Polatel<polatel@gmail.com> wrote:
> $subject.
> git version 1.6.4
>
> Here's what gdb has to say about it:
>
> 2456 alip@harikalardiyari> gdb --args git clone http://git.savannah.gnu.org/cgit/xboard.git
>...
> Getting pack 06483273097cbac210f10a4bd43324ae660053e6
>  which contains 74e24bdc2ec3f275da63ca1396a773e7043cb9e9
>
> Program received signal SIGSEGV, Segmentation fault.

This is the http clone interface generated by cgit, and a quick test
gives me an identical segfault, while `git clone
http://git.sv.gnu.org/r/xboard.git` succeeds. I can only guess, but
maybe this has something to do with caching in cgit:

$ curl http://git.savannah.gnu.org/cgit/xboard.git/objects/info/packs
P pack-720d634dfc5e7511332c1e6851f7c5c5f88e7af2.pack
P pack-06483273097cbac210f10a4bd43324ae660053e6.pack
P pack-a0a25c7cc57128b5317e0b5e7b8de7a59afe9af6.pack

$ curl http://git.savannah.gnu.org/cgit/xboard.git/objects/pack/pack-720d634dfc5e7511332c1e6851f7c5c5f88e7af2.pack
>pack-720d634dfc5e7511332c1e6851f7c5c5f88e7af2.pack

$ curl http://git.savannah.gnu.org/cgit/xboard.git/objects/pack/pack-720d634dfc5e7511332c1e6851f7c5c5f88e7af2.idx
>pack-720d634dfc5e7511332c1e6851f7c5c5f88e7af2.idx

$ git verify-pack -v pack-720d634dfc5e7511332c1e6851f7c5c5f88e7af2.pack
[snip]
non delta: 115 objects
chain length = 1: 64 objects
chain length = 2: 57 objects
chain length = 3: 16 objects
chain length = 4: 10 objects
chain length = 5: 7 objects
chain length = 6: 1 object
pack-720d634dfc5e7511332c1e6851f7c5c5f88e7af2.pack: ok

$ curl http://git.savannah.gnu.org/cgit/xboard.git/objects/pack/pack-06483273097cbac210f10a4bd43324ae660053e6.pack
>pack-06483273097cbac210f10a4bd43324ae660053e6.pack

$ curl http://git.savannah.gnu.org/cgit/xboard.git/objects/pack/pack-06483273097cbac210f10a4bd43324ae660053e6.idx
>pack-06483273097cbac210f10a4bd43324ae660053e6.idx

$ git verify-pack -v pack-06483273097cbac210f10a4bd43324ae660053e6.pack
[snip]
74e24bdc2ec3f275da63ca1396a773e7043cb9e9 blob   921 286 12694
[snip]
non delta: 233 objects
chain length = 1: 86 objects
chain length = 2: 74 objects
chain length = 3: 47 objects
chain length = 4: 8 objects
chain length = 5: 5 objects
chain length = 6: 1 object
pack-06483273097cbac210f10a4bd43324ae660053e6.pack: ok


$ curl http://git.savannah.gnu.org/cgit/xboard.git/objects/pack/pack-a0a25c7cc57128b5317e0b5e7b8de7a59afe9af6.pack
>pack-a0a25c7cc57128b5317e0b5e7b8de7a59afe9af6.pack

$ curl http://git.savannah.gnu.org/cgit/xboard.git/objects/pack/pack-a0a25c7cc57128b5317e0b5e7b8de7a59afe9af6.idx
>pack-a0a25c7cc57128b5317e0b5e7b8de7a59afe9af6.idx

$ git verify-pack -v pack-a0a25c7cc57128b5317e0b5e7b8de7a59afe9af6.pack
[snip]
non delta: 1139 objects
chain length = 1: 454 objects
chain length = 2: 349 objects
chain length = 3: 301 objects
chain length = 4: 235 objects
chain length = 5: 179 objects
chain length = 6: 96 objects
chain length = 7: 52 objects
chain length = 8: 37 objects
chain length = 9: 21 objects
chain length = 10: 6 objects
chain length = 11: 5 objects
chain length = 12: 1 object
chain length = 13: 2 objects
chain length = 14: 1 object
chain length = 15: 2 objects
chain length = 16: 1 object
chain length = 17: 1 object
chain length = 18: 2 objects
chain length = 19: 1 object
chain length = 20: 1 object
chain length = 21: 1 object
chain length = 22: 1 object
chain length = 23: 2 objects
chain length = 24: 2 objects
chain length = 25: 1 object
chain length = 26: 1 object
chain length = 27: 1 object
chain length = 28: 1 object
chain length = 29: 1 object
chain length = 30: 1 object
chain length = 31: 1 object
chain length = 32: 1 object
chain length = 33: 2 objects
chain length = 34: 3 objects
chain length = 35: 2 objects
chain length = 36: 1 object
chain length = 37: 1 object
chain length = 38: 1 object
chain length = 39: 2 objects
chain length = 40: 3 objects
chain length = 41: 1 object
chain length = 42: 2 objects
chain length = 43: 1 object
chain length = 44: 1 object
chain length = 45: 2 objects
chain length = 46: 1 object
pack-a0a25c7cc57128b5317e0b5e7b8de7a59afe9af6.pack: ok

Hmm, the packs looks ok so maybe the problem is related to our usage
of libcurl after all...

--
larsh
