From: Linus Torvalds <torvalds@linux-foundation.org>
Subject: git-send-pack SIGSEGV..
Date: Thu, 14 Jun 2007 21:29:46 -0700 (PDT)
Message-ID: <alpine.LFD.0.98.0706142124380.14121@woody.linux-foundation.org>
Mime-Version: 1.0
Content-Type: TEXT/PLAIN; charset=us-ascii
To: Git Mailing List <git@vger.kernel.org>,
	Junio C Hamano <junkio@cox.net>,
	Daniel Barkalow <barkalow@iabervon.org>
X-From: git-owner@vger.kernel.org Fri Jun 15 06:30:13 2007
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git@gmane.org
Received: from vger.kernel.org ([209.132.176.167])
	by lo.gmane.org with esmtp (Exim 4.50)
	id 1Hz3Rp-0004TD-7S
	for gcvg-git@gmane.org; Fri, 15 Jun 2007 06:30:09 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1750787AbXFOE36 (ORCPT <rfc822;gcvg-git@m.gmane.org>);
	Fri, 15 Jun 2007 00:29:58 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1750779AbXFOE35
	(ORCPT <rfc822;git-outgoing>); Fri, 15 Jun 2007 00:29:57 -0400
Received: from smtp2.linux-foundation.org ([207.189.120.14]:58903 "EHLO
	smtp2.linux-foundation.org" rhost-flags-OK-OK-OK-OK)
	by vger.kernel.org with ESMTP id S1750737AbXFOE35 (ORCPT
	<rfc822;git@vger.kernel.org>); Fri, 15 Jun 2007 00:29:57 -0400
Received: from imap1.linux-foundation.org (imap1.linux-foundation.org [207.189.120.55])
	by smtp2.linux-foundation.org (8.13.5.20060308/8.13.5/Debian-3ubuntu1.1) with ESMTP id l5F4TpRI030391
	(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=NO);
	Thu, 14 Jun 2007 21:29:52 -0700
Received: from localhost (localhost [127.0.0.1])
	by imap1.linux-foundation.org (8.13.5.20060308/8.13.5/Debian-3ubuntu1.1) with ESMTP id l5F4Tk5S011115;
	Thu, 14 Jun 2007 21:29:46 -0700
X-Spam-Status: No, hits=-2.561 required=5 tests=AWL,BAYES_00
X-Spam-Checker-Version: SpamAssassin 3.1.0-osdl_revision__1.12__
X-MIMEDefang-Filter: osdl$Revision: 1.181 $
X-Scanned-By: MIMEDefang 2.53 on 207.189.120.14
Sender: git-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/50240>


I haevn't had time to debug this at all, but

	git push --tags all

actually SIGSEGV's for me on the git repository. "all" is just a shorthand 
for the two repos I push my git repo to (so that I have it on some other 
machines too)

	[remote "all"]
		url = master.kernel.org:git
		url = login.linux-foundation.org:git.git

Without any real debugging at all, here's what I get:

	error: failed to push to 'master.kernel.org:git'
	error: send-pack died with strange error
	fatal: The remote end hung up unexpectedly
	error: failed to push to 'login.linux-foundation.org:git.git'
	error: send-pack died with strange error
	fatal: The remote end hung up unexpectedly

and a few core-files. The core-files look like so:

	Core was generated by `/home/torvalds/bin/git-send-pack --remote=all --thin master.kernel.org git refs'.
	Program terminated with signal 11, Segmentation fault.
	#0  0x0000003959477180 in strlen () from /lib64/libc.so.6
	(gdb) where
	#0  0x0000003959477180 in strlen () from /lib64/libc.so.6
	#1  0x000000000041cebe in match_refs (src=0x64b540, dst=<value optimized out>, dst_tail=0x62c890, nr_refspec=1, refspec=<value optimized out>, all=0) at remote.c:539
	#2  0x0000000000402e46 in main (argc=<value optimized out>, argv=0x7fffab2657a8) at send-pack.c:202

but I'm about to put the kids to bed, and I doubt I'll get to debug this 
before tomorrow. So I thought I'd send this out to Junio, Daniel and the 
list, in case somebody else gets to it first.

I *suspect* it's due to the refspec pattern matching changes Daniel did, 
but again - I haven't actually debugged it any deeper.

			Linus
