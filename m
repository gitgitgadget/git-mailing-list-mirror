From: Carl Worth <cworth@cworth.org>
Subject: [PATCH] Don't propagate SKIPPED warning to future commits.
Date: Fri, 10 Feb 2006 17:41:28 -0800
Message-ID: <87r76avfhz.wl%cworth@cworth.org>
Mime-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
X-From: git-owner@vger.kernel.org Sat Feb 11 02:42:29 2006
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git@gmane.org
Received: from vger.kernel.org ([209.132.176.167])
	by ciao.gmane.org with esmtp (Exim 4.43)
	id 1F7jmP-00053r-2R
	for gcvg-git@gmane.org; Sat, 11 Feb 2006 02:42:29 +0100
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1750725AbWBKBmY (ORCPT <rfc822;gcvg-git@m.gmane.org>);
	Fri, 10 Feb 2006 20:42:24 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1750762AbWBKBmY
	(ORCPT <rfc822;git-outgoing>); Fri, 10 Feb 2006 20:42:24 -0500
Received: from theworths.org ([217.160.253.102]:27052 "EHLO theworths.org")
	by vger.kernel.org with ESMTP id S1750725AbWBKBmY (ORCPT
	<rfc822;git@vger.kernel.org>); Fri, 10 Feb 2006 20:42:24 -0500
Received: (qmail 24884 invoked from network); 10 Feb 2006 20:42:21 -0500
Received: from localhost (HELO raht.localdomain) (127.0.0.1)
  by localhost with SMTP; 10 Feb 2006 20:42:21 -0500
To: git@vger.kernel.org
User-Agent: Wanderlust/2.14.0 (Africa) Emacs/21.4 Mule/5.0 (SAKAKI)
Sender: git-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/15913>

Here's a simple bug fix for the (currently undocumented) -S flag to
git-cvsimport.

The -S flag allows an import to proceed in the face of a missing ,v
file in the CVS repository. It marks this by adding a SKIPPED warning
in the relevant commit.

Without this patch, the SKIPPED warning propagates to all future
commits, (and accumulates with future SKIPPED warnings).

Martin did the original work on -S to fix an import of the cairo
repository.

However, I just discovered that a correct fix for the cairo import
problem was for me to just "rm -rf ~/.cvsps". (I suppose calling with
a -x option would have worked too.)

I don't know how common it is for CVS repositories to change in ways
such that the cvsps cache gets totally confused as in my case, but it
might be worth adding something to cvsimport to help this. Some
options could be:

 * Use cvsps -x always, to ignore the cache.

 * Warn the user, (perhaps emit some description of stale cache
   possibility if the import fails?).

 * Add a note to the documentation.

Signed-off-by: Carl Worth <cworth@cworth.org>

---

 git-cvsimport.perl |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

c816d743a1faf65fb209273a471b15c7b51b55df
diff --git a/git-cvsimport.perl b/git-cvsimport.perl
index 6b63aa2..25db0ed 100755
--- a/git-cvsimport.perl
+++ b/git-cvsimport.perl
@@ -749,6 +749,7 @@ my $commit = sub {
 	if (@skipped) {
 	    $logmsg .= "\n\n\nSKIPPED:\n\t";
 	    $logmsg .= join("\n\t", @skipped) . "\n";
+	    @skipped = ();
 	}
 
 	print $pw "$logmsg\n"
-- 
1.1.6.g9da5
