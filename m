Return-Path: <git-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on dcvr.yhbt.net
X-Spam-Level: 
X-Spam-ASN: AS31976 209.132.180.0/23
X-Spam-Status: No, score=-6.0 required=3.0 tests=AWL,BAYES_00,
	FREEMAIL_FORGED_FROMDOMAIN,FREEMAIL_FROM,HEADER_FROM_DIFFERENT_DOMAINS,
	RCVD_IN_DNSWL_HI,RP_MATCHES_RCVD shortcircuit=no autolearn=ham
	autolearn_force=no version=3.4.0
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by dcvr.yhbt.net (Postfix) with ESMTP id 8AB6C1F437
	for <e@80x24.org>; Sat, 28 Jan 2017 22:36:59 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1752349AbdA1Wg5 (ORCPT <rfc822;e@80x24.org>);
        Sat, 28 Jan 2017 17:36:57 -0500
Received: from mout.web.de ([212.227.15.3]:61549 "EHLO mout.web.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1752304AbdA1Wgz (ORCPT <rfc822;git@vger.kernel.org>);
        Sat, 28 Jan 2017 17:36:55 -0500
Received: from [192.168.178.36] ([79.237.55.102]) by smtp.web.de (mrweb001
 [213.165.67.108]) with ESMTPSA (Nemesis) id 0MfHQo-1cs0as2IXa-00OpTR; Sat, 28
 Jan 2017 23:03:16 +0100
X-Mozilla-News-Host: news://news.public-inbox.org:119
To:     Git List <git@vger.kernel.org>
Cc:     Junio C Hamano <gitster@pobox.com>,
        "brian m. carlson" <sandals@crustytoothpaste.net>
From:   =?UTF-8?Q?Ren=c3=a9_Scharfe?= <l.s.r@web.de>
Subject: [PATCH] use oid_to_hex_r() for converting struct object_id hashes to
 hex strings
Message-ID: <ea6aa07a-3fdc-fcca-706f-4a64a0b354b6@web.de>
Date:   Sat, 28 Jan 2017 23:03:03 +0100
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:45.0) Gecko/20100101
 Thunderbird/45.6.0
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: 7bit
X-Provags-ID: V03:K0:B6vwrTSSPK3CJ6iei4w80CPGxnwelucmE27+KYA7Cr1OfvZdqC9
 tNsoJjE/UF37+or5rZD2jcfhPmkqGRd1KTrtBg1QMlFjTDMhhkDJSJHrNdgCTQ/aps+spt4
 9eLaERytCUhnUE3GQ/FI7TMR4HtBx1STr6yQ9dt0mBWlDlu1zh76uEdvNvgi+ZoQdiWtYIM
 dTrhS0ZJSzkJjshkiDD4A==
X-UI-Out-Filterresults: notjunk:1;V01:K0:hTOWwil9hgs=:diSsXqLceNt8ssU0Asi5BG
 c6F/AIkIVzToMlOGiLFkgDyOlADD7n46GpSGfaT0PZN+1HPKFSV45Lo06qQ/2l8MQax+Ifp6H
 VdoW4XJreUO5CKxlQKB+NyN/y204QWR5/aJobHrPBL18+iU5//RKM1gr+3QwMju1HEO6Ow2mP
 cr52XJunxQl5agARiSbp+gGMjK0IY9RbWHeGhqIWUZEU3Nbjy60dMTqxZU4ZBt7eBN9ijBYqx
 maAz3KuI/+E2Forf4vE1A/DnSP/h3ATGaufodfL+QcTYsmevU7a/t/ldgoEgPiWervQPF8X9p
 zEygVBkgWrhI6X3ObYz/newrsy82yHr4ERX1pfzmur/7Hbhpe7gA3ZtGC3cFa1MdkiG6n9TEP
 /AWJbdhvi5p2z7H3wtYDX1FudM0kGqGO8FaUEmLCbS1lAo6KR25zXAygF6gwxa10oE7j31Al2
 msp4fBSvIGeb75NUkdVHenTfy3aLKluhiFTSj/oMH0FjauQdFdi28kqlaSjMSDpDvyTUm6cpC
 J2lq6PmdhaoZ3EuU6S59BgIKrKhSWKx0tMGP5aj1aWRwnV10FiP8GDN5Iqs6UpsiAZQbsjpHp
 9og0XrsERZ6mvCtGLo0o1WdvgyI+0lMqJcQNdlUBBkjYighLFXM0lkaMjHEvfs+jcNZ+yNWkn
 HIFAUfkH7mNYdvBc+zkuK/ztQGmkb8DS9ucLz0xGV+RqR68X/IDWvM5k6wbqHBlV1RkdCrQ5y
 LOcoOGWu17+gr+p2yb8tzjaXkP75NbTacvZwi6lhenu9k3lFVTYdDeG9pWap22+gDa0H+ehy0
 OEvw3FR
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

Patch generated by Coccinelle and contrib/coccinelle/object_id.cocci.

Signed-off-by: Rene Scharfe <l.s.r@web.de>
---
 builtin/blame.c       | 4 ++--
 builtin/merge-index.c | 2 +-
 builtin/rev-list.c    | 2 +-
 diff.c                | 2 +-
 4 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/builtin/blame.c b/builtin/blame.c
index 126b8c9e5b..cffc626540 100644
--- a/builtin/blame.c
+++ b/builtin/blame.c
@@ -1901,7 +1901,7 @@ static void emit_porcelain(struct scoreboard *sb, struct blame_entry *ent,
 	struct origin *suspect = ent->suspect;
 	char hex[GIT_SHA1_HEXSZ + 1];
 
-	sha1_to_hex_r(hex, suspect->commit->object.oid.hash);
+	oid_to_hex_r(hex, &suspect->commit->object.oid);
 	printf("%s %d %d %d\n",
 	       hex,
 	       ent->s_lno + 1,
@@ -1941,7 +1941,7 @@ static void emit_other(struct scoreboard *sb, struct blame_entry *ent, int opt)
 	int show_raw_time = !!(opt & OUTPUT_RAW_TIMESTAMP);
 
 	get_commit_info(suspect->commit, &ci, 1);
-	sha1_to_hex_r(hex, suspect->commit->object.oid.hash);
+	oid_to_hex_r(hex, &suspect->commit->object.oid);
 
 	cp = nth_line(sb, ent->lno);
 	for (cnt = 0; cnt < ent->num_lines; cnt++) {
diff --git a/builtin/merge-index.c b/builtin/merge-index.c
index ce356b1da1..2d1b6db6bd 100644
--- a/builtin/merge-index.c
+++ b/builtin/merge-index.c
@@ -22,7 +22,7 @@ static int merge_entry(int pos, const char *path)
 		if (strcmp(ce->name, path))
 			break;
 		found++;
-		sha1_to_hex_r(hexbuf[stage], ce->oid.hash);
+		oid_to_hex_r(hexbuf[stage], &ce->oid);
 		xsnprintf(ownbuf[stage], sizeof(ownbuf[stage]), "%o", ce->ce_mode);
 		arguments[stage] = hexbuf[stage];
 		arguments[stage + 4] = ownbuf[stage];
diff --git a/builtin/rev-list.c b/builtin/rev-list.c
index c43decda70..0aa93d5891 100644
--- a/builtin/rev-list.c
+++ b/builtin/rev-list.c
@@ -237,7 +237,7 @@ static int show_bisect_vars(struct rev_list_info *info, int reaches, int all)
 		cnt = reaches;
 
 	if (revs->commits)
-		sha1_to_hex_r(hex, revs->commits->item->object.oid.hash);
+		oid_to_hex_r(hex, &revs->commits->item->object.oid);
 
 	if (flags & BISECT_SHOW_ALL) {
 		traverse_commit_list(revs, show_commit, show_object, info);
diff --git a/diff.c b/diff.c
index f08cd8e033..d91a344908 100644
--- a/diff.c
+++ b/diff.c
@@ -3015,7 +3015,7 @@ static struct diff_tempfile *prepare_temp_file(const char *name,
 			if (!one->oid_valid)
 				sha1_to_hex_r(temp->hex, null_sha1);
 			else
-				sha1_to_hex_r(temp->hex, one->oid.hash);
+				oid_to_hex_r(temp->hex, &one->oid);
 			/* Even though we may sometimes borrow the
 			 * contents from the work tree, we always want
 			 * one->mode.  mode is trustworthy even when
-- 
2.11.0

