From: =?iso-8859-1?Q?Bj=F6rn?= Steinbrink <B.Steinbrink@gmx.de>
Subject: Re: `git-send-email' doesn't specify `Content-Type'
Date: Sat, 10 Nov 2007 13:25:28 +0100
Message-ID: <20071110122528.GA4977@atjola.homenet>
References: <87ode3klc7.fsf@chbouib.org> <Pine.LNX.4.64.0711100052290.4362@racer.site> <20071110101420.GA21353@bulgaria>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: QUOTED-PRINTABLE
Cc: Johannes Schindelin <Johannes.Schindelin@gmx.de>,
	Ludovic =?iso-8859-1?Q?Court=E8s?= <ludo@chbouib.org>,
	git@vger.kernel.org
To: Brian Swetland <swetland@google.com>
X-From: git-owner@vger.kernel.org Sat Nov 10 13:26:18 2007
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git-2@gmane.org
Received: from vger.kernel.org ([209.132.176.167])
	by lo.gmane.org with esmtp (Exim 4.50)
	id 1IqpPl-0007O6-Bo
	for gcvg-git-2@gmane.org; Sat, 10 Nov 2007 13:26:17 +0100
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1752046AbXKJMZv convert rfc822-to-quoted-printable (ORCPT
	<rfc822;gcvg-git-2@m.gmane.org>); Sat, 10 Nov 2007 07:25:51 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1752000AbXKJMZv
	(ORCPT <rfc822;git-outgoing>); Sat, 10 Nov 2007 07:25:51 -0500
Received: from mail.gmx.net ([213.165.64.20]:42192 "HELO mail.gmx.net"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with SMTP
	id S1751733AbXKJMZu (ORCPT <rfc822;git@vger.kernel.org>);
	Sat, 10 Nov 2007 07:25:50 -0500
Received: (qmail invoked by alias); 10 Nov 2007 12:25:29 -0000
Received: from i577BBC4D.versanet.de (EHLO localhost) [87.123.188.77]
  by mail.gmx.net (mp055) with SMTP; 10 Nov 2007 13:25:29 +0100
X-Authenticated: #5039886
X-Provags-ID: V01U2FsdGVkX1+jeoQKLGujlseePBI/KCJpAJK4yUGQsJsWAlVV9I
	OW1mEMaLssJC1q
Content-Disposition: inline
In-Reply-To: <20071110101420.GA21353@bulgaria>
User-Agent: Mutt/1.5.17 (2007-11-01)
X-Y-GMX-Trusted: 0
Sender: git-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/64339>

On 2007.11.10 02:14:20 -0800, Brian Swetland wrote:
> [Johannes Schindelin <Johannes.Schindelin@gmx.de>]
> > Hi,
> >=20
> > On Sat, 10 Nov 2007, Ludovic Court?s wrote:
> >=20
> > > Apparently, `git-send-email' doesn't specify the email's `Content=
-Type',
> > > notably its charset, while it should really add something like:
> > >=20
> > >   Content-Type: text/plain; charset=3DUTF-8
> > >=20
> > > Or did I miss an option or something?
> >=20
> > Apparently.  There was a thread some days ago, about that very issu=
e. =20
> > Please find and read it.
>=20
> The thread I found says that git-send-email should do the right thing=
 if
> there are non-ascii characters, but this does not seem to be the case
> for me.
>=20
> The example I have involves a coworker's name which needs non-ascii
> characters.  They are properly escaped in the From: line generated by
> git-format-patch.  git-send-email puts the generated From: line at th=
e
> top of the body of the email, unescapes it (to utf-8), and proceeds t=
o
> send the email with no Content-Type specified.

You mean that it converts the header field to utf-8? It doesn't do that
here (neither master nor 1.5.3.5) and IIRC that would be invalid anyway=
,
because Content-Type applies to exactly that, content, not headers. You=
r
sample has no non-ASCII characters (or at least I didn't see any), so
git-send-email doesn't add a header to specify a charset.

Bj=F6rn

> This behaviour is observed in 1.5.3.5.  A sample output from
> git-format-patch follows, which demonstrates the problem:
>=20
>=20
> >From 3440baaed3b21138f6fc8b80e03769e3903f9c11 Mon Sep 17 00:00:00 20=
01
> From: =3D?utf-8?q?Arve=3D20Hj=3DC3=3DB8nnev=3DC3=3DA5g?=3D <arve@andr=
oid.com>
> Date: Wed, 7 Nov 2007 22:51:44 -0800
> Subject: [PATCH] hrtimer: Add timer back to pending list if it was re=
activated and has already expired again.
>=20
> This avoids problems with timer hardware that does not respond to tim=
ers set in the past.
>=20
> Signed-off-by: Brian Swetland <swetland@android.com>
> ---
>  kernel/hrtimer.c |   10 ++++++++--
>  1 files changed, 8 insertions(+), 2 deletions(-)
>=20
> diff --git a/kernel/hrtimer.c b/kernel/hrtimer.c
> index 22a2514..7c60769 100644
> --- a/kernel/hrtimer.c
> +++ b/kernel/hrtimer.c
> @@ -1149,8 +1149,14 @@ static void run_hrtimer_softirq(struct softirq=
_action *h)
>  			 * If the timer was rearmed on another CPU, reprogram
>  			 * the event device.
>  			 */
> -			if (timer->base->first =3D=3D &timer->node)
> -				hrtimer_reprogram(timer, timer->base);
> +			if (timer->base->first =3D=3D &timer->node) {
> +				if(hrtimer_reprogram(timer, timer->base)) {
> +					__remove_hrtimer(timer, timer->base,
> +							 HRTIMER_STATE_PENDING, 0);
> +					list_add_tail(&timer->cb_entry,
> +						      &cpu_base->cb_pending);
> +				}
> +			}
>  		}
>  	}
>  	spin_unlock_irq(&cpu_base->lock);
