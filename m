From: Jeff King <peff@peff.net>
Subject: Re: reflogs generated by git-cvsimport
Date: Fri, 31 Jul 2009 16:40:23 -0400
Message-ID: <20090731204023.GB28226@coredump.intra.peff.net>
References: <87fxccagvx.fsf@Astalo.kon.iki.fi>
 <20090731191334.GA12132@coredump.intra.peff.net>
 <87bpn0a9t9.fsf@Astalo.kon.iki.fi>
Mime-Version: 1.0
Content-Type: text/plain; charset=utf-8
Cc: git@vger.kernel.org
To: Kalle Olavi Niemitalo <kon@iki.fi>
X-From: git-owner@vger.kernel.org Fri Jul 31 22:40:36 2009
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git-2@gmane.org
Received: from vger.kernel.org ([209.132.176.167])
	by lo.gmane.org with esmtp (Exim 4.50)
	id 1MWyu3-0001pW-Ft
	for gcvg-git-2@gmane.org; Fri, 31 Jul 2009 22:40:35 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1751739AbZGaUk1 (ORCPT <rfc822;gcvg-git-2@m.gmane.org>);
	Fri, 31 Jul 2009 16:40:27 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1751611AbZGaUk0
	(ORCPT <rfc822;git-outgoing>); Fri, 31 Jul 2009 16:40:26 -0400
Received: from peff.net ([208.65.91.99]:41320 "EHLO peff.net"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S1751606AbZGaUk0 (ORCPT <rfc822;git@vger.kernel.org>);
	Fri, 31 Jul 2009 16:40:26 -0400
Received: (qmail 30014 invoked by uid 107); 31 Jul 2009 20:42:34 -0000
Received: from coredump.intra.peff.net (HELO coredump.intra.peff.net) (10.0.0.2)
    by peff.net (qpsmtpd/0.40) with (AES128-SHA encrypted) SMTP; Fri, 31 Jul 2009 16:42:34 -0400
Received: by coredump.intra.peff.net (sSMTP sendmail emulation); Fri, 31 Jul 2009 16:40:23 -0400
Content-Disposition: inline
In-Reply-To: <87bpn0a9t9.fsf@Astalo.kon.iki.fi>
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/124597>

On Fri, Jul 31, 2009 at 11:15:14PM +0300, Kalle Olavi Niemitalo wrote:

> That patch does not work because the $commit_read and
> $commit_write file handles fall out of scope too early.
> Those and $pid could be returned from the do {...} as
> a list, but I think it's easier to remove the "do", declare
> the variables above the block, and assign them in the block.

Oops, indeed, I clearly did not look closely. But I see you understood
what I was trying to say, and I think you are right that it is probably
cleaner to just "my" them right before the block.

> Also, there's $ENV{'TZ'}="UTC" at the beginning of the script
> and it affects the reflogs too.  This is the annoying part.

Since that is covering the whole script, it is obviously a harder issue
and should probably be a separate patch from the GIT_COMMITTER_*
information.

> The script runs numerous subprocesses and it is not clear to
> me which of those need TZ=UTC and which ones should use the
> original TZ:

Sadly, there is nothing useful in the commit history as the TZ setting
goes all the way back to the script being added. I would guess it is
there to convince cvs to give us a consistent time, since its log output
usually comes out in the local timezone (though since cvsimport is based
on cvsps, I would assume cvsps handles this sanely).

I suspect if you set it for cvs and cvsps, that would be sufficient. The
rest of git should use the original.

-Peff
