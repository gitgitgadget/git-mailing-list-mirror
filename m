From: David Bremner <bremner@unb.ca>
Subject: Bug#469250: Commit f5bbc322 to git broke pre-commit hooks which read stdin
Date: Tue, 04 Mar 2008 09:38:21 +0100
Message-ID: <0tableanpe.wl%bremner@pivot.cs.unb.ca>
Reply-To: David Bremner <bremner-dated-1205829504.6c9c55@pivot.cs.unb.ca>, 469250@bugs.debian.org
Mime-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Cc: git@vger.kernel.org, 469250@bugs.debian.org
To: Kristian =?UTF-8?Q?H=C3=B8gsberg?= <krh@redhat.com>
X-From: bounce-debian-bugs-dist=glddb-debian-bugs-dist=m.gmane.org@lists.debian.org Tue Mar 04 09:45:00 2008
Return-path: <bounce-debian-bugs-dist=glddb-debian-bugs-dist=m.gmane.org@lists.debian.org>
Envelope-to: glddb-debian-bugs-dist@m.gmane.org
Received: from liszt.debian.org ([82.195.75.100])
	by lo.gmane.org with esmtp (Exim 4.50)
	id 1JWSlf-0001AB-QS
	for glddb-debian-bugs-dist@m.gmane.org; Tue, 04 Mar 2008 09:44:59 +0100
Received: from localhost (localhost [127.0.0.1])
	by liszt.debian.org (Postfix) with QMQP
	id DDE6313A5609; Tue,  4 Mar 2008 08:44:26 +0000 (UTC)
Old-Return-Path: <debbugs@rietz.debian.org>
X-Original-To: lists-debian-bugs-dist@liszt.debian.org
Delivered-To: lists-debian-bugs-dist@liszt.debian.org
Received: from localhost (localhost [127.0.0.1])
	by liszt.debian.org (Postfix) with ESMTP id 99B0213A56B9
	for <lists-debian-bugs-dist@liszt.debian.org>; Tue,  4 Mar 2008 08:44:26 +0000 (UTC)
Received: from liszt.debian.org ([127.0.0.1])
	by localhost (lists.debian.org [127.0.0.1]) (amavisd-new, port 2525)
	with ESMTP id 11554-100
	for <lists-debian-bugs-dist@liszt.debian.org>;
	Tue, 4 Mar 2008 08:44:22 +0000 (UTC)
Received: from rietz.debian.org (rietz.debian.org [140.211.166.43])
	by liszt.debian.org (Postfix) with ESMTP id 348EC13A5609;
	Tue,  4 Mar 2008 08:44:22 +0000 (UTC)
Received: from debbugs by rietz.debian.org with local (Exim 4.63)
	(envelope-from <debbugs@rietz.debian.org>)
	id 1JWSit-0002fu-7w; Tue, 04 Mar 2008 08:42:07 +0000
X-Loop: owner@bugs.debian.org
Resent-From: David Bremner <bremner@unb.ca>
Resent-To: debian-bugs-dist@lists.debian.org
Resent-CC: Joey Hess <joeyh@debian.org>
Resent-Date: Tue, 04 Mar 2008 08:42:05 +0000
Resent-Message-ID: <handler.469250.B469250.120461991013977@bugs.debian.org>
X-Debian-PR-Message: report 469250
X-Debian-PR-Package: metastore
X-Debian-PR-Keywords: patch
X-Debian-PR-Source: metastore
Received: via spool by 469250-submit@bugs.debian.org id=B469250.120461991013977
          (code B ref 469250); Tue, 04 Mar 2008 08:42:05 +0000
Received: (at 469250) by bugs.debian.org; 4 Mar 2008 08:38:30 +0000
Received: from pivot.cs.unb.ca ([131.202.240.57])
	by rietz.debian.org with esmtp (Exim 4.63)
	(envelope-from <bremner-dated-1205224704.4f8b71@pivot.cs.unb.ca>)
	id 1JWSfO-0003Sb-Bm
	for 469250@bugs.debian.org; Tue, 04 Mar 2008 08:38:30 +0000
Received: from bremner by pivot.cs.unb.ca with local (Exim 4.68)
	(envelope-from <bremner-dated-1205224704.4f8b71@pivot.cs.unb.ca>)
	id 1JWSfI-0006i7-HC
	for 469250@bugs.debian.org; Tue, 04 Mar 2008 04:38:24 -0400
Received: by pivot.cs.unb.ca (tmda-sendmail, from uid 1266);
	Tue, 04 Mar 2008 04:38:23 -0400
Received: from bremner (helo=pivot.cs.unb.ca)
	by pivot.cs.unb.ca with local-esmtp (Exim 4.68)
	(envelope-from <bremner@pivot.cs.unb.ca>)
	id 1JWSfG-0006hw-R6; Tue, 04 Mar 2008 04:38:23 -0400
User-Agent: SEMI/1.14.6 (Maruoka) FLIM/1.14.9 =?UTF-8?Q?(Goj=C5=8D)?=
	APEL/10.7 Emacs/22.1 (i486-pc-linux-gnu) MULE/5.0 (SAKAKI)
X-Delivery-Agent: TMDA/1.1.11 (Ladyburn)
X-TMDA-Fingerprint: w6RxxC4decQWid4UV8fopgXwtp4
X-Primary-Address: bremner@unb.ca
X-Tmda-Bare: David Bremner <bremner@pivot.cs.unb.ca>
Resent-Date: Tue, 04 Mar 2008 08:42:07 +0000
X-Virus-Scanned: at lists.debian.org with policy bank bug
X-Spam-Status: No, score=-5.97 tagged_above=3.6 required=5.3
	tests=[BAYES_00=-2, IMPRONONCABLE_2=1, LDO_WHITELIST=-5,
	UNWANTED_LANGUAGE_BODY=0.03]
X-Spam-Level: 
X-Debian-Message: from BTS
X-Mailing-List: <debian-bugs-dist@lists.debian.org> archive/latest/297760
X-Loop: debian-bugs-dist@lists.debian.org
List-Id: <debian-bugs-dist.lists.debian.org>
List-Post: <mailto:debian-bugs-dist@lists.debian.org>
List-Help: <mailto:debian-bugs-dist-request@lists.debian.org?subject=help>
List-Subscribe: <mailto:debian-bugs-dist-request@lists.debian.org?subject=subscribe>
List-Unsubscribe: <mailto:debian-bugs-dist-request@lists.debian.org?subject=unsubscribe>
Precedence: list
Resent-Sender: debian-bugs-dist-request@lists.debian.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/76054>


It looks like line 435 of builtin-commit.c disables stdin for hooks
(with the disclaimer that I first looked at the git source ten minutes
ago).

	   hook.no_stdin = 1

I'm not sure if this was by design, but just so you know, this breaks
people's hooks.  In particular the default metastore pre-commit hook
no longer works.  I didn't find anything relevant in the docs [1].

David

[1]: http://www.kernel.org/pub/software/scm/git/docs/hooks.html
