Return-Path: <git-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on dcvr.yhbt.net
X-Spam-Level: 
X-Spam-ASN: AS31976 209.132.180.0/23
X-Spam-Status: No, score=-2.6 required=3.0 tests=AWL,BAYES_00,
	FREEMAIL_FORGED_FROMDOMAIN,FREEMAIL_FROM,HEADER_FROM_DIFFERENT_DOMAINS,
	RCVD_IN_DNSWL_HI,T_RP_MATCHES_RCVD shortcircuit=no autolearn=no
	autolearn_force=no version=3.4.0
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by dcvr.yhbt.net (Postfix) with ESMTP id 324A71F404
	for <e@80x24.org>; Thu, 15 Feb 2018 00:29:38 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1032284AbeBOA3f (ORCPT <rfc822;e@80x24.org>);
        Wed, 14 Feb 2018 19:29:35 -0500
Received: from mout.gmx.net ([212.227.17.20]:34303 "EHLO mout.gmx.net"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1032237AbeBOA3e (ORCPT <rfc822;git@vger.kernel.org>);
        Wed, 14 Feb 2018 19:29:34 -0500
Received: from MININT-TB4PCE7.southpacific.corp.microsoft.com
 ([37.201.195.115]) by mail.gmx.com (mrgmx103 [212.227.17.168]) with ESMTPSA
 (Nemesis) id 0MBnPX-1eug06419L-00AoTe; Thu, 15 Feb 2018 01:29:30 +0100
Date:   Thu, 15 Feb 2018 01:29:27 +0100 (STD)
From:   Johannes Schindelin <johannes.schindelin@gmx.de>
X-X-Sender: virtualbox@MININT-6BKU6QN.europe.corp.microsoft.com
To:     git@vger.kernel.org
cc:     Junio C Hamano <gitster@pobox.com>
Subject: [PATCH 1/2] apply: demonstrate a problem applying svn diffs
In-Reply-To: <cover.1518654532.git.johannes.schindelin@gmx.de>
Message-ID: <24000fd64887994bfc5b70b5e4bd3d8c92661f81.1518654532.git.johannes.schindelin@gmx.de>
References: <cover.1518654532.git.johannes.schindelin@gmx.de>
User-Agent: Alpine 2.21.1 (DEB 209 2017-03-23)
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
X-Provags-ID: V03:K0:ihHu6VLVyQllxn892Pdip8d+oRiNwNz4MH0fA0vu/WZy2Kk2KHi
 1JjV58TgEjusnhsnIJBgh/J3psrfHauolgDN8AVHiNj75Bgk0TaHcVkxwyQ5zdJxqrG0ybG
 6UyuHeafI9MD1QJqWFRN0AstdbYYLoUaj9OExKRWQBUSVM5k4GfPKmZ4POUThEaT3yATUtt
 0i4gqLR2f6vU9bkHy0umQ==
X-UI-Out-Filterresults: notjunk:1;V01:K0:tcZUKEZt0wc=:6Rl/ecUvQlUdQm7IxZl6FP
 IMTCn8VRRqNAeOcQw9WIWBezJJJoVgqYD8rj+xBDh/iOW3i+ElHwd781zn3W1Xqhdc9Rvw3xw
 U1qkNDjX/zDwoTFT404yJKBXBDDf7G3fAesSvdA94tR0FKYVJTiLXF9v3qPro2/AQtHAmHn0/
 tcPj5TSUVYzI8IiAwnrRef+k1uebhk1/Er73DedT59+Qe4Y97purEKUo0WM4krOEo1oLlNvAI
 5wsjxTJv7Dpb1w06Wfcp11amh+ScOln6703r7moxX+NRb6VxxWW2eivoN5US+doJVk2hXlf7d
 /Qr6vkWcoDr0acuwysyge9Khfq6+Au8WyRtuHANoVvJ2rG/zUyAFkOkG+xjr596QU2/szE5Cw
 LpSiTXFqJHRl6F2MEpK9hGdhD10SzNHxQIvorwAY8Gg/Ab9ZtlseDIAQo3hFrLEfuoEOmRA4q
 w0tlGXLVhnsk6kIRDv1nmt7IYCUQhESBwUWmMwc7V2h5bRxGFLla/0F+z7JK9lDFQJVgn/qCg
 i096IVXqAVbLZZURMG0vw1pnRUZBUmfzUzvJ3LZ2FWyc1/nD2fs+nau5pHFj0qdYi/OceE3lO
 /CrKvXush938B0527Vxn6JAaS/t3tN2lLXOlw+QJocboopFtzNy+pgKHH6GHJhcGkLaOa7OsP
 yH2LS/cD1c5FXEdh1uuoSnDBuAjiiP0m1AuYhbeqyEfqKL2aY13OUNtSx98sNHiWk6feZRLRw
 YmOyM7u4VVY0d2u8BKicllOhYF4Km7gcF1y3kKl0yrWVshLDACfDrIi4OzjDGahBXV9uR8LYB
 8qGB/KWiznDkI2Sx6Eb+Ng8fMqwJ9Y0HLhUM/6WBpJllYo6NHc=
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

Subversion generates diffs that contain funny ---/+++ lines containing
more than just the file names. Example:

	--- a/trunk/README	(revision 4711)
	+++ /dev/null	(nonexistent)

Let's add a test case demonstrating that apply cannot handle the
/dev/null line (although it can handle the trunk/README line just fine).

Reported in https://github.com/git-for-windows/git/issues/1489

Signed-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>
---
 t/t4135-apply-weird-filenames.sh | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/t/t4135-apply-weird-filenames.sh b/t/t4135-apply-weird-filenames.sh
index 27cb0009fb1..b14b8085786 100755
--- a/t/t4135-apply-weird-filenames.sh
+++ b/t/t4135-apply-weird-filenames.sh
@@ -89,4 +89,21 @@ test_expect_success 'traditional, whitespace-damaged, colon in timezone' '
 	test_cmp expected "post image.txt"
 '
 
+cat >diff-from-svn <<\EOF
+Index: Makefile
+===================================================================
+diff --git a/branches/Makefile
+deleted file mode 100644
+--- a/branches/Makefile	(revision 13)
++++ /dev/null	(nonexistent)
+@@ +1 0,0 @@
+-
+EOF
+
+test_expect_failure 'apply handles a diff generated by Subversion' '
+	>Makefile &&
+	git apply -p2 diff-from-svn &&
+	test_path_is_missing Makefile
+'
+
 test_done
-- 
2.16.1.windows.1


