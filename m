From: Jeff King <peff@peff.net>
Subject: Re: Bug in gitk: can't unset "idinlist(...) ..."
Date: Fri, 10 Aug 2007 13:32:42 -0400
Message-ID: <20070810173242.GA23628@coredump.intra.peff.net>
References: <20070810154108.GA779@ruiner>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: Brian Hetro <whee@smaertness.net>, git@vger.kernel.org
To: Junio C Hamano <gitster@pobox.com>
X-From: git-owner@vger.kernel.org Fri Aug 10 19:32:57 2007
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git@gmane.org
Received: from vger.kernel.org ([209.132.176.167])
	by lo.gmane.org with esmtp (Exim 4.50)
	id 1IJYLz-0002xF-Sl
	for gcvg-git@gmane.org; Fri, 10 Aug 2007 19:32:52 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1753731AbXHJRcq (ORCPT <rfc822;gcvg-git@m.gmane.org>);
	Fri, 10 Aug 2007 13:32:46 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1753072AbXHJRcq
	(ORCPT <rfc822;git-outgoing>); Fri, 10 Aug 2007 13:32:46 -0400
Received: from 66-23-211-5.clients.speedfactory.net ([66.23.211.5]:1246 "EHLO
	peff.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S1752792AbXHJRcp (ORCPT <rfc822;git@vger.kernel.org>);
	Fri, 10 Aug 2007 13:32:45 -0400
Received: (qmail 4830 invoked by uid 111); 10 Aug 2007 17:32:51 -0000
X-Spam-Status: No, hits=-1.2 required=15.0
	tests=ALL_TRUSTED,AWL
X-Spam-Check-By: peff.net
Received: from coredump.intra.peff.net (HELO coredump.intra.peff.net) (10.0.0.2)
    by peff.net (qpsmtpd/0.32) with SMTP; Fri, 10 Aug 2007 13:32:51 -0400
Received: by coredump.intra.peff.net (sSMTP sendmail emulation); Fri, 10 Aug 2007 13:32:42 -0400
Content-Disposition: inline
In-Reply-To: <20070810154108.GA779@ruiner>
Sender: git-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/55559>

On Fri, Aug 10, 2007 at 11:41:08AM -0400, Brian Hetro wrote:

> I have a problem with gitk not being able to show one of my
> repositories (git version 1.5.3.rc4.41.g7efe).  I get this error while
> gitk starts:
> 
> can't unset "idinlist(f1d795add789ec43d3ccf1d35f3c39fb464f6e72)": no
> such element in array

Junio,

I did a little digging on this bug, since it was so similar to the
duplicate parent errors we were getting a few weeks ago. As it turns
out, Brian's repository, generated by hg2git, actually has commit
objects with duplicate parents in them. Older versions of git used to
remove duplicate parents for all commits, but due to your commits
11d65967 and 1ed84157, we now do it just for history simplification.
Which is why he was able to bisect it to 1ed84157, even though it is
perhaps not a git bug.

So maybe the right attitude is "hg2git should not be generating such
broken commits" (or "gitk should not barf on such broken commits" :) ),
but I thought I would mention it as an additional data point for those
changes. Should git handle duplicate parents of this fashion more
robustly? Or should we just assume that they should never have been
generated in the first place?

-Peff
