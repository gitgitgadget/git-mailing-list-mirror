From: Sitaram Chamarty <sitaramc@gmail.com>
Subject: Re: git pre-push hook to restrict master branch push !!!
Date: Mon, 11 Jun 2012 17:40:37 +0530
Message-ID: <CAMK1S_jrahLs_86hksb6_pXAxWnrCQ=myfD-mLTpLFjnS3c0kA@mail.gmail.com>
References: <20120611164851.0e4db9f0@shiva.selfip.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Cc: git@vger.kernel.org
To: "J. Bakshi" <joydeep.bakshi@infoservices.in>
X-From: git-owner@vger.kernel.org Mon Jun 11 14:10:49 2012
Return-path: <git-owner@vger.kernel.org>
Envelope-to: gcvg-git-2@plane.gmane.org
Received: from vger.kernel.org ([209.132.180.67])
	by plane.gmane.org with esmtp (Exim 4.69)
	(envelope-from <git-owner@vger.kernel.org>)
	id 1Se3SE-0002sT-JK
	for gcvg-git-2@plane.gmane.org; Mon, 11 Jun 2012 14:10:42 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1754129Ab2FKMKi (ORCPT <rfc822;gcvg-git-2@m.gmane.org>);
	Mon, 11 Jun 2012 08:10:38 -0400
Received: from mail-ob0-f174.google.com ([209.85.214.174]:52394 "EHLO
	mail-ob0-f174.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1753606Ab2FKMKi (ORCPT <rfc822;git@vger.kernel.org>);
	Mon, 11 Jun 2012 08:10:38 -0400
Received: by obbtb18 with SMTP id tb18so6656109obb.19
        for <git@vger.kernel.org>; Mon, 11 Jun 2012 05:10:37 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20120113;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :cc:content-type;
        bh=SyX4Bb67kIzWKvVV5V/BfgQZobcQTnIgJMBdzwCRH7g=;
        b=k24iOmxca2Pv1UxD9qcJO8FQ1Hhdcborrad/nofjhnZbwatvJD90AH4Lq/U9h5Lzf8
         BbABdwUFxjtEKTit92XOAhy25/tf/dhILhhKGEJssUzVg+2ivGSyr0Byt3CklhL9H7oc
         rdG8u6q+6xY/clg/kQilnqjYZZUcr7F58MgMpUpcEcVBLvxtNuE0eE2whhMOSDV++0vt
         Mx4wa9LuCXIttYwM/hqRnjTKXpfiiBidoeLOMJsjujE1WbE9ekPXcee2FaCtwOCBepWs
         y2izLEU0qm4kWOivK9iD3c2bSxIwATC73OYXMgU7SFSIbbeKBrJfkZ4Uc1Etn88TjGPU
         74DQ==
Received: by 10.182.51.100 with SMTP id j4mr16415680obo.78.1339416637637; Mon,
 11 Jun 2012 05:10:37 -0700 (PDT)
Received: by 10.182.108.67 with HTTP; Mon, 11 Jun 2012 05:10:37 -0700 (PDT)
In-Reply-To: <20120611164851.0e4db9f0@shiva.selfip.org>
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org
Archived-At: <http://permalink.gmane.org/gmane.comp.version-control.git/199650>

On Mon, Jun 11, 2012 at 4:48 PM, J. Bakshi
<joydeep.bakshi@infoservices.in> wrote:
> Hello list,
>
> I have a central server where git repos are located and based on http base push/pull.
> authentication is done by a text based password file, generated by htpasswd.
>
> I am searching for a server side hook (pre-push) which can prevent all push to master,
> except few users found at that password file generated by htpasswd. Is there any such hook
> available ? Some suggest to use gitolite, but it also based on the hooks to do the same.

If you don't want to use gitolite, you can roll  your own update hook.
 It can be as simple as

  - check $REMOTE_USER to see if the name is in the "allowed" list
(your choice how you want to maintain that list).  If allowed, 'exit
0".
  - otherwise check $1 (argument 1) to see if it is
"refs/heads/master".  If it is, "exit 1".

How difficult is that?
