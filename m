Return-Path: <git-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on dcvr.yhbt.net
X-Spam-Level: 
X-Spam-ASN: AS31976 209.132.180.0/23
X-Spam-Status: No, score=-3.0 required=3.0 tests=AWL,BAYES_00,
	FREEMAIL_FORGED_FROMDOMAIN,FREEMAIL_FROM,HEADER_FROM_DIFFERENT_DOMAINS,
	RCVD_IN_DNSWL_HI,RP_MATCHES_RCVD shortcircuit=no autolearn=ham
	autolearn_force=no version=3.4.0
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by dcvr.yhbt.net (Postfix) with ESMTP id CBED120A10
	for <e@80x24.org>; Sun,  1 Oct 2017 14:44:15 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1751125AbdJAOoN (ORCPT <rfc822;e@80x24.org>);
        Sun, 1 Oct 2017 10:44:13 -0400
Received: from mout.web.de ([212.227.15.14]:60022 "EHLO mout.web.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1751063AbdJAOoM (ORCPT <rfc822;git@vger.kernel.org>);
        Sun, 1 Oct 2017 10:44:12 -0400
Received: from [192.168.178.36] ([91.20.57.42]) by smtp.web.de (mrweb001
 [213.165.67.108]) with ESMTPSA (Nemesis) id 0MXpqx-1dnGXx2ZCJ-00Wr4x; Sun, 01
 Oct 2017 16:44:06 +0200
To:     Git List <git@vger.kernel.org>
Cc:     Junio C Hamano <gitster@pobox.com>, Duy Nguyen <pclouds@gmail.com>
From:   =?UTF-8?Q?Ren=c3=a9_Scharfe?= <l.s.r@web.de>
Subject: [PATCH] path: use strbuf_add_real_path()
Message-ID: <7f710738-98e1-f075-9369-113296e077bb@web.de>
Date:   Sun, 1 Oct 2017 16:44:06 +0200
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0) Gecko/20100101
 Thunderbird/52.3.0
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
Content-Transfer-Encoding: 7bit
X-Provags-ID: V03:K0:JWBgx8VVqC8wkxgQhsUfOaYWxi1e/x4d0NK4OnPVwctUMCee3qF
 vBPeNZo7Q+BP/5MpgTQiJLCzeuFYAWFEt0egTi17PyVmblxdBCeyBtACTvorlG4+F5Y9Hv0
 +N+fmaLRaOfh8f5hfq830be/DAttTjqfqeAnZcOEI7Qqo/3CW1N3uplKnSl1GXEYSnWO2nv
 tqmIXHBDQlpphDb6gkScw==
X-UI-Out-Filterresults: notjunk:1;V01:K0:STHyMTliLag=:NEYcm/37eWy1KB6lOPchnz
 dR8e/TkR0CWuDWRmkL/xa1i1sd7z3iTvuFx7X//CTMhkLdJqUAkWHbLQ31leW824XL4hT7C1O
 JEtfnxgyP3cl6j2YM9QkXXyXnfAamvLz20fwVZN6Gvd0Z1DbW2I+wdO8amgnH4OObOYzpPgCc
 G3WrZ3XyGkyaSlRPoGlYkfG+bsCgMyiBES/JyZy4M4+IoRJJAyogoSHWFf5x2zvhqqR4L8EtZ
 IT/vMH9ayf/GZ7f2EoWMrp7kQrnD25p41OKV9cm3MkGZw28sX5KB0Zu1S7aMlZuamfG/xkUIJ
 +NIXg2rut+0Scp9p/Z2MKwo8R4qtXl+s30XHwL95viJPnJM1R8GMtKN7L9uaL9byh5da1z6+o
 VhmvHNJbVna1vZ0B3PPZf5iH4FCfww84oxmPZHJUQ0cHeBiLfhqtuqIk40uisihRP8s9m6RNd
 Z0sT0dEbM4Ps9/xmmFA6+R1fLv+zBQvfoMVXYiiD0AIfgAXW+T5u6qDCwA5IxEDlrUOZ9wD8G
 sK9RfgMJlfGaJsncSARaDrJf+ek45KeiFZ48BgyZ2gevjXDym3xGrVFVmsxP22XyClrzTCpII
 IvXOnFOYOvAnZIukvgT28VdFnwKH0qU8nvyTAxkx3pI/7AF0DjbJvp5+4v4V9W1y5+QqYOBHU
 Hqh02zf2hJ/zJ3W205vf1aiOG/ERbTvptMJ009k0L1y8ierWh7L+18ZK704qHh9VzmjZQGVbR
 V30z85Egp4lN7kI886hiRiDENfBPr2FH84dBKv5ruvbHbf52/GgXhW2BTsxlI7ywUwI6RIYpf
 Iy5nTnNdPfYrPNqPLgwWncsWFZuRvbH+DaNevSB0/pf8mpj/L8=
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

Avoid a string copy to a static buffer by using strbuf_add_real_path()
instead of combining strbuf_addstr() and real_path().

Patch generated by Coccinelle and contrib/coccinelle/strbuf.cocci.

Signed-off-by: Rene Scharfe <l.s.r@web.de>
---
 path.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/path.c b/path.c
index b533ec938d..bf096c411c 100644
--- a/path.c
+++ b/path.c
@@ -717,7 +717,7 @@ char *expand_user_path(const char *path, int real_home)
 			if (!home)
 				goto return_null;
 			if (real_home)
-				strbuf_addstr(&user_path, real_path(home));
+				strbuf_add_real_path(&user_path, home);
 			else
 				strbuf_addstr(&user_path, home);
 #ifdef GIT_WINDOWS_NATIVE
-- 
2.14.2
