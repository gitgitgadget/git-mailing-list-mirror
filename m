Return-Path: <git-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on dcvr.yhbt.net
X-Spam-Level: 
X-Spam-ASN: AS31976 209.132.180.0/23
X-Spam-Status: No, score=-2.8 required=3.0 tests=BAYES_00,DKIM_SIGNED,
	DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FORGED_FROMDOMAIN,FREEMAIL_FROM,
	HEADER_FROM_DIFFERENT_DOMAINS,RCVD_IN_DNSWL_HI,T_RP_MATCHES_RCVD
	shortcircuit=no autolearn=no autolearn_force=no version=3.4.0
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by dcvr.yhbt.net (Postfix) with ESMTP id 6EA251F406
	for <e@80x24.org>; Wed,  3 Jan 2018 12:36:27 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1751733AbeACMgY (ORCPT <rfc822;e@80x24.org>);
        Wed, 3 Jan 2018 07:36:24 -0500
Received: from mail-wr0-f177.google.com ([209.85.128.177]:37398 "EHLO
        mail-wr0-f177.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1751335AbeACMgX (ORCPT <rfc822;git@vger.kernel.org>);
        Wed, 3 Jan 2018 07:36:23 -0500
Received: by mail-wr0-f177.google.com with SMTP id f8so1423156wre.4
        for <git@vger.kernel.org>; Wed, 03 Jan 2018 04:36:23 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:from:date:message-id:subject:to;
        bh=0Q+LDSDbqbUr3dlYhyASugOWA6C09Y6r/kRyPsG6ENc=;
        b=JfhBMtMl58PrRpXP32ugyL86Nbu/QlTVFdaDbM6mcW0XasTNDy5oWCJHBQ/MGmjFx0
         zwoLxDEH0Rrhjz6+BiSWyM/B5IciNm+2M56C+CR9QZuoKFW1sHif3qLnQNNqizTV+0Ej
         uaFi4ZHbfA58ULC+9qO/sdupxPs/Ac7u4U/LioP++P1fg7wcnT4XhC1SgdAHYXIvGAZL
         W6NtZILrB2WM4fwAg63qK4d3KWPBq9Swh430FUz2HLwbVq++oz9IFCXJpJbwaT0CL7BQ
         0vqq92hPr3yhT42KTBr7w4xMxbqHdShZUjSduhx5LCg4/CYWSwHTcpe4YmVAPtUqF547
         4A8w==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:from:date:message-id:subject:to;
        bh=0Q+LDSDbqbUr3dlYhyASugOWA6C09Y6r/kRyPsG6ENc=;
        b=pz0D3LdmJMSkGXYiy4KCaLpSqyHHe49unyzHdJqlG//QBDgeSiKXR1FqJHLroDu1m6
         gDnaglSgWoCILnLVddGg0vrS9J2YQjEHcd6bDIx3HBv9ykvqCQ2+clZ+AYKsk2sjSm3f
         UWc3NBhIWC53j9YW9jJJTrhBS+3WQPE0qovBSBsjiQO8ZEZQIg6iK4wu7sFydnmBFgZh
         ytTfORTfioVIT0/KnkE7PrX22gHwBhJ/xSQygeC8NJTa76ShhUSjDnpmBUztjK5DNB6m
         iIj2BnzygWfr5W3xcbMIieaqhH6R1rqBhjB6V9pxANNOTiep8mRmkauzJHpJ28be+NN4
         6RCA==
X-Gm-Message-State: AKGB3mLi2wpFkZw0BMKbO7mO2sgAtAeO2MFhTGdPnhDN+K95pIUS+yax
        +ZbZqY4oDmoVDRMSF5hCuoAqIrangjZBJYqeWuTZkA==
X-Google-Smtp-Source: ACJfBovdtXAOO2M0RJDQPQmWEXLDD7h+LW3etzoJf6jcybBBen4SkXNq1SfFGi3sR6OA0fPaM+o4rIWlBN1NeTzz10w=
X-Received: by 10.223.146.199 with SMTP id 65mr1453256wrn.259.1514982982261;
 Wed, 03 Jan 2018 04:36:22 -0800 (PST)
MIME-Version: 1.0
Received: by 10.223.197.193 with HTTP; Wed, 3 Jan 2018 04:36:21 -0800 (PST)
From:   Yasushi SHOJI <yasushi.shoji@gmail.com>
Date:   Wed, 3 Jan 2018 21:36:21 +0900
Message-ID: <CAELBRWKYZK2tVhGZSExXRXrRB94jFN-4N3d=iKARzEsqLu7k1g@mail.gmail.com>
Subject: [BUG] v2.16.0-rc0 seg faults when git bisect skip
To:     git@vger.kernel.org
Content-Type: text/plain; charset="UTF-8"
Sender: git-owner@vger.kernel.org
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

Hi,

git version 2.16.0.rc0 seg faults on my machine when I

git bisect skip

Here is a back trace:

$ /opt/mygit/bin/git --version
git version 2.16.0.rc0

$ /opt/mygit/bin/git bisect skip
Segmentation fault (core dumped)

$ gdb /opt/mygit/bin/git core
GNU gdb (Debian 7.12-6+b1) 7.12.0.20161007-git
Copyright (C) 2016 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from /opt/mygit/bin/git...done.
[New LWP 5211]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Core was generated by `git bisect--helper --next-all'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x000055a73107f900 in best_bisection_sorted (list=0x0, nr=0) at bisect.c:232
232 free_commit_list(p->next);
(gdb) bt
#0  0x000055a73107f900 in best_bisection_sorted (list=0x0, nr=0) at bisect.c:232
#1  0x000055a73107fc0f in do_find_bisection (list=0x0, nr=0,
weights=0x55a731b6ffd0, find_all=1) at bisect.c:361
#2  0x000055a73107fcf4 in find_bisection (commit_list=0x7ffe8750d4d0,
reaches=0x7ffe8750d4c4, all=0x7ffe8750d4c0, find_all=1) at
bisect.c:400
#3  0x000055a73108128d in bisect_next_all (prefix=0x0, no_checkout=0)
at bisect.c:969
#4  0x000055a730fd5238 in cmd_bisect__helper (argc=0,
argv=0x7ffe8750e230, prefix=0x0) at builtin/bisect--helper.c:140
#5  0x000055a730fcbc76 in run_builtin (p=0x55a73145c778
<commands+120>, argc=2, argv=0x7ffe8750e230) at git.c:346
#6  0x000055a730fcbf40 in handle_builtin (argc=2, argv=0x7ffe8750e230)
at git.c:554
#7  0x000055a730fcc0e8 in run_argv (argcp=0x7ffe8750e0ec,
argv=0x7ffe8750e0e0) at git.c:606
#8  0x000055a730fcc29b in cmd_main (argc=2, argv=0x7ffe8750e230) at git.c:683
#9  0x000055a731068d9e in main (argc=3, argv=0x7ffe8750e228) at common-main.c:43
(gdb) p p
$1 = (struct commit_list *) 0x0

As you can see, the code dereferences to the 'next' while 'p' is NULL.

I'm sure I did 'git bisect good' after git _found_ bad commit.  Then I
typed 'git bisect skip' on the commit 726804874 of guile repository.
If that matters at all.

I haven't touched guile repo to preserve the current state.

Let me know if you need any other info.
-- 
          yashi
